SELECT.HRGT_DAILY_PATIENT_DTL.RETRIEVE_FOR_TODAY=SELECT a.hrgnum_puk AS patcrno, INITCAP (A.HRGSTR_FNAME) AS PATFIRSTNAME, INITCAP (A.HRGSTR_MNAME) AS PATMIDDLENAME, INITCAP (A.HRGSTR_LNAME) AS PATLASTNAME, A.GNUM_GENDER_CODE AS PATGENDERCODE, A.GNUM_MARITAL_STATUS_CODE AS PATMARITALSTATUSCODE, TO_CHAR (A.HRGDT_DOB, 'dd-Mon-yyyy') AS PATDOB, INITCAP (A.HRGSTR_FATHER_NAME) AS PATGUARDIANNAME, INITCAP (A.HRGSTR_MOMNAME) AS PATMOMNAME, a.hrgnum_episode_code AS episodecode, a.hrgnum_visit_no AS episodevisitno,a.hrgnum_episode_type_code AS episodetypecode, a.hgnum_deptunitcode AS departmentunitcode, a.hrgnum_que_no AS queno,a.hrgnum_is_old AS patisold, TO_CHAR (a.hrgdt_episode_date, 'dd-Mon-yyyy') AS episodedate, hgnum_treatment_cat_code AS patsecondarycatcode, hgnum_patient_cat_code AS patprimarycatcode, (SELECT INITCAP (e.gstr_dept_name) FROM GBLT_DEPARTMENT_MST e WHERE e.gnum_dept_code \= a.gnum_dept_code AND e.GNUM_ISVALID\=1) department FROM HRGT_DAILY_PATIENT_DTL A WHERE TRUNC(GDT_ENTRY_DATE)\=TRUNC(SYSDATE)

UPDATE.HRGT_DAILY_PATIENT_DTL.ISCOFIRMED	=UPDATE HRGT_DAILY_PATIENT_DTL SET HRGNUM_IS_CONFIRMED\=?, GNUM_SEAT_ID\=? WHERE HRGNUM_PUK\=? AND HRGNUM_EPISODE_CODE\=? AND HRGNUM_VISIT_NO\=?


UPDATE.HRGT_EPISODE_DTL.EPISODE_IS_OPEN=UPDATE HRGT_EPISODE_DTL SET HRGNUM_IS_CONFIRMED \= ? ,HRGNUM_IS_EPISODE_OPEN \= ?, GNUM_DOC_SEAT_ID \= ?  WHERE HRGNUM_PUK \= ? AND HRGNUM_VISIT_NO \= ? AND HRGNUM_EPISODE_CODE \= ? AND GNUM_HOSPITAL_CODE\=?

SELECT.CLOSE.EPISODE.HRGT_EPISODE_CLOSE_DTL=SELECT A.HRGNUM_EPISODE_CODE as episodecode,DECODE( A.HRGNUM_EPISODE_TYPE_CODE,0,'IPD',1,'OPD',2,'Emergency MLC',3,'Emergency Non MLC') AS episodetype, GSTR_DEPT_NAME as department,HGSTR_UNITNAME as unit FROM HRGT_EPISODE_DTL A, HRGT_EPISODE_CLOSE_DTL B, HGBT_UNIT_MST D,GBLT_DEPARTMENT_MST C  WHERE A.HRGNUM_PUK\=b.HRGNUM_PUK AND A.HRGNUM_EPISODE_CODE\=B.HRGNUM_EPISODE_CODE AND C.GNUM_DEPT_CODE\=A.GNUM_DEPT_CODE AND A.HRGNUM_IS_EPISODE_OPEN\=0 AND D.HGNUM_DEPTUNITCODE\=A.HGNUM_DEPTUNITCODE  AND b.HRGNUM_PUK\=?



UPDATE.HRGT_EPISODE_DTL.NEXT_VISIT_DATE=UPDATE HRGT_EPISODE_DTL SET HRGNUM_IS_CONFIRMED \= ?, GNUM_DOC_SEAT_ID \= ?,  HRGDT_NEXT_VISIT_DATE \= TO_DATE(?,'dd/mm/yyyy') WHERE HRGNUM_PUK \= ? AND HRGNUM_VISIT_NO \= ? AND HRGNUM_EPISODE_CODE \= ? AND GNUM_HOSPITAL_CODE\=?


UPDATE.IS_EPISODE_OPEN.HRGT_EPISODE_DTL=update HRGT_EPISODE_DTL set HRGNUM_IS_EPISODE_OPEN = 1 where HRGNUM_PUK = ? and HRGNUM_EPISODE_CODE = ?

SELECT.COUNT_NEW_MAIL.HOPT_CONSULTATION_DTL=select count(*) from hopt_consultation_dtl where hopnum_to_doct_seatid = ? AND HOPNUM_ACK_STATUS=? 
  

#INSERT.HOPT_CONSULTATION_DTL=INSERT INTO hopt_consultation_dtl (hrgnum_puk, hrgnum_episode_code, hrgnum_visit_no, hrgnum_req_id, hopstr_subject, hrgnum_par_req_id, hopstr_content,hopnum_mail_type, hopstr_from_doct_code, hopnum_from_doct_seatid, hopstr_to_doct_code,hopnum_to_doct_seatid, hopdt_sent_date, hopdt_receive_date, hopnum_ack_status,GNUM_HOSPITAL_CODE) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, sysdate, TO_DATE (?, 'dd/mm/yyyy hh24\:mi\:ss'), ?,?)

INSERT.HOPT_CONSULTATION_DTL=INSERT INTO hopt_consultation_dtl (hrgnum_puk, hrgnum_episode_code, hrgnum_visit_no, hrgnum_req_id, hopstr_subject, hrgnum_par_req_id, hopstr_content,hopnum_mail_type,hopstr_from_doct_code,hopnum_from_doct_seatid, hopdt_sent_date, hopdt_receive_date, hopnum_ack_status,GNUM_HOSPITAL_CODE,HOPNUM_TO_USER_TYPE,HOPSTR_TO_DOCT_NAME,HOPSTR_FROM_DOCT_NAME,hopnum_to_doct_seatid,hopstr_to_doct_code) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?,  sysdate, TO_DATE (?, 'dd/mm/yyyy hh24\:mi\:ss'), ?,?,?,?,?,?,?)

UPDATE.HOPT_CONSULTATION_DTL.ACK_STATUS=update HOPT_CONSULTATION_DTL set HOPNUM_ACK_STATUS =? where HRGNUM_REQ_ID=?




SELECT.PREVIOUS.ALLERGIES.HRGT_EPISODE_ALLERGIES_DTL=SELECT hrgnum_puk AS patcrno, hrgnum_episode_code AS episodecode, hrgnum_visit_no AS episodevisitno, hrgnum_s_no AS serialno, hgnum_allergies_code AS allergiescode, (SELECT hgstr_allergies_type FROM hgbt_allergies_type_mst WHERE hgnum_allergies_code \= a.hgnum_allergies_code AND gnum_hospital_code\=a.gnum_hospital_code) AS allergytypename, hrgstr_remarks AS remarks, hgnum_organ_code AS organcode, (SELECT hgstr_organ_name FROM hgbt_organ_mst WHERE hgnum_organ_code \= a.hgnum_organ_code) AS organname, hgstr_reason_code AS reasoncode,  hgstr_reason_desc AS reasonname, hgnum_sensitivity_code AS sensitivitycode, (SELECT hgstr_sensitivity_type FROM hgbt_allergies_sensitivity_mst WHERE hgnum_sensitivity_code \= a.hgnum_sensitivity_code AND gnum_hospital_code\=a.gnum_hospital_code) AS sensitivityname, gnum_isvalid AS isvalid, gnum_seat_id AS seatid, gdt_entry_date AS entrydate FROM hrgt_episode_allergies_dtl a WHERE hrgnum_puk \= ? AND gnum_hospital_code\= ?


SELECT.MAX_REQUEST_ID.HOPT_CONSULTATION_DTL=select nvl(max(hrgnum_req_id),0) from hopt_consultation_dtl where GNUM_HOSPITAL_CODE = ?


INSERT.HOPT_DOC_UPLOAD_DTL=INSERT INTO HRGT_PATIENT_DOCUMENT_DTL (hrgnum_puk, hrgnum_s_no, hrgnum_episode_code, hrgnum_visit_no, \
						   HRGSTR_DOC_TITLE, hrgstr_file_name, HRGSTR_DOCUMENT_ID,HRGSTR_DIR_PATH, gnum_isvalid, gnum_seat_id, gdt_entry_date,GNUM_HOSPITAL_CODE,GNUM_FILE_TYPE,HRGSTR_MLC_NO,HRGNUM_ADMISSION_NO) \
						   VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, SYSDATE,?,?,?,?)


INSERT.HRGT_EPISODE_ALLERGY_DTL=INSERT INTO HRGT_EPISODE_ALLERGY_DTL(HRGNUM_PUK, HRGNUM_EPISODE_CODE, HRGNUM_VISIT_NO, HRGNUM_S_NO, HGNUM_ALLERGY_TYPE_CODE, HRGNUM_ADMISSION_NO, HRGSTR_REMARKS, HGSTR_ALLERGY_ID, HGNUM_SENSITIVITY_CODE, GNUM_ISVALID, GNUM_SEAT_ID, GDT_ENTRY_DATE, HGSTR_ALLERGY_NAME, GNUM_HOSPITAL_CODE, HRGSTR_IP_ADD, HGSTR_SYMTOM_DESC, HGSTR_ALLERGY_SITE, HGSTR_ADVICE, HGSTR_ALLERGY_TYPE,HRGDT_DURATION_DATE, HRGNUM_ISREVOKED) VALUES(?,?,?,(SELECT NVL(MAX(HRGNUM_S_NO),0)+1 FROM HRGT_EPISODE_ALLERGY_DTL WHERE HRGNUM_PUK \= ? AND HRGNUM_EPISODE_CODE \= ? AND HRGNUM_VISIT_NO \= ?),?,?,?,?,?,?,?,SYSDATE,?,?,?,?,?,?,?,TRUNC(TRUNC(SYSDATE) - ?*365),?) 
                   					
#Modified on 05.10.2016 for snomed ct integration 
INSERT.HRGT_EPISODE_PAT_ALLERGIES_DTL=INSERT INTO HRGT_EPISODE_PAT_ALLERGIES_DTL(HRGNUM_PUK, HRGNUM_EPISODE_CODE, HRGNUM_VISIT_NO, HRGNUM_S_NO, SCTNUM_ID_ALLERGRY, HRGNUM_ADMISSION_NO, SCTSTR_PTERM_ALLERGRY, GNUM_ISVALID, SCTNUM_ID_SENSITIVITY, GNUM_SEAT_ID, SCTSTR_PTERM_SENSITIVITY, GDT_ENTRY_DATE, SCTSTR_IDS_SYMPTOMS, SCTSTR_PTERMS_SYMPTOMS, GNUM_HOSPITAL_CODE, HPMRGDT_EFFECTIVE_FRM, HRGSTR_IP_ADD, SCTSTR_IDS_SITES, SCTSTR_PTERMS_SITES, HGSTR_SYMTOM_DESC, HGSTR_ALLERGY_SITE, SCTSTR_IDS_ADVICE, HGSTR_ADVICE, SCTSTR_PTERMS_ADVICE, HRGNUM_ISREVOKED,HRGDT_DURATION_DATE) VALUES (?, ?, ?, (SELECT NVL(MAX(HRGNUM_S_NO),0)+1 FROM HRGT_EPISODE_PAT_ALLERGIES_DTL WHERE HRGNUM_PUK \= ? AND HRGNUM_EPISODE_CODE \= ? AND HRGNUM_VISIT_NO \= ?), ?, ?, ?, ?, ?, ?, ?,  SYSDATE, ?,  ?, ?, SYSDATE,  ?, ?, ?, ?,  ?, ?, ?, ?, ?, TRUNC(TRUNC(SYSDATE) - ?*365))\t

   
                   					
                   					
UPDATE.SLOT.APPOINTMENT.PERSONS.HAPT_SLOT_DTL = UPDATE HAPT_SLOT_DTL SET HAPNUM_TOT_APT_PSN\=? WHERE HAPNUM_ACT_APT_CODE\=? AND HAPNUM_SLOT_CODE\=? AND TO_DATE(HAPDT_SLOT_DATE,'DD-MM-YY')\= TO_DATE(?,'DD-MM-YY')
													
SELECT.SLOT.APPOINTMENT.PERSONS.HAPT_SLOT_DTL = SELECT HAPNUM_TOT_APT_PSN FROM HAPT_SLOT_DTL   WHERE HAPNUM_ACT_APT_CODE\=? AND HAPNUM_SLOT_CODE\=? AND  TO_DATE(HAPDT_SLOT_DATE,'DD-MM-YY')\= TO_DATE(?,'DD-MM-YY')
												
INSERT.APPOINTMENT.DTL.HAPT_APPOINTMENT_DTL =	INSERT INTO  HAPT_APPOINTMENT_DTL(HAPNUM_APT_REQ_NO,HAPNUM_ACTIVITY_CODE,\
												HAPNUM_ACT_APT_CODE,HAPNUM_SLOT_CODE,HAPNUM_SLOT_DATE,HRGNUM_PUK,HAPSTR_PATIENT_NAME,\
												HAPNUM_APT_STATUS,GNUM_SEAT_ID,HAPSTR_REMARKS,HAPSTR_STATUS_REMARKS,HAP_PATIENT_DOB,HAPNUM_PATEINT_GENDER,HAPSTR_PATIENT_FNAME)\
												VALUES(?,?,?,?,TO_DATE(?,'DD-MM-YY'),?,?,?,?,?,?,GetDob(?,?),?,?)
												
SELECT.COUNT.RECORDS.HAPT_APPOINTMENT_DTL	=	 SELECT COUNT(*) FROM HAPT_APPOINTMENT_DTL

SELECT.GENRATE.APT.REQ.FOR.COUNT.ZERO.HAPT_APPOINTMENT_DTL	=	 SELECT TO_CHAR(SYSDATE,'YYMM'),TO_CHAR(COUNT(*)+1,'00000') FROM HAPT_APPOINTMENT_DTL

SELECT.GENRATE.APT.REQ.FOR.COUNT.NOT.ZERO.HAPT_APPOINTMENT_DTL	= SELECT max(HAPNUM_APT_REQ_NO)+1 FROM HAPT_APPOINTMENT_DTL																								
																
#changed HRGT_EPISODE_DATE to GDT_ENTRY_DATE bec no data entered for HRGT_EPISODE_DATE	... by Akash Singh, Dated on 04-06-2015	

# changed diagnosisname query, old query- (SELECT C.HGBSTR_DISEASE_DESC FROM HGBT_HOSPITAL_DISEASE_MST C WHERE trim(A.HRGNUM_DIAGNOSTIC_CODE) = TRIM(C.HGBSTR_HOSPITAL_DISEASE_CODE) AND C.GNUM_ISVALID=? AND C.GNUM_HOSPITAL_CODE=?) )  AS dignosisName, \ 	                   					
# Commented by Dheeraj on 30-Nov-2018
#SELECT.PAT_PROFILE_DIGNOSIS_DETAIL.HRGT_EPISODE_DIAGNOSIS_DTL=SELECT A.HRGNUM_PUK as patCrNo, A.HRGNUM_EPISODE_CODE as episodeCode, A.HRGNUM_VISIT_NO AS episodeVisitNo, A.HRGNUM_ADMISSION_NO AS patAdmNo, A.HRGNUM_DIAGNOSTIC_CODE AS diagnosticCode,GNUM_DIAGNOSTIC_TYPE_CODE as diagnosticTypeCode,HRGNUM_DIAGNOSIS_CODE_TYPE as diagnosisCodeType,DECODE(A.HRGNUM_DIAGNOSIS_CODE_TYPE,0,(SELECT B.HGBSTR_DISEASE FROM HGBT_ICD_DISEASE_MST B WHERE trim(A.HRGNUM_DIAGNOSTIC_CODE) \= TRIM(B.HGBSTR_DISEASE_CODE) ANd HGNUM_RECORD_TYPE\=0 AND B.GNUM_ISVALID\=?), 1, (SELECT hgbstr_disease FROM hgbt_icd_disease_mst WHERE TRIM(hgbstr_disease_code) \=TRIM(a.hrgnum_diagnostic_code) and HGNUM_RECORD_TYPE\=0) || '(' || hrgnum_diagnostic_code ||')', 2, HRGSTR_DIAGNOSTIC_NAME || '(' || hrgnum_diagnostic_code ||')', HRGSTR_DIAGNOSTIC_NAME ) AS dignosisName, (SELECT D.HGBSTR_DIAGNOSTIC_TYPE_NAME FROM HGBT_DIAGNOSIS_TYPE_MST D WHERE A.GNUM_DIAGNOSTIC_TYPE_CODE \= D.HGBNUM_DIAGNOSTIC_TYPE_CODE AND D.GNUM_ISVALID\=? AND D.GNUM_HOSPITAL_CODE\=?) AS diagnosticTypeName, HRGSTR_REMARKS\tAS remarks, TO_CHAR(GDT_ENTRY_DATE,'dd-Mon-yyyy') as episodeDate FROM HRGT_EPISODE_DIAGNOSIS_DTL A WHERE HRGNUM_PUK\=? AND HRGNUM_EPISODE_CODE\=? AND HRGNUM_VISIT_NO \= (SELECT MAX(HRGNUM_VISIT_NO) FROM HRGT_EPISODE_DIAGNOSIS_DTL WHERE HRGNUM_PUK\=? AND HRGNUM_EPISODE_CODE\=? AND GNUM_ISVALID\=? AND GNUM_HOSPITAL_CODE\=?) AND A.GNUM_ISVALID\=? AND A.GNUM_HOSPITAL_CODE \=? 
#Updated by Dheeraj on 30-Nov-2018 to avoid getting revoked diagnosis list
SELECT.PAT_PROFILE_DIGNOSIS_DETAIL.HRGT_EPISODE_DIAGNOSIS_DTL=SELECT A.HRGNUM_PUK as patCrNo, A.HRGNUM_EPISODE_CODE as episodeCode, A.HRGNUM_VISIT_NO AS episodeVisitNo, A.HRGNUM_ADMISSION_NO AS patAdmNo, A.HRGNUM_DIAGNOSTIC_CODE AS diagnosticCode,GNUM_DIAGNOSTIC_TYPE_CODE as diagnosticTypeCode,HRGNUM_DIAGNOSIS_CODE_TYPE as diagnosisCodeType,DECODE(A.HRGNUM_DIAGNOSIS_CODE_TYPE,0,(SELECT B.HGBSTR_DISEASE FROM HGBT_ICD_DISEASE_MST B WHERE trim(A.HRGNUM_DIAGNOSTIC_CODE) \= TRIM(B.HGBSTR_DISEASE_CODE) ANd HGNUM_RECORD_TYPE\=0 AND B.GNUM_ISVALID\=?), 1, (SELECT hgbstr_disease FROM hgbt_icd_disease_mst WHERE TRIM(hgbstr_disease_code) \=TRIM(a.hrgnum_diagnostic_code) and HGNUM_RECORD_TYPE\=0) || '(' || hrgnum_diagnostic_code ||')', 2, HRGSTR_DIAGNOSTIC_NAME || '(' || hrgnum_diagnostic_code ||')', HRGSTR_DIAGNOSTIC_NAME ) AS dignosisName, (SELECT D.HGBSTR_DIAGNOSTIC_TYPE_NAME FROM HGBT_DIAGNOSIS_TYPE_MST D WHERE A.GNUM_DIAGNOSTIC_TYPE_CODE \= D.HGBNUM_DIAGNOSTIC_TYPE_CODE AND D.GNUM_ISVALID\=? AND D.GNUM_HOSPITAL_CODE\=?) AS diagnosticTypeName, HRGSTR_REMARKS\tAS remarks, TO_CHAR(GDT_ENTRY_DATE,'dd-Mon-yyyy') as episodeDate FROM HRGT_EPISODE_DIAGNOSIS_DTL A WHERE HRGNUM_PUK\=? AND HRGNUM_EPISODE_CODE\=? AND HRGNUM_VISIT_NO \= (SELECT MAX(HRGNUM_VISIT_NO) FROM HRGT_EPISODE_DIAGNOSIS_DTL WHERE HRGNUM_PUK\=? AND HRGNUM_EPISODE_CODE\=? AND (HRGNUM_DIAGNOSIS_CODE_TYPE \= 0 OR HRGNUM_DIAGNOSIS_CODE_TYPE\= 1 OR HRGNUM_DIAGNOSIS_CODE_TYPE\= 3) AND GNUM_ISVALID\=? AND GNUM_HOSPITAL_CODE\=?) AND HBNUM_ISREPEAT not in (3) AND A.GNUM_ISVALID\=? AND A.GNUM_HOSPITAL_CODE \=? 
															 
SELECT.EPISODE_BY_CRNO_PAT_PROFILE.HRGT_EPISODE_DTL=SELECT A.hrgnum_puk,A.HRGNUM_EPISODE_CODE as episodeCode,A.HRGDT_EPISODE_DATE as episodeDate,(SELECT D.HRGDT_EPISODE_DATE FROM  HRGT_EPISODE_DTL D WHERE  D.HRGNUM_PUK\=A.HRGNUM_PUK AND D.HRGNUM_EPISODE_CODE\=A.HRGNUM_EPISODE_CODE AND D.HRGNUM_VISIT_NO \=(SELECT MAX(E.HRGNUM_VISIT_NO) FROM HRGT_EPISODE_DTL E WHERE  E.HRGNUM_PUK\=A.HRGNUM_PUK AND E.HRGNUM_EPISODE_CODE\=A.HRGNUM_EPISODE_CODE )) as lastVisitDate FROM HRGT_EPISODE_DTL A WHERE  A.HRGNUM_PUK\=? AND a.HGNUM_DEPTUNITCODE\=? AND A.HRGNUM_VISIT_NO \= (SELECT MIN(C.HRGNUM_VISIT_NO) FROM HRGT_EPISODE_DTL C WHERE C.HRGNUM_PUK\=A.HRGNUM_PUK AND C.HRGNUM_EPISODE_CODE\=A.HRGNUM_EPISODE_CODE ) ORDER BY A.HRGNUM_EPISODE_CODE
													

INSERT.HOPT_PAT_PROFILE_DTL.RETRIVE_BY_PROFILE_ID=INSERT INTO hopt_pat_profile_dtl (hopnum_profile_id, hopnum_slno, hrgnum_puk, gnum_dept_code, hgnum_deptunitcode, hopstr_profile_header, hopstr_profile_remark, gnum_isvalid, gnum_seat_id, gdt_entry_date, gdt_lstmod_date, gnum_lstmod_seatid, gdt_effective_frm, gdt_effective_to,GNUM_HOSPITAL_CODE) VALUES (?, (SELECT NVL (MAX (hopnum_slno), 0) + 1 FROM hopt_pat_profile_dtl WHERE hopnum_profile_id \= ?), ?, ?, ?, ?, ?, ?, ?, SYSDATE, ?, ?, TO_DATE (?, 'dd/mm/yyyy hh24\:mi\:ss'), TO_DATE (?, 'dd/mm/yyyy hh24\:mi\:ss'),?)
			

INSERT.HOPT_PAT_BELONGING_DTL	=INSERT INTO HOPT_PAT_BELONGING_DTL (HRGNUM_PUK, HOPNUM_BELONGING_ID, HOPDT_COLLECTION_DATE, HOPSTR_QTY, HOPSTR_REMARK, HOPNUM_HANDOVER_BY, HOPDT_HANDOVER_DT, HOSTR_HANDOVER_TO, GNUM_ISVALID, GNUM_SEAT_ID, GDT_ENTRY_DATE, GDT_LSTMOD_DATE, GNUM_LSTMOD_SEATID, GNUM_HOSPITAL_CODE) VALUES(?,?,TRUNC(SYSDATE),?,?,?,TO_DATE(?,'dd-Mon-yyyy'),?,?,?,SYSDATE,TO_DATE(?,'dd-Mon-yyyy'),?,?)             \t\t\t\t\t

													
														
<!-- Not In Use -->
SELECT.HOPT_PAT_PROFILE_DTL.PROFILE_DTL_BY_CRNO=SELECT hopnum_profile_id as patProfileId, hopnum_slno as serialNo, hopstr_profile_header as patProfileHeader, hopstr_profile_remark as patProfileRemark, gnum_isvalid as isValid, gnum_seat_id as seatId, TO_CHAR(gdt_entry_date,'dd-Mon-yyyy') as entryDate,NVL(TO_CHAR(gdt_effective_frm,'dd-Mon-yyyy'),' ') as prevEffectiveFrom, NVL(TO_CHAR(gdt_effective_to,'dd-Mon-yyyy'),' ') as prevEffectiveTo FROM hopt_pat_profile_dtl WHERE hrgnum_puk \= ? AND gnum_seat_id \= ? AND hgnum_deptunitcode \= ? ORDER BY  serialNo
   
<!-- Not In Use -->
UPDATE.HOPT_PAT_PROFILE_DTL.EFFECTIVE_FROM_TO=UPDATE hopt_pat_profile_dtl SET gdt_effective_to \= TO_DATE (?, 'dd/mm/yyyy'), gdt_lstmod_date \= SYSDATE, GNUM_LSTMOD_SEATID\=?, GNUM_ISVALID\=?  WHERE hopnum_profile_id \= ? AND hopnum_slno \=?



UPDATE.HANDOVER.DETAILS.HOPT_PAT_BELONGING_DTL=UPDATE HOPT_PAT_BELONGING_DTL SET HOPNUM_HANDOVER_BY\=?,HOPDT_HANDOVER_DT\= TRUNC(SYSDATE),HOSTR_HANDOVER_TO\=?,GDT_LSTMOD_DATE\= TRUNC(SYSDATE),GNUM_LSTMOD_SEATID\=? WHERE HRGNUM_PUK\=? AND HOPNUM_BELONGING_ID\=? AND HOPDT_COLLECTION_DATE >\= TRUNC (TO_DATE (?, 'dd-Mon-yyyy')) AND GNUM_HOSPITAL_CODE \=?
												
UPDATE.BELONGING.DETAILS.HOPT_PAT_BELONGING_DTL	=UPDATE HOPT_PAT_BELONGING_DTL SET HOPNUM_BELONGING_ID \= ?, HOPSTR_QTY \= ?, HOPSTR_REMARK \= ?, GDT_LSTMOD_DATE \= TRUNC(SYSDATE), GNUM_LSTMOD_SEATID \= ? WHERE HRGNUM_PUK \= ? AND HOPNUM_BELONGING_ID \= ? AND HOPDT_COLLECTION_DATE >\= TRUNC (TO_DATE (?, 'dd-Mon-yyyy')) AND GNUM_HOSPITAL_CODE\=?
#Added by:	Akash Singh
#Date:		09-01-2015
#Reason:	Showing data for custom Profile from HPMRT_PAT_ALLERGY_DTL
#Logs:		Added SELECT.HPMRT_PAT_ALLERGY_DTL.PAT_PROFILE_BY_CRNO

#modifiedBy NehaRajgariya Date:27July2016
SELECT.HPMRT_PAT_ALLERGY_DTL.PAT_AUTO_PROFILE_BY_CRNO = SELECT A.HRGNUM_PUK as patCrNo,A.HRGNUM_S_NO as serialNo,A.HGSTR_ALLERGY_NAME as allergyName,A.HGNUM_ALLERGY_TYPE_CODE as allergyTypeCode,TO_CHAR(HRGDT_DURATION_DATE,'dd-Mon-yyyy') as duration,ahis_util.age_YR_MON_DAY(HRGDT_DURATION_DATE,trunc(sysdate)) as durationDays, A.HGSTR_ALLERGY_TYPE as allergyTypeName,A.HGSTR_ALLERGY_ID as allergyID,TO_CHAR(GDT_ENTRY_DATE,'dd-Mon-yyyy') as entryDate  FROM HRGT_EPISODE_ALLERGY_DTL A WHERE HRGNUM_PUK\=? AND GNUM_ISVALID\=? AND HRGNUM_ISREVOKED\=?  AND HRGNUM_EPISODE_CODE\=? AND hrgnum_visit_no\=(select max(hrgnum_visit_no) FROM HRGT_EPISODE_ALLERGY_DTL WHERE GNUM_ISVALID\=1 AND HRGNUM_ISREVOKED\=0 AND HRGNUM_PUK\= A.HRGNUM_PUK AND HRGNUM_EPISODE_CODE\=A.HRGNUM_EPISODE_CODE) 
#modifiedBy NehaRajgariya Date:27July2016	   				                                   
SELECT.HPMRT_PAT_ALLERGY_DTL.PAT_PROFILE_BY_CRNO = SELECT A.HRGNUM_PUK as patCrNo,A.HGSTR_ALLERGY_NAME as allergyName,A.HGNUM_ALLERGY_TYPE_CODE as allergyTypeCode,TO_CHAR(HRGDT_DURATION_DATE,'dd-Mon-yyyy') as duration,ahis_util.age_YR_MON_DAY(HRGDT_DURATION_DATE,trunc(sysdate)) as durationDays, A.HGSTR_ALLERGY_TYPE as allergyTypeName,A.HGSTR_ALLERGY_ID as allergyID,TO_CHAR(GDT_ENTRY_DATE,'dd-Mon-yyyy') as entryDate  FROM HPMRT_PAT_ALLERGY_DTL A WHERE HRGNUM_PUK\=? AND GNUM_ISVALID\=? AND SYSDATE BETWEEN HRGDT_EFFECTIVE_FRM AND NVL(HRGDT_EFFECTIVE_TO,SYSDATE)  \t\t\t\t                             


SELECT.PREVIOUS.ALLERGY.HPMRT_PAT_ALLERGY_DTL = SELECT HGNUM_ALLERGY_TYPE_CODE as allergyTypeCode, HGSTR_ALLERGY_TYPE as allergyTypeName, HGSTR_ALLERGY_ID as allergyID,HGSTR_ALLERGY_NAME as allergyName, (TRUNC(SYSDATE)-TRUNC(HRGDT_DURATION_DATE)) as duration, ahis_util.age_YR_MON_DAY(hrgdt_duration_date,trunc(sysdate)) AS durationDays FROM HPMRT_PAT_ALLERGY_DTL WHERE HRGNUM_PUK \= ? AND GNUM_ISVALID \= ? AND TRUNC(HRGDT_EFFECTIVE_FRM) <\= TRUNC(SYSDATE) AND NVL(TRUNC(HRGDT_EFFECTIVE_TO),SYSDATE+1) > TRUNC(SYSDATE) AND HGNUM_ALLERGY_TYPE_CODE \= 11

 # added for snomed integration date: 06.10.2016
SELECT.PREVIOUS.ALLERGY.HRGT_EPISODE_PAT_ALLERGIES_DTL = SELECT sctnum_id_allergry as allergyID, sctstr_pterm_allergry as allergyName, sctnum_id_sensitivity,  sctstr_pterm_sensitivity, sctstr_ids_symptoms,  sctstr_pterms_symptoms, sctstr_ids_sites, sctstr_pterms_sites, hgstr_symtom_desc,  hgstr_allergy_site, sctstr_ids_advice, hgstr_advice, sctstr_pterms_advice,  hrgnum_isrevoked, hpmrstr_revoke_remarks, hrgdt_duration_date as duration, ahis_util.age_YR_MON_DAY(hrgdt_duration_date,trunc(sysdate)) AS durationDays FROM hrgt_episode_pat_allergies_dtl WHERE HRGNUM_PUK \= ? AND GNUM_ISVALID \= ? AND TRUNC(hpmrgdt_effective_frm) <\= TRUNC(SYSDATE) AND NVL(TRUNC(hpmrgdt_effective_to),SYSDATE+1) > TRUNC(SYSDATE)




 
INSERT.HPMRT_PAT_ALLERGY_DTL.old = INSERT INTO HPMRT_PAT_ALLERGY_DTL (HRGNUM_PUK, HRGNUM_S_NO, HGSTR_ALLERGY_NAME, HGNUM_ALLERGY_TYPE_CODE, HRGDT_EFFECTIVE_FRM, HRGDT_EFFECTIVE_TO, HGSTR_ALLERGY_TYPE, HRGSTR_REVOKE_REMARKS, HGSTR_ALLERGY_ID, GNUM_ISVALID, GNUM_SEAT_ID, GNUM_HOSPITAL_CODE, GDT_ENTRY_DATE, GSTR_IP_ADD,HRGDT_DURATION_DATE) VALUES(?,(SELECT NVL(MAX(HRGNUM_S_NO),0)+1 FROM HPMRT_PAT_ALLERGY_DTL WHERE HRGNUM_PUK\=? AND GNUM_HOSPITAL_CODE \= ?), ?,?,SYSDATE,?\:\:timestamp,?,?,?,?,?,?,SYSDATE,?,TRUNC(TRUNC(SYSDATE) - ?*365))
#last used					
INSERT.HPMRT_PAT_ALLERGY_DTL.old1 = INSERT INTO HPMRT_PAT_ALLERGY_DTL (HRGNUM_PUK, HGSTR_ALLERGY_NAME, HGNUM_ALLERGY_TYPE_CODE, HRGDT_EFFECTIVE_FRM, HRGDT_EFFECTIVE_TO, HGSTR_ALLERGY_TYPE, HRGSTR_REVOKE_REMARKS, HGSTR_ALLERGY_ID, GNUM_ISVALID, GNUM_SEAT_ID, GNUM_HOSPITAL_CODE, GDT_ENTRY_DATE, GSTR_IP_ADD,HRGDT_DURATION_DATE) VALUES(?,?,?,SYSDATE,?\:\:timestamp,?,?,?,?,?,?,SYSDATE,?,TRUNC(TRUNC(SYSDATE) - ?*365))
#commented by Dheeraj								
# snomd ct integration  date: 26.9.2016									
#INSERT.HPMRT_PAT_ALLERGY_DTL = INSERT INTO HPMRT_PAT_ALLERGY_DTL (HRGNUM_PUK, HGSTR_ALLERGY_NAME, HGNUM_ALLERGY_TYPE_CODE, HRGDT_EFFECTIVE_FRM, HRGDT_EFFECTIVE_TO, HGSTR_ALLERGY_TYPE, HRGSTR_REVOKE_REMARKS, HGSTR_ALLERGY_ID, GNUM_ISVALID, GNUM_SEAT_ID, GNUM_HOSPITAL_CODE, GDT_ENTRY_DATE, GSTR_IP_ADD,HRGDT_DURATION_DATE) VALUES(?,?,?,SYSDATE,?\:\:timestamp,?,?,?,?,?,?,SYSDATE,?,TRUNC(TRUNC(SYSDATE) - ?*365))\t\t\t\t\t\t\t\t
# updated by Dheeraj on 10-Dec-2018 to insert Drug Allergy data
INSERT.HPMRT_PAT_ALLERGY_DTL = INSERT INTO HPMRT_PAT_ALLERGY_DTL (HRGNUM_PUK, HGSTR_ALLERGY_NAME, HGNUM_ALLERGY_TYPE_CODE, HRGDT_EFFECTIVE_FRM, HRGDT_EFFECTIVE_TO, HGSTR_ALLERGY_TYPE, HRGSTR_REVOKE_REMARKS, HGSTR_ALLERGY_ID, GNUM_ISVALID, GNUM_SEAT_ID, GNUM_HOSPITAL_CODE, GDT_ENTRY_DATE, GSTR_IP_ADD,HRGDT_DURATION_DATE,SERIAL_NO) VALUES(?,?,?,SYSDATE,?\:\:timestamp,?,?,?,?,?,?,SYSDATE,?,TRUNC(TRUNC(SYSDATE) - ?*365),?)\t\t\t\t\t\t\t\t
	
								
EXIST_ALLERGY_CODE.HPMRT_PAT_ALLERGY_DTL = SELECT * FROM HPMRT_PAT_ALLERGY_DTL WHERE HRGNUM_PUK \= ? AND HGNUM_ALLERGY_TYPE_CODE\=? AND HGSTR_ALLERGY_ID \= ? AND GNUM_HOSPITAL_CODE \= ? AND GNUM_ISVALID \= ? AND TRUNC(HRGDT_EFFECTIVE_FRM) <\= TRUNC(SYSDATE) AND NVL(HRGDT_EFFECTIVE_TO,SYSDATE+1) >\= TRUNC(SYSDATE)


											
SELECT_ALL_ALLERGY_EPISODE.HRGT_EPISODE_ALLERGY_DTL = SELECT HRGSTR_REMARKS AS remarks, TO_CHAR(GDT_ENTRY_DATE,'dd-Mon-yyyy') AS entryDate, HGSTR_SYMTOM_DESC AS allergySymtoms, HGSTR_ALLERGY_SITE AS allergySite, HGSTR_ALLERGY_NAME AS reasonName, HGSTR_ALLERGY_TYPE AS allergyTypeName,TO_CHAR(HRGDT_DURATION_DATE,'dd-Mon-yyyy') as duration, ahis_util.age_YR_MON_DAY(hrgdt_duration_date,trunc(sysdate)) AS durationDays FROM HRGT_EPISODE_ALLERGY_DTL WHERE HRGNUM_PUK \= ? AND HGNUM_ALLERGY_TYPE_CODE \= ? AND HGSTR_ALLERGY_ID \= ? AND GNUM_HOSPITAL_CODE \= ? ORDER BY entryDate DESC,reasonName

														
# added for snomed integration date: 06.10.2016												
SELECT_ALL_ALLERGY_EPISODE.HRGT_EPISODE_PAT_ALLERGIES_DTL = SELECT sctnum_id_allergry as allergyID, sctstr_pterm_allergry AS reasonName,TO_CHAR(GDT_ENTRY_DATE,'dd-Mon-yyyy') AS entryDate, sctnum_id_sensitivity, sctstr_pterm_sensitivity, sctstr_ids_symptoms,  sctstr_pterms_symptoms AS allergySymtoms, sctstr_ids_sites, sctstr_pterms_sites, hgstr_symtom_desc,  hgstr_allergy_site AS allergySite, sctstr_ids_advice, hgstr_advice as advice, sctstr_pterms_advice,  hrgnum_isrevoked, hpmrstr_revoke_remarks, TO_CHAR(HRGDT_DURATION_DATE,'dd-Mon-yyyy') as duration, ahis_util.age_YR_MON_DAY(hrgdt_duration_date,trunc(sysdate)) AS durationDays FROM hrgt_episode_pat_allergies_dtl WHERE HRGNUM_PUK \= ? AND sctnum_id_allergry\=? AND GNUM_ISVALID \= ? AND GNUM_HOSPITAL_CODE \= ? AND TRUNC(hpmrgdt_effective_frm) <\= TRUNC(SYSDATE) AND NVL(TRUNC(hpmrgdt_effective_to),SYSDATE+1) > TRUNC(SYSDATE)


INSERT.HRGT_EPISODE_ALLERGY_SITEDTL = INSERT INTO HRGT_EPISODE_ALLERGY_SITEDTL (HRGNUM_PUK, HRGNUM_EPISODE_CODE, HRGNUM_VISIT_NO, HRGNUM_S_NO, HGNUM_ALLERGY_TYPE_CODE, HRGNUM_ADMISSION_NO, HGNUM_ALLERGY_SITE_ID, HGSTR_ALLERGY_ID, GNUM_ISVALID, GNUM_SEAT_ID, GNUM_HOSPITAL_CODE, GDT_ENTRY_DATE) VALUES(?,?,?,(SELECT NVL(MAX(HRGNUM_S_NO),0)+1 FROM HRGT_EPISODE_ALLERGY_SITEDTL WHERE HRGNUM_PUK \= ? AND HRGNUM_EPISODE_CODE \= ? AND HRGNUM_VISIT_NO \= ?),?,?,?,?,?,?,?,SYSDATE)


INSERT.HRGT_EPISODE_ALLERGY_SYMDTL = INSERT INTO HRGT_EPISODE_ALLERGY_SYMDTL (HRGNUM_PUK, HRGNUM_EPISODE_CODE, HRGNUM_VISIT_NO, HRGNUM_S_NO, HGNUM_ALLERGY_TYPE_CODE, HRGNUM_ADMISSION_NO, HGNUM_SYMPTOM_CODE, HGSTR_ALLERGY_ID, GNUM_ISVALID, GNUM_SEAT_ID, GNUM_HOSPITAL_CODE, GDT_ENTRY_DATE) VALUES(?,?,?,(SELECT NVL(MAX(HRGNUM_S_NO),0)+1 FROM HRGT_EPISODE_ALLERGY_SYMDTL WHERE HRGNUM_PUK \= ? AND HRGNUM_EPISODE_CODE \= ? AND HRGNUM_VISIT_NO \= ?),?,?,?,?,?,?,?,SYSDATE)
										
SELECT.PAT_EPI_CLI_DATA.HRGT_EPISODE_CLINICAL_DTL = SELECT HGNUM_TEMPLATE_ID AS templateId, HGNUM_PARA_ID AS paraId, HGSTR_PARA_VALUE AS paraValue FROM HRGT_EPISODE_CLINICAL_DTL WHERE HRGNUM_PUK\=? AND HRGNUM_EPISODE_CODE\=? AND HRGNUM_VISIT_NO\=? AND GNUM_DESK_MENU_ID\=? AND GNUM_HOSPITAL_CODE\=? AND GNUM_ISVALID\=?\t\t\t             \t\t
										   
SELECT.PAT_EPI_CLI_DATA_TEMP_WISE.HRGT_EPISODE_CLINICAL_DTL	=SELECT HGNUM_TEMPLATE_ID AS templateId, HGNUM_PARA_ID AS paraId, HGSTR_PARA_VALUE AS paraValue, NVL((SELECT A.HGSTR_PARENT_PARA FROM HGBT_PARAMETER_MST A WHERE A.HGNUM_PARA_ID\=X.HGNUM_PARA_ID AND A.GNUM_HOSPITAL_CODE\=?),'') AS paraParentId FROM HRGT_EPISODE_CLINICAL_DTL X WHERE HRGNUM_PUK\=? AND HRGNUM_EPISODE_CODE\=? AND HRGNUM_VISIT_NO\=? AND GNUM_DESK_MENU_ID\=? AND HGNUM_TEMPLATE_ID IN (\#) AND GNUM_HOSPITAL_CODE\=? AND GNUM_ISVALID\=?\t\t\t             \t\t

SELECT.PAT_CLI_DATA.HPMRT_PAT_CLINICAL_DTL	=SELECT B.HGNUM_TEMPLATE_ID AS TEMPLATEID, C.HGNUM_PARA_ID AS PARAID, C.HGSTR_PARA_VALUE AS PARAVALUE FROM HGBT_TEMPLATE_PARA_MST B, HPMRT_PAT_CLINICAL_DTL C WHERE C.HRGNUM_PUK\=? AND B.HGNUM_TEMPLATE_ID IN (\#) AND B.HGNUM_PARA_ID\=C.HGNUM_PARA_ID AND B.GNUM_HOSPITAL_CODE\=100 AND C.GNUM_HOSPITAL_CODE\=? AND B.GNUM_ISVALID\=? AND C.GNUM_ISVALID\=?
															             		
SELECT.PATIENT_FINAL_CLINICAL_DATA.HPMRT.HRGT	=SELECT HGNUM_TEMPLATE_ID AS TEMPLATEID, HGNUM_PARA_ID AS PARAID, HGSTR_PARA_VALUE AS PARAVALUE FROM HRGT_EPISODE_CLINICAL_DTL A WHERE HRGNUM_PUK\=? AND HRGNUM_EPISODE_CODE\=? AND HRGNUM_VISIT_NO\=? AND GNUM_DESK_MENU_ID\=? AND GNUM_HOSPITAL_CODE\=? AND GNUM_ISVALID\=? AND HGNUM_PARA_ID NOT IN (SELECT HGNUM_PARA_ID FROM HPMRT_PAT_CLINICAL_DTL WHERE HRGNUM_PUK\=? AND GNUM_ISVALID\=?) UNION SELECT B.HGNUM_TEMPLATE_ID AS TEMPLATEID, C.HGNUM_PARA_ID AS PARAID, C.HGSTR_PARA_VALUE AS PARAVALUE FROM HGBT_TEMPLATE_PARA_MST B, HPMRT_PAT_CLINICAL_DTL C WHERE C.HRGNUM_PUK\=? AND B.HGNUM_TEMPLATE_ID IN (\#) AND B.HGNUM_PARA_ID\=C.HGNUM_PARA_ID AND B.GNUM_HOSPITAL_CODE\=C.GNUM_HOSPITAL_CODE AND C.GNUM_HOSPITAL_CODE\=? AND B.gnum_hospital_code \= ? AND B.GNUM_ISVALID\=? AND C.GNUM_ISVALID\=? 
#added  by manisha deskmenuid																		   	
SELECT.ALL_RECORD_DATES.HIPD_PAT_CLINICAL_DTL_DESKMENU	=SELECT TO_CHAR(HRGDT_RECORD_DATE,'dd-Mon-yyyy HH24\:MI'), TO_CHAR(HRGDT_RECORD_DATE,'dd-Mon-yyyy HH24\:MI') FROM (SELECT DISTINCT HRGDT_RECORD_DATE FROM HIPD_PAT_CLINICAL_DTL WHERE HRGNUM_ADMISSION_NO\=? AND GNUM_HOSPITAL_CODE\=? AND GNUM_ISVALID\=? AND gnum_desk_menu_id\= ? ORDER BY HRGDT_RECORD_DATE DESC)


SELECT.ALL_RECORD_DATES.HIPD_PAT_CLINICAL_DTL =SELECT TO_CHAR(HRGDT_RECORD_DATE,'dd-Mon-yyyy HH24\:MI'), TO_CHAR(HRGDT_RECORD_DATE,'dd-Mon-yyyy HH24\:MI') FROM (SELECT DISTINCT HRGDT_RECORD_DATE FROM HIPD_PAT_CLINICAL_DTL WHERE HRGNUM_ADMISSION_NO\=? AND GNUM_HOSPITAL_CODE\=? AND GNUM_ISVALID\=? ORDER BY HRGDT_RECORD_DATE DESC)


SELECT.PAT_REC_CLI_DATA.HIPD_PAT_CLINICAL_DTL = SELECT HGNUM_TEMPLATE_ID AS templateId, HGNUM_PARA_ID AS paraId, HGSTR_PARA_VALUE AS paraValue, NVL((SELECT A.HGSTR_PARENT_PARA FROM HGBT_PARAMETER_MST A WHERE A.HGNUM_PARA_ID\=X.HGNUM_PARA_ID AND A.GNUM_HOSPITAL_CODE\=100),'') AS paraParentId FROM HIPD_PAT_CLINICAL_DTL X WHERE HRGNUM_ADMISSION_NO\=? AND TO_CHAR(HRGDT_RECORD_DATE,'dd-Mon-yyyy HH24\:MI')\=? AND GNUM_HOSPITAL_CODE\=? AND GNUM_ISVALID\=?\t\t\t             \t\t
											
SELECT.PAT_REC_CLI_DATA_TEMP_WISE.HIPD_PAT_CLINICAL_DTL	=SELECT HGNUM_TEMPLATE_ID AS templateId, HGNUM_PARA_ID AS paraId, HGSTR_PARA_VALUE AS paraValue FROM HIPD_PAT_CLINICAL_DTL WHERE HRGNUM_ADMISSION_NO\=? AND TO_CHAR(HRGDT_RECORD_DATE,'dd-Mon-yyyy HH24\:MI')\=? AND HGNUM_TEMPLATE_ID IN (\#) AND GNUM_HOSPITAL_CODE\=? AND GNUM_ISVALID\=?\t\t\t             \t\t
										
#query Modified for the OPD Patient Data by Shruti Shail on 11-May-2017
#SELECT X.HRGNUM_VISIT_NO AS recordDate Replaced by SELECT TO_CHAR(X.GDT_ENTRY_DATE,'dd-Mon-yyyy') AS recordDate By Shruti Shail on 11-May-2017
#FROM HIPD_PAT_CLINICAL_DTL Replaced by FROM HRGT_EPISODE_CLINICAL_DTL By Shruti Shail on 11-May-2017
SELECT.PAT_EPICLIDATA_DATE_PROFILE.HIPD_PAT_CLINICAL_DTL = SELECT TO_CHAR(X.GDT_ENTRY_DATE,'dd-Mon-yyyy') AS recordDate, X.HGNUM_TEMPLATE_ID AS templateId, X.HGNUM_PARA_ID AS paraId, X.HGSTR_PARA_VALUE AS paraValue, Y.HGSTR_PARA_NAME AS paraName, NVL(Y.HGSTR_PARENT_PARA,'') AS paraParentId FROM HRGT_EPISODE_CLINICAL_DTL X, HGBT_PARAMETER_MST Y, HGBT_TEMPLATE_PARA_MST z WHERE X.HRGNUM_PUK\=? AND X.HRGNUM_EPISODE_CODE\=? AND X.GNUM_DESK_MENU_ID\=? AND X.GNUM_HOSPITAL_CODE\=? AND X.GNUM_ISVALID\=? AND Y.GNUM_ISVALID \= 1 AND Z.GNUM_ISVALID \= 1 AND X.HGNUM_PARA_ID\=Y.HGNUM_PARA_ID AND Y.GNUM_HOSPITAL_CODE\=100 AND X.HGNUM_TEMPLATE_ID \= Z.HGNUM_TEMPLATE_ID AND X.HGNUM_PARA_ID \= Z.HGNUM_PARA_ID AND Z.GNUM_HOSPITAL_CODE\=100 ORDER BY Z.HGNUM_TEMPLATE_ID, Z.HGNUM_ROW, Z.HGNUM_COL

SELECT.PAT_IPDCLIDATA_DATE_PROFILE.HIPD_PAT_CLINICAL_DTL = SELECT TO_CHAR(HRGDT_RECORD_DATE,'dd-Mon-yyyy HH24\:MI') AS recordDate, X.HGNUM_TEMPLATE_ID AS templateId, X.HGNUM_PARA_ID AS paraId, X.HGSTR_PARA_VALUE AS paraValue, Y.HGSTR_PARA_NAME AS paraName, NVL(Y.HGSTR_PARENT_PARA,'') AS paraParentId FROM HIPD_PAT_CLINICAL_DTL X, HGBT_PARAMETER_MST Y, HGBT_TEMPLATE_PARA_MST z WHERE X.GNUM_HOSPITAL_CODE\=? AND X.GNUM_ISVALID\=? AND X.HRGNUM_ADMISSION_NO\=? AND X.GNUM_DESK_MENU_ID\=? AND Y.GNUM_ISVALID \= 1 AND Z.GNUM_ISVALID \= 1 AND X.HGNUM_PARA_ID\=Y.HGNUM_PARA_ID AND Y.GNUM_HOSPITAL_CODE\=100 AND X.HGNUM_TEMPLATE_ID \= Z.HGNUM_TEMPLATE_ID AND X.HGNUM_PARA_ID \= Z.HGNUM_PARA_ID AND Z.GNUM_HOSPITAL_CODE\=100 ORDER BY Z.HGNUM_TEMPLATE_ID, Z.HGNUM_ROW, Z.HGNUM_COL

UPDATE.CONSENT_STATUS.HGBT_CONSENT_DTL= update  HGBT_CONSENT_DTL set HGNUM_CONSENT_STATUS\=?,HGNUM_RECEIVED_BY\=? ,HGDT_RECEIVED_DATE\=SYSDATE,HRGNUM_CONSENT_GIVENBY\=?,HRGSTR_RELATIVE_NAME\=?,HRGSTR_RELATIVE_ADDRESS\=?,HRGSTR_RELATIVE_IDMARK\=?,GNUM_RELATION_CODE\=?,HRGSTR_RELATIVE_CONTACTNO\=?  WHERE HRGNUM_PUK \= ? AND HRGNUM_EPISODE_CODE \= ? AND HRGNUM_VISIT_NO \= ? and HGSTR_REQ_ID\= ?  and HGNUM_SERVICE_TYPE_ID\= ? and HGSTR_SERVICE_ID\= ? AND GNUM_ISVALID \= ? AND GNUM_HOSPITAL_CODE \= ?\tand HGNUM_SERVICE_CONSENT_ID\=?
   												
SELECT.NOOFREQUESTSTATUS.HGBT_CONSENT_DTL	=SELECT COUNT(*) FROM HGBT_CONSENT_DTL WHERE HRGNUM_PUK\=? AND HRGNUM_EPISODE_CODE\=? AND HRGNUM_VISIT_NO\=? AND HGNUM_CONSENT_STATUS\=? AND GNUM_ISVALID\=? AND GNUM_HOSPITAL_CODE\=?\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t

SELECT.PAT_EPISODE_PROFILES.HPMRT_PAT_PROFILE_DTL	=SELECT HPMRNUM_PROFILE_ID AS profileId,HRGNUM_PUK as patCrNo,HRGNUM_EPISODE_CODE as episodeCode,HGNUM_DEPTUNITCODE as departmentUnitCode, HPMRNUM_SLNO AS serialNo, HRGNUM_VISIT_NO AS episodeVisitNo, INITCAP(HPMRSTR_PROFILE_HEADER) AS profileHeader, HRGNUM_ADMISSION_NO AS admissionNo,HPMRNUM_PROFILE_STATUS as profileStatus, HPMRSTR_PROFILE_REMARK AS remarks, HPMRNUM_PROFILE_TYPE AS profileType, HPMRNUM_ACCESS_TYPE AS accessType, HPMRNUM_USER_LEVEL AS userLevel, GNUM_ISVALID AS isValid, GNUM_SEAT_ID AS seatId, TO_CHAR(GDT_ENTRY_DATE,'dd-Mon-yyyy') AS entryDate,NVL(TO_CHAR(GDT_EFFECTIVE_FRM,'dd-Mon-yyyy'),' ') AS effectiveFrom, NVL(TO_CHAR(GDT_EFFECTIVE_TO,'dd-Mon-yyyy'),' ') AS effectiveTo,hpmrnum_issinglepage AS isSinglePageFlag FROM HPMRT_PAT_PROFILE_DTL WHERE HRGNUM_PUK \= ? AND HRGNUM_EPISODE_CODE \= ? AND GNUM_SEAT_ID \= ? AND GNUM_ISVALID \= ? AND GNUM_HOSPITAL_CODE \= ? AND TRUNC(SYSDATE) BETWEEN TRUNC(GDT_EFFECTIVE_FRM) AND TRUNC(NVL(GDT_EFFECTIVE_TO,SYSDATE)) UNION SELECT HPMRNUM_PROFILE_ID AS profileId,HRGNUM_PUK as patCrNo,HRGNUM_EPISODE_CODE as episodeCode,HGNUM_DEPTUNITCODE as departmentUnitCode, HPMRNUM_SLNO AS serialNo, HRGNUM_VISIT_NO AS episodeVisitNo, INITCAP(HPMRSTR_PROFILE_HEADER) AS profileHeader, HRGNUM_ADMISSION_NO AS admissionNo,HPMRNUM_PROFILE_STATUS as profileStatus, HPMRSTR_PROFILE_REMARK AS remarks, HPMRNUM_PROFILE_TYPE AS profileType, HPMRNUM_ACCESS_TYPE AS accessType, HPMRNUM_USER_LEVEL AS userLevel, GNUM_ISVALID AS isValid, GNUM_SEAT_ID AS seatId, TO_CHAR(GDT_ENTRY_DATE,'dd-Mon-yyyy') AS entryDate,NVL(TO_CHAR(GDT_EFFECTIVE_FRM,'dd-Mon-yyyy'),' ') AS effectiveFrom, NVL(TO_CHAR(GDT_EFFECTIVE_TO,'dd-Mon-yyyy'),' ') AS effectiveTo,hpmrnum_issinglepage AS isSinglePageFlag FROM HPMRT_PAT_PROFILE_DTL WHERE HRGNUM_ADMISSION_NO \= ? AND GNUM_SEAT_ID \= ? AND GNUM_ISVALID \= ? AND GNUM_HOSPITAL_CODE \= ? AND TRUNC(SYSDATE) BETWEEN TRUNC(GDT_EFFECTIVE_FRM) AND TRUNC(NVL(GDT_EFFECTIVE_TO,SYSDATE)) AND hpmrnum_profile_type \= ?  ORDER BY profileId
													
#SELECT.PAT_PROFILES_FOR_INBOX.HPMRT_PAT_PROFILE_DTL	=SELECT A.HPMRNUM_PROFILE_ID, A.HPMRSTR_PROFILE_HEADER FROM HPMRT_PAT_PROFILE_DTL A WHERE A.HRGNUM_PUK \= ? AND A.GNUM_ISVALID \= ?  and a.gnum_hospital_code\=? AND TRUNC (SYSDATE) BETWEEN TRUNC (A.GDT_EFFECTIVE_FRM) AND TRUNC (NVL (A.GDT_EFFECTIVE_TO, SYSDATE)) AND A.HPMRNUM_ACCESS_TYPE \= ? AND ? >\= A.HPMRNUM_USER_LEVEL UNION SELECT A.HPMRNUM_PROFILE_ID, A.HPMRSTR_PROFILE_HEADER FROM HPMRT_PAT_PROFILE_DTL A WHERE A.HRGNUM_PUK \= ? AND A.GNUM_ISVALID \= ?  and a.gnum_hospital_code\=? AND TRUNC (SYSDATE) BETWEEN TRUNC (A.GDT_EFFECTIVE_FRM) AND TRUNC (NVL (A.GDT_EFFECTIVE_TO, SYSDATE)) AND A.HPMRNUM_ACCESS_TYPE \= ? AND ? >\= A.HPMRNUM_USER_LEVEL AND ? IN (SELECT DISTINCT B.HGNUM_DEPTUNITCODE FROM HPMRT_PROFILE_ACCESS_DTL B WHERE B.HPMRNUM_PROFILE_ID \= A.HPMRNUM_PROFILE_ID AND B.GNUM_ISVALID \= ? and a.gnum_hospital_code\=b.gnum_hospital_code) UNION SELECT A.HPMRNUM_PROFILE_ID, A.HPMRSTR_PROFILE_HEADER FROM HPMRT_PAT_PROFILE_DTL A WHERE A.HRGNUM_PUK \= ? AND A.GNUM_ISVALID \= ?  and a.gnum_hospital_code\=? AND TRUNC (SYSDATE) BETWEEN TRUNC (A.GDT_EFFECTIVE_FRM) AND TRUNC (NVL (A.GDT_EFFECTIVE_TO, SYSDATE)) AND A.HPMRNUM_ACCESS_TYPE \= ? AND ? IN (SELECT DISTINCT B.GNUM_USER_ID FROM HPMRT_PROFILE_ACCESS_DTL B WHERE B.HPMRNUM_PROFILE_ID \= A.HPMRNUM_PROFILE_ID AND B.GNUM_ISVALID \= ? and a.gnum_hospital_code\=b.gnum_hospital_code) 

#Nilesh Gupta
SELECT.PAT_PROFILES_FOR_INBOX.HPMRT_PAT_PROFILE_DTL = SELECT A.HPMRNUM_PROFILE_ID, A.HPMRSTR_PROFILE_HEADER FROM HPMRT_PAT_PROFILE_DTL A WHERE A.HRGNUM_PUK \= ? AND A.hpmrnum_profile_status  \=2 AND A.GNUM_ISVALID \= ?  and a.gnum_hospital_code\=? AND TRUNC (SYSDATE) BETWEEN TRUNC (A.GDT_EFFECTIVE_FRM) AND TRUNC (NVL (A.GDT_EFFECTIVE_TO, SYSDATE)) UNION SELECT A.HPMRNUM_PROFILE_ID, A.HPMRSTR_PROFILE_HEADER FROM HPMRT_PAT_PROFILE_DTL A WHERE A.HRGNUM_PUK \= ? AND A.hpmrnum_profile_status  \=2 AND A.GNUM_ISVALID \= ?  and a.gnum_hospital_code\=? AND TRUNC (SYSDATE) BETWEEN TRUNC (A.GDT_EFFECTIVE_FRM) AND TRUNC (NVL (A.GDT_EFFECTIVE_TO, SYSDATE)) AND ? IN (SELECT DISTINCT B.HGNUM_DEPTUNITCODE FROM HPMRT_PROFILE_ACCESS_DTL B WHERE B.HPMRNUM_PROFILE_ID \= A.HPMRNUM_PROFILE_ID AND B.GNUM_ISVALID \= ? and a.gnum_hospital_code\=b.gnum_hospital_code) UNION SELECT A.HPMRNUM_PROFILE_ID, A.HPMRSTR_PROFILE_HEADER FROM HPMRT_PAT_PROFILE_DTL A WHERE A.HRGNUM_PUK \= ? AND A.GNUM_ISVALID \= ?  and a.gnum_hospital_code\=? AND TRUNC (SYSDATE) BETWEEN TRUNC (A.GDT_EFFECTIVE_FRM) AND TRUNC (NVL (A.GDT_EFFECTIVE_TO, SYSDATE)) AND ? IN (SELECT DISTINCT B.GNUM_USER_ID FROM HPMRT_PROFILE_ACCESS_DTL B WHERE B.HPMRNUM_PROFILE_ID \= A.HPMRNUM_PROFILE_ID AND B.GNUM_ISVALID \= ? and a.gnum_hospital_code\=b.gnum_hospital_code)
 													
#modifed for snomed-ct integration by manisha gangwar date: 22.8.2016
INSERT.CREATE.HPMRT_PAT_PROFILE_DTL	=INSERT INTO HPMRT_PAT_PROFILE_DTL (HPMRNUM_PROFILE_ID, HPMRNUM_SLNO, HRGNUM_PUK, HRGNUM_EPISODE_CODE, HRGNUM_VISIT_NO, HGNUM_DEPTUNITCODE, HRGNUM_ADMISSION_NO, HPMRSTR_PROFILE_HEADER, HPMRNUM_PROFILE_TYPE, HPMRNUM_ACCESS_TYPE, HPMRNUM_USER_LEVEL, HPMRSTR_PROFILE_REMARK, GNUM_ISVALID, GNUM_SEAT_ID, GDT_ENTRY_DATE, GDT_EFFECTIVE_FRM, GNUM_HOSPITAL_CODE,HPMRNUM_PROFILE_STATUS) VALUES (?, (SELECT NVL(MAX(HPMRNUM_SLNO),0)+1 FROM HPMRT_PAT_PROFILE_DTL WHERE HPMRNUM_PROFILE_ID\=?), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, SYSDATE, SYSDATE,?,?)

#UPDATE.OLD_RECORD.HPMRT_PAT_PROFILE_DTL	=	UPDATE HPMRT_PAT_PROFILE_DTL SET GNUM_ISVALID=?, GDT_LSTMOD_DATE=SYSDATE, GNUM_LSTMOD_SEATID=? \
#											WHERE HPMRNUM_PROFILE_ID=(SELECT HPMRNUM_PROFILE_ID FROM HPMRT_PAT_PROFILE_DTL WHERE HPMRNUM_PROFILE_TYPE=? and HRGNUM_PUK=? and GNUM_ISVALID=1) AND GNUM_HOSPITAL_CODE=?

UPDATE.OLD_RECORD.HPMRT_PAT_PROFILE_DTL	=UPDATE HPMRT_PAT_PROFILE_DTL SET GNUM_ISVALID\=?, GDT_LSTMOD_DATE\=SYSDATE, GNUM_LSTMOD_SEATID\=? WHERE HPMRNUM_PROFILE_ID\=? and HPMRNUM_SLNO\=? and GNUM_ISVALID\=1 AND GNUM_HOSPITAL_CODE\=? 

// Modified to add cut off time By Shruti Shail on 27-Oct-2016
INSERT.NEW.OPD.HRGT_EPISODE_DRUG_DTL_OLD	=INSERT INTO HRGT_EPISODE_DRUG_DTL (HRGNUM_PUK, HRGNUM_EPISODE_CODE, HRGNUM_VISIT_NO, HRGNUM_S_NO, HRGNUM_ADMISSION_NO, HSTNUM_ITEM_ID, HSTSTR_ITEM_NAME, hstnum_itembrand_id, HGNUM_DOSE_ID, HGSTR_DOSE_NAME, HGNUM_FREQUENCY_ID, HGNUM_DAYS, HRGDT_START_DATE, HRGDT_END_DATE, HRGSTR_REMARKS, PSRSTR_EMP_NO, HBNUM_RX_CONTINUE, GNUM_SEAT_ID, GDT_ENTRY_DATE, GNUM_ISVALID, GNUM_HOSPITAL_CODE ,HGNUM_ISEMPTY_STOMACH,HGNUM_DRUG_ROUTE_ID,HGNUM_DOSE_QTY, HSTNUM_ISSUE_QTY, HSTNUM_REQUIRED_QTY,HRGNUM_ENTRY_MODE) VALUES (?,?,?,(SELECT NVL(MAX(HRGNUM_S_NO),0)+1 FROM HRGT_EPISODE_DRUG_DTL WHERE HRGNUM_PUK\=? AND HRGNUM_EPISODE_CODE\=? AND HRGNUM_VISIT_NO\=?),?,?,?,?,?,?,?,?,to_date(? ,'dd-mm-yyyy hh24\:mi')+?,TRUNC(SYSDATE)+?+?-1,?,?,?,?,to_date(?,'dd-MM-yyyy hh24\:mi'),?,?,?,?,?,?,?,?) 

INSERT.NEW.OPD.HRGT_EPISODE_DRUG_DTL	=INSERT INTO HRGT_EPISODE_DRUG_DTL (HRGNUM_PUK, HRGNUM_EPISODE_CODE, HRGNUM_VISIT_NO, HRGNUM_S_NO, HRGNUM_ADMISSION_NO, HSTNUM_ITEM_ID, HSTSTR_ITEMBRAND_NAME, hstnum_itembrand_id, HGNUM_DOSE_ID, HGSTR_DOSE_NAME, HGNUM_FREQUENCY_ID, HGNUM_DAYS, HRGDT_START_DATE, HRGDT_END_DATE, HRGSTR_REMARKS, PSRSTR_EMP_NO, HBNUM_RX_CONTINUE, GNUM_SEAT_ID, GDT_ENTRY_DATE, GNUM_ISVALID, GNUM_HOSPITAL_CODE ,HGNUM_ISEMPTY_STOMACH,HGNUM_DRUG_ROUTE_ID,HGNUM_DOSE_QTY, HSTNUM_ISSUE_QTY, HSTNUM_REQUIRED_QTY,HRGNUM_ENTRY_MODE,HSTSTR_ITEM_NAME,hstnum_itemtype_id) VALUES (?,?,?,(SELECT NVL(MAX(HRGNUM_S_NO),0)+1 FROM HRGT_EPISODE_DRUG_DTL WHERE HRGNUM_PUK\=? AND HRGNUM_EPISODE_CODE\=? AND HRGNUM_VISIT_NO\=?),?,?,?,?,?,?,?,?,to_date(? ,'dd-mm-yyyy hh24\:mi')+?, TRUNC(SYSDATE)+?+?-1,?,?,?,?,to_date(?,'dd-MM-yyyy hh24\:mi'),?,?,?,?,?,?,?,? , (SELECT pkg_opd_func.get_drugitem_name('','',?,'','')),?) 
INSERT.REVOKED_TREATMENT.HRGT_EPISODE_DRUG_DTL_OLD = INSERT INTO HRGT_EPISODE_DRUG_DTL (HRGNUM_PUK, HRGNUM_EPISODE_CODE, HRGNUM_VISIT_NO, HRGNUM_S_NO, HRGNUM_ADMISSION_NO, HSTNUM_ITEM_ID, HSTSTR_ITEM_NAME, hstnum_itembrand_id,HGNUM_DOSE_ID, HGSTR_DOSE_NAME, HGNUM_FREQUENCY_ID, HGNUM_DAYS, HRGDT_START_DATE, HRGDT_END_DATE, HRGSTR_REMARKS, PSRSTR_EMP_NO, HBNUM_RX_CONTINUE, GNUM_SEAT_ID, GDT_ENTRY_DATE, GNUM_ISVALID, GNUM_HOSPITAL_CODE ,HGNUM_ISEMPTY_STOMACH,HGNUM_DRUG_ROUTE_ID,HGNUM_DOSE_QTY, HSTNUM_ISSUE_QTY, HSTNUM_REQUIRED_QTY,HRGNUM_ENTRY_MODE,hrgstr_revoke_remarks) VALUES (?,?,?,(SELECT NVL(MAX(HRGNUM_S_NO),0)+1 FROM HRGT_EPISODE_DRUG_DTL WHERE HRGNUM_PUK\=? AND HRGNUM_EPISODE_CODE\=? AND HRGNUM_VISIT_NO\=?),?,?,?,?,?,?,?,?,to_date(? ,'dd-Mon-yyyy'),to_date(?,'dd-Mon-yyyy'),?,?,?,?,to_date(?,'dd-MM-yyyy hh24\:mi'),?,?,?,?,?,?,?,?,?) 
INSERT.REVOKED_TREATMENT.HRGT_EPISODE_DRUG_DTL = INSERT INTO HRGT_EPISODE_DRUG_DTL (HRGNUM_PUK, HRGNUM_EPISODE_CODE, HRGNUM_VISIT_NO, HRGNUM_S_NO, HRGNUM_ADMISSION_NO, HSTNUM_ITEM_ID, HSTSTR_ITEMBRAND_NAME, hstnum_itembrand_id,HGNUM_DOSE_ID, HGSTR_DOSE_NAME, HGNUM_FREQUENCY_ID, HGNUM_DAYS, HRGDT_START_DATE, HRGDT_END_DATE, HRGSTR_REMARKS, PSRSTR_EMP_NO, HBNUM_RX_CONTINUE, GNUM_SEAT_ID, GDT_ENTRY_DATE, GNUM_ISVALID, GNUM_HOSPITAL_CODE ,HGNUM_ISEMPTY_STOMACH,HGNUM_DRUG_ROUTE_ID, HGNUM_DOSE_QTY, HSTNUM_ISSUE_QTY, HSTNUM_REQUIRED_QTY,HRGNUM_ENTRY_MODE,hrgstr_revoke_remarks,HSTSTR_ITEM_NAME,hstnum_itemtype_id) VALUES (?,?,?,(SELECT NVL(MAX(HRGNUM_S_NO),0)+1 FROM HRGT_EPISODE_DRUG_DTL WHERE HRGNUM_PUK\=? AND HRGNUM_EPISODE_CODE\=? AND HRGNUM_VISIT_NO\=?),?,?,?,?,?,?,?,?,to_date(? ,'dd-Mon-yyyy'),to_date(?,'dd-Mon-yyyy'), ?,?,?,?,to_date(?,'dd-MM-yyyy hh24\:mi'),?,?,?,?,?,?,?,?,?, (SELECT pkg_opd_func.get_drugitem_name('','',?,'','')),?) 


UPDATE.OPD.HRGT_EPISODE_DRUG_DTL = update HRGT_EPISODE_DRUG_DTL set HBNUM_RX_CONTINUE\=? ,HRGDT_END_DATE\=sysdate where HRGNUM_PUK\=? and HRGNUM_EPISODE_CODE\=?  and HRGNUM_VISIT_NO\=? and HRGNUM_S_NO\=?  and GNUM_HOSPITAL_CODE\=? and GNUM_ISVALID\=?
									
INSERT.NEW.OPD.HRGT_EPISODE_RESTADVICE_DTL = INSERT INTO HRGT_EPISODE_RESTADVICE_DTL (HRGNUM_PUK, HRGNUM_EPISODE_CODE,HRGNUM_S_NO, HRGNUM_ADMISSION_NO,HRGNUM_VISIT_NO, HRGSTR_REST_REASON,GNUM_SEAT_ID,GDT_ENTRY_DATE,HGNUM_ADVICE_DAYS,GNUM_ISVALID,HRGDT_START_DATE, HRGDT_END_DATE,HRGSTR_REMARKS,GNUM_HOSPITAL_CODE,PSRSTR_EMP_NO,HRGNUM_CERTIFICATE_STATUS)  VALUES (?,?,(SELECT NVL(MAX(HRGNUM_S_NO),0)+1 FROM HRGT_EPISODE_RESTADVICE_DTL WHERE HRGNUM_PUK\=? AND HRGNUM_EPISODE_CODE\=? AND HRGNUM_VISIT_NO\=?),?,?,?,?,SYSDATE,?,?,SYSDATE,TRUNC(SYSDATE)+?-1,?,?,?,?)

INSERT.NEW.OPD.HRGT_EPISODE_EXTTREATMENT_DTL = insert into HRGT_EPISODE_EXTTREATMENT_DTL(HRGNUM_PUK, HRGNUM_EPISODE_CODE,HRGNUM_S_NO,HRGNUM_ADMISSION_NO, HRGNUM_VISIT_NO,HGNUM_EXT_TREATMENT_ID,HGNUM_DOSE_ID,GNUM_SEAT_ID,HGSTR_DOSE_NAME,HGNUM_FREQUENCY_ID,GDT_ENTRY_DATE, HGNUM_DAYS,GNUM_ISVALID,HRGDT_START_DATE,HRGDT_END_DATE,HRGSTR_REMARKS,GNUM_HOSPITAL_CODE,PSRSTR_EMP_NO,HBNUM_RX_CONTINUE,HRGNUM_ISMASTER_BOUND,HGSTR_EXT_TREATMENT_NAME,HGNUM_TREATMENT_TYPE ) values(?,?,(SELECT NVL(MAX(HRGNUM_S_NO),0)+1 FROM HRGT_EPISODE_EXTTREATMENT_DTL WHERE HRGNUM_PUK\=? AND HRGNUM_EPISODE_CODE\=? AND HRGNUM_VISIT_NO\=?), ?,?,?,?,?,?,?,trunc(sysdate),?,?,TRUNC(SYSDATE)+?,TRUNC(SYSDATE)+?+?-1,?,?,?,?,?,?,?)
												
INSERT.NEW.OPD.HRGT_EPISODE_DIETADVICE_DTL = INSERT INTO HRGT_EPISODE_DIETADVICE_DTL (HRGNUM_PUK, HRGNUM_EPISODE_CODE,HRGNUM_S_NO,  HRGNUM_ADMISSION_NO,HRGNUM_VISIT_NO, HDMNUM_DIET_TYPE_CODE,GNUM_SEAT_ID,GDT_ENTRY_DATE,HGNUM_ADVICE_DAYS,GNUM_ISVALID,HRGDT_START_DATE, HRGDT_END_DATE,HRGSTR_REMARKS,GNUM_HOSPITAL_CODE,PSRSTR_EMP_NO)  VALUES (?,?,(SELECT NVL(MAX(HRGNUM_S_NO),0)+1 FROM HRGT_EPISODE_DIETADVICE_DTL WHERE HRGNUM_PUK\=? AND HRGNUM_EPISODE_CODE\=? AND HRGNUM_VISIT_NO\=?),?,?,?,?,SYSDATE,?,?,SYSDATE,TRUNC(SYSDATE)+?-1,?,?,?)\t
												
UPDATE.OPD.HRGT_EPISODE_RESTADVICE_DTL = update HRGT_EPISODE_RESTADVICE_DTL set GNUM_ISVALID\=?  where HRGNUM_PUK\=? and HRGNUM_EPISODE_CODE\=? and HRGNUM_VISIT_NO\=? and GNUM_HOSPITAL_CODE\=? \t\t
										
UPDATE.OPD.HRGT_EPISODE_DIETADVICE_DTL = update HRGT_EPISODE_DIETADVICE_DTL set GNUM_ISVALID=? where HRGNUM_PUK=? and HRGNUM_EPISODE_CODE=? and HRGNUM_S_NO=? and HRGNUM_VISIT_NO=? and GNUM_HOSPITAL_CODE=? 		

PATIENT_DRUG_ALLERGY_STATUS = select PKG_MRD_DTL.PatientDrugAllergy(?,?,?) from dual

SELECT_DRUG_CONSENT_STATUS.HGBT_CONSENT_MAPPING = select count(*) from HGBT_CONSENT_MAPPING where HGSTR_SERVICE_ID=? and GNUM_HOSPITAL_CODE=? and GNUM_ISVALID=? and HGNUM_SERVICE_TYPE_ID=?

SELECT_PREV_DRUG_STATUS.HRGT_EPISODE_DRUG_DTL = SELECT b.hgnum_deptunitcode, pkg_clinical_gbl_fun.get_dept_name(b.gnum_hospital_code\:\:character varying,b.gnum_dept_code\:\:character varying)|| ' (' || pkg_clinical_gbl_fun.get_deptunit_name(b.gnum_hospital_code\:\:character varying,b.hgnum_deptunitcode\:\:character varying) || ')' || DECODE(b.gnum_hospital_code,?,'', ' (' || pkg_clinical_gbl_fun.gethospitalname(b.gnum_hospital_code\:\:character varying) || ')' ) AS unit FROM hrgt_episode_dtl b WHERE b.hrgnum_puk \= ? AND b.hrgnum_is_episode_open \= ? AND b.hgnum_deptunitcode NOT IN (?) AND b.hrgnum_visit_no IN ( SELECT MAX (a.hrgnum_visit_no) FROM hrgt_episode_drug_dtl a WHERE a.hrgnum_puk \= b.hrgnum_puk AND a.gnum_hospital_code \= b.gnum_hospital_code AND a.hrgnum_episode_code \= b.hrgnum_episode_code AND a.hstnum_item_id \= ? AND TRUNC (SYSDATE) BETWEEN a.hrgdt_start_date AND a.hrgdt_end_date AND a.hbnum_rx_continue <> ? AND a.gnum_isvalid \= ?) 



REVOKE.HRGT_EPISODE_DIAGNOSIS_DTL = UPDATE HRGT_EPISODE_DIAGNOSIS_DTL SET HBNUM_ISREPEAT \= ? WHERE HRGNUM_PUK \= ? AND HRGNUM_EPISODE_CODE \= ? AND HRGNUM_DIAGNOSTIC_CODE \= ? AND HRGNUM_VISIT_NO \= ? AND HRGNUM_DIAGNOSIS_CODE_TYPE \=? AND GNUM_HOSPITAL_CODE \= ?\t\t\t\t\t\t\t\t\t\t\t

SELECT.LAST_RECORD_VALUE.HIPD_PAT_CLINICAL_DTL	=SELECT DISTINCT TO_CHAR(A.HRGDT_RECORD_DATE,'dd-Mon-yyyy HH24\:MI') AS recordDate,  A.HGNUM_PARA_ID AS paraId, A.HGSTR_PARA_VALUE AS paraValue FROM HIPD_PAT_CLINICAL_DTL A WHERE A.HRGNUM_ADMISSION_NO\=? AND A.GNUM_HOSPITAL_CODE\=? AND A.GNUM_ISVALID\=? AND HGNUM_PARA_ID IN(\#) AND HRGDT_RECORD_DATE\=(SELECT NVL(MAX(HRGDT_RECORD_DATE),SYSDATE) FROM HIPD_PAT_CLINICAL_DTL WHERE HRGNUM_ADMISSION_NO\=? AND GNUM_HOSPITAL_CODE\=? AND GNUM_ISVALID\=? AND HGNUM_PARA_ID\=A.HGNUM_PARA_ID)


SELECT_PAT_ALERT.HPMRT_PAT_ALERTS_DTL1 = SELECT A.HGSTR_ALERT_NAME AS ALERTNAME, A.HGNUM_PAT_ALERT_ID AS PATALERTID, A.HRGDT_EFFECTIVE_FRM AS effectiveFrom, A.HBSTR_REMARKS AS REMARKS, ahis_util.age_YR_MON_DAY(hrgdt_duration_date,trunc(sysdate)) AS durationDays, DATE_PART('day',((trunc(SYSDATE) - trunc(HRGDT_DURATION_DATE))))/365 AS DURATIONDATE, HRGDT_EFFECTIVE_TO AS EFFECTIVETO, HRGSTR_REVOKE_REMARKS AS REVOKEREMARKS , b.hgnum_snomedct_concept_id AS snomedCtId FROM HPMRT_PAT_ALERTS_DTL A, hgbt_pat_alert_mst b WHERE HRGNUM_PUK \= ? AND A.GNUM_ISVALID \= ? AND A.GNUM_HOSPITAL_CODE \= ? AND TRUNC(NVL(HRGDT_EFFECTIVE_TO,SYSDATE+1)) > TRUNC(SYSDATE) and A.HGNUM_PAT_ALERT_ID\=B.HGNUM_PAT_ALERT_ID ORDER BY A.HGSTR_ALERT_NAME

/* Added By Pawan Kumar B N on 20-Mar-2013 */        
SELECT_PAT_ALERT.HPMRT_PAT_ALERTS_DTL2 = SELECT A.HGSTR_ALERT_NAME AS ALERTNAME, A.HGNUM_PAT_ALERT_ID AS PATALERTID, A.HRGDT_EFFECTIVE_FRM AS effectiveFrom, A.HBSTR_REMARKS AS REMARKS, ahis_util.age_YR_MON_DAY(hrgdt_duration_date,trunc(sysdate)) AS durationDays, DATE_PART('day',((trunc(SYSDATE) - trunc(HRGDT_DURATION_DATE))))/365 AS DURATIONDATE, HRGDT_EFFECTIVE_TO AS EFFECTIVETO, HRGSTR_REVOKE_REMARKS AS REVOKEREMARKS , b.hgnum_snomedct_concept_id AS snomedCtId FROM HPMRT_PAT_ALERTS_DTL A, hgbt_pat_alert_mst b WHERE HRGNUM_PUK \= ? AND A.GNUM_ISVALID \= ? AND TRUNC(NVL(HRGDT_EFFECTIVE_TO,SYSDATE+1)) > TRUNC(SYSDATE) and A.HGNUM_PAT_ALERT_ID\=B.HGNUM_PAT_ALERT_ID ORDER BY A.HGSTR_ALERT_NAME\t\t\t\t\t\t\t\t\t\t\t
SELECT_PAT_ALERT.HPMRT_PAT_ALERTS_DTL = SELECT A.HGSTR_ALERT_NAME AS ALERTNAME, A.HGNUM_PAT_ALERT_ID AS PATALERTID, A.HRGDT_EFFECTIVE_FRM AS effectiveFrom, A.HBSTR_REMARKS AS REMARKS, ahis_util.age_YR_MON_DAY(hrgdt_duration_date,trunc(sysdate)) AS durationDays, DATE_PART('day',((trunc(SYSDATE) - trunc(HRGDT_DURATION_DATE))))/365 AS DURATIONDATE, HRGDT_EFFECTIVE_TO AS EFFECTIVETO, HRGSTR_REVOKE_REMARKS AS REVOKEREMARKS  FROM HPMRT_PAT_ALERTS_DTL A WHERE HRGNUM_PUK \= ? AND A.GNUM_ISVALID \= ? AND TRUNC(NVL(HRGDT_EFFECTIVE_TO,SYSDATE+1)) > TRUNC(SYSDATE) ORDER BY A.HGSTR_ALERT_NAME\t\t\t\t\t\t\t\t\t\t\t



INSERT.HPMRT_PAT_ALERTS_DTL = INSERT INTO HPMRT_PAT_ALERTS_DTL(HRGNUM_PUK, HRGNUM_S_NO, HGSTR_ALERT_NAME, HGNUM_PAT_ALERT_ID, HRGDT_EFFECTIVE_FRM, HBSTR_REMARKS, HRGDT_DURATION_DATE, HRGDT_EFFECTIVE_TO, HRGSTR_REVOKE_REMARKS, GNUM_ISVALID, GNUM_SEAT_ID, GNUM_HOSPITAL_CODE, GDT_ENTRY_DATE, HRGSTR_IP_ADD) VALUES(?,(SELECT NVL(MAX(HRGNUM_S_NO),0)+1 FROM HPMRT_PAT_ALERTS_DTL WHERE HRGNUM_PUK \= ?),?,?,SYSDATE,?,TRUNC(TRUNC(SYSDATE) - (?*365 + (?/4) ) ),?\:\:timestamp,?,?,?,?,SYSDATE,?)\t


INSERT.HRGT_EPISODE_ALERT_DTL = INSERT INTO HRGT_EPISODE_ALERT_DTL (HRGNUM_PUK, HRGNUM_EPISODE_CODE, HRGNUM_VISIT_NO, HRGNUM_S_NO, HGNUM_PAT_ALERT_ID, HRGNUM_ADMISSION_NO, HRGSTR_REMARKS, HRGDT_DURATION_DATE, HRGNUM_ISREVOKED, GNUM_ISVALID, GNUM_SEAT_ID, GDT_ENTRY_DATE, HGSTR_ALERT_NAME, GNUM_HOSPITAL_CODE, HRGSTR_IP_ADD)VALUES(?,?,?,(SELECT NVL(MAX(HRGNUM_S_NO),0)+1 FROM HRGT_EPISODE_ALERT_DTL WHERE HRGNUM_PUK \= ? AND HRGNUM_EPISODE_CODE \= ? AND HRGNUM_VISIT_NO \= ?),?,?,?,TRUNC(TRUNC(SYSDATE) - (?*365 + (?/4) )  ),?,?,?,SYSDATE,?,?,?)
					
UPDATE_REVOKE_ALERT.HPMRT_PAT_ALERTS_DTL1 = UPDATE HPMRT_PAT_ALERTS_DTL SET HRGDT_EFFECTIVE_TO \= SYSDATE, HRGSTR_REVOKE_REMARKS \= ? WHERE HRGNUM_PUK \= ? AND HGNUM_PAT_ALERT_ID \= ? AND GNUM_HOSPITAL_CODE \= ?
UPDATE_REVOKE_ALERT.HPMRT_PAT_ALERTS_DTL = UPDATE HPMRT_PAT_ALERTS_DTL SET HRGDT_EFFECTIVE_TO \= SYSDATE, HRGSTR_REVOKE_REMARKS \= ? WHERE HRGNUM_PUK \= ? AND HGNUM_PAT_ALERT_ID \= ?\t\t\t\t\t\t\t\t\t\t


SELECT_PATIENT_ALL_ALERT.HPMRT_PAT_ALERTS_DTL.OLD = SELECT A.HGSTR_ALERT_NAME as alertName, A.HGNUM_PAT_ALERT_ID as patAlertId, TO_CHAR(HRGDT_EFFECTIVE_FRM,'dd-Mon-yyyy') as effectiveFrom, A.HBSTR_REMARKS as remarks, ahis_util.age_YR_MON_DAY(hrgdt_duration_date,trunc(sysdate)) as durationDays, (trunc(SYSDATE) - trunc(HRGDT_DURATION_DATE)) AS DURATIONDATE, TO_CHAR(HRGDT_EFFECTIVE_TO,'dd-Mon-yyyy') as effectiveTo, A.HRGSTR_REVOKE_REMARKS as revokeRemarks, TO_CHAR(A.GDT_ENTRY_DATE,'dd-Mon-yyyy') as entryDate,B.hgnum_snomedct_concept_id AS snomedCtId FROM HPMRT_PAT_ALERTS_DTL A,hgbt_pat_alert_mst B WHERE A.HRGNUM_PUK \= ? and A.GNUM_HOSPITAL_CODE \= ? and A.HGNUM_PAT_ALERT_ID\=B.HGNUM_PAT_ALERT_ID ORDER BY A.GDT_ENTRY_DATE DESC\t\t\t\t\t\t\t\t\t\t\t
#MODIFIED FOR SNOMED INTEGRATION DATE: 30.9.2016
SELECT_PATIENT_ALL_ALERT.HPMRT_PAT_ALERTS_DTL = SELECT A.HGSTR_ALERT_NAME as alertName, A.HGNUM_PAT_ALERT_ID as patAlertId, TO_CHAR(HRGDT_EFFECTIVE_FRM,'dd-Mon-yyyy') as effectiveFrom, A.HBSTR_REMARKS as remarks, ahis_util.age_YR_MON_DAY(hrgdt_duration_date,trunc(sysdate)) as durationDays, (trunc(SYSDATE) - trunc(HRGDT_DURATION_DATE)) AS DURATIONDATE, TO_CHAR(HRGDT_EFFECTIVE_TO,'dd-Mon-yyyy') as effectiveTo, A.HRGSTR_REVOKE_REMARKS as revokeRemarks, TO_CHAR(A.GDT_ENTRY_DATE,'dd-Mon-yyyy') as entryDate FROM HPMRT_PAT_ALERTS_DTL A WHERE A.HRGNUM_PUK \= ? and A.GNUM_HOSPITAL_CODE \= ? ORDER BY A.GDT_ENTRY_DATE DESC\t\t\t\t\t\t\t\t\t\t\t



SELECT.PATINFOBYCRNO.HRGT_EPISODE_DTL	=SELECT hrgnum_episode_code, hrgnum_visit_no FROM hrgt_episode_dtl WHERE hrgnum_puk \=? and trunc(GDT_ENTRY_DATE)\=trunc(sysdate) and GNUM_ISVALID\=? and GNUM_HOSPITAL_CODE\=?

DELETE.HPMRT_PROFILE_ACCESS_DTL	=UPDATE HPMRT_PROFILE_ACCESS_DTL SET GNUM_ISVALID\=?,GDT_LSTMOD_DATE\=SYSDATE, GNUM_LSTMOD_SEATID\=? WHERE HPMRNUM_PROFILE_ID\=? AND GNUM_ISVALID\=?

INSERT.CREATE.HPMRT_PROFILE_ACCESS_DTL	=INSERT INTO HPMRT_PROFILE_ACCESS_DTL (HPMRNUM_PROFILE_ID, GNUM_SLNO, GNUM_USER_ID, HGNUM_DEPTUNITCODE, HIPNUM_WARD_CODE, GNUM_ISVALID, GNUM_SEAT_ID, HPMRNUM_ACCESS_TYPE, GDT_ENTRY_DATE, GNUM_HOSPITAL_CODE) VALUES (?, (SELECT NVL(MAX(GNUM_SLNO),0)+1 FROM HPMRT_PROFILE_ACCESS_DTL WHERE HPMRNUM_PROFILE_ID\=?), ?, ?, ?, ?, ?, ?,SYSDATE, ?)
INSERT.HRGT_EPISODE_DRUG_SCHEDULE_DTL = insert into HRGT_EPISODE_DRUG_SCHEDULE_DTL(HRGNUM_PUK,HRGNUM_EPISODE_CODE,HRGNUM_S_NO,HRGNUM_SCHEDULE_SLNO, \
										HRGNUM_VISIT_NO,HSTNUM_ITEM_ID,HGNUM_DOSE_ID,GNUM_SEAT_ID,HGSTR_DOSE_NAME,HGSTR_DOSE_TIME,GDT_ENTRY_DATE, \
										HGNUM_ISEMPTY_STOMACH,GNUM_ISVALID,HGNUM_DOSE_SHIFT,HRGSTR_REMARKS,GNUM_HOSPITAL_CODE,HGSTR_CUTOFF_TIME_LEFT,HGSTR_CUTOFF_TIME_RIGHT)  \
										values(?,?,?,?,?,?,?,?,?,?,sysdate,?,?,?,?,?,?,?)

SELECT.PROFILES_ACCESSES.HPMRT_PROFILE_ACCESS_DTL	=SELECT A.GNUM_USER_ID AS userId,C.HPMRNUM_USER_LEVEL as userLevel, (SELECT INITCAP(B.GSTR_USER_NAME)  FROM GBLT_USER_MST B WHERE A.GNUM_USER_ID \= B.GNUM_USERID AND A.GNUM_HOSPITAL_CODE\=B.GNUM_HOSPITAL_CODE AND B.GNUM_ISVALID\=? AND TRUNC(SYSDATE) BETWEEN TRUNC(B.GDT_EFFECT_DATE) AND TRUNC(NVL(B.GDT_EXPIRY_DATE,SYSDATE)) ) as userSeatId, (SELECT B.PSRSTR_EMP_NO  FROM GBLT_USER_MST B WHERE A.GNUM_USER_ID \= B.GNUM_USERID AND A.GNUM_HOSPITAL_CODE\=B.GNUM_HOSPITAL_CODE AND B.GNUM_ISVALID\=? AND TRUNC(SYSDATE) BETWEEN TRUNC(B.GDT_EFFECT_DATE) AND TRUNC(NVL(B.GDT_EXPIRY_DATE,SYSDATE)) ) as userEmpID, (SELECT INITCAP(B.GSTR_USR_NAME)  FROM GBLT_USER_MST B WHERE A.GNUM_USER_ID \= B.GNUM_USERID AND A.GNUM_HOSPITAL_CODE\=B.GNUM_HOSPITAL_CODE AND B.GNUM_ISVALID\=? AND TRUNC(SYSDATE) BETWEEN TRUNC(B.GDT_EFFECT_DATE) AND TRUNC(NVL(B.GDT_EXPIRY_DATE,SYSDATE)) ) as userName, (SELECT B.GNUM_DESIGNATION  FROM GBLT_USER_MST B WHERE A.GNUM_USER_ID \= B.GNUM_USERID AND A.GNUM_HOSPITAL_CODE\=B.GNUM_HOSPITAL_CODE AND B.GNUM_ISVALID\=? AND TRUNC(SYSDATE) BETWEEN TRUNC(B.GDT_EFFECT_DATE) AND TRUNC(NVL(B.GDT_EXPIRY_DATE,SYSDATE)) ) as userType, A.HGNUM_DEPTUNITCODE AS departmentUnitCode, A.HIPNUM_WARD_CODE AS wardCode, DECODE(C.HPMRNUM_ACCESS_TYPE,0,0,A.HPMRNUM_ACCESS_TYPE) as accessType FROM HPMRT_PROFILE_ACCESS_DTL A,HPMRT_PAT_PROFILE_DTL C WHERE C.HPMRNUM_PROFILE_ID \= ? AND A.HPMRNUM_PROFILE_ID(+)\=C.HPMRNUM_PROFILE_ID and A.GNUM_ISVALID(+)\=C.GNUM_ISVALID AND C.GNUM_ISVALID \= ? ORDER BY departmentUnitCode,userId,wardCode


SELECT_MAX_SLNO.HRGT_EPISODE_DRUG_SCHEDULE_DTL = select nvl(max(HRGNUM_S_NO),0)+1 from HRGT_EPISODE_DRUG_DTL  where HRGNUM_PUK\=? and HRGNUM_EPISODE_CODE\=? and  HRGNUM_VISIT_NO\=? and GNUM_HOSPITAL_CODE\=?

INSERT_EXT_INV.HRGT_EPISODE_EXTINV_DTL = INSERT INTO HRGT_EPISODE_EXTEXAM_DTL(HRGNUM_PUK, HRGNUM_EPISODE_CODE, HRGNUM_SLNO, HRGDT_ENTRY_DATE, HRGDT_RECORD_DATE, HRGNUM_VISIT_NO, HRGNUM_ADMISSION_NO, HGSTR_PARA_VALUE, HGNUM_PARA_ID, GNUM_ISVALID, HGSTR_TEST_NAME, GNUM_SEAT_ID, GDT_ENTRY_DATE, HRGSTR_EXTLAB_NAME, GNUM_HOSPITAL_CODE, HRGSTR_EXTLAB_ADD, HRGSTR_EXTLAB_CONTACTNO, HRGSTR_MIN_VALUE, HRGSTR_MAX_VALUE, HRGSTR_REMARKS, HRGNUM_ENTRY_MODE,HRGNUM_FROM_LAB)VALUES(?,?,(SELECT NVL(MAX(HRGNUM_SLNO),0)+1 FROM HRGT_EPISODE_EXTEXAM_DTL WHERE HRGNUM_PUK \= ? AND TRUNC(HRGDT_ENTRY_DATE)\=TRUNC(SYSDATE)),SYSDATE,TO_DATE(?,'dd-Mon-yyyy hh24\:mi'),?,?,?,?,?,?,?,SYSDATE,?,?,?,?,?,?,?,?,?)

SELECT_ADDED_EXT_INV.HRGT_EPISODE_EXTINV_DTL = SELECT TO_CHAR(A.HRGDT_RECORD_DATE,'dd-Mon-yyyy hh24\:mi') as recordDate, A.HGSTR_PARA_VALUE as paraValue, A.HGNUM_PARA_ID as paraId, (SELECT HGSTR_PARA_NAME FROM HGBT_PARAMETER_MST WHERE HGNUM_PARA_ID\=A.HGNUM_PARA_ID AND GNUM_HOSPITAL_CODE\=?) as paraName FROM HRGT_EPISODE_EXTEXAM_DTL A WHERE A.HRGNUM_PUK \= ? AND A.GNUM_ISVALID \= ? AND A.GNUM_HOSPITAL_CODE \= ? ORDER BY A.HRGDT_RECORD_DATE DESC\t\t\t\t\t\t\t\t\t\t\t

SELECT.EPISODE_EXT_INVS.HRGT_EPISODE_EXTINV_DTL =SELECT TO_CHAR(A.HRGDT_RECORD_DATE,'dd-Mon-yyyy hh24\:mi') as recordDate, A.HGSTR_PARA_VALUE as paraValue, A.HGNUM_PARA_ID as paraId, (SELECT HGSTR_PARA_NAME FROM HGBT_PARAMETER_MST WHERE HGNUM_PARA_ID\=A.HGNUM_PARA_ID AND GNUM_HOSPITAL_CODE\=100 AND GNUM_ISVALID\=1) as paraName FROM HRGT_EPISODE_EXTEXAM_DTL A WHERE A.HRGNUM_PUK \= ? AND A.HRGNUM_EPISODE_CODE\=? AND A.GNUM_ISVALID \= ? AND A.GNUM_HOSPITAL_CODE \= ?\t\t\t\t\t\t\t\t\t\t\t

UPDATE.OPD.HRGT_EPISODE_EXTTREATMENT_DTL = update HRGT_EPISODE_EXTTREATMENT_DTL set HBNUM_RX_CONTINUE\=? where HRGNUM_PUK\=? and HRGNUM_EPISODE_CODE\=?  and HRGNUM_VISIT_NO\=? and HRGNUM_S_NO\=?  and GNUM_HOSPITAL_CODE\=? and GNUM_ISVALID\=?
UPDATE_REVOKE.HRGT_EPISODE_DRUG_SCHEDULE_DTL = update HRGT_EPISODE_DRUG_SCHEDULE_DTL set GNUM_ISVALID\=? where HRGNUM_PUK\=? and HRGNUM_EPISODE_CODE\=? and HRGNUM_VISIT_NO\=? and GNUM_HOSPITAL_CODE\=? and HSTNUM_ITEM_ID\=? and HRGNUM_S_NO\=? and HRGNUM_SCHEDULE_SLNO\=? and trunc(GDT_ENTRY_DATE)\=to_date(?,'dd-mon-yyyy')

												
INSERT.HPMRT_PROFILE_DIAGNOSIS_DTL=INSERT INTO HPMRT_PROFILE_DIAGNOSIS_DTL(HPMRNUM_PROFILE_ID,HGBSTR_DIAGNOSTIC_TYPE_NAME,HGBSTR_DISEASE_NAME,GNUM_DIAGNOSTIC_TYPE_CODE,HRGNUM_DIAGNOSTIC_CODE,GNUM_SEAT_ID,GDT_ENTRY_DATE,GNUM_ISVALID,HRGSTR_REMARKS,HRGNUM_DIAGNOSIS_CODE_TYPE,GNUM_HOSPITAL_CODE,HPMRDT_ASSIGN_DATE,HPMRDT_REVOKE_DATE,HRGNUM_VISIT_NO,HRGNUM_EPISODE_CODE) VALUES(?,?,?,?,?,?,sysdate,?,?,?,?,TO_DATE(?,'dd-Mon-yyyy'),?,?,?) 
                                             
SELECT_DIAG_DTL.HPMRT_PROFILE_DIAGNOSIS_DTL= SELECT HPMRNUM_PROFILE_ID as profileId, HGBSTR_DIAGNOSTIC_TYPE_NAME as diagnosticTypeName,HGBSTR_DISEASE_NAME as diseaseName,GNUM_DIAGNOSTIC_TYPE_CODE as diagnosticTypeCode,HRGNUM_DIAGNOSTIC_CODE as diagnosticCode,HRGNUM_DIAGNOSIS_CODE_TYPE as diagnosisCodeType,HRGSTR_REMARKS as remarks,TO_CHAR(HPMRDT_ASSIGN_DATE,'dd-Mon-yyyy') as episodeDate,HGBSTR_DISEASE_NAME as dignosisName  FROM HPMRT_PROFILE_DIAGNOSIS_DTL WHERE HPMRNUM_PROFILE_ID\=? AND GNUM_HOSPITAL_CODE\=? AND GNUM_ISVALID\=?
										
											
UPDATE_IS_VALID.HPMRT_PROFILE_DIAGNOSIS_DTL=  	UPDATE HPMRT_PROFILE_DIAGNOSIS_DTL SET GNUM_ISVALID=? WHERE HPMRNUM_PROFILE_ID=? AND GNUM_HOSPITAL_CODE=?

UPDATE_PROFILE_STATUS.HPMRT_PAT_PROFILE_DTL=    UPDATE HPMRT_PAT_PROFILE_DTL SET HPMRNUM_PROFILE_STATUS=?,HPMRNUM_ACCESS_TYPE=?,HPMRNUM_USER_LEVEL=? WHERE HPMRNUM_PROFILE_ID=? AND GNUM_ISVALID=? AND GNUM_HOSPITAL_CODE=?

UPDATE_PROFILE_HEADER.HPMRT_PAT_PROFILE_DTL=     UPDATE HPMRT_PAT_PROFILE_DTL SET HPMRSTR_PROFILE_HEADER=? WHERE HPMRNUM_PROFILE_ID=? AND GNUM_ISVALID=? AND GNUM_HOSPITAL_CODE=?

INSERT.HPMRT_PROFILE_ALLERGY_DTL=            INSERT INTO HPMRT_PROFILE_ALLERGY_DTL(HPMRNUM_PROFILE_ID,HGSTR_ALLERGY_NAME,HGNUM_ALLERGY_TYPE_CODE,HGSTR_ALLERGY_TYPE,HRGDT_DURATION_DATE,HGSTR_ALLERGY_ID,GNUM_ISVALID,GNUM_SEAT_ID,GNUM_HOSPITAL_CODE,GDT_ENTRY_DATE,HRGSTR_IP_ADD) \
	   		                                  VALUES(?,?,?,?,TO_DATE(?,'dd-Mon-yyyy'),?,?,?,?,SYSDATE,?)


#Chart View Details "Patient Profile"  Added by Manisha Gangwar Date: 10.08.2017
UPDATE_IS_VALID.HPMRT_PROFILE_CHARTVIEW_DTL=  	UPDATE HPMRT_PROFILE_CHARTVIEW_DTL SET GNUM_ISVALID=? WHERE HPMRNUM_PROFILE_ID=? AND GNUM_HOSPITAL_CODE=?

INSERT.HPMRT_PROFILE_CHARTVIEW_DTL=INSERT INTO hpmrt_profile_chartview_dtl(hpmrnum_profile_id, hgnum_chart_id, hpmrdt_from_date, hpmrdt_to_date, gnum_seat_id, hpmrstr_chart_html, gdt_entry_date, gnum_isvalid, gnum_hospital_code, hrgnum_episode_code, hrgnum_visit_no) VALUES (?, ?,TO_DATE(?,'dd-Mon-yyyy'), TO_DATE(?,'dd-Mon-yyyy'), ?, ?\:\:character varying, SYSDATE, ?, ?, ?, ?);

SELECT_CHARTVIEW_DTL.HPMRT_PROFILE_CHARTVIEW_DTL= SELECT HPMRNUM_PROFILE_ID as profileId, hgnum_chart_id as chartId,TO_CHAR(hpmrdt_from_date,'dd-Mon-yyyy') as fromDate,TO_CHAR(hpmrdt_to_date,'dd-Mon-yyyy')  as toDate,hpmrstr_chart_html as chartHtml,gnum_hospital_code as hospitalCode,hrgnum_episode_code as episodeCode,hrgnum_visit_no as visitNo  FROM hpmrt_profile_chartview_dtl WHERE HPMRNUM_PROFILE_ID\=? AND GNUM_HOSPITAL_CODE\=? AND GNUM_ISVALID\=?



#End Chart View Details
	   		                                  
#Query modified to select duration of allergy by Shruti Shail on 11-May-2017
SELECT_ALLERGY_DTL.HPMRT_PROFILE_ALLERGY_DTL= SELECT HPMRNUM_PROFILE_ID as profileId, HGSTR_ALLERGY_NAME as allergyName,HGNUM_ALLERGY_TYPE_CODE as allergyTypeCode,HGSTR_ALLERGY_TYPE as allergyTypeName,TO_CHAR(HRGDT_DURATION_DATE,'dd-Mon-yyyy') as duration,HGSTR_ALLERGY_ID as allergyID  ,ahis_util.age_YR_MON_DAY(HRGDT_DURATION_DATE,trunc(sysdate)) as durationDays FROM HPMRT_PROFILE_ALLERGY_DTL WHERE HPMRNUM_PROFILE_ID\=? AND GNUM_HOSPITAL_CODE\=? AND GNUM_ISVALID\=?
        										
 UPDATE_IS_VALID.HPMRT_PROFILE_ALLERGY_DTL=  	UPDATE HPMRT_PROFILE_ALLERGY_DTL SET GNUM_ISVALID=? WHERE HPMRNUM_PROFILE_ID=? AND GNUM_HOSPITAL_CODE=? 
 
 
SELECT_INVESTIGATION.HIVT_REQUISITION_DTL.HIVT_REQUISITION_HEADER.OLD= SELECT  TO_CHAR(HIVTNUM_REQ_DNO) AS reqDNo,GNUM_LAB_TEST_CODE as labTestCode,TO_CHAR(HGNUM_VISIT_DATE,'dd-Mon-yyyy') as visitDate,(SELECT GSTR_LAB_NAME FROM GBLT_LABORATORY_MST WHERE GNUM_LAB_CODE\=SUBSTR(GNUM_LAB_TEST_CODE,1,5) AND gdt_effective_frm <\= TRUNC (SYSDATE) AND NVL (gdt_effective_to, SYSDATE + 1) >\= TRUNC (SYSDATE) AND GNUM_HOSPITAL_CODE\=?) AS labName, (SELECT GSTR_TEST_NAME FROM GBLT_TEST_MST WHERE GNUM_TEST_CODE\= SUBSTR(GNUM_LAB_TEST_CODE,6,9) AND GNUM_HOSPITAL_CODE\=? AND gdt_effective_frm <\= TRUNC (SYSDATE) AND NVL (gdt_effective_to, SYSDATE + 1) >\= TRUNC (SYSDATE)) AS testName, SUBSTR(GNUM_LAB_TEST_CODE,1,5) AS labCode,SUBSTR(GNUM_LAB_TEST_CODE,6,9) AS testCode,HGNUM_VISITNO  FROM HIVT_REQUISITION_DTL A, HIVT_REQUISITION_HEADER B WHERE SUBSTR(HIVTNUM_REQ_DNO,1,18)\=HIVNUM_REQ_NO AND HRGNUM_PUK\=? AND HRGSTR_EPISODE_CODE\=? AND A.GBNUM_STATUS_CODE IN (9,16,17) 
#Changed by Manisha Gangwar, dated on 05-04-2015,
SELECT_INVESTIGATION.HIVT_REQUISITION_DTL.HIVT_REQUISITION_HEADER_OLD1= SELECT  TO_CHAR(HIVTNUM_REQ_DNO) AS reqDNo, a.gnum_lab_code||a.gnum_test_code as labTestCode,TO_CHAR(HGNUM_VISIT_DATE,'dd-Mon-yyyy') as visitDate, (SELECT GSTR_LAB_NAME FROM HIVT_LABORATORY_MST WHERE GNUM_LAB_CODE\=a.gnum_lab_code AND GNUM_HOSPITAL_CODE\=?) AS labName, (SELECT GSTR_TEST_NAME FROM HIVT_TEST_MST WHERE GNUM_TEST_CODE\= a.gnum_test_code) AS testName, a.gnum_lab_code AS labCode, a.gnum_test_code  AS testCode,  HGNUM_VISITNO  FROM HIVT_REQUISITION_DTL A, HIVT_REQUISITION_HEADER B  WHERE a.hivnum_req_no\=B.HIVNUM_REQ_NO  AND B.HRGNUM_PUK\=? AND B.gnum_EPISODE_CODE\=?   AND A.hivnum_reqdtl_status IN (9,16,17)  
																																		

#Added by Manisha Gangwar, dated on 10-01-2017,
SELECT_INVESTIGATION.HIVT_REQUISITION_DTL.HIVT_REQUISITION_HEADER= Select hivtnum_req_dno AS reqDNo ,a.gnum_lab_code as labCode, a.gnum_lab_code||a.gnum_test_code as labTestCode, b.HGNUM_VISITNO, pkg_inv_fun.fun_lab_name(a.gnum_lab_code,a.gnum_hospital_code) as labName, gnum_test_code as prvTestCode, pkg_inv_fun.fun_test_name(gnum_test_code) as testName, gbnum_priority_code, decode(GBNUM_PRIORITY_CODE,1,'Normal',2,'Urgent',3,'Low') as priority, to_char(hivt_entry_date,'dd-Mon-yyyy') as visitDate, decode(pkg_inv_fun.fun_test_type(gnum_test_code),'P','Patient Based','S', 'Sample Based', 'I','Slide Based') as sampleCode, hivnum_reqdtl_status as resultStatusCode, DECODE(hivnum_reqdtl_status,2,'Requisition Raised',3,'Sample Collected',4,'Packing List Generated',5,'Requisition Raised', 6,'Sample/Patient Accepted', 7,'Result Entered', 8,'Result Validated',9,'Patient Rejected',10,'Test Rescheduled',11,'Test Rescheduled',12,'Sample Cancelled',13,'Ready For Report Printing',14,'Result Printed', 15,'Test Cancelled',16,'Test Deleted',26,'Report Generated',55,'Test Advised',17,'Machine Processing',18,'Machine Processing') resultStatus, pkg_inv_fun.fun_sample_name(gnum_sample_code) sampleName, gnum_sample_code,to_char(hivt_entry_date,'MMddyyyy') as sortReqDate, nvl(hivstr_report_url,'') as reportURL, a.gnum_hospital_code as HospitalCode, b.gnum_episode_code as EpisodeCode, nvl(to_char(b.hipnum_admno),'') as PatAdmNo,b.hgnum_deptunitcode as DepartmentUnitCode, nvl(b.hgnum_visitno,0) as EpisodeVisitNo from hivt_requisition_dtl a, hivt_requisition_header b where a.hivnum_req_no\=b.hivnum_req_no and b.gnum_isvalid\=1 and a.gnum_hospital_code\=b.gnum_hospital_code and b.hrgnum_puk\=? and a.hivnum_reqdtl_status not in(3,5,6,12,15,16)
 
																																		
																				
																		
INSERT.HPMRT_PROFILE_INV_DTL= INSERT INTO HPMRT_PROFILE_INV_DTL(HPMRNUM_PROFILE_ID,HIVTNUM_REQ_DNO,GNUM_ISVALID,GNUM_SEAT_ID,GNUM_HOSPITAL_CODE,GDT_ENTRY_DATE) VALUES(?,TO_CHAR(?),?,?,?,SYSDATE)\t
 
 #Changed by Akash Singh, dated on 04-06-2015, due to G5 changes                    								
#SELECT_INVESTIGATION_DTL.HPMRT_PROFILE_INV_DTL=      SELECT  TO_CHAR(a.HIVTNUM_REQ_DNO) AS reqDNo,GNUM_LAB_TEST_CODE as labTestCode,TO_CHAR(HGNUM_VISIT_DATE,'dd-Mon-yyyy') as visitDate,(SELECT GSTR_LAB_NAME FROM GBLT_LABORATORY_MST WHERE GNUM_LAB_CODE=SUBSTR(GNUM_LAB_TEST_CODE,1,5) AND \
#																		gdt_effective_frm <= TRUNC (SYSDATE) AND NVL (gdt_effective_to, SYSDATE + 1) >= TRUNC (SYSDATE) AND GNUM_HOSPITAL_CODE=?) AS labName, (SELECT GSTR_TEST_NAME FROM GBLT_TEST_MST WHERE GNUM_TEST_CODE= SUBSTR(GNUM_LAB_TEST_CODE,6,9) \
#																		AND GNUM_HOSPITAL_CODE=? AND gdt_effective_frm <= TRUNC (SYSDATE) AND NVL (gdt_effective_to, SYSDATE + 1) >= TRUNC (SYSDATE)) AS testName, \
#																		SUBSTR(GNUM_LAB_TEST_CODE,1,5) AS labCode,SUBSTR(GNUM_LAB_TEST_CODE,6,9) AS testCode,HGNUM_VISITNO  FROM HIVT_REQUISITION_DTL A, HIVT_REQUISITION_HEADER B WHERE SUBSTR(A.HIVTNUM_REQ_DNO,1,18)=B.HIVNUM_REQ_NO AND a.HIVTNUM_REQ_DNO in (SELECT hivtnum_req_dno FROM hpmrt_profile_inv_dtl WHERE hpmrnum_profile_id = ? AND GNUM_HOSPITAL_CODE=? AND GNUM_ISVALID=?) \
#																		AND HRGNUM_PUK=? AND HRGSTR_EPISODE_CODE=? ORDER BY HGNUM_VISITNO DESC

SELECT_INVESTIGATION_DTL.HPMRT_PROFILE_INV_DTL= SELECT  TO_CHAR(a.HIVTNUM_REQ_DNO) AS reqDNo,a.gnum_lab_code || gnum_test_code as labTestCode,TO_CHAR(HGNUM_VISIT_DATE,'dd-Mon-yyyy') as visitDate,(SELECT GSTR_LAB_NAME FROM hivt_laboratory_mst WHERE gnum_isvalid\=1 and GNUM_LAB_CODE\=a.gnum_lab_code AND GNUM_HOSPITAL_CODE\=?) AS labName, (SELECT GSTR_TEST_NAME FROM hivt_test_mst WHERE gnum_isvalid\=1  and GNUM_TEST_CODE\= a.gnum_test_code ) AS testName, a.gnum_lab_code AS labCode,gnum_test_code AS testCode,HGNUM_VISITNO  FROM HIVT_REQUISITION_DTL A, HIVT_REQUISITION_HEADER B WHERE A.HIVNUM_REQ_NO\=B.HIVNUM_REQ_NO AND A.gnum_hospital_code\= b.gnum_hospital_code AND a.HIVTNUM_REQ_DNO in (SELECT hivtnum_req_dno FROM hpmrt_profile_inv_dtl WHERE hpmrnum_profile_id \= ? AND GNUM_HOSPITAL_CODE\=? AND GNUM_ISVALID\=?) AND HRGNUM_PUK\=? AND gnum_episode_code\=? ORDER BY HGNUM_VISITNO DESC
																		
UPDATE_IS_VALID.HPMRT_PROFILE_INV_DTL=  	UPDATE HPMRT_PROFILE_INV_DTL SET GNUM_ISVALID=? WHERE HPMRNUM_PROFILE_ID=? AND GNUM_HOSPITAL_CODE=?

SELECT_COUNT.HPMRT_PROFILE_RESTRICTED_CAT=    	SELECT count(*) FROM HPMRT_PROFILE_RESTRICTED_CAT where GNUM_PATIENT_CAT_CODE=? AND HPMRNUM_PROFILE_TYPE=? AND GNUM_HOSPITAL_CODE=? AND GNUM_ISVALID=?

SELECT_ACCESS_RECORDID.HPMRT_PROFILE_GROUP_DTL=    SELECT HPMRNUM_RECORD_MODE as recordMode,HPMRNUM_ACCESS_RECORD_ID as accessRecordId FROM HPMRT_PROFILE_GROUP_DTL  WHERE  HPMRNUM_PROFILE_GROUP_ID=? AND GNUM_HOSPITAL_CODE=? AND GNUM_ISVALID=?				

INSERT.HPMRT_PROFILE_ACCESS_DTL= INSERT INTO HPMRT_PROFILE_ACCESS_DTL (GNUM_USER_ID,HPMRNUM_PROFILE_ID,HGNUM_DEPTUNITCODE,HIPNUM_WARD_CODE,HPMRNUM_SLNO,GNUM_ISVALID,GNUM_SEAT_ID,HPMRNUM_ACCESS_TYPE,GDT_ENTRY_DATE,GNUM_HOSPITAL_CODE) VALUES(?,?,?,?,(SELECT NVL(MAX(HPMRNUM_SLNO),0)+1 FROM HPMRT_PROFILE_ACCESS_DTL WHERE HPMRNUM_PROFILE_ID\=?),?,?,?,sysdate,?)
		   							   
SELECT_GROUP_ID.HPMRT_PROFILE_GROUP_DTL=   SELECT HPMRNUM_ACCESS_TYPE AS accessType,HPMRNUM_USER_LEVEL AS userLevel,HPMRNUM_PROFILE_GROUP_ID AS profileGroupId  FROM HPMRT_PROFILE_ACCESS_POLICY WHERE  HGNUM_DEPTUNITCODE=? AND HPMRNUM_PROFILE_TYPE=? AND HPMRNUM_POLICY_TYPE=? AND GNUM_HOSPITAL_CODE=? AND GNUM_ISVALID=?
 

SELECT.HRGT_EPISODE_DIAGNOSIS_DTL.ALL_MAX_VISIT_EMR=SELECT a.hrgnum_puk AS patcrno, a.hrgnum_episode_code AS episodecode,a.hrgnum_visit_no AS episodevisitno,a.hrgnum_admission_no AS patadmno,TO_CHAR (hrgt_episode_date, 'dd-Mon-yyyy') AS entrydate,  a.hrgnum_diagnostic_code AS diagnosticcode, DECODE(a.hrgnum_diagnosis_code_type,0, (SELECT b.hgbstr_disease FROM hgbt_icd_disease_mst b WHERE a.hrgnum_diagnostic_code \=TRIM (b.hgbstr_disease_code)  AND b.gnum_isvalid \= a.gnum_isvalid and b.HGNUM_RECORD_TYPE\=0),1, (SELECT c.hgbstr_disease_desc FROM hgbt_hospital_disease_mst c WHERE a.hrgnum_diagnostic_code \= TRIM (c.hgbstr_hospital_disease_code) AND c.gnum_isvalid \= a.gnum_isvalid AND c.gnum_hospital_code \= a.gnum_hospital_code) ) AS dignosisname, (SELECT d.hgbstr_diagnostic_type_name FROM hgbt_diagnosis_type_mst d WHERE a.gnum_diagnostic_type_code \=d.hgbnum_diagnostic_type_code AND d.gnum_isvalid \= a.gnum_isvalid AND d.gnum_hospital_code \= a.gnum_hospital_code) AS diagnostictypename, hrgstr_remarks AS remarks, TO_CHAR (hrgt_episode_date, 'dd-Mon-yyyy') AS episodedate FROM hrgt_episode_diagnosis_dtl a WHERE hrgnum_puk \= ? AND hrgnum_visit_no \= (SELECT MAX (hrgnum_visit_no) FROM hrgt_episode_diagnosis_dtl WHERE hrgnum_puk \= hrgnum_puk AND hrgnum_episode_code \= a.hrgnum_episode_code AND gnum_isvalid \= a.gnum_isvalid AND gnum_hospital_code \= a.gnum_hospital_code) AND a.gnum_isvalid \= ? AND a.gnum_hospital_code \= ? ORDER BY hrgnum_visit_no
														
SELECT.HRGT_EPISODE_ALLERGY_DTL.BY_CRNO_EPISODE_VISIT=SELECT INITCAP(HGSTR_ALLERGY_NAME) AS allergyname,HGNUM_ALLERGY_TYPE_CODE AS allergytypecode,INITCAP(HGSTR_ALLERGY_TYPE) AS allergytypename,ahis_util.dob_age_on (hrgdt_duration_date, SYSDATE) AS duration, hrgstr_remarks AS remarks,TO_CHAR (gdt_entry_date, 'dd-Mon-yyyy') AS entrydate,hgstr_symtom_desc AS allergysymtoms,hgstr_allergy_site AS allergysite, hgstr_allergy_name AS reasonname FROM HRGT_EPISODE_ALLERGY_DTL WHERE HRGNUM_PUK\=? AND HRGNUM_EPISODE_CODE\=? AND HRGNUM_VISIT_NO\=? AND GNUM_ISVALID\=? AND GNUM_HOSPITAL_CODE\=? ORDER BY INITCAP (hgstr_allergy_name),hgnum_allergy_type_code\t\t\t
													  									
SELECT.HPMRT_PAT_ALERTS_DTL.CHRONIC_EMR_OLD	=SELECT HGSTR_ALERT_NAME AS ALERTNAME, HGNUM_PAT_ALERT_ID AS PATALERTID, HRGDT_EFFECTIVE_FRM AS effectiveFrom, HBSTR_REMARKS AS REMARKS, ahis_util.dob_age_on(hrgdt_duration_date,sysdate) AS durationDays, ahis_util.age_YR_MON_DAY(hrgdt_duration_date,TRUNC(SYSDATE)) AS DURATIONDATE, HRGDT_EFFECTIVE_TO AS EFFECTIVETO, HRGSTR_REVOKE_REMARKS AS REVOKEREMARKS FROM HPMRT_PAT_ALERTS_DTL WHERE HRGNUM_PUK \= ? AND GNUM_ISVALID \= ? AND GNUM_HOSPITAL_CODE \= ? AND TRUNC(NVL(HRGDT_EFFECTIVE_TO,SYSDATE+1)) > TRUNC(SYSDATE) ORDER BY HGSTR_ALERT_NAME\t\t\t\t\t\t\t\t\t\t\t\t\t  \t\t\t\t\t\t\t\t\t

SELECT.HPMRT_PAT_ALERTS_DTL.CHRONIC_EMR	=SELECT distinct b.hrgnum_puk patCrNo, b.hrgnum_episode_code episodeCode, b.hrgnum_visit_no episodeVisitNo, a.hgstr_alert_name AS alertname, a.hgnum_pat_alert_id AS patalertid, hrgdt_effective_frm AS effectivefrom, hbstr_remarks AS remarks, ahis_util.dob_age_on (a.hrgdt_duration_date, SYSDATE) AS durationdays, ahis_util.age_yr_mon_day (a.hrgdt_duration_date, TRUNC (SYSDATE)) AS durationdate, hrgdt_effective_to AS effectiveto, hrgstr_revoke_remarks AS revokeremarks, (SELECT gstr_usr_name || ' (' || gstr_user_name || ')' FROM gblt_user_mst WHERE gnum_userid \= a.gnum_seat_id AND gnum_hospital_code \= a.gnum_hospital_code AND gnum_isvalid \= a.gnum_isvalid) AS seatid, TO_CHAR (a.gdt_entry_date, 'dd-Mon-yyyy') entrydate,b.HRGNUM_ADMISSION_NO admissionNo,a.gdt_entry_date, (SELECT hgnum_deptunitcode FROM hrgt_episode_dtl WHERE hrgnum_episode_code \= b.hrgnum_episode_code AND hrgnum_puk \= b.hrgnum_puk AND hrgnum_visit_no \= b.hrgnum_visit_no AND gnum_isvalid \= b.gnum_isvalid AND gnum_hospital_code \= b.gnum_hospital_code)departmentUnitCode,a.GNUM_HOSPITAL_CODE as hospitalCode FROM hpmrt_pat_alerts_dtl a, hrgt_episode_alert_dtl b WHERE a.hrgnum_puk \= ? AND a.gnum_isvalid \= ?  AND a.hrgnum_puk \= b.hrgnum_puk AND a.hgnum_pat_alert_id \= b.hgnum_pat_alert_id AND b.hrgnum_isrevoked \= ? \tAND b.hrgnum_visit_no \=(SELECT MAX (hrgnum_visit_no) FROM hrgt_episode_alert_dtl WHERE hrgnum_puk \= b.hrgnum_puk AND hrgnum_episode_code \= b.hrgnum_episode_code AND gnum_isvalid \= b.gnum_isvalid AND gnum_hospital_code \= b.gnum_hospital_code and HRGNUM_S_NO\=b.HRGNUM_S_NO)\t\t\t\t\t\t\t\t\t\t\t\t  \t\t\t\t\t\t\t\t\t

SELECT.HRGT_EPISODE_DIAGNOSIS_DTL.EPISODE_VISIT_WISE_EMR=SELECT   a.hrgnum_puk AS patcrno, a.hrgnum_episode_code AS episodecode,a.hrgnum_visit_no AS episodevisitno,a.hrgnum_admission_no AS patadmno, a.hrgnum_diagnostic_code AS diagnosticcode,DECODE(a.hrgnum_diagnosis_code_type,0, (SELECT b.hgbstr_disease FROM hgbt_icd_disease_mst b WHERE a.hrgnum_diagnostic_code \= TRIM (b.hgbstr_disease_code) AND b.gnum_isvalid \= a.gnum_isvalid and b.HGNUM_RECORD_TYPE\=0),1, (SELECT c.hgbstr_disease_desc FROM hgbt_hospital_disease_mst c WHERE a.hrgnum_diagnostic_code \= TRIM (c.hgbstr_hospital_disease_code) AND c.gnum_isvalid \= a.gnum_isvalid AND c.gnum_hospital_code \= a.gnum_hospital_code)) AS dignosisname,(SELECT d.hgbstr_diagnostic_type_name FROM hgbt_diagnosis_type_mst d WHERE a.gnum_diagnostic_type_code \=d.hgbnum_diagnostic_type_code AND d.gnum_isvalid \= a.gnum_isvalid AND d.gnum_hospital_code \= a.gnum_hospital_code) AS diagnostictypename,hrgstr_remarks AS remarks,TO_CHAR (GDT_ENTRY_DATE, 'dd-Mon-yyyy') AS entryDate,HRGNUM_DIAGNOSIS_CODE_TYPE as diagnosisCodeType FROM hrgt_episode_diagnosis_dtl a WHERE hrgnum_puk \= ? AND a.hrgnum_episode_code\=? AND hrgnum_visit_no \=? AND a.gnum_isvalid \= ? AND a.gnum_hospital_code \= ? ORDER BY a.hrgnum_episode_code,hrgnum_visit_no

UPDATE_ACCESS_TYPE.HPMRT_PAT_PROFILE_DTL=    UPDATE HPMRT_PAT_PROFILE_DTL SET HPMRNUM_ACCESS_TYPE=?,HPMRNUM_USER_LEVEL=? WHERE HPMRNUM_PROFILE_ID=? AND GNUM_ISVALID=? AND GNUM_HOSPITAL_CODE=?



SELECT.HRGT_EPISODE_ALLERGY_DTL.ALL_EMR=SELECT HRGNUM_PUK as patCrNo, HRGNUM_EPISODE_CODE as episodeCode, HRGNUM_VISIT_NO as episodeVisitNo,INITCAP(HGSTR_ALLERGY_NAME) AS allergyname,HGNUM_ALLERGY_TYPE_CODE AS allergytypecode,INITCAP(HGSTR_ALLERGY_TYPE) AS allergytypename,ahis_util.age_YR_MON_DAY(hrgdt_duration_date,TRUNC(SYSDATE)) AS duration, hrgstr_remarks AS remarks,TO_CHAR (gdt_entry_date, 'dd-Mon-yyyy') AS entrydate,hgstr_symtom_desc AS allergysymtoms,hgstr_allergy_site AS allergysite, hgstr_allergy_name AS reasonname, (SELECT HRGNUM_IS_EPISODE_OPEN FROM HRGT_EPISODE_DTL WHERE HRGNUM_PUK\=A.HRGNUM_PUK AND HRGNUM_EPISODE_CODE\=A.HRGNUM_EPISODE_CODE AND GNUM_HOSPITAL_CODE\=A.GNUM_HOSPITAL_CODE and GNUM_ISVALID\=A.GNUM_ISVALID AND HRGNUM_VISIT_NO\=( SELECT MAX(HRGNUM_VISIT_NO) FROM HRGT_EPISODE_DTL WHERE HRGNUM_PUK\=A.HRGNUM_PUK AND HRGNUM_EPISODE_CODE\=A.HRGNUM_EPISODE_CODE  AND GNUM_HOSPITAL_CODE\=A.GNUM_HOSPITAL_CODE and GNUM_ISVALID\=A.GNUM_ISVALID )) AS episodeIsOpen,HRGNUM_ISREVOKED as isRevoked, (SELECT HGNUM_DEPTUNITCODE FROM HRGT_EPISODE_DTL WHERE HRGNUM_PUK\=A.HRGNUM_PUK AND HRGNUM_EPISODE_CODE\=A.HRGNUM_EPISODE_CODE AND HRGNUM_VISIT_NO\=A.HRGNUM_VISIT_NO AND GNUM_ISVALID\=A.GNUM_ISVALID AND GNUM_HOSPITAL_CODE\=A.GNUM_HOSPITAL_CODE) AS departmentUnitCode,HRGNUM_ADMISSION_NO as patAdmNo,(SELECT hgstr_sensitivity_type FROM hgbt_allergy_sensitivity_mst WHERE hgnum_sensitivity_code \= a.hgnum_sensitivity_code AND gnum_hospital_code \= 100 AND gnum_isvalid \= a.gnum_isvalid) as sensitivityName, a.gnum_hospital_code as hospitalCode FROM HRGT_EPISODE_ALLERGY_DTL A WHERE HRGNUM_PUK\=? AND GNUM_ISVALID\=? \t\t

UPDATE_ISVALID.HPMRT_PAT_PROFILE_DTL	=UPDATE HPMRT_PAT_PROFILE_DTL SET GNUM_ISVALID\=?, GDT_LSTMOD_DATE\=SYSDATE, GNUM_LSTMOD_SEATID\=? WHERE HPMRNUM_PROFILE_ID\=? AND GNUM_ISVALID\=? AND GNUM_HOSPITAL_CODE\=?
											
DELETE_USER_PRIV.HPMRT_PROFILE_ACCESS_DTL=   UPDATE HPMRT_PROFILE_ACCESS_DTL SET GNUM_ISVALID=?,GDT_LSTMOD_DATE=SYSDATE, GNUM_LSTMOD_SEATID=? WHERE  HPMRNUM_PROFILE_ID=? AND GNUM_USER_ID=? AND  GNUM_ISVALID=? AND GNUM_HOSPITAL_CODE=?

#Modified by Vasu on 24.April.2019 for External Treatment at Patient profile
#SELECT.HRGT_EPISODE_DRUG_DTL.PAT_PROFILE_BY_CRNO= SELECT HSTNUM_ITEM_ID AS drugId,HSTSTR_ITEM_NAME AS drugName,HGNUM_DOSE_ID AS doseId,HGSTR_DOSE_NAME AS doseName,HGNUM_FREQUENCY_ID AS frequencyId,(SELECT UPPER(HGSTR_FREQUENCY_NAME) FROM HGBT_DRUG_FREQUENCY_MST A WHERE A.HGNUM_FREQUENCY_ID\=B.HGNUM_FREQUENCY_ID AND A.GNUM_HOSPITAL_CODE\=? AND A.GNUM_ISVALID\=B.GNUM_ISVALID AND GNUM_ISVALID\=? ) as frequencyName, TO_CHAR(HRGDT_START_DATE,'dd-Mon-yyyy') AS startDate,TO_CHAR(HRGDT_END_DATE,'dd-Mon-yyyy') AS endDate,HRGNUM_ADMISSION_NO AS admissionNo,HRGNUM_VISIT_NO AS episodeVisitNo,HGNUM_DAYS AS days,HRGSTR_REMARKS AS remarks,PSRSTR_EMP_NO AS empNo,HBNUM_RX_CONTINUE AS rxContinue,HGNUM_ISEMPTY_STOMACH AS isEmptyStomach,HGNUM_DRUG_ROUTE_ID AS drugRouteId  FROM HRGT_EPISODE_DRUG_DTL B WHERE HRGNUM_PUK\=? AND HRGNUM_EPISODE_CODE\=? AND GDT_ENTRY_DATE\=(SELECT MAX(GDT_ENTRY_DATE) FROM HRGT_EPISODE_DRUG_DTL WHERE HRGNUM_PUK\=? AND HRGNUM_EPISODE_CODE\=? AND GNUM_HOSPITAL_CODE\=? AND GNUM_ISVALID\=?) AND GNUM_HOSPITAL_CODE\=? AND GNUM_ISVALID\=? AND HRGNUM_EPISODE_CODE \= ?

SELECT.HRGT_EPISODE_DRUG_DTL.PAT_PROFILE_BY_CRNO = SELECT  'Drug' as medicationType, HSTNUM_ITEM_ID AS drugId,HSTSTR_ITEM_NAME AS medicationName,HGNUM_DOSE_ID AS doseId,HGSTR_DOSE_NAME AS  doseName,HGNUM_FREQUENCY_ID AS frequencyId,(SELECT UPPER(HGSTR_FREQUENCY_NAME) FROM HGBT_DRUG_FREQUENCY_MST A  WHERE A.HGNUM_FREQUENCY_ID\=B.HGNUM_FREQUENCY_ID AND A.GNUM_HOSPITAL_CODE\= ? AND A.GNUM_ISVALID\=B.GNUM_ISVALID AND GNUM_ISVALID\=? ) as frequencyName, TO_CHAR(HRGDT_START_DATE,'dd-Mon-yyyy') AS startDate,TO_CHAR(HRGDT_END_DATE,'dd-Mon-yyyy') AS endDate,HRGNUM_ADMISSION_NO AS admissionNo,HRGNUM_VISIT_NO AS episodeVisitNo, HGNUM_DAYS AS days,HRGSTR_REMARKS AS remarks,PSRSTR_EMP_NO AS empNo,HBNUM_RX_CONTINUE AS rxContinue,HGNUM_ISEMPTY_STOMACH AS isEmptyStomach,HGNUM_DRUG_ROUTE_ID AS drugRouteId  FROM HRGT_EPISODE_DRUG_DTL B WHERE HRGNUM_PUK\=? AND HRGNUM_EPISODE_CODE\=? AND GDT_ENTRY_DATE\=(SELECT MAX(GDT_ENTRY_DATE) FROM HRGT_EPISODE_DRUG_DTL WHERE HRGNUM_PUK\=? AND HRGNUM_EPISODE_CODE\=? AND GNUM_HOSPITAL_CODE\=? AND GNUM_ISVALID\=?) AND GNUM_HOSPITAL_CODE\=? AND GNUM_ISVALID\=? AND HRGNUM_EPISODE_CODE \= ? UNION SELECT 'Other' as medicationType , HGNUM_EXT_TREATMENT_ID AS drugid, hgstr_ext_treatment_name AS medicationName ,hgnum_dose_id AS doseid, '-' AS dosename,hgnum_frequency_id AS frequencyid, (SELECT UPPER (hgstr_frequency_name) FROM hgbt_drug_frequency_mst a WHERE a.hgnum_frequency_id \= b.hgnum_frequency_id AND a.gnum_hospital_code \= ? AND a.gnum_isvalid \= b.gnum_isvalid AND gnum_isvalid \= ?) AS frequencyname, TO_CHAR (hrgdt_start_date, 'dd-Mon-yyyy') AS startdate,TO_CHAR (hrgdt_end_date, 'dd-Mon-yyyy') AS endDate, hrgnum_admission_no AS admissionno, hrgnum_visit_no AS episodevisitno, hgnum_days AS days, hrgstr_remarks AS remarks, psrstr_emp_no AS empno,hbnum_rx_continue AS rxcontinue,'0' AS isemptystomach,'0' AS drugrouteid  FROM hrgt_episode_exttreatment_dtl B WHERE HRGNUM_PUK\=? AND HRGNUM_EPISODE_CODE\=? AND GDT_ENTRY_DATE\= (SELECT MAX(GDT_ENTRY_DATE) FROM hrgt_episode_exttreatment_dtl  WHERE HRGNUM_PUK\=? AND HRGNUM_EPISODE_CODE\=? AND  GNUM_HOSPITAL_CODE\=? AND GNUM_ISVALID\=?) AND GNUM_HOSPITAL_CODE\=? AND GNUM_ISVALID\=? AND HRGNUM_EPISODE_CODE \= ?\t
#INSERT.HPMRT_PROFILE_DRUG_ADVICE_DTL= INSERT INTO HPMRT_PROFILE_DRUG_ADVICE_DTL(HPMRNUM_PROFILE_ID,HGSTR_DOSE_NAME,HGNUM_DRUG_ROUTE_ID,HSTNUM_ITEM_ID,HGNUM_DOSE_ID,GNUM_SEAT_ID,HGNUM_FREQUENCY_ID,GDT_ENTRY_DATE,HGNUM_DAYS,GNUM_ISVALID,HRGDT_START_DATE,HRGDT_END_DATE,HRGSTR_REMARKS,HSTSTR_ITEM_NAME,GNUM_HOSPITAL_CODE,HGNUM_ISEMPTY_STOMACH,PSRSTR_EMP_NO,HRGNUM_ISMANAGEMENT_PLAN,HBNUM_RX_CONTINUE,HGNUM_DOSE_QTY,HSTNUM_ISSUE_QTY,HSTNUM_REQUIRED_QTY,HRGNUM_ENTRY_MODE,HGNUM_START_DAY,HPMRNUM_ITEM_SRNO) VALUES(?,?,?,?,?,?,?,SYSDATE,?,?,TO_DATE(?,'dd-Mon-yyyy'),TO_DATE(?,'dd-Mon-yyyy'),?,?,?,?,?,?,?,?,?,?,?,?,(SELECT NVL(MAX(HPMRNUM_ITEM_SRNO),0)+1 FROM HPMRT_PROFILE_DRUG_ADVICE_DTL WHERE HPMRNUM_PROFILE_ID\=? AND GNUM_HOSPITAL_CODE\=?))
													                 											
INSERT.HPMRT_PROFILE_DRUG_ADVICE_DTL= INSERT INTO HPMRT_PROFILE_DRUG_ADVICE_DTL(HPMRNUM_PROFILE_ID,HGSTR_DOSE_NAME,HGNUM_DRUG_ROUTE_ID,HSTNUM_ITEM_ID,HGNUM_DOSE_ID,GNUM_SEAT_ID,HGNUM_FREQUENCY_ID,GDT_ENTRY_DATE,HGNUM_DAYS,GNUM_ISVALID,HRGDT_START_DATE,HRGDT_END_DATE,HRGSTR_REMARKS,HSTSTR_ITEM_NAME,GNUM_HOSPITAL_CODE,HGNUM_ISEMPTY_STOMACH,PSRSTR_EMP_NO,HRGNUM_ISMANAGEMENT_PLAN,HBNUM_RX_CONTINUE,HGNUM_DOSE_QTY,HSTNUM_ISSUE_QTY,HSTNUM_REQUIRED_QTY,HRGNUM_ENTRY_MODE,HGNUM_START_DAY,HPMRNUM_ITEM_SRNO,hgstr_medication_type) VALUES(?,?,?,?,?,?,?,SYSDATE,?,?,TO_DATE(?,'dd-Mon-yyyy'),TO_DATE(?,'dd-Mon-yyyy'),?,?,?,?,?,?,?,?,?,?,?,?,(SELECT NVL(MAX(HPMRNUM_ITEM_SRNO),0)+1 FROM HPMRT_PROFILE_DRUG_ADVICE_DTL WHERE HPMRNUM_PROFILE_ID\=? AND GNUM_HOSPITAL_CODE\=?),?)\t\t\t\t\t\t\t\t\t\t\t                 \t\t\t\t\t\t\t\t\t\t\t

UPDATE.TODAY_VISIT_RECORD.HRGT_EPISODE_DRUG_DTL = update HRGT_EPISODE_DRUG_DTL set GNUM_ISVALID\=? where HRGNUM_PUK\=? and HRGNUM_EPISODE_CODE\=? and HRGNUM_VISIT_NO\=? and HRGNUM_S_NO\=?   and GNUM_HOSPITAL_CODE\=? and GNUM_ISVALID\=? and trunc(GDT_ENTRY_DATE)\=trunc(to_date(sysdate,'dd-mm-yyyy hh24\:mi'))
														
UPDATE.TODAY_VISIT_RECORD.HRGT_EPISODE_EXTTREATMENT_DTL = update HRGT_EPISODE_EXTTREATMENT_DTL set GNUM_ISVALID\=? where HRGNUM_PUK\=? and HRGNUM_EPISODE_CODE\=? and HRGNUM_VISIT_NO\=?   and GNUM_HOSPITAL_CODE\=? and GNUM_ISVALID\=? and trunc(GDT_ENTRY_DATE)\=to_date(?,'dd-mon-yyyy')
															
INSERT.RX_AND_REVOKE.HRGT_EPISODE_EXTTREATMENT_DTL = insert into HRGT_EPISODE_EXTTREATMENT_DTL(HRGNUM_PUK, HRGNUM_EPISODE_CODE,HRGNUM_S_NO,HRGNUM_ADMISSION_NO, HRGNUM_VISIT_NO,HGNUM_EXT_TREATMENT_ID,HGNUM_DOSE_ID,GNUM_SEAT_ID,HGSTR_DOSE_NAME,HGNUM_FREQUENCY_ID,GDT_ENTRY_DATE, HGNUM_DAYS,GNUM_ISVALID,HRGDT_START_DATE,HRGDT_END_DATE,HRGSTR_REMARKS,GNUM_HOSPITAL_CODE,PSRSTR_EMP_NO,HBNUM_RX_CONTINUE,HRGNUM_ISMASTER_BOUND,HGSTR_EXT_TREATMENT_NAME,HGNUM_TREATMENT_TYPE ) values(?,?,(SELECT NVL(MAX(HRGNUM_S_NO),0)+1 FROM HRGT_EPISODE_EXTTREATMENT_DTL WHERE HRGNUM_PUK\=? AND HRGNUM_EPISODE_CODE\=? AND HRGNUM_VISIT_NO\=?), ?,?,?,?,?,?,?,trunc(sysdate),?,?,to_date(?,'dd-mon-yyyy'),to_date(?,'dd-mon-yyyy'),?,?,?,?,?,?,?)

#Modified by Vasu on 24.April.2019																										
#SELECT_TREAT_DTL.HPMRT_PROFILE_DRUG_ADVICE_DTL= SELECT HPMRNUM_PROFILE_ID as profileId,HSTNUM_ITEM_ID AS drugId,HSTSTR_ITEM_NAME AS drugName,HGNUM_DOSE_ID AS doseId,HGSTR_DOSE_NAME AS doseName,HGNUM_FREQUENCY_ID AS frequencyId,(SELECT UPPER(HGSTR_FREQUENCY_NAME) FROM HGBT_DRUG_FREQUENCY_MST A WHERE A.HGNUM_FREQUENCY_ID\=B.HGNUM_FREQUENCY_ID AND A.GNUM_HOSPITAL_CODE\=100 AND A.GNUM_ISVALID\=B.GNUM_ISVALID AND GNUM_ISVALID\=? ) as frequencyName, (SELECT HGNUM_FREQUENCY FROM hgbt_drug_frequency_mst a WHERE a.hgnum_frequency_id \= b.hgnum_frequency_id AND a.gnum_hospital_code \= 100 AND a.gnum_isvalid \= b.gnum_isvalid AND gnum_isvalid \= 1) AS frequency, TO_CHAR(HRGDT_START_DATE,'dd-Mon-yyyy') AS startDate,TO_CHAR(HRGDT_END_DATE,'dd-Mon-yyyy') AS endDate,HGNUM_DAYS AS days,HGNUM_START_DAY as startDay,HRGSTR_REMARKS AS remarks,PSRSTR_EMP_NO AS empNo,HBNUM_RX_CONTINUE AS rxContinue,HGNUM_ISEMPTY_STOMACH AS isEmptyStomach,HGNUM_DRUG_ROUTE_ID AS drugRouteId  FROM HPMRT_PROFILE_DRUG_ADVICE_DTL B WHERE HPMRNUM_PROFILE_ID\=? AND GNUM_HOSPITAL_CODE\=? AND GNUM_ISVALID\=? AND HRGNUM_ENTRY_MODE\=?
SELECT_TREAT_DTL.HPMRT_PROFILE_DRUG_ADVICE_DTL= SELECT HPMRNUM_PROFILE_ID as profileId,HSTNUM_ITEM_ID AS drugId,hgstr_medication_type as medicationType,HSTSTR_ITEM_NAME AS drugName,HSTSTR_ITEM_NAME AS medicationName,HGNUM_DOSE_ID AS doseId,HGSTR_DOSE_NAME AS doseName,HGNUM_FREQUENCY_ID AS frequencyId,(SELECT UPPER(HGSTR_FREQUENCY_NAME) FROM HGBT_DRUG_FREQUENCY_MST A WHERE A.HGNUM_FREQUENCY_ID\=B.HGNUM_FREQUENCY_ID AND A.GNUM_HOSPITAL_CODE\=100 AND A.GNUM_ISVALID\=B.GNUM_ISVALID AND GNUM_ISVALID\=? ) as frequencyName, (SELECT HGNUM_FREQUENCY FROM hgbt_drug_frequency_mst a WHERE a.hgnum_frequency_id \= b.hgnum_frequency_id AND a.gnum_hospital_code \= 100 AND a.gnum_isvalid \= b.gnum_isvalid AND gnum_isvalid \= 1) AS frequency, TO_CHAR(HRGDT_START_DATE,'dd-Mon-yyyy') AS startDate,TO_CHAR(HRGDT_END_DATE,'dd-Mon-yyyy') AS endDate,HGNUM_DAYS AS days,HGNUM_START_DAY as startDay,HRGSTR_REMARKS AS remarks,PSRSTR_EMP_NO AS empNo,HBNUM_RX_CONTINUE AS rxContinue,HGNUM_ISEMPTY_STOMACH AS isEmptyStomach,HGNUM_DRUG_ROUTE_ID AS drugRouteId  FROM HPMRT_PROFILE_DRUG_ADVICE_DTL B WHERE HPMRNUM_PROFILE_ID\=? AND GNUM_HOSPITAL_CODE\=? AND GNUM_ISVALID\=? AND HRGNUM_ENTRY_MODE\=?
												   
SELECT.HRGT_EPISODE_DIAGNOSIS_DTL.ALL_EMR_OLD =SELECT   a.hrgnum_puk AS patcrno, a.hrgnum_episode_code AS episodecode,a.hrgnum_visit_no AS episodevisitno,a.hrgnum_admission_no AS patadmno, TO_CHAR (GDT_ENTRY_DATE, 'dd-Mon-yyyy') AS entrydate,a.hrgnum_diagnostic_code AS diagnosticcode,DECODE(a.hrgnum_diagnosis_code_type,0, (SELECT b.hgbstr_disease FROM hgbt_icd_disease_mst b WHERE a.hrgnum_diagnostic_code \=TRIM (b.hgbstr_disease_code) AND b.gnum_isvalid \= a.gnum_isvalid and b.HGNUM_RECORD_TYPE\=0),1, (SELECT c.hgbstr_disease_desc FROM hgbt_hospital_disease_mst c WHERE a.hrgnum_diagnostic_code \=TRIM (c.hgbstr_hospital_disease_code) AND c.gnum_isvalid \= a.gnum_isvalid AND c.gnum_hospital_code \= a.gnum_hospital_code) ) AS dignosisname,(SELECT d.hgbstr_diagnostic_type_name FROM hgbt_diagnosis_type_mst d WHERE a.gnum_diagnostic_type_code \= d.hgbnum_diagnostic_type_code AND d.gnum_isvalid \= a.gnum_isvalid AND d.gnum_hospital_code \= a.gnum_hospital_code) AS diagnostictypename,hrgstr_remarks AS remarks, TO_CHAR (hrgt_episode_date, 'dd-Mon-yyyy') AS episodedate, (SELECT hrgnum_is_episode_open FROM hrgt_episode_dtl WHERE hrgnum_puk \= a.hrgnum_puk AND hrgnum_episode_code \= a.hrgnum_episode_code AND gnum_hospital_code \= a.gnum_hospital_code AND gnum_isvalid \= a.gnum_isvalid AND hrgnum_visit_no \=(SELECT MAX (hrgnum_visit_no) FROM hrgt_episode_dtl WHERE hrgnum_puk \= a.hrgnum_puk AND hrgnum_episode_code \= a.hrgnum_episode_code AND gnum_hospital_code \=a.gnum_hospital_code AND gnum_isvalid \= a.gnum_isvalid)) AS episodeisopen, DECODE (hbnum_isrepeat, 0, 1, 1, 1, 2, 2) AS isrepeat, (SELECT HGNUM_DEPTUNITCODE FROM HRGT_EPISODE_DTL WHERE HRGNUM_PUK\=A.HRGNUM_PUK AND HRGNUM_EPISODE_CODE\=A.HRGNUM_EPISODE_CODE AND HRGNUM_VISIT_NO\=A.HRGNUM_VISIT_NO AND GNUM_ISVALID\=A.GNUM_ISVALID AND GNUM_HOSPITAL_CODE\=A.GNUM_HOSPITAL_CODE) AS departmentUnitCode,HRGNUM_ADMISSION_NO as patAdmNo FROM hrgt_episode_diagnosis_dtl a WHERE hrgnum_puk \= ? AND a.gnum_isvalid \= ? AND a.gnum_hospital_code \= ? ORDER BY episodeisopen,isrepeat,episodecode, diagnostictypename, diagnosticcode

SELECT.HRGT_EPISODE_DIAGNOSIS_DTL.CURRENT_DISEASE =SELECT   a.hrgnum_puk AS patcrno, a.hrgnum_episode_code AS episodecode,a.hrgnum_visit_no AS episodevisitno,a.hrgnum_admission_no AS patadmno, TO_CHAR (GDT_ENTRY_DATE, 'dd-Mon-yyyy') AS entrydate,a.hrgnum_diagnostic_code AS diagnosticcode,DECODE(a.hrgnum_diagnosis_code_type,0, (SELECT b.hgbstr_disease FROM hgbt_icd_disease_mst b WHERE a.hrgnum_diagnostic_code \=TRIM (b.hgbstr_disease_code) AND b.gnum_isvalid \= a.gnum_isvalid and b.HGNUM_RECORD_TYPE\=0),1, (SELECT c.hgbstr_disease_desc FROM hgbt_hospital_disease_mst c WHERE a.hrgnum_diagnostic_code \=TRIM (c.hgbstr_hospital_disease_code) AND c.gnum_isvalid \= a.gnum_isvalid AND c.gnum_hospital_code \= a.gnum_hospital_code) ) AS dignosisname,(SELECT d.hgbstr_diagnostic_type_name FROM hgbt_diagnosis_type_mst d WHERE a.gnum_diagnostic_type_code \= d.hgbnum_diagnostic_type_code AND d.gnum_isvalid \= a.gnum_isvalid AND d.gnum_hospital_code \= a.gnum_hospital_code) AS diagnostictypename,hrgstr_remarks AS remarks, TO_CHAR (hrgt_episode_date, 'dd-Mon-yyyy') AS episodedate, (SELECT hrgnum_is_episode_open FROM hrgt_episode_dtl WHERE hrgnum_puk \= a.hrgnum_puk AND hrgnum_episode_code \= a.hrgnum_episode_code AND gnum_hospital_code \= a.gnum_hospital_code AND gnum_isvalid \= a.gnum_isvalid AND hrgnum_visit_no \=(SELECT MAX (hrgnum_visit_no) FROM hrgt_episode_dtl WHERE hrgnum_puk \= a.hrgnum_puk AND hrgnum_episode_code \= a.hrgnum_episode_code AND gnum_hospital_code \=a.gnum_hospital_code AND gnum_isvalid \= a.gnum_isvalid)) AS episodeisopen, DECODE (hbnum_isrepeat, 0, 1, 1, 1, 2, 2) AS isrepeat, (SELECT HGNUM_DEPTUNITCODE FROM HRGT_EPISODE_DTL WHERE HRGNUM_PUK\=A.HRGNUM_PUK AND HRGNUM_EPISODE_CODE\=A.HRGNUM_EPISODE_CODE AND HRGNUM_VISIT_NO\=A.HRGNUM_VISIT_NO AND GNUM_ISVALID\=A.GNUM_ISVALID AND GNUM_HOSPITAL_CODE\=A.GNUM_HOSPITAL_CODE) AS departmentUnitCode,HRGNUM_ADMISSION_NO as patAdmNo FROM hrgt_episode_diagnosis_dtl a WHERE hrgnum_puk \= ? AND a.gnum_isvalid \= ? AND a.gnum_hospital_code \= ? ORDER BY episodeisopen,isrepeat,episodecode, diagnostictypename, diagnosticcode

#Modified by Vasu on 04.Sept.2018 For Revoked Diagnosis at EMR
#SELECT.HRGT_EPISODE_DIAGNOSIS_DTL.ALL_EMR	=SELECT   a.hrgnum_puk AS patcrno, a.hrgnum_episode_code AS episodecode,a.hrgnum_visit_no AS episodevisitno,a.hrgnum_admission_no AS patadmno, TO_CHAR (GDT_ENTRY_DATE, 'dd-Mon-yyyy') AS entrydate,a.hrgnum_diagnostic_code AS diagnosticcode, DECODE (hrgnum_diagnosis_code_type, 1, (SELECT hgbstr_disease FROM hgbt_icd_disease_mst WHERE TRIM(hgbstr_disease_code) \=TRIM(a.hrgnum_diagnostic_code) and HGNUM_RECORD_TYPE\=0) || '(' || hrgnum_diagnostic_code ||')', 2, HRGSTR_DIAGNOSTIC_NAME || '(' || hrgnum_diagnostic_code ||')', HRGSTR_DIAGNOSTIC_NAME ) AS dignosisname, (SELECT d.hgbstr_diagnostic_type_name FROM hgbt_diagnosis_type_mst d WHERE a.gnum_diagnostic_type_code \= d.hgbnum_diagnostic_type_code AND d.gnum_isvalid \= a.gnum_isvalid AND d.gnum_hospital_code \= 100) AS diagnostictypename,hrgstr_remarks AS remarks, TO_CHAR (hrgt_episode_date, 'dd-Mon-yyyy') AS episodedate, (SELECT hrgnum_is_episode_open FROM hrgt_episode_dtl WHERE hrgnum_puk \= a.hrgnum_puk AND hrgnum_episode_code \= a.hrgnum_episode_code AND gnum_hospital_code \= a.gnum_hospital_code AND gnum_isvalid \= a.gnum_isvalid AND hrgnum_visit_no \=(SELECT MAX (hrgnum_visit_no) FROM hrgt_episode_dtl WHERE hrgnum_puk \= a.hrgnum_puk AND hrgnum_episode_code \= a.hrgnum_episode_code AND gnum_hospital_code \=a.gnum_hospital_code AND gnum_isvalid \= a.gnum_isvalid)) AS episodeisopen, DECODE (hbnum_isrepeat, 0, 1, 1, 1, 2, 2) AS isrepeat, DECODE(hrgnum_diagnosis_code_type, 3,hgstr_disease_site,(SELECT hgstr_disease_site FROM hgbt_disease_site_mst WHERE hgnum_disease_site_id \= A.hgnum_disease_site_id AND gnum_hospital_code\=100) ) as diagnosisSite, (SELECT HGNUM_DEPTUNITCODE FROM HRGT_EPISODE_DTL WHERE HRGNUM_PUK\=A.HRGNUM_PUK AND HRGNUM_EPISODE_CODE\=A.HRGNUM_EPISODE_CODE AND HRGNUM_VISIT_NO\=A.HRGNUM_VISIT_NO AND GNUM_ISVALID\=A.GNUM_ISVALID AND GNUM_HOSPITAL_CODE\=A.GNUM_HOSPITAL_CODE) AS departmentUnitCode,HRGNUM_ADMISSION_NO as patAdmNo, a.gnum_hospital_code AS hospitalcode FROM hrgt_episode_diagnosis_dtl a WHERE hrgnum_puk \= ? AND a.gnum_isvalid \= ?
#SELECT.HRGT_EPISODE_DIAGNOSIS_DTL.ALL_EMR	=SELECT   a.hrgnum_puk AS patcrno, a.hrgnum_episode_code AS episodecode,a.hrgnum_visit_no AS episodevisitno,a.hrgnum_admission_no AS patadmno, TO_CHAR (GDT_ENTRY_DATE, 'dd-Mon-yyyy') AS entrydate,a.hrgnum_diagnostic_code AS diagnosticcode, DECODE (hrgnum_diagnosis_code_type, 1, (SELECT hgbstr_disease FROM hgbt_icd_disease_mst WHERE TRIM(hgbstr_disease_code) \=TRIM(a.hrgnum_diagnostic_code) and HGNUM_RECORD_TYPE\=0) || '(' || hrgnum_diagnostic_code ||')', 2, HRGSTR_DIAGNOSTIC_NAME || '(' || hrgnum_diagnostic_code ||')', HRGSTR_DIAGNOSTIC_NAME ) AS dignosisname, (SELECT d.hgbstr_diagnostic_type_name FROM hgbt_diagnosis_type_mst d WHERE a.gnum_diagnostic_type_code \= d.hgbnum_diagnostic_type_code AND d.gnum_isvalid \= a.gnum_isvalid AND d.gnum_hospital_code \= 100) AS diagnostictypename,hrgstr_remarks AS remarks, TO_CHAR (hrgt_episode_date, 'dd-Mon-yyyy') AS episodedate, (SELECT hrgnum_is_episode_open FROM hrgt_episode_dtl WHERE hrgnum_puk \= a.hrgnum_puk AND hrgnum_episode_code \= a.hrgnum_episode_code AND gnum_hospital_code \= a.gnum_hospital_code AND gnum_isvalid \= a.gnum_isvalid AND hrgnum_visit_no \=(SELECT MAX (hrgnum_visit_no) FROM hrgt_episode_dtl WHERE hrgnum_puk \= a.hrgnum_puk AND hrgnum_episode_code \= a.hrgnum_episode_code AND gnum_hospital_code \=a.gnum_hospital_code AND gnum_isvalid \= a.gnum_isvalid)) AS episodeisopen, DECODE (hbnum_isrepeat, 0, 1, 1, 1, 2, 2, 3, 3) AS isrepeat, DECODE(hrgnum_diagnosis_code_type, 3,hgstr_disease_site,(SELECT hgstr_disease_site FROM hgbt_disease_site_mst WHERE hgnum_disease_site_id \= A.hgnum_disease_site_id AND gnum_hospital_code\=100) ) as diagnosisSite, (SELECT HGNUM_DEPTUNITCODE FROM HRGT_EPISODE_DTL WHERE HRGNUM_PUK\=A.HRGNUM_PUK AND HRGNUM_EPISODE_CODE\=A.HRGNUM_EPISODE_CODE AND HRGNUM_VISIT_NO\=A.HRGNUM_VISIT_NO AND GNUM_ISVALID\=A.GNUM_ISVALID AND GNUM_HOSPITAL_CODE\=A.GNUM_HOSPITAL_CODE) AS departmentUnitCode,HRGNUM_ADMISSION_NO as patAdmNo, a.gnum_hospital_code AS hospitalcode FROM hrgt_episode_diagnosis_dtl a WHERE hrgnum_puk \= ? AND a.gnum_isvalid \= ?
#Modified by Prachi on 26-march-2019 
#SELECT.HRGT_EPISODE_DIAGNOSIS_DTL.ALL_EMR  =SELECT a.hrgnum_puk AS patcrno, a.hrgnum_episode_code AS episodecode,a.hrgnum_visit_no AS episodevisitno,a.hrgnum_admission_no AS patadmno, TO_CHAR (GDT_ENTRY_DATE, 'dd-Mon-yyyy') AS entrydate,a.hrgnum_diagnostic_code AS diagnosticcode, hrgstr_diagnostic_name || DECODE (hrgnum_diagnosis_code_type, 1,' ('||hrgnum_diagnostic_code||')','') AS dignosisname, hgbstr_diagnostic_type_name AS diagnostictypename,hrgstr_remarks AS remarks, TO_CHAR (gdt_entry_date, 'dd-Mon-yyyy') AS episodedate,1 AS episodeisopen, DECODE (hbnum_isrepeat, 0, 1, 1, 1, 2, 2, 3, 3) AS isrepeat,DECODE(hrgnum_diagnosis_code_type, 3,hgstr_disease_site,(SELECT hgstr_disease_site FROM hgbt_disease_site_mst WHERE hgnum_disease_site_id \= A.hgnum_disease_site_id AND gnum_hospital_code\=100) ) as diagnosisSite, (SELECT HGNUM_DEPTUNITCODE FROM HRGT_EPISODE_DTL WHERE HRGNUM_PUK \= A.HRGNUM_PUK AND HRGNUM_EPISODE_CODE \= A.HRGNUM_EPISODE_CODE AND HRGNUM_VISIT_NO \= A.HRGNUM_VISIT_NO AND GNUM_ISVALID \=A.GNUM_ISVALID AND gnum_hospital_code \= A.GNUM_HOSPITAL_CODE) AS departmentUnitCode,HRGNUM_ADMISSION_NO as patAdmNo, a.gnum_hospital_code AS hospitalcode FROM hrgt_episode_diagnosis_dtl a WHERE hrgnum_puk \= ? and hrgnum_episode_code||hrgnum_visit_no \=(SELECT MAX (hrgnum_episode_code||hrgnum_visit_no)FROM hrgt_episode_diagnosis_dtl WHERE hrgnum_puk \= a.hrgnum_puk AND hrgnum_episode_code \= a.hrgnum_episode_code AND gnum_hospital_code \= a.gnum_hospital_code AND gnum_isvalid \= ?) AND a.gnum_isvalid \= ? 
#Modified By Shweta On 14-May-2019
SELECT.HRGT_EPISODE_DIAGNOSIS_DTL.ALL_EMR=SELECT a.hrgnum_puk AS patcrno, a.hrgnum_episode_code AS episodecode,a.hrgnum_visit_no AS episodevisitno, a.hrgnum_admission_no AS patadmno, TO_CHAR (GDT_ENTRY_DATE, 'dd-Mon-yyyy') AS entrydate,a.hrgnum_diagnostic_code AS diagnosticcode, hrgstr_diagnostic_name || DECODE (hrgnum_diagnosis_code_type, 1,' ('||hrgnum_diagnostic_code||')','') AS dignosisname, decode(hrgnum_diagnosis_code_type,1,'ICD-10',2,'Hospital', 3,'SNOMED-CT',4,'Other') AS diagnosisCodeType, hgbstr_diagnostic_type_name AS diagnostictypename,hrgstr_remarks AS remarks, TO_CHAR (gdt_entry_date, 'dd-Mon-yyyy') AS episodedate, 1 AS episodeisopen, DECODE (hbnum_isrepeat, 0, 1, 1, 1, 2, 2, 3, 3) AS isrepeat, DECODE(hrgnum_diagnosis_code_type, 3,hgstr_disease_site, (SELECT hgstr_disease_site FROM hgbt_disease_site_mst WHERE hgnum_disease_site_id \= A.hgnum_disease_site_id AND gnum_hospital_code\=100) ) as diagnosisSite, (SELECT HGNUM_DEPTUNITCODE FROM HRGT_EPISODE_DTL WHERE  HRGNUM_PUK \= A.HRGNUM_PUK AND HRGNUM_EPISODE_CODE \= A.HRGNUM_EPISODE_CODE AND HRGNUM_VISIT_NO \= A.HRGNUM_VISIT_NO  AND GNUM_ISVALID \=A.GNUM_ISVALID AND gnum_hospital_code \= A.GNUM_HOSPITAL_CODE) AS departmentUnitCode,HRGNUM_ADMISSION_NO as patAdmNo, a.gnum_hospital_code AS hospitalcode FROM hrgt_episode_diagnosis_dtl a WHERE hrgnum_puk \= ? and hrgnum_episode_code||hrgnum_visit_no \=(SELECT MAX (hrgnum_episode_code||hrgnum_visit_no)FROM hrgt_episode_diagnosis_dtl WHERE hrgnum_puk \= a.hrgnum_puk AND hrgnum_episode_code \= a.hrgnum_episode_code  AND gnum_hospital_code \= a.gnum_hospital_code AND gnum_isvalid \= ?) AND a.gnum_isvalid \= ? 
																											
SELECT_HOPT_CONSULTATION_DTL_BY_MAIL_ID=SELECT   hrgnum_puk AS patcrno, hrgnum_episode_code AS episodecode,hrgnum_visit_no AS episodevisitno, hrgnum_req_id AS mailrequestid,hopstr_subject AS subject, hrgnum_par_req_id AS mailparentrequestid, hopstr_content AS content, hopnum_mail_type AS mailtype,hopstr_from_doct_code AS fromdoctorcode,pkg_bloodbank_mst.emp_name_useridwise(gnum_hospital_code,hopnum_from_doct_seatid) || '(' || (SELECT gstr_user_name FROM gblt_user_mst b WHERE gnum_isvalid \= ? AND b.gnum_hospital_code \= a.gnum_hospital_code AND gnum_userid \= hopnum_from_doct_seatid) || ')' AS fromdoctor, pkg_bloodbank_mst.emp_name_useridwise(gnum_hospital_code,hopnum_to_doct_seatid) || '(' || (SELECT gstr_user_name FROM gblt_user_mst b WHERE gnum_isvalid \= ? AND b.gnum_hospital_code \= a.gnum_hospital_code AND gnum_userid \= hopnum_to_doct_seatid) || ')' AS todoctor,hopnum_from_doct_seatid AS fromdoctorseatid,hopstr_to_doct_code AS todoctorcode,hopnum_to_doct_seatid AS todoctorseatid, TO_CHAR (hopdt_sent_date, 'dd-Mon-yyyy') AS sentdate,TO_CHAR (hopdt_receive_date, 'dd-Mon-yyyy') AS receivedate,hopnum_ack_status AS ackstatus FROM hopt_consultation_dtl a WHERE hrgnum_req_id \= ? AND gnum_hospital_code \= ? ORDER BY sentdate
																											


UPDATE_IS_VALID.HPMRT_PROFILE_DRUG_ADVICE_DTL=  	UPDATE HPMRT_PROFILE_DRUG_ADVICE_DTL SET GNUM_ISVALID=? WHERE HPMRNUM_PROFILE_ID=? AND GNUM_HOSPITAL_CODE=? AND HRGNUM_ENTRY_MODE=?


UPDATE.NEW_IF_EXISTS.HPMRT_PAT_ALLERGY_DTL = UPDATE HPMRT_PAT_ALLERGY_DTL SET HRGDT_EFFECTIVE_TO \= NULL, HRGSTR_REVOKE_REMARKS \= NULL WHERE HRGNUM_PUK \= ? AND HGNUM_ALLERGY_TYPE_CODE \= ? AND HGSTR_ALLERGY_ID \= ? AND GNUM_HOSPITAL_CODE \= ?

UPDATE_REVOKE_ALLERGY.HPMRT_PAT_ALLERGY_DTL = UPDATE HPMRT_PAT_ALLERGY_DTL SET HRGDT_EFFECTIVE_TO \= SYSDATE, HRGSTR_REVOKE_REMARKS \= ?, GNUM_ISVALID \=0, GDT_LSTMOD_DATE\=sysdate, GNUM_LSTMOD_SEATID\=? WHERE HRGNUM_PUK \= ? AND HGNUM_ALLERGY_TYPE_CODE \= ? AND HGSTR_ALLERGY_ID \= ? 


# added for snomed integration by manisha gangwar date: 07.10.2016 
UPDATE_REVOKE_ALLERGY.HRGT_EPISODE_PAT_ALLERGIES_DTL = UPDATE HRGT_EPISODE_PAT_ALLERGIES_DTL SET hpmrgdt_effective_to \= SYSDATE, hpmrstr_revoke_remarks \= ?,hrgnum_isrevoked\=?, GNUM_ISVALID \=0, GDT_LSTMOD_DATE\=sysdate, GNUM_LSTMOD_SEATID\=? WHERE HRGNUM_PUK \= ?  AND sctnum_id_allergry \= ?  


#Added by:	Akash Singh
#Date:		09-01-2015
#Reason:	Showing data for custom Profile from HPMRT_PAT_ALERTS_DTL
#Logs:		Added SELECT.HPMRT_PAT_ALERTS_DTL.PAT_PROFILE_BY_CRNO

#Modified by Vasu on 26.April.2019
#SELECT.HPMRT_PAT_ALERTS_DTL.PAT_AUTO_PROFILE_BY_CRNO= SELECT HGSTR_ALERT_NAME as alertName,HGNUM_PAT_ALERT_ID as patAlertId,TO_CHAR(HRGDT_DURATION_DATE,'dd-Mon-yyyy') as durationDate,ahis_util.age_YR_MON_DAY(hrgdt_duration_date,trunc(sysdate)) as durationDays, HRGSTR_REMARKS as remarks, TO_CHAR(GDT_ENTRY_DATE,'dd-Mon-yyyy') as entryDate FROM HRGT_EPISODE_ALERT_DTL WHERE HRGNUM_PUK \= ? AND GNUM_ISVALID \= ? AND HRGNUM_ISREVOKED \= ? AND HRGNUM_EPISODE_CODE \= ?

SELECT.HPMRT_PAT_ALERTS_DTL.PAT_AUTO_PROFILE_BY_CRNO= SELECT A.HGSTR_ALERT_NAME AS ALERTNAME, A.HGNUM_PAT_ALERT_ID AS PATALERTID, TO_CHAR(HRGDT_EFFECTIVE_FRM,'dd-MM-yyyy') AS effectiveFrom, A.HBSTR_REMARKS AS REMARKS, ahis_util.age_YR_MON_DAY(hrgdt_duration_date,trunc(sysdate)) AS durationDays, to_char(hrgdt_duration_date,'dd-MM-yyyy') AS DURATIONDATE, HRGDT_EFFECTIVE_TO AS EFFECTIVETO, HRGSTR_REVOKE_REMARKS AS REVOKEREMARKS  FROM HPMRT_PAT_ALERTS_DTL A WHERE HRGNUM_PUK \= ? AND A.GNUM_ISVALID \= ? AND TRUNC(NVL(HRGDT_EFFECTIVE_TO,SYSDATE+1)) > TRUNC(SYSDATE) ORDER BY A.HGSTR_ALERT_NAME\t\t\t\t\t\t\t\t\t\t\t
#Modified by Vasu on 25.Feb.2019(Cancelled Chronic Diseases should not display at patient profile)
#SELECT.HPMRT_PAT_ALERTS_DTL.PAT_PROFILE_BY_CRNO= SELECT HGSTR_ALERT_NAME as alertName,HGNUM_PAT_ALERT_ID as patAlertId,TO_CHAR(HRGDT_DURATION_DATE,'dd-Mon-yyyy') as durationDate,ahis_util.age_YR_MON_DAY(hrgdt_duration_date,trunc(sysdate)) as durationDays, hbstr_remarks as remarks, TO_CHAR(GDT_ENTRY_DATE,'dd-Mon-yyyy') as entryDate FROM HPMRT_PAT_ALERTS_DTL WHERE HRGNUM_PUK \= ? AND GNUM_ISVALID \= ?
SELECT.HPMRT_PAT_ALERTS_DTL.PAT_PROFILE_BY_CRNO= SELECT A.HGSTR_ALERT_NAME AS ALERTNAME, A.HGNUM_PAT_ALERT_ID AS PATALERTID, TO_CHAR(HRGDT_EFFECTIVE_FRM,'dd-MM-yyyy') AS effectiveFrom, A.HBSTR_REMARKS AS REMARKS, ahis_util.age_YR_MON_DAY(hrgdt_duration_date,trunc(sysdate)) AS durationDays, to_char(hrgdt_duration_date,'dd-MM-yyyy') AS DURATIONDATE, HRGDT_EFFECTIVE_TO AS EFFECTIVETO, HRGSTR_REVOKE_REMARKS AS REVOKEREMARKS  FROM HPMRT_PAT_ALERTS_DTL A WHERE HRGNUM_PUK \= ? AND A.GNUM_ISVALID \= ? AND TRUNC(NVL(HRGDT_EFFECTIVE_TO,SYSDATE+1)) > TRUNC(SYSDATE) ORDER BY A.HGSTR_ALERT_NAME\t\t\t\t\t\t\t\t\t\t\t

INSERT.HPMRT_PROFILE_ALERTS_DTL=          INSERT INTO HPMRT_PROFILE_ALERTS_DTL(HPMRNUM_PROFILE_ID,HGSTR_ALERT_NAME,HGNUM_PAT_ALERT_ID,HRGDT_EFFECTIVE_FRM,HBSTR_REMARKS,HRGDT_DURATION_DATE,GNUM_ISVALID,GNUM_SEAT_ID,GNUM_HOSPITAL_CODE,GDT_ENTRY_DATE,HRGSTR_IP_ADD) \
                                            VALUES(?,?,?,TO_DATE(?,'dd-MM-yyyy'),?,TO_DATE(?,'dd-MM-yyyy'),?,?,?,sysdate,?)
                                            
 SELECT_ALERTS_DTL.HPMRT_PROFILE_ALERTS_DTL= SELECT HPMRNUM_PROFILE_ID as profileId,HGSTR_ALERT_NAME as alertName,HGNUM_PAT_ALERT_ID as patAlertId,TO_CHAR(HRGDT_EFFECTIVE_FRM,'dd-Mon-yyyy') as effectiveFrom,HBSTR_REMARKS as remarks,TO_CHAR(HRGDT_DURATION_DATE,'dd-Mon-yyyy') as durationDate,ahis_util.age_YR_MON_DAY(hrgdt_duration_date,trunc(sysdate)) as durationDays,TO_CHAR(HRGDT_EFFECTIVE_TO,'dd-Mon-yyyy') as effectiveTo,TO_CHAR(GDT_ENTRY_DATE,'dd-Mon-yyyy') as entryDate FROM HPMRT_PROFILE_ALERTS_DTL WHERE HPMRNUM_PROFILE_ID\=? AND GNUM_HOSPITAL_CODE\=? AND GNUM_ISVALID\=?
 													

UPDATE_IS_VALID.HPMRT_PROFILE_ALERTS_DTL=  	UPDATE HPMRT_PROFILE_ALERTS_DTL SET GNUM_ISVALID=? WHERE HPMRNUM_PROFILE_ID=? AND GNUM_HOSPITAL_CODE=?

SELECT.PAT_PROFILE_IPD_DIGNOSIS_DETAIL.HRGT_EPISODE_DIAGNOSIS_DTL=SELECT A.HRGNUM_PUK as patCrNo, A.HRGNUM_EPISODE_CODE as episodeCode, A.HRGNUM_VISIT_NO AS episodeVisitNo, A.HRGNUM_ADMISSION_NO AS patAdmNo, A.HRGNUM_DIAGNOSTIC_CODE AS diagnosticCode,GNUM_DIAGNOSTIC_TYPE_CODE as diagnosticTypeCode,HRGNUM_DIAGNOSIS_CODE_TYPE as diagnosisCodeType, DECODE (hrgnum_diagnosis_code_type, 1, (SELECT hgbstr_disease FROM hgbt_icd_disease_mst WHERE TRIM(hgbstr_disease_code) \=TRIM(a.hrgnum_diagnostic_code) and HGNUM_RECORD_TYPE\=0) || '(' || hrgnum_diagnostic_code ||')', 2, HRGSTR_DIAGNOSTIC_NAME || '(' || hrgnum_diagnostic_code ||')', HRGSTR_DIAGNOSTIC_NAME )  AS dignosisName, (SELECT d.hgbstr_diagnostic_type_name FROM hgbt_diagnosis_type_mst d WHERE gnum_diagnostic_type_code \=d.hgbnum_diagnostic_type_code AND d.gnum_isvalid \=gnum_isvalid AND d.gnum_hospital_code \= gnum_hospital_code) as diagnosticTypeName, HRGSTR_REMARKS\tAS remarks, TO_CHAR(HRGT_EPISODE_DATE,'dd-Mon-yyyy') as episodeDate FROM HRGT_EPISODE_DIAGNOSIS_DTL A WHERE HRGNUM_PUK\=? AND HRGNUM_ADMISSION_NO\=? AND HRGNUM_VISIT_NO \= (SELECT MAX(HRGNUM_VISIT_NO) FROM HRGT_EPISODE_DIAGNOSIS_DTL WHERE HRGNUM_PUK\=? AND HRGNUM_ADMISSION_NO\=? AND GNUM_ISVALID\=? AND GNUM_HOSPITAL_CODE\=?) AND A.GNUM_ISVALID\=? AND A.GNUM_HOSPITAL_CODE \=? ORDER BY HRGNUM_VISIT_NO

SELECT_IPD.HRGT_EPISODE_DRUG_DTL.PAT_PROFILE_BY_CRNO_OLD =select * from (SELECT DISTINCT RANK() OVER (PARTITION BY hstnum_item_id order BY hstnum_item_id, GDT_ENTRY_DATE) AS ranking, HSTNUM_ITEM_ID AS drugId,gdt_entry_date, HSTSTR_ITEM_NAME AS drugName,HGNUM_DOSE_ID AS doseId,HGSTR_DOSE_NAME AS doseName,HGNUM_FREQUENCY_ID AS frequencyId,(SELECT UPPER(HGSTR_FREQUENCY_NAME) FROM HGBT_DRUG_FREQUENCY_MST A WHERE A.HGNUM_FREQUENCY_ID\=B.HGNUM_FREQUENCY_ID AND A.GNUM_HOSPITAL_CODE\=100 AND A.GNUM_ISVALID\=B.GNUM_ISVALID AND GNUM_ISVALID\=? ) as frequencyName, date_part('day',(TRUNC(hrgdt_end_date)-TRUNC(hrgdt_start_date))) AS startDay, TO_CHAR(HRGDT_START_DATE,'dd-Mon-yyyy') AS startDate,TO_CHAR(HRGDT_END_DATE,'dd-Mon-yyyy') AS endDate,HRGNUM_ADMISSION_NO AS admissionNo,HRGNUM_VISIT_NO AS episodeVisitNo,HGNUM_DAYS AS days,HRGSTR_REMARKS AS remarks,PSRSTR_EMP_NO AS empNo,HBNUM_RX_CONTINUE AS rxContinue,HGNUM_ISEMPTY_STOMACH AS isEmptyStomach,HGNUM_DRUG_ROUTE_ID AS drugRouteId  FROM HRGT_EPISODE_DRUG_DTL B WHERE HRGNUM_PUK\=? AND HRGNUM_ADMISSION_NO\=? and hbnum_rx_continue IN (0,1) AND GNUM_HOSPITAL_CODE\=? AND GNUM_ISVALID\=?  order by GDT_ENTRY_DATE desc) where ranking\=1 order by gdt_entry_date
														/*AND GDT_ENTRY_DATE=(SELECT MAX(GDT_ENTRY_DATE) FROM HRGT_EPISODE_DRUG_DTL WHERE HRGNUM_PUK=? AND HRGNUM_ADMISSION_NO=? AND GNUM_HOSPITAL_CODE=? AND GNUM_ISVALID=?)*/
#Added by Vasu on 23.April to get External Treatment Details at Patient Profile
SELECT_IPD.HRGT_EPISODE_DRUG_DTL.PAT_PROFILE_BY_CRNO= select * from ( SELECT 'Drug' as medicationType, HSTNUM_ITEM_ID AS drugId,gdt_entry_date, HSTSTR_ITEM_NAME AS medicationName,HGNUM_DOSE_ID AS doseId,HGSTR_DOSE_NAME AS doseName, HGNUM_FREQUENCY_ID AS frequencyId, (SELECT UPPER(HGSTR_FREQUENCY_NAME) FROM HGBT_DRUG_FREQUENCY_MST A WHERE A.HGNUM_FREQUENCY_ID\=B.HGNUM_FREQUENCY_ID AND A.GNUM_HOSPITAL_CODE\=100 AND A.GNUM_ISVALID\=B.GNUM_ISVALID AND GNUM_ISVALID\= ? ) as frequencyName, date_part('day',(TRUNC(hrgdt_end_date)-TRUNC(hrgdt_start_date))) AS startDay, TO_CHAR(HRGDT_START_DATE,'dd-Mon-yyyy') AS startDate,TO_CHAR(HRGDT_END_DATE,'dd-Mon-yyyy') AS endDate, HRGNUM_ADMISSION_NO AS admissionNo, HRGNUM_VISIT_NO AS episodeVisitNo,HGNUM_DAYS AS days,HRGSTR_REMARKS AS remarks,PSRSTR_EMP_NO AS empNo,HBNUM_RX_CONTINUE AS rxContinue,HGNUM_ISEMPTY_STOMACH AS isEmptyStomach,HGNUM_DRUG_ROUTE_ID AS drugRouteId  FROM HRGT_EPISODE_DRUG_DTL B WHERE HRGNUM_PUK\= ? AND HRGNUM_ADMISSION_NO\= ? and hbnum_rx_continue IN (0,1) AND GNUM_HOSPITAL_CODE\= ? AND GNUM_ISVALID\= ? UNION SELECT 'Other' as medicationType , '0' AS drugid,gdt_entry_date, hgstr_ext_treatment_name AS medicationName,hgnum_dose_id AS doseid, '-' AS dosename,hgnum_frequency_id AS frequencyid, (SELECT UPPER (hgstr_frequency_name) FROM hgbt_drug_frequency_mst a WHERE a.hgnum_frequency_id \= b.hgnum_frequency_id AND a.gnum_hospital_code \= 100  AND a.gnum_isvalid \= b.gnum_isvalid AND gnum_isvalid \= ?) AS frequencyname, date_part('day',(TRUNC(hrgdt_end_date)-TRUNC(hrgdt_start_date))) AS startDay,  TO_CHAR (hrgdt_start_date, 'dd-Mon-yyyy') AS startdate,TO_CHAR (hrgdt_end_date, 'dd-Mon-yyyy') AS enddate, hrgnum_admission_no AS admissionno, hrgnum_visit_no AS episodevisitno, hgnum_days AS days, hrgstr_remarks AS remarks, psrstr_emp_no AS empno,hbnum_rx_continue AS rxcontinue,  '0' AS isemptystomach,'0' AS drugrouteid FROM  hrgt_episode_exttreatment_dtl b WHERE hrgnum_puk \=  ? AND HRGNUM_ADMISSION_NO\= ? and hbnum_rx_continue IN (0,1) AND GNUM_HOSPITAL_CODE\= ? AND GNUM_ISVALID\= ?  ) order by medicationType, medicationName  \t\t\t\t\t\t\t\t\t\t\t\t\t 
#modofied by NehaRajgariya Date:26July2016
#SELECT_INVESTIGATION_IPD.HIVT_REQUISITION_DTL.HIVT_REQUISITION_HEADER=    SELECT hivtnum_req_dno AS reqDNo,gnum_test_code as labTestCode,to_char(hivt_entry_date,'dd-Mon-yyyy') as visitDate,pkg_inv_fun.fun_lab_name(a.gnum_lab_code,a.gnum_hospital_code) AS labName, pkg_inv_fun.fun_test_name(gnum_test_code) AS testName, a.gnum_lab_code AS labCode,decode(pkg_inv_fun.fun_test_type(gnum_test_code),'P','Patient Based','S', 'Sample Based', 'I','Slide Based') AS testCode,HGNUM_VISITNO  FROM HIVT_REQUISITION_DTL A, HIVT_REQUISITION_HEADER B WHERE a.hivnum_req_no=b.hivnum_req_no \
#																		AND HRGNUM_PUK=? AND HIPNUM_ADMNO=? AND hivnum_reqdtl_status IN (9, 16, 17) ORDER BY HGNUM_VISITNO DESC

#modified by manisha gangwar date:11.01.2017

#SELECT_INVESTIGATION_IPD.HIVT_REQUISITION_DTL.HIVT_REQUISITION_HEADER=    Select hivtnum_req_dno AS reqDNo ,a.gnum_lab_code as labCode, a.gnum_lab_code||a.gnum_test_code as labTestCode, HGNUM_VISITNO, \
#																		pkg_inv_fun.fun_lab_name(a.gnum_lab_code,a.gnum_hospital_code) as labName, gnum_test_code as prvTestCode, pkg_inv_fun.fun_test_name(gnum_test_code) as testName, gbnum_priority_code, decode(GBNUM_PRIORITY_CODE,1,'Normal',2,'Urgent',3,'Low') as priority, \
#																		to_char(hivt_entry_date,'dd-Mon-yyyy') as visitDate, decode(pkg_inv_fun.fun_test_type(gnum_test_code),'P','Patient Based','S', 'Sample Based', 'I','Slide Based') as sampleCode, \
#																		hivnum_reqdtl_status as resultStatusCode, DECODE(hivnum_reqdtl_status,2,'Requisition Raised',3,'Sample Collected',4,'Packing List Generated',5,'Requisition Raised', 6,'Sample/Patient Accepted', 7,'Result Entered', 8,'Result Validated',9,'Patient Rejected',10,'Test Rescheduled',11,'Test Rescheduled',12,'Sample Cancelled',13,'Ready For Report Printing',14,'Result Printed', 15,'Test Cancelled',16,'Test Deleted',26,'Report Generated',55,'Test Advised',17,'Machine Processing',18,'Machine Processing') resultStatus, \
#																		pkg_inv_fun.fun_sample_name(gnum_sample_code) sampleName, gnum_sample_code,to_char(hivt_entry_date,'MMddyyyy') as sortReqDate, nvl(hivstr_report_url,'') as reportURL, a.gnum_hospital_code as HospitalCode, b.gnum_episode_code as EpisodeCode, nvl(to_char(b.hipnum_admno),'') as PatAdmNo,b.hgnum_deptunitcode as DepartmentUnitCode, \
#																		nvl(b.hgnum_visitno,0) as EpisodeVisitNo FROM HIVT_REQUISITION_DTL A, HIVT_REQUISITION_HEADER B WHERE a.hivnum_req_no=b.hivnum_req_no \
#																		AND HRGNUM_PUK=? AND HIPNUM_ADMNO=? ORDER BY HGNUM_VISITNO DESC
																

#Modified by VASU on 6-Nov-2017																
#SELECT_INVESTIGATION_IPD.HIVT_REQUISITION_DTL.HIVT_REQUISITION_HEADER= Select hivtnum_req_dno AS reqDNo ,a.gnum_lab_code as labCode, a.gnum_lab_code||a.gnum_test_code as labTestCode, HGNUM_VISITNO, pkg_inv_fun.fun_lab_name(a.gnum_lab_code,a.gnum_hospital_code) as labName, gnum_test_code as prvTestCode, pkg_inv_fun.fun_test_name(gnum_test_code) as testName, gbnum_priority_code, decode(GBNUM_PRIORITY_CODE,1,'Normal',2,'Urgent',3,'Low') as priority, to_char(hivt_entry_date,'dd-Mon-yyyy') as visitDate, decode(pkg_inv_fun.fun_test_type(gnum_test_code),'P','Patient Based','S', 'Sample Based', 'I','Slide Based') as sampleCode, hivnum_reqdtl_status as resultStatusCode, DECODE(hivnum_reqdtl_status,2,'Requisition Raised',3,'Sample Collected',4,'Packing List Generated',5,'Requisition Raised', 6,'Sample/Patient Accepted', 7,'Result Entered', 8,'Result Validated',9,'Patient Rejected',10,'Test Rescheduled',11,'Test Rescheduled',12,'Sample Cancelled',13,'Ready For Report Printing',14,'Result Printed', 15,'Test Cancelled',16,'Test Deleted',26,'Report Generated',55,'Test Advised',17,'Machine Processing',18,'Machine Processing') resultStatus, pkg_inv_fun.fun_sample_name(gnum_sample_code) sampleName, gnum_sample_code,to_char(hivt_entry_date,'MMddyyyy') as sortReqDate, nvl(hivstr_report_url,'') as reportURL, a.gnum_hospital_code as HospitalCode, b.gnum_episode_code as EpisodeCode, nvl(to_char(b.hipnum_admno),'') as PatAdmNo,b.hgnum_deptunitcode as DepartmentUnitCode, nvl(b.hgnum_visitno,0) as EpisodeVisitNo FROM HIVT_REQUISITION_DTL A, HIVT_REQUISITION_HEADER B WHERE a.hivnum_req_no\=b.hivnum_req_no AND HRGNUM_PUK\=? AND HIPNUM_ADMNO\=? AND A.hivnum_reqdtl_status IN (8, 13, 14, 26) ORDER BY HGNUM_VISITNO DESC

# given by chandan  on 06.1.2020  # for AIIMS Patna
SELECT_INVESTIGATION_IPD.HIVT_REQUISITION_DTL.HIVT_REQUISITION_HEADER= select * from ( Select hivtnum_req_dno AS reqDNo ,a.gnum_lab_code as labCode, a.gnum_lab_code||a.gnum_test_code as labTestCode, HGNUM_VISITNO_reqd, pkg_inv_fun.fun_lab_name(a.gnum_lab_code,a.gnum_hospital_code) as labName, gnum_test_code as prvTestCode, pkg_inv_fun.fun_test_name(gnum_test_code) as testName, gbnum_priority_code, decode(GBNUM_PRIORITY_CODE,1,'Normal',2,'Urgent',3,'Low') as priority, to_char(hivt_entry_date,'dd-Mon-yyyy') as visitDate, decode(pkg_inv_fun.fun_test_type(gnum_test_code),'P','Patient Based','S', 'Sample Based', 'I','Slide Based') as sampleCode, hivnum_reqdtl_status as resultStatusCode, DECODE(hivnum_reqdtl_status,2,'Requisition Raised',3,'Sample Collected',4,'Packing List Generated',5,'Requisition Raised', 6,'Sample/Patient Accepted', 7,'Result Entered', 8,'Result Validated',9,'Patient Rejected',10,'Test Rescheduled',11,'Test Rescheduled',12,'Sample Cancelled',13,'Ready For Report Printing',14,'Result Printed', 15,'Test Cancelled',16,'Test Deleted',26,'Report Generated',55,'Test Advised',17,'Machine Processing',18,'Machine Processing') resultStatus, pkg_inv_fun.fun_sample_name(gnum_sample_code) sampleName, gnum_sample_code,to_char(hivt_entry_date,'MMddyyyy') as sortReqDate, nvl(hivstr_report_url,'') as reportURL, a.gnum_hospital_code as HospitalCode, gnum_episode_code_reqd as EpisodeCode, nvl(to_char(hipnum_admno_reqd),'') as PatAdmNo,hgnum_deptunitcode_reqd as DepartmentUnitCode, nvl(hgnum_visitno_reqd,0) as EpisodeVisitNo FROM HIVT_REQUISITION_DTL A WHERE HRGNUM_PUK_reqd\=? AND HIPNUM_ADMNO_reqd\=? AND A.hivnum_reqdtl_status IN (8, 13, 14, 26)  union   Select hivtnum_req_dno AS reqDNo ,a.gnum_lab_code as labCode, a.gnum_lab_code||a.gnum_test_code as labTestCode, HGNUM_VISITNO_reqd, pkg_inv_fun.fun_lab_name(a.gnum_lab_code,a.gnum_hospital_code) as labName, gnum_test_code as prvTestCode, pkg_inv_fun.fun_test_name(gnum_test_code) as testName, gbnum_priority_code, decode(GBNUM_PRIORITY_CODE,1,'Normal',2,'Urgent',3,'Low') as priority, to_char(hivt_entry_date,'dd-Mon-yyyy') as visitDate, decode(pkg_inv_fun.fun_test_type(gnum_test_code),'P','Patient Based','S', 'Sample Based', 'I','Slide Based') as sampleCode, hivnum_reqdtl_status as resultStatusCode, DECODE(hivnum_reqdtl_status,2,'Requisition Raised',3,'Sample Collected',4,'Packing List Generated',5,'Requisition Raised', 6,'Sample/Patient Accepted', 7,'Result Entered', 8,'Result Validated',9,'Patient Rejected',10,'Test Rescheduled',11,'Test Rescheduled',12,'Sample Cancelled',13,'Ready For Report Printing',14,'Result Printed', 15,'Test Cancelled',16,'Test Deleted',26,'Report Generated',55,'Test Advised',17,'Machine Processing',18,'Machine Processing') resultStatus, pkg_inv_fun.fun_sample_name(gnum_sample_code) sampleName, gnum_sample_code,to_char(hivt_entry_date,'MMddyyyy') as sortReqDate, nvl(hivstr_report_url,'') as reportURL, a.gnum_hospital_code as HospitalCode, gnum_episode_code_reqd as EpisodeCode, nvl(to_char(hipnum_admno_reqd),'') as PatAdmNo,hgnum_deptunitcode_reqd as DepartmentUnitCode, nvl(hgnum_visitno_reqd,0) as EpisodeVisitNo FROM HIVT_REQUISITION_DTL_hst A WHERE  HRGNUM_PUK_reqd\=? AND HIPNUM_ADMNO_reqd\=? AND A.hivnum_reqdtl_status IN (8, 13, 14, 26) ) ORDER BY HGNUM_VISITNO_reqd DESC    \t


#modifed for snomed-ct by manisha gangwar date: 22.8.2016
INSERT.HPMRT_PROFILE_FOOTER_DTL=		INSERT INTO HPMRT_PROFILE_FOOTER_DTL(HPMRNUM_PROFILE_ID,HPMRSTR_PROFILE_SUMMARY,GNUM_ISVALID,HPMRDT_REVIEW_DATE,GNUM_SEAT_ID,HPMRNUM_REVIEW_DAYS,GNUM_HOSPITAL_CODE,GDT_ENTRY_DATE,HRGNUM_DISCLAIMER_ID,HGSTR_DISCLAIMER_DESC1,HGSTR_DISCLAIMER_DESC2,HGSTR_DISCLAIMER_DESC3,sctstr_ids_remaks,sctstr_pterms_remarks,hgstr_prescribed_by_consultant_name) \
                         												VALUES(?,?,?,TO_DATE(?,'dd-mon-yyyy'),?,?,?,sysdate,?,?,?,?,?,?,?)
                         												
SELECT_FOOTER_DETAILS.HPMRT_PROFILE_FOOTER_DTL=				SELECT HPMRNUM_PROFILE_ID as profileId,HPMRSTR_PROFILE_SUMMARY as profileSummary,nvl(TO_CHAR(HPMRDT_REVIEW_DATE,'dd-Mon-yyyy'),'') as reviewDate,HRGNUM_DISCLAIMER_ID as disclaimerId,HGSTR_DISCLAIMER_DESC1 as disclaimerDesc1,HGSTR_DISCLAIMER_DESC2 as disclaimerDesc2,HGSTR_DISCLAIMER_DESC3 as disclaimerDesc3,(SELECT HPMRNUM_PROFILE_TYPE FROM HPMRT_PAT_PROFILE_DTL WHERE HPMRNUM_PROFILE_ID=A.HPMRNUM_PROFILE_ID AND GNUM_HOSPITAL_CODE=A.GNUM_HOSPITAL_CODE AND GNUM_ISVALID=?) as profileType, sctstr_ids_remaks,sctstr_pterms_remarks,hgstr_prescribed_by_consultant_name as dischargeAdvisedBy FROM HPMRT_PROFILE_FOOTER_DTL A WHERE A.HPMRNUM_PROFILE_ID=? AND A.GNUM_HOSPITAL_CODE=? AND A.GNUM_ISVALID=?

UPDATE_IS_VALID.HPMRT_PROFILE_FOOTER_DTL=  	UPDATE HPMRT_PROFILE_FOOTER_DTL SET GNUM_ISVALID=? WHERE HPMRNUM_PROFILE_ID=? AND GNUM_HOSPITAL_CODE=?					 													 


INSERT.HPMRT_PROFILE_DIETADVICE_DTL= INSERT INTO HPMRT_PROFILE_DIETADVICE_DTL(HPMRNUM_PROFILE_ID,HDMNUM_DIET_TYPE_CODE,GNUM_SEAT_ID,GDT_ENTRY_DATE,HGNUM_ADVICE_DAYS,GNUM_ISVALID,HRGSTR_REMARKS,GNUM_HOSPITAL_CODE) VALUES(?,?,?,sysdate,?,?,?,?)\t   \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t 

INSERT.HPMRT_PROFILE_RESTADVICE_DTL=INSERT INTO HPMRT_PROFILE_RESTADVICE_DTL(HPMRNUM_PROFILE_ID,HRGSTR_REST_REASON,GNUM_SEAT_ID,GDT_ENTRY_DATE,HGNUM_DAYS,GNUM_ISVALID,HRGSTR_REMARKS,GNUM_HOSPITAL_CODE) VALUES(?,?,?,sysdate,?,?,?,?)\t   \t\t

SELECT.HRGT_EPISODE_DRUG_DTL.ALL_DETAIL_EMR_OLD =SELECT hstnum_item_id AS drugid, hststr_item_name AS drugname,hgnum_dose_id AS doseid, hgstr_dose_name AS dosename,hgnum_frequency_id AS frequencyid,(SELECT UPPER (hgstr_frequency_name) FROM hgbt_drug_frequency_mst a WHERE a.hgnum_frequency_id \= b.hgnum_frequency_id AND a.gnum_hospital_code \= b.gnum_hospital_code AND a.gnum_isvalid \= b.gnum_isvalid AND gnum_isvalid \= 1) AS frequencyname,TO_CHAR (hrgdt_start_date, 'dd-Mon-yyyy') AS startdate,TO_CHAR (hrgdt_end_date, 'dd-Mon-yyyy') AS enddate,hrgnum_admission_no AS admissionno, hrgnum_visit_no AS episodevisitno, hgnum_days AS days, hrgstr_remarks AS remarks, psrstr_emp_no AS empno,hbnum_rx_continue AS rxcontinue,hgnum_isempty_stomach AS isemptystomach,hgnum_drug_route_id AS drugrouteid,hrgnum_episode_code as episodeCode,HRGNUM_VISIT_NO as episodeVisitNo, (SELECT HGNUM_DEPTUNITCODE FROM HRGT_EPISODE_DTL WHERE HRGNUM_PUK\=B.HRGNUM_PUK AND HRGNUM_EPISODE_CODE\=B.HRGNUM_EPISODE_CODE AND HRGNUM_VISIT_NO\=B.HRGNUM_VISIT_NO AND GNUM_ISVALID\=B.GNUM_ISVALID AND GNUM_HOSPITAL_CODE\=B.GNUM_HOSPITAL_CODE) AS departmentUnitCode FROM hrgt_episode_drug_dtl b WHERE hrgnum_puk \=? AND gdt_entry_date \= (SELECT MAX (gdt_entry_date) FROM hrgt_episode_drug_dtl WHERE hrgnum_puk \= b.hrgnum_puk AND hrgnum_episode_code \= b.hrgnum_episode_code AND gnum_hospital_code \= b.gnum_hospital_code  AND gnum_isvalid \= b.gnum_isvalid) AND gnum_hospital_code \= ? AND gnum_isvalid \= ?    ORDER BY hrgdt_start_date,hststr_item_name\t\t\t\t\t\t\t\t\t\t\t\t\t 

SELECT.HRGT_EPISODE_DRUG_DTL.ALL_DETAIL_EMR = SELECT hstnum_itembrand_id AS drugid, hststr_itembrand_name AS drugname,hgnum_dose_id AS doseid, hgstr_dose_name AS dosename,hgnum_frequency_id AS frequencyid,(SELECT UPPER (hgstr_frequency_name) FROM hgbt_drug_frequency_mst a WHERE a.hgnum_frequency_id \= b.hgnum_frequency_id AND a.gnum_hospital_code \= 100 AND a.gnum_isvalid \= b.gnum_isvalid AND gnum_isvalid \= 1) AS frequencyname,TO_CHAR (hrgdt_start_date, 'dd-Mon-yyyy') AS startdate,TO_CHAR (hrgdt_end_date, 'dd-Mon-yyyy') AS enddate,hrgnum_admission_no AS admissionno, hrgnum_visit_no AS episodevisitno, hgnum_days AS days, hrgstr_remarks AS remarks, psrstr_emp_no AS empno,hbnum_rx_continue AS rxcontinue,hgnum_isempty_stomach AS isemptystomach,hgnum_drug_route_id AS drugrouteid,hrgnum_episode_code as episodeCode,HRGNUM_VISIT_NO as episodeVisitNo, (SELECT HGNUM_DEPTUNITCODE FROM HRGT_EPISODE_DTL WHERE HRGNUM_PUK\=B.HRGNUM_PUK AND HRGNUM_EPISODE_CODE\=B.HRGNUM_EPISODE_CODE AND HRGNUM_VISIT_NO\=B.HRGNUM_VISIT_NO AND GNUM_ISVALID\=B.GNUM_ISVALID AND GNUM_HOSPITAL_CODE\=B.GNUM_HOSPITAL_CODE) AS departmentUnitCode, b.gnum_hospital_code as hospitalCode FROM hrgt_episode_drug_dtl b WHERE hrgnum_puk \=? AND HBNUM_RX_CONTINUE \= 1 AND hrgnum_visit_no \= (SELECT MAX (hrgnum_visit_no) FROM hrgt_episode_drug_dtl WHERE hrgnum_puk \= b.hrgnum_puk AND hrgnum_episode_code \= b.hrgnum_episode_code AND gnum_hospital_code \= b.gnum_hospital_code  AND gnum_isvalid \= b.gnum_isvalid)  AND gnum_isvalid \= ?    \t\t\t\t\t\t\t\t\t\t\t\t 

SELECT.HSTT_DRUG_SAFTY_ALERT_MST = select HSTSTR_CL as CL ,HSTSTR_SP as SP ,HSTSTR_INT as INT ,HSTSTR_ADR as ADR ,HSTSTR_INT_POT_HAZ as INT_POT_HAZ ,HSTSTR_ADR_POT_LT as ADR_POT_LT ,HSTSTR_LAB_INT as LAB_INT, HSTSTR_INT_FOOD as INT_FOOD , GSTR_REMARKS as remarks  from HSTT_DRUG_SAFTY_ALERT_MST  where HSTNUM_ITEM_ID\=(select HSTNUM_ITEM_ID from HSTT_DRUGBRAND_MST b where HSTNUM_ITEMBRAND_ID\=? and  GNUM_HOSPITAL_CODE\=100 ) and GNUM_HOSPITAL_CODE\=? and GNUM_ISVALID\=? \t\t\t\t\t\t\t\t\t\t\t\t\t 


SELECT.HIVT_REQUISITION_DTL_HIVT_REQUISITION_HEADER.ALL_INVESTIGATION_EMR_OLD=Select hivtnum_req_dno ,a.gnum_lab_code as prvLabCode, pkg_inv_fun.fun_lab_name(a.gnum_lab_code,a.gnum_hospital_code) as labName, gnum_test_code as prvTestCode, pkg_inv_fun.fun_test_name(gnum_test_code) as testName, gbnum_priority_code, decode(GBNUM_PRIORITY_CODE,1,'Normal',2,'Urgent',3,'Low') as priority,to_char(hivt_entry_date,'dd-Mon-yyyy') as visitDate, decode(pkg_inv_fun.fun_test_type(gnum_test_code),'P','Patient Based','S', 'Sample Based', 'I','Slide Based') as sampleCode,hivnum_reqdtl_status as resultStatusCode, DECODE(hivnum_reqdtl_status,2,'Requisition Raised',3,'Sample Collected',4,'Packing List Generated',5,'Requisition Raised', 6,'Sample/Patient Accepted', 7,'Result Entered', 8,'Result Validated',9,'Patient Rejected',10,'Test Rescheduled',11,'Test Rescheduled',12,'Sample Cancelled',13,'Ready For Report Printing',14,'Result Printed', 15,'Test Cancelled',16,'Test Deleted',26,'Report Generated',55,'Test Advised',17,'Machine Processing',18,'Machine Processing') resultStatus,pkg_inv_fun.fun_sample_name(gnum_sample_code) sampleName, gnum_sample_code,to_char(hivt_entry_date,'MMddyyyy') as sortReqDate, hivstr_report_url as reportURL, a.gnum_hospital_code as HospitalCode, b.gnum_episode_code as EpisodeCode, b.hipnum_admno as PatAdmNo,b.hgnum_deptunitcode as DepartmentUnitCode,nvl(b.hgnum_visitno,0) as EpisodeVisitNo from hivt_requisition_dtl a, hivt_requisition_header b where a.hivnum_req_no\=b.hivnum_req_no and b.gnum_isvalid\=? and a.gnum_hospital_code\=b.gnum_hospital_code and b.hrgnum_puk\=?



#modified by manisha Gangwar date: 14.5.2018 For View Report security
#SELECT.HIVT_REQUISITION_DTL_HIVT_REQUISITION_HEADER.ALL_INVESTIGATION_EMR=Select hivtnum_req_dno ,a.gnum_lab_code as prvLabCode, pkg_inv_fun.fun_lab_name(a.gnum_lab_code,a.gnum_hospital_code) as labName, a.gnum_test_code as prvTestCode, pkg_inv_fun.fun_test_name(a.gnum_test_code) as testName, gbnum_priority_code, decode(GBNUM_PRIORITY_CODE,1,'Normal',2,'Urgent',3,'Low') as priority,to_char(hivt_entry_date,'dd-Mon-yyyy') as visitDate, decode(pkg_inv_fun.fun_test_type(a.gnum_test_code),'P','Patient Based','S', 'Sample Based', 'I','Slide Based') as sampleCode,hivnum_reqdtl_status as resultStatusCode, DECODE(hivnum_reqdtl_status,2,'Requisition Raised',3,'Sample Collected',4,'Packing List Generated',5,'Requisition Raised', 6,'Sample/Patient Accepted', 7,'Result Entered', 8,'Result Validated',9,'Patient Rejected',10,'Test Rescheduled',11,'Test Rescheduled',12,'Sample Cancelled',13,'Ready For Report Printing',14,'Result Printed', 15,'Test Cancelled',16,'Test Deleted',26,'Report Generated',55,'Test Advised',17,'Machine Processing',18,'Machine Processing') resultStatus,pkg_inv_fun.fun_sample_name(gnum_sample_code) sampleName, gnum_sample_code,to_char(hivt_entry_date,'MMddyyyy') as sortReqDate, hivstr_report_url as reportURL, a.gnum_hospital_code as HospitalCode, b.gnum_episode_code as EpisodeCode, b.hipnum_admno as PatAdmNo,b.hgnum_deptunitcode as DepartmentUnitCode,nvl(b.hgnum_visitno,0) as EpisodeVisitNo , z.gnum_isconfidential as isConfidential from hivt_requisition_dtl a, hivt_requisition_header b , hivt_laboratory_test_mst z where a.hivnum_req_no\=b.hivnum_req_no and z.gnum_hospital_code\=a.gnum_hospital_code  and z.gnum_labcode\=a.GNUM_LAB_CODE and z.gnum_test_code\=a.gnum_test_code and b.gnum_isvalid\=? and a.gnum_hospital_code\=b.gnum_hospital_code and b.hrgnum_puk\=? 
#Modified by Vasu on 30.Jan.2019
#SELECT.HIVT_REQUISITION_DTL_HIVT_REQUISITION_HEADER.ALL_INVESTIGATION_EMR=Select prvLabCode,labName,prvTestCode,testGroupName,testName,priorityCode,priority,visitDate,sampleCode,resultStatusCode,resultStatus,sampleName,sampleCode1,sortReqDate,entryDate,reportURL,HospitalCode,EpisodeCode,PatAdmNo,DepartmentUnitCode,EpisodeVisitNo,isConfidential from(Select a.gnum_lab_code as prvLabCode, pkg_inv_fun.fun_lab_name(a.gnum_lab_code,a.gnum_hospital_code) as labName, a.gnum_test_code as prvTestCode,'NA' as testGroupName, pkg_inv_fun.fun_test_name(a.gnum_test_code) as testName, gbnum_priority_code as priorityCode, decode(GBNUM_PRIORITY_CODE,1,'Normal',2,'Urgent',3,'Low') as priority,to_char(hivt_entry_date,'dd-Mon-yyyy') as visitDate, decode(pkg_inv_fun.fun_test_type(a.gnum_test_code),'P','Patient Based','S', 'Sample Based', 'I','Slide Based') as sampleCode,hivnum_reqdtl_status as resultStatusCode, DECODE(hivnum_reqdtl_status,2,'Requisition Raised',3,'Sample Collected',4,'Packing List Generated',5,'Requisition Raised', 6,'Sample/Patient Accepted', 7,'Result Entered', 8,'Result Validated',9,'Patient Rejected',10,'Test Rescheduled',11,'Test Rescheduled',12,'Sample Cancelled',13,'Ready For Report Printing',14,'Result Printed', 15,'Test Cancelled',16,'Test Deleted',26,'Report Generated',55,'Test Advised',17,'Machine Processing',18,'Machine Processing') resultStatus,pkg_inv_fun.fun_sample_name(gnum_sample_code) sampleName, gnum_sample_code sampleCode1,to_char(hivt_entry_date,'MMddyyyy') as sortReqDate,hivt_entry_date as entryDate , hivstr_report_url as reportURL, a.gnum_hospital_code as HospitalCode, b.gnum_episode_code as EpisodeCode, b.hipnum_admno as PatAdmNo,b.hgnum_deptunitcode as DepartmentUnitCode,nvl(b.hgnum_visitno,0) as EpisodeVisitNo , z.gnum_isconfidential as isConfidential from hivt_requisition_dtl a, hivt_requisition_header b , hivt_laboratory_test_mst z where a.hivnum_req_no\=b.hivnum_req_no and z.gnum_hospital_code\=a.gnum_hospital_code  and z.gnum_labcode\=a.GNUM_LAB_CODE and z.gnum_test_code\=a.gnum_test_code and b.gnum_isvalid\=? and a.gnum_hospital_code\=b.gnum_hospital_code and b.hrgnum_puk\=? and hgnum_group_code is null UNION SELECT DISTINCT a.gnum_lab_code as prvLabCode, pkg_inv_fun.fun_lab_name(a.gnum_lab_code,a.gnum_hospital_code) as labName, a.hgnum_group_code as prvTestCode, (Select hgstr_group_name from hivt_test_group_mst where gnum_isvalid\=1 and gnum_hospital_code\=a.gnum_hospital_code and hgnum_group_code\=a.hgnum_group_code) as testGroupName,(Select hgstr_group_name from hivt_test_group_mst where gnum_isvalid\=1 and gnum_hospital_code\=a.gnum_hospital_code and hgnum_group_code\=a.hgnum_group_code) ||' ('||(SELECT string_agg(pkg_inv_fun.fun_test_name(gnum_test_code), ', ') FROM hivt_requisition_dtl b WHERE b.hgnum_group_code \= a.hgnum_group_code AND b.hivnum_req_no \= a.hivnum_req_no AND b.gnum_hospital_Code \= a.gnum_hospital_Code AND b.gnum_sample_code\=a.gnum_sample_code)||')' as testName, gbnum_priority_code, decode(GBNUM_PRIORITY_CODE,1,'Normal',2,'Urgent',3,'Low') as priority,to_char(hivt_entry_date,'dd-Mon-yyyy') as visitDate, decode(pkg_inv_fun.fun_test_type(a.gnum_test_code),'P','Patient Based','S', 'Sample Based', 'I','Slide Based') as sampleCode,hivnum_reqdtl_status as resultStatusCode, DECODE(hivnum_reqdtl_status,2,'Requisition Raised',3,'Sample Collected',4,'Packing List Generated',5,'Requisition Raised', 6,'Sample/Patient Accepted', 7,'Result Entered', 8,'Result Validated',9,'Patient Rejected',10,'Test Rescheduled',11,'Test Rescheduled',12,'Sample Cancelled',13,'Ready For Report Printing',14,'Result Printed', 15,'Test Cancelled',16,'Test Deleted',26,'Report Generated',55,'Test Advised',17,'Machine Processing',18,'Machine Processing') resultStatus,pkg_inv_fun.fun_sample_name(gnum_sample_code) sampleName, gnum_sample_code,to_char(hivt_entry_date,'MMddyyyy') as sortReqDate,hivt_entry_date as entrydate, hivstr_report_url as reportURL, a.gnum_hospital_code as HospitalCode, b.gnum_episode_code as EpisodeCode, b.hipnum_admno as PatAdmNo,b.hgnum_deptunitcode as DepartmentUnitCode,nvl(b.hgnum_visitno,0) as EpisodeVisitNo , z.gnum_isconfidential as isConfidential from hivt_requisition_dtl a, hivt_requisition_header b , hivt_laboratory_test_mst z where a.hivnum_req_no\=b.hivnum_req_no and z.gnum_hospital_code\=a.gnum_hospital_code  and z.gnum_labcode\=a.GNUM_LAB_CODE and z.gnum_test_code\=a.gnum_test_code and b.gnum_isvalid\=? and a.gnum_hospital_code\=b.gnum_hospital_code and b.hrgnum_puk\=? AND hgnum_group_code IS NOT NULL) ORDER BY TO_DATE(entrydate,'dd-Mon-yyyy hh24\:mi') DESC
#Modified by Vasu on 03.Sept.2019

#SELECT.HIVT_REQUISITION_DTL_HIVT_REQUISITION_HEADER.ALL_INVESTIGATION_EMR = Select prvLabCode,labName,prvTestCode,testGroupName,testName,priorityCode,priority,visitDate,sampleCode,resultStatusCode,resultStatus,sampleName,sampleCode1,sortReqDate,entryDate,reportURL,HospitalCode,EpisodeCode,PatAdmNo,DepartmentUnitCode,EpisodeVisitNo,isConfidential from(Select a.gnum_lab_code as prvLabCode, pkg_inv_fun.fun_lab_name(a.gnum_lab_code,a.gnum_hospital_code) as labName, a.gnum_test_code as prvTestCode,'NA' as testGroupName, pkg_inv_fun.fun_test_name(a.gnum_test_code) as testName, gbnum_priority_code as priorityCode, decode(GBNUM_PRIORITY_CODE,1,'Normal',2,'Urgent',3,'Low') as priority,to_char(hivt_entry_date,'dd-Mon-yyyy') as visitDate, decode(pkg_inv_fun.fun_test_type(a.gnum_test_code),'P','Patient Based','S', 'Sample Based', 'I','Slide Based') as sampleCode,hivnum_reqdtl_status as resultStatusCode, DECODE(hivnum_reqdtl_status,2,'Requisition Raised',3,'Sample Collected',4,'Packing List Generated',5,'Requisition Raised', 6,'Sample/Patient Accepted', 7,'Result Entered', 8,'Result Validated',9,'Patient Rejected',10,'Test Rescheduled',11,'Test Rescheduled',12,'Sample Cancelled',13,'Ready For Report Printing',14,'Result Printed', 15,'Test Cancelled',16,'Test Deleted',26,'Report Generated',55,'Test Advised',17,'Machine Processing',18,'Machine Processing') resultStatus,pkg_inv_fun.fun_sample_name(gnum_sample_code) sampleName, gnum_sample_code sampleCode1,to_char(hivt_entry_date,'MMddyyyy') as sortReqDate,hivt_entry_date as entryDate , hivstr_report_url as reportURL, a.gnum_hospital_code as HospitalCode, b.gnum_episode_code as EpisodeCode, b.hipnum_admno as PatAdmNo,b.hgnum_deptunitcode as DepartmentUnitCode,nvl(b.hgnum_visitno,0) as EpisodeVisitNo , z.gnum_isconfidential as isConfidential from hivt_requisition_dtl a, hivt_requisition_header b , hivt_laboratory_test_mst z where a.hivnum_req_no\=b.hivnum_req_no and z.gnum_hospital_code\=a.gnum_hospital_code  and z.gnum_labcode\=a.GNUM_LAB_CODE and z.gnum_test_code\=a.gnum_test_code and b.gnum_isvalid\=1 and a.gnum_hospital_code\=b.gnum_hospital_code and b.hrgnum_puk \= ? and hgnum_group_code is null UNION SELECT DISTINCT a.gnum_lab_code as prvLabCode, pkg_inv_fun.fun_lab_name(a.gnum_lab_code,a.gnum_hospital_code) as labName, a.hgnum_group_code as prvTestCode, (Select hgstr_group_name from hivt_test_group_mst where gnum_isvalid\=1 and gnum_hospital_code\=a.gnum_hospital_code and hgnum_group_code\=a.hgnum_group_code) as testGroupName,(Select hgstr_group_name from hivt_test_group_mst where gnum_isvalid\=1 and gnum_hospital_code\=a.gnum_hospital_code and hgnum_group_code\=a.hgnum_group_code) ||' ('||(SELECT string_agg(pkg_inv_fun.fun_test_name(gnum_test_code), ', ') FROM hivt_requisition_dtl_hst b WHERE b.hgnum_group_code \= a.hgnum_group_code AND b.hivnum_req_no \= a.hivnum_req_no AND b.gnum_hospital_Code \= a.gnum_hospital_Code AND b.gnum_sample_code\=a.gnum_sample_code)||')' as testName, gbnum_priority_code, decode(GBNUM_PRIORITY_CODE,1,'Normal',2,'Urgent',3,'Low') as priority,to_char(hivt_entry_date,'dd-Mon-yyyy') as visitDate, decode(pkg_inv_fun.fun_test_type(a.gnum_test_code),'P','Patient Based','S', 'Sample Based', 'I','Slide Based') as sampleCode,hivnum_reqdtl_status as resultStatusCode, DECODE(hivnum_reqdtl_status,2,'Requisition Raised',3,'Sample Collected',4,'Packing List Generated',5,'Requisition Raised', 6,'Sample/Patient Accepted', 7,'Result Entered', 8,'Result Validated',9,'Patient Rejected',10,'Test Rescheduled',11,'Test Rescheduled',12,'Sample Cancelled',13,'Ready For Report Printing',14,'Result Printed', 15,'Test Cancelled',16,'Test Deleted',26,'Report Generated',55,'Test Advised',17,'Machine Processing',18,'Machine Processing') resultStatus,pkg_inv_fun.fun_sample_name(gnum_sample_code) sampleName, gnum_sample_code,to_char(hivt_entry_date,'MMddyyyy') as sortReqDate,hivt_entry_date as entrydate, hivstr_report_url as reportURL, a.gnum_hospital_code as HospitalCode, a.gnum_episode_code_reqd as EpisodeCode, a.hipnum_admno_reqd as PatAdmNo,a.hgnum_deptunitcode_reqd as DepartmentUnitCode,nvl(a.hgnum_visitno_reqd,0) as EpisodeVisitNo , z.gnum_isconfidential as isConfidential from hivt_requisition_dtl_hst a,  hivt_laboratory_test_mst z where z.gnum_hospital_code\=a.gnum_hospital_code  and z.gnum_labcode\=a.GNUM_LAB_CODE and z.gnum_test_code\=a.gnum_test_code and a.gnum_isvalid_reqd\=1  and a.hrgnum_puk_reqd \=? AND hgnum_group_code IS NOT NULL UNION SELECT DISTINCT a.gnum_lab_code as prvLabCode, pkg_inv_fun.fun_lab_name(a.gnum_lab_code,a.gnum_hospital_code) as labName, a.hgnum_group_code as prvTestCode, (Select hgstr_group_name from hivt_test_group_mst where gnum_isvalid\=1 and gnum_hospital_code\=a.gnum_hospital_code and hgnum_group_code\=a.hgnum_group_code) as testGroupName,(Select hgstr_group_name from hivt_test_group_mst where gnum_isvalid\=1 and gnum_hospital_code\=a.gnum_hospital_code and hgnum_group_code\=a.hgnum_group_code) ||' ('||(SELECT string_agg(pkg_inv_fun.fun_test_name(gnum_test_code), ', ') FROM hivt_requisition_dtl_hst b WHERE b.hgnum_group_code \= a.hgnum_group_code AND b.hivnum_req_no \= a.hivnum_req_no AND b.gnum_hospital_Code \= a.gnum_hospital_Code AND b.gnum_sample_code\=a.gnum_sample_code)||')' as testName, gbnum_priority_code, decode(GBNUM_PRIORITY_CODE,1,'Normal',2,'Urgent',3,'Low') as priority,to_char(hivt_entry_date,'dd-Mon-yyyy') as visitDate, decode(pkg_inv_fun.fun_test_type(a.gnum_test_code),'P','Patient Based','S', 'Sample Based', 'I','Slide Based') as sampleCode,hivnum_reqdtl_status as resultStatusCode, DECODE(hivnum_reqdtl_status,2,'Requisition Raised',3,'Sample Collected',4,'Packing List Generated',5,'Requisition Raised', 6,'Sample/Patient Accepted', 7,'Result Entered', 8,'Result Validated',9,'Patient Rejected',10,'Test Rescheduled',11,'Test Rescheduled',12,'Sample Cancelled',13,'Ready For Report Printing',14,'Result Printed', 15,'Test Cancelled',16,'Test Deleted',26,'Report Generated',55,'Test Advised',17,'Machine Processing',18,'Machine Processing') resultStatus,pkg_inv_fun.fun_sample_name(gnum_sample_code) sampleName, gnum_sample_code,to_char(hivt_entry_date,'MMddyyyy') as sortReqDate,hivt_entry_date as entrydate, hivstr_report_url as reportURL, a.gnum_hospital_code as HospitalCode, a.gnum_episode_code_reqd as EpisodeCode, a.hipnum_admno_reqd as PatAdmNo,a.hgnum_deptunitcode_reqd as DepartmentUnitCode,nvl(a.hgnum_visitno_reqd,0) as EpisodeVisitNo , z.gnum_isconfidential as isConfidential from hivt_requisition_dtl_hst a,  hivt_laboratory_test_mst z where  z.gnum_hospital_code\=a.gnum_hospital_code  and z.gnum_labcode\=a.GNUM_LAB_CODE and z.gnum_test_code\=a.gnum_test_code  and gnum_isvalid_reqd\=1 and a.hrgnum_puk_reqd \=? AND hgnum_group_code IS NOT NULL UNION Select a.gnum_lab_code as prvLabCode, pkg_inv_fun.fun_lab_name(a.gnum_lab_code,a.gnum_hospital_code) as labName, a.gnum_test_code as prvTestCode,'NA' as testGroupName, pkg_inv_fun.fun_test_name(a.gnum_test_code) as testName, gbnum_priority_code as priorityCode, decode(GBNUM_PRIORITY_CODE,1,'Normal',2,'Urgent',3,'Low') as priority,to_char(hivt_entry_date,'dd-Mon-yyyy') as visitDate, decode(pkg_inv_fun.fun_test_type(a.gnum_test_code),'P','Patient Based','S', 'Sample Based', 'I','Slide Based') as sampleCode,hivnum_reqdtl_status as resultStatusCode, DECODE(hivnum_reqdtl_status,2,'Requisition Raised',3,'Sample Collected',4,'Packing List Generated',5,'Requisition Raised', 6,'Sample/Patient Accepted', 7,'Result Entered', 8,'Result Validated',9,'Patient Rejected',10,'Test Rescheduled',11,'Test Rescheduled',12,'Sample Cancelled',13,'Ready For Report Printing',14,'Result Printed', 15,'Test Cancelled',16,'Test Deleted',26,'Report Generated',55,'Test Advised',17,'Machine Processing',18,'Machine Processing') resultStatus,pkg_inv_fun.fun_sample_name(gnum_sample_code) sampleName, gnum_sample_code sampleCode1,to_char(hivt_entry_date,'MMddyyyy') as sortReqDate,hivt_entry_date as entryDate , hivstr_report_url as reportURL, a.gnum_hospital_code as HospitalCode, b.gnum_episode_code as EpisodeCode, b.hipnum_admno as PatAdmNo,b.hgnum_deptunitcode as DepartmentUnitCode,nvl(b.hgnum_visitno,0) as EpisodeVisitNo , z.gnum_isconfidential as isConfidential from hivt_requisition_dtl_hst a, hivt_requisition_header b , hivt_laboratory_test_mst z where a.hivnum_req_no\=b.hivnum_req_no and z.gnum_hospital_code\=a.gnum_hospital_code  and z.gnum_labcode\=a.GNUM_LAB_CODE and z.gnum_test_code\=a.gnum_test_code and b.gnum_isvalid\=1 and a.gnum_hospital_code\=b.gnum_hospital_code and b.hrgnum_puk \=? and hgnum_group_code is null) ORDER BY TO_DATE(entrydate,'dd-Mon-yyyy hh24\:mi') DESC
# query by chandan on 06.1.19
SELECT.HIVT_REQUISITION_DTL_HIVT_REQUISITION_HEADER.ALL_INVESTIGATION_EMR = SELECT prvLabCode	,labName	,prvTestCode	,testGroupName	,testName	,priorityCode	,priority	,visitDate	,sampleCode	,resultStatusCode	,resultStatus	,sampleName	,sampleCode1	,sortReqDate	,entryDate	,reportURL	,HospitalCode	,EpisodeCode	,PatAdmNo	,DepartmentUnitCode	,EpisodeVisitNo	,isConfidential FROM (	SELECT a.gnum_lab_code AS prvLabCode		,pkg_inv_fun.fun_lab_name(a.gnum_lab_code, a.gnum_hospital_code) AS labName		,a.gnum_test_code AS prvTestCode		,'NA' AS testGroupName		,pkg_inv_fun.fun_test_name(a.gnum_test_code) AS testName		,gbnum_priority_code AS priorityCode		,decode(GBNUM_PRIORITY_CODE, 1, 'Normal', 2, 'Urgent', 3, 'Low') AS priority		,to_char(hivt_entry_date, 'dd-Mon-yyyy') AS visitDate		,decode(pkg_inv_fun.fun_test_type(a.gnum_test_code), 'P', 'Patient Based', 'S', 'Sample Based', 'I', 'Slide Based') AS sampleCode		,hivnum_reqdtl_status AS resultStatusCode		,DECODE(hivnum_reqdtl_status, 2, 'Requisition Raised', 3, 'Sample Collected', 4, 'Packing List Generated', 5, 'Requisition Raised', 6, 'Sample/Patient Accepted', 7, 'Result Entered', 8, 'Result Validated', 9, 'Patient Rejected', 10, 'Test Rescheduled', 11, 'Test Rescheduled', 12, 'Sample Cancelled', 13, 'Ready For Report Printing', 14, 'Result Printed', 15, 'Test Cancelled', 16, 'Test Deleted', 26, 'Report Generated', 55, 'Test Advised', 17, 'Machine Processing', 18, 'Machine Processing') resultStatus		,pkg_inv_fun.fun_sample_name(gnum_sample_code) sampleName		,gnum_sample_code sampleCode1		,to_char(hivt_entry_date, 'MMddyyyy') AS sortReqDate		,hivt_entry_date AS entryDate		,hivstr_report_url AS reportURL		,a.gnum_hospital_code AS HospitalCode		,gnum_episode_code_reqd AS EpisodeCode		,hipnum_admno_reqd AS PatAdmNo		,hgnum_deptunitcode_reqd AS DepartmentUnitCode		,nvl(hgnum_visitno_reqd, 0) AS EpisodeVisitNo		,z.gnum_isconfidential AS isConfidential	FROM hivt_requisition_dtl a				,hivt_laboratory_test_mst z	WHERE 		 z.gnum_hospital_code = a.gnum_hospital_code		AND z.gnum_labcode = a.GNUM_LAB_CODE		AND z.gnum_test_code = a.gnum_test_code		AND gnum_isvalid_reqd = 1		AND a.gnum_hospital_code = ?		AND hrgnum_puk_reqd = ?		AND hgnum_group_code IS NULL		union 		SELECT a.gnum_lab_code AS prvLabCode		,pkg_inv_fun.fun_lab_name(a.gnum_lab_code, a.gnum_hospital_code) AS labName		,a.gnum_test_code AS prvTestCode		,'NA' AS testGroupName		,pkg_inv_fun.fun_test_name(a.gnum_test_code) AS testName		,gbnum_priority_code AS priorityCode		,decode(GBNUM_PRIORITY_CODE, 1, 'Normal', 2, 'Urgent', 3, 'Low') AS priority		,to_char(hivt_entry_date, 'dd-Mon-yyyy') AS visitDate		,decode(pkg_inv_fun.fun_test_type(a.gnum_test_code), 'P', 'Patient Based', 'S', 'Sample Based', 'I', 'Slide Based') AS sampleCode		,hivnum_reqdtl_status AS resultStatusCode		,DECODE(hivnum_reqdtl_status, 2, 'Requisition Raised', 3, 'Sample Collected', 4, 'Packing List Generated', 5, 'Requisition Raised', 6, 'Sample/Patient Accepted', 7, 'Result Entered', 8, 'Result Validated', 9, 'Patient Rejected', 10, 'Test Rescheduled', 11, 'Test Rescheduled', 12, 'Sample Cancelled', 13, 'Ready For Report Printing', 14, 'Result Printed', 15, 'Test Cancelled', 16, 'Test Deleted', 26, 'Report Generated', 55, 'Test Advised', 17, 'Machine Processing', 18, 'Machine Processing') resultStatus		,pkg_inv_fun.fun_sample_name(gnum_sample_code) sampleName		,gnum_sample_code sampleCode1		,to_char(hivt_entry_date, 'MMddyyyy') AS sortReqDate		,hivt_entry_date AS entryDate		,hivstr_report_url AS reportURL		,a.gnum_hospital_code AS HospitalCode		,gnum_episode_code_reqd AS EpisodeCode		,hipnum_admno_reqd AS PatAdmNo		,hgnum_deptunitcode_reqd AS DepartmentUnitCode		,nvl(hgnum_visitno_reqd, 0) AS EpisodeVisitNo		,z.gnum_isconfidential AS isConfidential	FROM hivt_requisition_dtl_hst a      ,hivt_laboratory_test_mst z	WHERE 		 z.gnum_hospital_code = a.gnum_hospital_code		AND z.gnum_labcode = a.GNUM_LAB_CODE		AND z.gnum_test_code = a.gnum_test_code		AND gnum_isvalid_reqd = 1		AND a.gnum_hospital_code = ?		AND hrgnum_puk_reqd = ?		AND hgnum_group_code IS NULL	) ORDER BY TO_DATE(entrydate, 'dd-Mon-yyyy hh24:mi') DESC \t


SELECT_DISCHARGE_REST_DETAIL.HPMRT_PROFILE_RESTADVICE_DTL=     SELECT HPMRNUM_PROFILE_ID as profileId,HRGSTR_REST_REASON as restReason ,HGNUM_DAYS as days FROM HPMRT_PROFILE_RESTADVICE_DTL WHERE HPMRNUM_PROFILE_ID=? AND GNUM_HOSPITAL_CODE=? AND GNUM_ISVALID=?

SELECT_DISCHARGE_DIET_DETAIL.HPMRT_PROFILE_DIETADVICE_DTL= SELECT HDMNUM_DIET_TYPE_CODE as dietTypeCode ,HGNUM_ADVICE_DAYS as days,HRGSTR_REMARKS as remarks FROM HPMRT_PROFILE_DIETADVICE_DTL WHERE HPMRNUM_PROFILE_ID\=? AND GNUM_HOSPITAL_CODE\=? AND GNUM_ISVALID\=?

UPDATE_IS_VALID.HPMRT_PROFILE_DIETADVICE_DTL=  UPDATE HPMRT_PROFILE_DIETADVICE_DTL SET GNUM_ISVALID=? WHERE HPMRNUM_PROFILE_ID=? AND GNUM_HOSPITAL_CODE=?

UPDATE_IS_VALID.HPMRT_PROFILE_RESTADVICE_DTL=  UPDATE HPMRT_PROFILE_RESTADVICE_DTL SET GNUM_ISVALID=? WHERE HPMRNUM_PROFILE_ID=? AND GNUM_HOSPITAL_CODE=?

INSERT.HPMRT_PROFILE_EXTTREATMENT_DTL=       INSERT INTO HPMRT_PROFILE_EXTTREATMENT_DTL(HPMRNUM_PROFILE_ID,HGNUM_EXT_TREATMENT_ID,GNUM_SEAT_ID,HGNUM_FREQUENCY_ID,GDT_ENTRY_DATE,HGNUM_DAYS,GNUM_ISVALID,HRGSTR_REMARKS,GNUM_HOSPITAL_CODE,HGSTR_EXT_TREATMENT_NAME,HGNUM_START_DAY,HGNUM_TREATMENT_TYPE) \
                                              VALUES(?,?,?,?,sysdate,?,?,?,?,?,?,?)
                                              
SELECT_DISCHARGE_EXTERNAL_TEAT_DETAIL.HPMRT_PROFILE_EXTTREATMENT_DTL=       SELECT HPMRNUM_PROFILE_ID as profileId,HGNUM_TREATMENT_TYPE as treatmentType,HGNUM_EXT_TREATMENT_ID as extTreatmentId,HGNUM_FREQUENCY_ID as frequencyId,HGNUM_DAYS as days,HRGSTR_REMARKS as remarks,HGSTR_EXT_TREATMENT_NAME as extTreatmentName,HGNUM_START_DAY as startDay FROM HPMRT_PROFILE_EXTTREATMENT_DTL WHERE HPMRNUM_PROFILE_ID=? AND GNUM_HOSPITAL_CODE=? AND GNUM_ISVALID=? AND HGNUM_TREATMENT_TYPE=?

#Modified by Vasu on 31.Aug.2018 for view patient profile 
#SELECT.HPMRT_PAT_PROFILE_DTL.PROFILE_VIEW_DETAIL_ALL=SELECT a.hpmrnum_profile_id, a.hpmrstr_profile_header,a.HRGNUM_PUK, a.HGNUM_DEPTUNITCODE,(SELECT INITCAP(HRGSTR_FNAME) || INITCAP(HRGSTR_MNAME) || HRGSTR_LNAME FROM HRGT_PATIENT_DTL WHERE HRGNUM_PUK\=a.HRGNUM_PUK AND GNUM_ISVALID\=A.GNUM_ISVALID AND GNUM_HOSPITAL_CODE\=a.gnum_hospital_code) AS NAME,((SELECT INITCAP (e.gstr_dept_name) FROM gblt_department_mst e WHERE e.gnum_dept_code \= (SELECT GNUM_DEPT_CODE FROM hgbt_unit_mst g WHERE g.hgnum_deptunitcode \= a.hgnum_deptunitcode  and g.gnum_hospital_code\=a.gnum_hospital_code  ) and e.gnum_hospital_code\=a.gnum_hospital_code  AND GNUM_ISVALID\=1) ||'('|| (SELECT INITCAP (g.hgstr_unitname) FROM hgbt_unit_mst g WHERE g.hgnum_deptunitcode \= a.hgnum_deptunitcode and g.gnum_hospital_code\=a.gnum_hospital_code  AND GNUM_ISVALID\=1 ) ||')') AS departmentunit FROM hpmrt_pat_profile_dtl a WHERE HRGNUM_PUK\=? and a.gnum_isvalid \= ? AND GNUM_HOSPITAL_CODE\=? AND TRUNC (SYSDATE) BETWEEN TRUNC (a.gdt_effective_frm) AND TRUNC (NVL (a.gdt_effective_to, SYSDATE)) AND a.hpmrnum_access_type \= ? AND ? >\= a.hpmrnum_user_level UNION SELECT a.hpmrnum_profile_id, a.hpmrstr_profile_header,a.HRGNUM_PUK, a.HGNUM_DEPTUNITCODE,(SELECT INITCAP(HRGSTR_FNAME) || INITCAP(HRGSTR_MNAME) || INITCAP(HRGSTR_LNAME) FROM HRGT_PATIENT_DTL WHERE HRGNUM_PUK\=a.HRGNUM_PUK AND GNUM_ISVALID\=A.GNUM_ISVALID AND GNUM_HOSPITAL_CODE\=a.gnum_hospital_code) AS NAME,((SELECT INITCAP (e.gstr_dept_name) FROM gblt_department_mst e WHERE e.gnum_dept_code \= (SELECT GNUM_DEPT_CODE FROM hgbt_unit_mst g WHERE g.hgnum_deptunitcode \= a.hgnum_deptunitcode  and g.gnum_hospital_code\=a.gnum_hospital_code  and gdt_effective_frm <\= TRUNC (SYSDATE)  AND NVL (gdt_effective_to, SYSDATE + 1) >\= TRUNC (SYSDATE) ) and e.gnum_hospital_code\=a.gnum_hospital_code AND GNUM_ISVALID\=1) ||'('||(SELECT INITCAP (g.hgstr_unitname) FROM hgbt_unit_mst g WHERE g.hgnum_deptunitcode \= a.hgnum_deptunitcode and g.gnum_hospital_code\=a.gnum_hospital_code  AND GNUM_ISVALID\=1 ) ||')') AS departmentunit FROM hpmrt_pat_profile_dtl a WHERE HRGNUM_PUK\=? and a.gnum_isvalid \= ? AND TRUNC (SYSDATE) BETWEEN TRUNC (a.gdt_effective_frm) AND TRUNC (NVL (a.gdt_effective_to, SYSDATE)) AND a.hpmrnum_access_type \= ? AND ? >\= a.hpmrnum_user_level AND GNUM_HOSPITAL_CODE\=? AND ? IN ( SELECT DISTINCT b.hgnum_deptunitcode FROM hpmrt_profile_access_dtl b WHERE b.hpmrnum_profile_id \= a.hpmrnum_profile_id AND b.gnum_isvalid \= ?) UNION SELECT a.hpmrnum_profile_id, a.hpmrstr_profile_header,a.HRGNUM_PUK, a.HGNUM_DEPTUNITCODE,(SELECT HRGSTR_FNAME || HRGSTR_MNAME || HRGSTR_LNAME FROM HRGT_PATIENT_DTL WHERE HRGNUM_PUK\=a.HRGNUM_PUK AND GNUM_ISVALID\=A.GNUM_ISVALID AND GNUM_HOSPITAL_CODE\=a.gnum_hospital_code) AS NAME, ((SELECT INITCAP (e.gstr_dept_name) FROM gblt_department_mst e WHERE e.gnum_dept_code \= (SELECT GNUM_DEPT_CODE FROM hgbt_unit_mst g WHERE g.hgnum_deptunitcode \= a.hgnum_deptunitcode  and g.gnum_hospital_code\=a.gnum_hospital_code  and gdt_effective_frm <\= TRUNC (SYSDATE)  AND NVL (gdt_effective_to, SYSDATE + 1) >\= TRUNC (SYSDATE) ) and e.gnum_hospital_code\=a.gnum_hospital_code AND GNUM_ISVALID\=1) ||'('||(SELECT INITCAP (g.hgstr_unitname) FROM hgbt_unit_mst g WHERE g.hgnum_deptunitcode \= a.hgnum_deptunitcode and g.gnum_hospital_code\=a.gnum_hospital_code   AND GNUM_ISVALID\=1) ||')') AS departmentunit FROM hpmrt_pat_profile_dtl a WHERE HRGNUM_PUK\=? and a.gnum_isvalid \= ? AND TRUNC (SYSDATE) BETWEEN TRUNC (a.gdt_effective_frm) AND TRUNC (NVL (a.gdt_effective_to, SYSDATE)) AND a.hpmrnum_access_type \= ? AND A.GNUM_HOSPITAL_CODE\=? AND ? IN ( SELECT DISTINCT b.gnum_user_id FROM hpmrt_profile_access_dtl b WHERE b.hpmrnum_profile_id \= a.hpmrnum_profile_id AND b.gnum_isvalid \= ? AND B.GNUM_HOSPITAL_CODE\=A.GNUM_HOSPITAL_CODE) AND HPMRNUM_PROFILE_STATUS\=2
					  
SELECT.HPMRT_PAT_PROFILE_DTL.PROFILE_VIEW_DETAIL_ALL=SELECT a.hpmrnum_profile_id, a.hpmrstr_profile_header,a.HRGNUM_PUK, a.HGNUM_DEPTUNITCODE,(SELECT INITCAP(HRGSTR_FNAME) || INITCAP(HRGSTR_MNAME) || HRGSTR_LNAME FROM HRGT_PATIENT_DTL WHERE HRGNUM_PUK\=a.HRGNUM_PUK AND GNUM_ISVALID\=A.GNUM_ISVALID AND GNUM_HOSPITAL_CODE\=a.gnum_hospital_code) AS NAME,((SELECT INITCAP (e.gstr_dept_name) FROM gblt_department_mst e WHERE e.gnum_dept_code \= (SELECT GNUM_DEPT_CODE FROM hgbt_unit_mst g WHERE g.hgnum_deptunitcode \= a.hgnum_deptunitcode  and g.gnum_hospital_code\=a.gnum_hospital_code  ) and e.gnum_hospital_code\=a.gnum_hospital_code  AND GNUM_ISVALID\=1) ||'('|| (SELECT INITCAP (g.hgstr_unitname) FROM hgbt_unit_mst g WHERE g.hgnum_deptunitcode \= a.hgnum_deptunitcode and g.gnum_hospital_code\=a.gnum_hospital_code  AND GNUM_ISVALID\=1 ) ||')') AS departmentunit FROM hpmrt_pat_profile_dtl a WHERE HRGNUM_PUK\=? and a.gnum_isvalid \= ? AND GNUM_HOSPITAL_CODE\=? AND TRUNC (SYSDATE) BETWEEN TRUNC (a.gdt_effective_frm) AND TRUNC (NVL (a.gdt_effective_to, SYSDATE)) UNION SELECT a.hpmrnum_profile_id, a.hpmrstr_profile_header,a.HRGNUM_PUK, a.HGNUM_DEPTUNITCODE,(SELECT INITCAP(HRGSTR_FNAME) || INITCAP(HRGSTR_MNAME) || INITCAP(HRGSTR_LNAME) FROM HRGT_PATIENT_DTL WHERE HRGNUM_PUK\=a.HRGNUM_PUK AND GNUM_ISVALID\=A.GNUM_ISVALID AND GNUM_HOSPITAL_CODE\=a.gnum_hospital_code) AS NAME,((SELECT INITCAP (e.gstr_dept_name) FROM gblt_department_mst e WHERE e.gnum_dept_code \= (SELECT GNUM_DEPT_CODE FROM hgbt_unit_mst g WHERE g.hgnum_deptunitcode \= a.hgnum_deptunitcode  and g.gnum_hospital_code\=a.gnum_hospital_code  and gdt_effective_frm <\= TRUNC (SYSDATE)  AND NVL (gdt_effective_to, SYSDATE + 1) >\= TRUNC (SYSDATE) ) and e.gnum_hospital_code\=a.gnum_hospital_code AND GNUM_ISVALID\=1) ||'('||(SELECT INITCAP (g.hgstr_unitname) FROM hgbt_unit_mst g WHERE g.hgnum_deptunitcode \= a.hgnum_deptunitcode and g.gnum_hospital_code\=a.gnum_hospital_code  AND GNUM_ISVALID\=1 ) ||')') AS departmentunit FROM hpmrt_pat_profile_dtl a WHERE HRGNUM_PUK\=? and a.gnum_isvalid \= ? AND TRUNC (SYSDATE) BETWEEN TRUNC (a.gdt_effective_frm) AND TRUNC (NVL (a.gdt_effective_to, SYSDATE)) AND a.hpmrnum_access_type \= ? AND ? >\= a.hpmrnum_user_level AND GNUM_HOSPITAL_CODE\=? AND ? IN ( SELECT DISTINCT b.hgnum_deptunitcode FROM hpmrt_profile_access_dtl b WHERE b.hpmrnum_profile_id \= a.hpmrnum_profile_id AND b.gnum_isvalid \= ?) UNION SELECT a.hpmrnum_profile_id, a.hpmrstr_profile_header,a.HRGNUM_PUK, a.HGNUM_DEPTUNITCODE,(SELECT HRGSTR_FNAME || HRGSTR_MNAME || HRGSTR_LNAME FROM HRGT_PATIENT_DTL WHERE HRGNUM_PUK\=a.HRGNUM_PUK AND GNUM_ISVALID\=A.GNUM_ISVALID AND GNUM_HOSPITAL_CODE\=a.gnum_hospital_code) AS NAME, ((SELECT INITCAP (e.gstr_dept_name) FROM gblt_department_mst e WHERE e.gnum_dept_code \= (SELECT GNUM_DEPT_CODE FROM hgbt_unit_mst g WHERE g.hgnum_deptunitcode \= a.hgnum_deptunitcode  and g.gnum_hospital_code\=a.gnum_hospital_code  and gdt_effective_frm <\= TRUNC (SYSDATE)  AND NVL (gdt_effective_to, SYSDATE + 1) >\= TRUNC (SYSDATE) ) and e.gnum_hospital_code\=a.gnum_hospital_code AND GNUM_ISVALID\=1) ||'('||(SELECT INITCAP (g.hgstr_unitname) FROM hgbt_unit_mst g WHERE g.hgnum_deptunitcode \= a.hgnum_deptunitcode and g.gnum_hospital_code\=a.gnum_hospital_code   AND GNUM_ISVALID\=1) ||')') AS departmentunit FROM hpmrt_pat_profile_dtl a WHERE HRGNUM_PUK\=? and a.gnum_isvalid \= ? AND TRUNC (SYSDATE) BETWEEN TRUNC (a.gdt_effective_frm) AND TRUNC (NVL (a.gdt_effective_to, SYSDATE)) AND a.hpmrnum_access_type \= ? AND A.GNUM_HOSPITAL_CODE\=? AND ? IN ( SELECT DISTINCT b.gnum_user_id FROM hpmrt_profile_access_dtl b WHERE b.hpmrnum_profile_id \= a.hpmrnum_profile_id AND b.gnum_isvalid \= ? AND B.GNUM_HOSPITAL_CODE\=A.GNUM_HOSPITAL_CODE) AND HPMRNUM_PROFILE_STATUS\=2\t\t\t\t\t  
					  

UPDATE_IS_VALID.HPMRT_PROFILE_EXTTREATMENT_DTL=  UPDATE HPMRT_PROFILE_EXTTREATMENT_DTL SET GNUM_ISVALID=? WHERE HPMRNUM_PROFILE_ID=? AND GNUM_HOSPITAL_CODE=? AND HGNUM_TREATMENT_TYPE=?

					  
SELECT_DRUG_REACTION_STATUS.HRGT_EPISODE_DRUG_REACTION_DTL = select count(*) from HRGT_EPISODE_DRUG_REACTION_DTL where HRGNUM_PUK\=? and HSTNUM_ITEM_ID\=? and GNUM_ISVALID\=?
															  


INSERT.HPMRT_PROFILE_CLINICAL_DTL= INSERT INTO HPMRT_PROFILE_CLINICAL_DTL(HPMRNUM_PROFILE_ID,HRGDT_RECORD_DATE,GNUM_DESK_MENU_ID,HGNUM_TEMPLATE_ID,HGSTR_PARA_VALUE,GNUM_ISVALID,GNUM_SEAT_ID,HGNUM_PARA_ID,GDT_ENTRY_DATE,GNUM_HOSPITAL_CODE,HPMRNUM_RECORD_VIEW) VALUES(?,TO_DATE(?,'dd-Mon-yyyy hh24\:mi'),?,?,?,?,?,?,sysdate,?,?)
                            			
#Query modified to fetch para value By Shruti Shail on 11-May-2017
SELECT.HPMRT_PROFILE_CLINICAL_DTL= SELECT DISTINCT TO_CHAR(HRGDT_RECORD_DATE,'dd-Mon-yyyy hh24\:mi') as recordDate, HGNUM_PARA_ID as paraId,GNUM_DESK_MENU_ID as deskMenuId,HGNUM_TEMPLATE_ID as templateId,HPMRNUM_PROFILE_ID as profileId,HPMRNUM_RECORD_VIEW as recordView ,HGSTR_PARA_VALUE as paraValue FROM HPMRT_PROFILE_CLINICAL_DTL WHERE HPMRNUM_PROFILE_ID\=? AND  GNUM_HOSPITAL_CODE\=?  AND  GNUM_ISVALID\=? ORDER BY HGNUM_TEMPLATE_ID,HGNUM_PARA_ID

UPDATE_IS_VALID.HPMRT_PROFILE_CLINICAL_DTL=  	UPDATE HPMRT_PROFILE_CLINICAL_DTL SET GNUM_ISVALID=? WHERE HPMRNUM_PROFILE_ID=? AND GNUM_HOSPITAL_CODE=?                            			

SELECT_HRGT_EPISODE_EXTEXAM_DTL_INVESTIGATION_BY_CRNO_EMR_OLD=SELECT   TO_CHAR (a.hrgdt_record_date, 'dd-Mon-yyyy hh24\:mi') AS recorddate,a.hgstr_para_value AS paravalue, a.hgnum_para_id AS paraid,HRGNUM_EPISODE_CODE AS episodeCode, HRGNUM_VISIT_NO AS episodeVisitNo, (SELECT hgstr_para_name FROM hgbt_parameter_mst WHERE hgnum_para_id \= a.hgnum_para_id AND gnum_hospital_code \= a.gnum_hospital_code) AS paraname, (SELECT hgnum_deptunitcode  FROM hrgt_episode_dtl WHERE hrgnum_puk \= a.hrgnum_puk  AND hrgnum_episode_code \= a.hrgnum_episode_code AND hrgnum_visit_no \= a.hrgnum_visit_no AND gnum_isvalid \= a.gnum_isvalid AND gnum_hospital_code \= a.gnum_hospital_code) AS departmentunitcode,HRGNUM_ADMISSION_NO AS patAdmNo FROM hrgt_episode_extexam_dtl a WHERE a.hrgnum_puk \= ? AND a.gnum_isvalid \= ? AND a.gnum_hospital_code \= ? ORDER BY a.hrgdt_record_date DESC
															
SELECT_HRGT_EPISODE_EXTEXAM_DTL_INVESTIGATION_BY_CRNO_EMR=SELECT   TO_CHAR (a.hrgdt_record_date, 'dd-Mon-yyyy hh24\:mi') AS recorddate,a.hgstr_para_value AS paravalue, a.hgnum_para_id AS paraid,HRGNUM_EPISODE_CODE AS episodeCode, HRGNUM_VISIT_NO AS episodeVisitNo, (SELECT hgstr_para_name FROM hgbt_parameter_mst WHERE hgnum_para_id \= a.hgnum_para_id AND gnum_hospital_code \= 100) AS paraname, (SELECT hgnum_deptunitcode  FROM hrgt_episode_dtl WHERE hrgnum_puk \= a.hrgnum_puk  AND hrgnum_episode_code \= a.hrgnum_episode_code AND hrgnum_visit_no \= a.hrgnum_visit_no AND gnum_isvalid \= a.gnum_isvalid AND gnum_hospital_code \= a.gnum_hospital_code) AS departmentunitcode,HRGNUM_ADMISSION_NO AS patAdmNo, a.gnum_hospital_code as hospitalCode FROM hrgt_episode_extexam_dtl a WHERE a.hrgnum_puk \= ? AND a.gnum_isvalid \= ?  
															
SELECT.HRGT_EPISODE_CLINICAL_DTL.HIPD_PAT_CLINICAL_DTL.BY_CRNO_EMR=SELECT  hrgnum_episode_code as episodeCode, hrgnum_visit_no as episodeVisitNo, hgstr_para_value as paraValue, a.hgnum_para_id as paraId,null as admissionNo,TO_CHAR(a.GDT_ENTRY_DATE,'dd-Mon-yyyy') as recordDate, (SELECT hgnum_deptunitcode FROM hrgt_episode_dtl WHERE hrgnum_puk \= a.hrgnum_puk AND hrgnum_episode_code \= a.hrgnum_episode_code AND hrgnum_visit_no \= a.hrgnum_visit_no AND gnum_isvalid \= a.gnum_isvalid AND gnum_hospital_code \= a.gnum_hospital_code) AS departmentunitcode,b.hgnum_col as col, b.hgnum_row as row1,(SELECT hgstr_para_name FROM hgbt_parameter_mst WHERE hgnum_para_id \= a.hgnum_para_id AND gnum_hospital_code \= 100) AS paraDesc,b.HGNUM_TEMPLATE_ID tempId,a.gnum_hospital_code as hospitalCode FROM hrgt_episode_clinical_dtl a,hgbt_template_para_mst b WHERE hrgnum_puk \= ? AND a.gnum_isvalid \= ?  AND a.hgnum_template_id \=b.hgnum_template_id AND a.hgnum_para_id\=b.hgnum_para_id and b.gnum_hospital_code \= 100 and  b.gnum_isvalid \= a.gnum_isvalid AND a.hgnum_template_id IN (SELECT hgnum_template_id FROM hgbt_template_mst WHERE gnum_hospital_code \= 100 AND gnum_isvalid \= a.gnum_isvalid AND hgnum_template_category \= ?)  AND b.hgnum_col\=(select MIN(hgnum_col) from hgbt_template_para_mst where  hgnum_template_id \=b.hgnum_template_id AND hgnum_para_id\=b.hgnum_para_id and gnum_hospital_code \= 100 and gnum_isvalid \= a.gnum_isvalid) UNION SELECT  HRGNUM_EPISODE_CODE as episodeCode, HRGNUM_VISIT_NO as episodeVisitNo, HGSTR_PARA_VALUE as paraValue, b.HGNUM_PARA_ID as paraId,HRGNUM_ADMISSION_NO as admissionNo,TO_CHAR(HRGDT_RECORD_DATE,'dd-Mon-yyyy') as recordDate, (SELECT hgnum_deptunitcode FROM hrgt_episode_dtl WHERE hrgnum_puk \= B.hrgnum_puk AND hrgnum_episode_code \= B.hrgnum_episode_code AND hrgnum_visit_no \= B.hrgnum_visit_no AND gnum_isvalid \= B.gnum_isvalid AND gnum_hospital_code \= B.gnum_hospital_code) AS departmentunitcode,c.hgnum_col as col, c.hgnum_row as row1, (SELECT hgstr_para_name FROM hgbt_parameter_mst WHERE hgnum_para_id \= B.hgnum_para_id AND gnum_hospital_code \= 100) AS paraDesc,b.HGNUM_TEMPLATE_ID tempId,b.gnum_hospital_code as hospitalCode FROM HIPD_PAT_CLINICAL_DTL B,hgbt_template_para_mst C WHERE hrgnum_puk \= ? AND b.gnum_isvalid \= ?  AND b.hgnum_template_id \=c.hgnum_template_id AND b.hgnum_para_id\=c.hgnum_para_id and c.gnum_hospital_code \= 100 and  c.gnum_isvalid \= b.gnum_isvalid AND b.hgnum_template_id IN (SELECT hgnum_template_id FROM hgbt_template_mst WHERE gnum_hospital_code \= 100 AND gnum_isvalid \= B.gnum_isvalid AND hgnum_template_category \= ?) AND c.hgnum_col\=(select MIN(hgnum_col) from hgbt_template_para_mst where  hgnum_template_id \=b.hgnum_template_id AND hgnum_para_id\=b.hgnum_para_id and gnum_hospital_code \= 100 and gnum_isvalid \= b.gnum_isvalid) order by recordDate,tempId,row1,col


SELECT.HIPD_DOCTOR_ROUND_DTL.PAT_PROFILE_BY_CRNO =		SELECT TO_CHAR(HIPDT_ROUND_TIME,'dd-Mon-yyyy hh24:mi') AS roundTime,HIPSTR_PROGRESS_NOTES AS progressNote FROM HIPD_DOCTOR_ROUND_DTL WHERE HRGNUM_PUK=?  AND HRGNUM_ADMISSION_NO=?  AND GNUM_ISVALID=? AND GNUM_HOSPITAL_CODE=? AND HIPNUM_VERIFY_FLAG=? AND HRGNUM_EPISODE_CODE=? 

SELECT_RECORD_VIEW.HPMRT_PROFILE_CLINICAL_DTL=   SELECT DISTINCT(HPMRNUM_RECORD_VIEW) FROM HPMRT_PROFILE_CLINICAL_DTL where HPMRNUM_PROFILE_ID=? AND GNUM_HOSPITAL_CODE=? AND GNUM_ISVALID=?

SELECT_DATE_WISE.HPMRT_PROFILE_CLINICAL_DTL=    SELECT DISTINCT TO_CHAR(HRGDT_RECORD_DATE,'dd-Mon-yyyy hh24:mi') as recordDate,GNUM_DESK_MENU_ID as deskMenuId,HPMRNUM_PROFILE_ID as profileId,HPMRNUM_RECORD_VIEW as recordView FROM HPMRT_PROFILE_CLINICAL_DTL WHERE HPMRNUM_PROFILE_ID=? AND  GNUM_HOSPITAL_CODE=?  AND  GNUM_ISVALID=?


SELECT.HOPT_PAT_IMAGE_DTL.EMR=SELECT HRGNUM_PUK AS patCrNo, HRGNUM_EPISODE_CODE AS episodeCode, HRGNUM_VISIT_NO AS episodeVisitNo, HOPSTR_IMAGE_NAME AS imageName, HOPSTR_IMAGE_FILENAME AS imageFileName, HOPSTR_DIR_PATH AS dirPath, HRGNUM_ADMISSION_NO AS admissionNo, (SELECT hgnum_deptunitcode FROM hrgt_episode_dtl WHERE hrgnum_puk \= a.hrgnum_puk AND hrgnum_episode_code \= a.hrgnum_episode_code AND hrgnum_visit_no \= a.hrgnum_visit_no AND gnum_isvalid \= a.gnum_isvalid AND gnum_hospital_code \= a.gnum_hospital_code) AS departmentunitcode,TO_CHAR(GDT_ENTRY_DATE,'dd-Mon-yyyy') AS entryDate FROM HOPT_PAT_IMAGE_DTL A WHERE A.HRGNUM_PUK\= ? AND A.GNUM_ISVALID\= ? AND A.GNUM_HOSPITAL_CODE\=? AND A.HOPSTR_IMAGE_FILENAME IS NOT NULL \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t

SELECT.HPMRT_PAT_PROFILE_DTL.EMR_1=SELECT a.GDT_ENTRY_DATE,a.hpmrnum_profile_id, a.hpmrstr_profile_header, a.hrgnum_episode_code AS episodecode, a.hrgnum_visit_no AS episodevisitno,to_char(a.gdt_entry_date ,'dd-Mon-yyyy hh24\:mi'), (SELECT hgnum_deptunitcode FROM hrgt_episode_dtl WHERE hrgnum_puk \= a.hrgnum_puk  AND hrgnum_episode_code \= a.hrgnum_episode_code  AND hrgnum_visit_no \= a.hrgnum_visit_no  AND gnum_isvalid \= a.gnum_isvalid AND gnum_hospital_code \= a.gnum_hospital_code) AS departmentunitcode, hrgnum_admission_no AS patadmno, a.gnum_hospital_code as hospitalCode,a.gdt_entry_date as generationDate,hpmrnum_issinglepage AS isSinglePageFlag FROM hpmrt_pat_profile_dtl a WHERE a.hrgnum_puk \= ? AND a.gnum_isvalid \= ? AND  a.HPMRNUM_PROFILE_STATUS\=2
  							  
SELECT.HPMRT_PAT_PROFILE_DTL.EMR=(SELECT a.GDT_ENTRY_DATE,a.hrgnum_puk, a.hpmrnum_profile_id, a.hpmrstr_profile_header, a.hrgnum_episode_code AS episodecode, a.hrgnum_visit_no AS episodevisitno,to_char(a.gdt_entry_date ,'dd-Mon-yyyy hh24:mi'), (SELECT hgnum_deptunitcode FROM hrgt_episode_dtl WHERE hrgnum_puk = a.hrgnum_puk  AND hrgnum_episode_code = a.hrgnum_episode_code  AND hrgnum_visit_no = a.hrgnum_visit_no  AND gnum_isvalid = a.gnum_isvalid AND gnum_hospital_code = a.gnum_hospital_code) AS departmentunitcode, hrgnum_admission_no AS patadmno, a.gnum_hospital_code as hospitalCode,a.gdt_entry_date as generationDate,hpmrnum_issinglepage AS isSinglePageFlag FROM hpmrt_pat_profile_dtl a WHERE HPMRNUM_PROFILE_STATUS=2 AND HPMRNUM_SLNO=(SELECT MAX(HPMRNUM_SLNO) FROM hpmrt_pat_profile_dtl WHERE HRGNUM_PUK=a.HRGNUM_PUK AND HRGNUM_EPISODE_CODE=a.HRGNUM_EPISODE_CODE AND HRGNUM_VISIT_NO=a.HRGNUM_VISIT_NO) AND a.hrgnum_admission_no is null AND a.hrgnum_puk = ? UNION SELECT a.GDT_ENTRY_DATE,a.hrgnum_puk, a.hpmrnum_profile_id, a.hpmrstr_profile_header, a.hrgnum_episode_code AS episodecode, a.hrgnum_visit_no AS episodevisitno,to_char(a.gdt_entry_date ,'dd-Mon-yyyy hh24:mi'), (SELECT hgnum_deptunitcode FROM hrgt_episode_dtl WHERE hrgnum_puk = a.hrgnum_puk  AND hrgnum_episode_code = a.hrgnum_episode_code  AND hrgnum_visit_no = a.hrgnum_visit_no  AND gnum_isvalid = a.gnum_isvalid AND gnum_hospital_code = a.gnum_hospital_code) AS departmentunitcode, hrgnum_admission_no AS patadmno, a.gnum_hospital_code as hospitalCode,a.gdt_entry_date as generationDate,hpmrnum_issinglepage AS isSinglePageFlag FROM hpmrt_pat_profile_dtl a WHERE HPMRNUM_PROFILE_STATUS=2 AND HPMRNUM_SLNO=(SELECT MAX(HPMRNUM_SLNO) FROM hpmrt_pat_profile_dtl WHERE HRGNUM_PUK=a.HRGNUM_PUK AND HRGNUM_EPISODE_CODE=a.HRGNUM_EPISODE_CODE AND HRGNUM_VISIT_NO=a.HRGNUM_VISIT_NO AND hrgnum_admission_no=a.hrgnum_admission_no) AND a.hrgnum_admission_no is not null AND a.hrgnum_puk = ?) ORDER BY  1 desc
#SELECT.EPISODE_PAT_IMAGES.HOPT_PAT_IMAGE_DTL	=SELECT HRGNUM_PUK AS patCrNo, GDT_ENTRY_DATE, HRGNUM_EPISODE_CODE AS episodeCode, HRGNUM_VISIT_NO AS episodeVisitNo, HRGNUM_ADMISSION_NO AS admissionNo, INITCAP(HOPSTR_IMAGE_NAME) AS imageName, HOPSTR_IMAGE_FILENAME AS imageFileName, HOPSTR_DIR_PATH AS dirPath, HOPSTR_REMARKS AS remarks, TO_CHAR(GDT_ENTRY_DATE,'dd-Mon-yyyy') AS entryDate, (SELECT COUNT(*) FROM HOPT_PAT_IMAGE_DTL A WHERE A.HOPSTR_NEW_FILENAME\=X.HOPSTR_IMAGE_FILENAME) AS isLogPresent FROM HOPT_PAT_IMAGE_DTL X WHERE HRGNUM_PUK\=? AND HRGNUM_EPISODE_CODE\=? AND GNUM_HOSPITAL_CODE\=? AND GNUM_ISVALID\=? \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  \t\t\t\t
# Modified by VASU on 31-AUG-2017 to get entry date in "dd-mm-yyyy hh24:mi" format
SELECT.EPISODE_PAT_IMAGES.HOPT_PAT_IMAGE_DTL	=SELECT HRGNUM_PUK AS patCrNo, GDT_ENTRY_DATE, HRGNUM_EPISODE_CODE AS episodeCode, HRGNUM_VISIT_NO AS episodeVisitNo, HRGNUM_ADMISSION_NO AS admissionNo, INITCAP(HOPSTR_IMAGE_NAME) AS imageName, HOPSTR_IMAGE_FILENAME AS imageFileName, HOPSTR_DIR_PATH AS dirPath, HOPSTR_REMARKS AS remarks, TO_CHAR(GDT_ENTRY_DATE,'dd-Mon-yyyy HH24\:mi') AS entryDate, (SELECT COUNT(*) FROM HOPT_PAT_IMAGE_DTL A WHERE A.HOPSTR_NEW_FILENAME\=X.HOPSTR_IMAGE_FILENAME) AS isLogPresent FROM HOPT_PAT_IMAGE_DTL X WHERE HRGNUM_PUK\=? AND HRGNUM_EPISODE_CODE\=? AND GNUM_HOSPITAL_CODE\=? AND GNUM_ISVALID\=? \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  \t\t\t\t 
 															
INSERT.RECORD.HOPT_PAT_IMAGE_DTL	=INSERT INTO HOPT_PAT_IMAGE_DTL (HRGNUM_PUK, HRGNUM_EPISODE_CODE, HRGNUM_VISIT_NO, HRGNUM_ADMISSION_NO, HOPSTR_IMAGE_NAME, HOPSTR_IMAGE_FILENAME, HOPSTR_REMARKS, HOPSTR_DIR_PATH, GNUM_ISVALID, GNUM_SEAT_ID, GNUM_HOSPITAL_CODE, GDT_ENTRY_DATE) VALUES (?, ?, ?, ?, ?, ?||TO_CHAR(TO_DATE(?,'dd-Mon-yyyy hh24\:mi'),'dd-mm-yyyy')||?||(SELECT NVL(COUNT(*),0)+1 FROM HOPT_PAT_IMAGE_DTL WHERE HRGNUM_PUK\=? AND TRUNC(GDT_ENTRY_DATE)\= TRUNC(SYSDATE))||?, ?, ?, ?, ?, ?, TO_DATE(?,'dd-Mon-yyyy hh24\:mi'))

SELECT.FILENAME_OF_MAX_SNO.HOPT_PAT_IMAGE_DTL	=SELECT hrgnum_s_no FROM HOPT_PAT_IMAGE_DTL WHERE HRGNUM_PUK\=? AND GDT_ENTRY_DATE\=TO_DATE(?,'dd-Mon-yyyy hh24\:mi') AND HRGNUM_EPISODE_CODE\=? AND HRGNUM_VISIT_NO\=? AND HOPSTR_IMAGE_NAME\=? AND GNUM_ISVALID\=? AND GNUM_SEAT_ID\=? AND GNUM_HOSPITAL_CODE\=?

UPDATE.OLD_RECORD.HOPT_PAT_IMAGE_DTL	=	UPDATE HOPT_PAT_IMAGE_DTL SET GNUM_ISVALID=?, GDT_LSTMOD_DATE=SYSDATE, GNUM_LSTMOD_SEATID=?, HOPSTR_NEW_FILENAME=? WHERE HOPSTR_IMAGE_FILENAME=?

SELECT.LOG_PAT_IMAGES.HOPT_PAT_IMAGE_DTL	=SELECT HRGNUM_PUK AS patCrNo, GDT_ENTRY_DATE, HRGNUM_EPISODE_CODE AS episodeCode, HRGNUM_VISIT_NO AS episodeVisitNo, HRGNUM_ADMISSION_NO AS admissionNo, INITCAP(HOPSTR_IMAGE_NAME) AS imageName, HOPSTR_IMAGE_FILENAME AS imageFileName, HOPSTR_DIR_PATH AS dirPath, HOPSTR_REMARKS AS remarks, TO_CHAR(GDT_ENTRY_DATE,'dd-Mon-yyyy') AS entryDate, (SELECT COUNT(*) FROM HOPT_PAT_IMAGE_DTL A WHERE A.HOPSTR_NEW_FILENAME\=X.HOPSTR_IMAGE_FILENAME) AS isLogPresent FROM HOPT_PAT_IMAGE_DTL X WHERE HOPSTR_NEW_FILENAME\=?\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  \t\t\t\t 

REMOVE.HRGT_EPISODE_DIAGNOSIS_DTL	=UPDATE HRGT_EPISODE_DIAGNOSIS_DTL SET GNUM_ISVALID \= ? WHERE HRGNUM_PUK \= ? AND HRGNUM_EPISODE_CODE \= ? AND HRGNUM_S_NO \= ? AND HRGNUM_VISIT_NO \= ?  AND GNUM_HOSPITAL_CODE \= ?\t\t

REMOVE.PAT_EPI_ALL_DIAG.HRGT_EPISODE_DIAGNOSIS_DTL	=UPDATE HRGT_EPISODE_DIAGNOSIS_DTL SET GNUM_ISVALID \= ? WHERE HRGNUM_PUK \= ? AND HRGNUM_EPISODE_CODE \= ? AND HRGNUM_VISIT_NO \= ?  AND GNUM_HOSPITAL_CODE \= ?\t\t

#SELECT_PREVIOUS_PROFILE.HPMRT_PAT_PROFILE_DTL=		  SELECT a.HPMRNUM_PROFILE_ID AS profileId,a.HRGNUM_PUK as patCrNo, INITCAP(a.HPMRSTR_PROFILE_HEADER) AS profileHeader, a.HRGNUM_ADMISSION_NO AS admissionNo,a.HPMRNUM_PROFILE_STATUS as profileStatus, \
#														a.HPMRSTR_PROFILE_REMARK AS remarks, a.HPMRNUM_PROFILE_TYPE AS profileType,\
#														a.GNUM_ISVALID AS isValid, a.GNUM_SEAT_ID AS seatId, TO_CHAR(a.GDT_ENTRY_DATE,'dd-Mon-yyyy') AS entryDate,\
#														NVL(TO_CHAR(a.GDT_EFFECTIVE_FRM,'dd-Mon-yyyy'),' ') AS effectiveFrom, NVL(TO_CHAR(a.GDT_EFFECTIVE_TO,'dd-Mon-yyyy'),' ') AS effectiveTo, \
#														 (select HPMRSTR_PROFILE_NAME from HPMRT_PROFILE_TYPE_MST where HPMRNUM_PROFILE_TYPE=a.HPMRNUM_PROFILE_TYPE AND gnum_hospital_code = a.gnum_hospital_code \
#                      									AND gnum_isvalid = 1)profileTypeDesc FROM HPMRT_PAT_PROFILE_DTL a \
#														WHERE a.HRGNUM_PUK = ? AND a.GNUM_ISVALID = ? AND TRUNC(SYSDATE) BETWEEN TRUNC(GDT_EFFECTIVE_FRM) AND TRUNC(NVL(GDT_EFFECTIVE_TO,SYSDATE)) AND a.hpmrnum_access_type =? AND a.GNUM_HOSPITAL_CODE=? AND ? >= a.hpmrnum_user_level AND  a.HPMRNUM_PROFILE_STATUS=? \
#														UNION \
#														SELECT a.HPMRNUM_PROFILE_ID AS profileId,a.HRGNUM_PUK as patCrNo, INITCAP(a.HPMRSTR_PROFILE_HEADER) AS profileHeader, a.HRGNUM_ADMISSION_NO AS admissionNo,a.HPMRNUM_PROFILE_STATUS as profileStatus, \
#														a.HPMRSTR_PROFILE_REMARK AS remarks, a.HPMRNUM_PROFILE_TYPE AS profileType,\
#														a.GNUM_ISVALID AS isValid, a.GNUM_SEAT_ID AS seatId, TO_CHAR(a.GDT_ENTRY_DATE,'dd-Mon-yyyy') AS entryDate,\
#														NVL(TO_CHAR(a.GDT_EFFECTIVE_FRM,'dd-Mon-yyyy'),' ') AS effectiveFrom, NVL(TO_CHAR(a.GDT_EFFECTIVE_TO,'dd-Mon-yyyy'),' ') AS effectiveTo, \
#														 (select HPMRSTR_PROFILE_NAME from HPMRT_PROFILE_TYPE_MST where HPMRNUM_PROFILE_TYPE=a.HPMRNUM_PROFILE_TYPE AND gnum_hospital_code = a.gnum_hospital_code \
#                      									AND gnum_isvalid = 1)profileTypeDesc FROM HPMRT_PAT_PROFILE_DTL a \
#														WHERE a.HRGNUM_PUK = ? AND a.GNUM_ISVALID = ? AND TRUNC(SYSDATE) BETWEEN TRUNC(GDT_EFFECTIVE_FRM) AND TRUNC(NVL(GDT_EFFECTIVE_TO,SYSDATE)) AND a.hpmrnum_access_type =? AND a.GNUM_HOSPITAL_CODE=?  AND  a.HPMRNUM_PROFILE_STATUS=? AND \
#														? IN (SELECT DISTINCT b.gnum_user_id FROM hpmrt_profile_access_dtl b WHERE b.hpmrnum_profile_id = a.hpmrnum_profile_id AND b.GNUM_HOSPITAL_CODE=a.GNUM_HOSPITAL_CODE  AND b.gnum_isvalid = ?) \
#														UNION \
#														SELECT a.HPMRNUM_PROFILE_ID AS profileId,a.HRGNUM_PUK as patCrNo, INITCAP(a.HPMRSTR_PROFILE_HEADER) AS profileHeader, a.HRGNUM_ADMISSION_NO AS admissionNo,a.HPMRNUM_PROFILE_STATUS as profileStatus, \
#														a.HPMRSTR_PROFILE_REMARK AS remarks, a.HPMRNUM_PROFILE_TYPE AS profileType,\
#														a.GNUM_ISVALID AS isValid, a.GNUM_SEAT_ID AS seatId, TO_CHAR(a.GDT_ENTRY_DATE,'dd-Mon-yyyy') AS entryDate,\
#														NVL(TO_CHAR(a.GDT_EFFECTIVE_FRM,'dd-Mon-yyyy'),' ') AS effectiveFrom, NVL(TO_CHAR(a.GDT_EFFECTIVE_TO,'dd-Mon-yyyy'),' ') AS effectiveTo, \
#														 (select HPMRSTR_PROFILE_NAME from HPMRT_PROFILE_TYPE_MST where HPMRNUM_PROFILE_TYPE=a.HPMRNUM_PROFILE_TYPE AND gnum_hospital_code = a.gnum_hospital_code \
#                      									AND gnum_isvalid = 1)profileTypeDesc FROM HPMRT_PAT_PROFILE_DTL a,hpmrt_profile_access_dtl b \
#														WHERE a.HRGNUM_PUK = ? AND a.GNUM_ISVALID = ? AND TRUNC(SYSDATE) BETWEEN TRUNC(GDT_EFFECTIVE_FRM) AND TRUNC(NVL(GDT_EFFECTIVE_TO,SYSDATE)) AND a.hpmrnum_access_type =? AND ? >= a.hpmrnum_user_level AND a.HPMRNUM_PROFILE_STATUS=? \
#														 AND b.hpmrnum_profile_id =a.hpmrnum_profile_id AND b.gnum_isvalid = a.gnum_isvalid AND a.GNUM_HOSPITAL_CODE=? AND b.GNUM_HOSPITAL_CODE=a.GNUM_HOSPITAL_CODE AND b.HGNUM_DEPTUNITCODE in (SELECT GNUM_COLUMN_VALUE FROM GBLT_ROLE_SEAT_TABLE_DTL P, GBLT_METATABLE_COLUMN_MST Q WHERE P.GNUM_METATABLE_ID = Q.GNUM_METATABLE_ID AND Q.GSTR_TABLE_NAME = 'HGBT_UNIT_MST' AND GSTR_COLUMN_NAME = 'HGNUM_DEPTUNITCODE' AND \
#														  P.GNUM_SEATID = Pkg_Usermgmt.fun_getseatid(?,a.GNUM_HOSPITAL_CODE)  AND P.GNUM_HOSPITAL_CODE=a.GNUM_HOSPITAL_CODE)										
	
#modifiedby:NehaRajgariya Date:7sept2016
SELECT_PREVIOUS_PROFILE.HPMRT_PAT_PROFILE_DTL=SELECT a.HPMRNUM_PROFILE_ID AS profileId,a.HRGNUM_PUK as patCrNo, INITCAP(a.HPMRSTR_PROFILE_HEADER) AS profileHeader, a.HRGNUM_ADMISSION_NO AS admissionNo,a.HPMRNUM_PROFILE_STATUS as profileStatus, a.HPMRSTR_PROFILE_REMARK AS remarks, a.HPMRNUM_PROFILE_TYPE AS profileType,a.GNUM_ISVALID AS isValid, a.GNUM_SEAT_ID AS seatId, TO_CHAR(a.GDT_ENTRY_DATE,'dd-Mon-yyyy') AS entryDate,NVL(TO_CHAR(a.GDT_EFFECTIVE_FRM,'dd-Mon-yyyy'),' ') AS effectiveFrom, NVL(TO_CHAR(a.GDT_EFFECTIVE_TO,'dd-Mon-yyyy'),' ') AS effectiveTo, (select HPMRSTR_PROFILE_NAME from HPMRT_PROFILE_TYPE_MST where HPMRNUM_PROFILE_TYPE\=a.HPMRNUM_PROFILE_TYPE AND gnum_hospital_code \= 100 AND gnum_isvalid \= 1)profileTypeDesc FROM HPMRT_PAT_PROFILE_DTL a WHERE a.HRGNUM_PUK \= ? AND a.GNUM_ISVALID \= ? AND TRUNC(SYSDATE) BETWEEN TRUNC(GDT_EFFECTIVE_FRM) AND TRUNC(NVL(GDT_EFFECTIVE_TO,SYSDATE)) AND a.hpmrnum_access_type \=? AND a.GNUM_HOSPITAL_CODE\=? AND ? >\= a.hpmrnum_user_level AND  a.HPMRNUM_PROFILE_STATUS\=? UNION SELECT a.HPMRNUM_PROFILE_ID AS profileId,a.HRGNUM_PUK as patCrNo, INITCAP(a.HPMRSTR_PROFILE_HEADER) AS profileHeader, a.HRGNUM_ADMISSION_NO AS admissionNo,a.HPMRNUM_PROFILE_STATUS as profileStatus, a.HPMRSTR_PROFILE_REMARK AS remarks, a.HPMRNUM_PROFILE_TYPE AS profileType,a.GNUM_ISVALID AS isValid, a.GNUM_SEAT_ID AS seatId, TO_CHAR(a.GDT_ENTRY_DATE,'dd-Mon-yyyy') AS entryDate,NVL(TO_CHAR(a.GDT_EFFECTIVE_FRM,'dd-Mon-yyyy'),' ') AS effectiveFrom, NVL(TO_CHAR(a.GDT_EFFECTIVE_TO,'dd-Mon-yyyy'),' ') AS effectiveTo, (select HPMRSTR_PROFILE_NAME from HPMRT_PROFILE_TYPE_MST where HPMRNUM_PROFILE_TYPE\=a.HPMRNUM_PROFILE_TYPE AND gnum_hospital_code \= 100 AND gnum_isvalid \= 1)profileTypeDesc FROM HPMRT_PAT_PROFILE_DTL a WHERE a.HRGNUM_PUK \= ? AND a.GNUM_ISVALID \= ? AND TRUNC(SYSDATE) BETWEEN TRUNC(GDT_EFFECTIVE_FRM) AND TRUNC(NVL(GDT_EFFECTIVE_TO,SYSDATE)) AND a.hpmrnum_access_type \=? AND a.GNUM_HOSPITAL_CODE\=?  AND  a.HPMRNUM_PROFILE_STATUS\=? AND ? IN (SELECT DISTINCT b.gnum_user_id FROM hpmrt_profile_access_dtl b WHERE b.hpmrnum_profile_id \= a.hpmrnum_profile_id AND b.GNUM_HOSPITAL_CODE\=a.GNUM_HOSPITAL_CODE  AND b.gnum_isvalid \= ?) UNION SELECT a.HPMRNUM_PROFILE_ID AS profileId,a.HRGNUM_PUK as patCrNo, INITCAP(a.HPMRSTR_PROFILE_HEADER) AS profileHeader, a.HRGNUM_ADMISSION_NO AS admissionNo,a.HPMRNUM_PROFILE_STATUS as profileStatus, a.HPMRSTR_PROFILE_REMARK AS remarks, a.HPMRNUM_PROFILE_TYPE AS profileType,a.GNUM_ISVALID AS isValid, a.GNUM_SEAT_ID AS seatId, TO_CHAR(a.GDT_ENTRY_DATE,'dd-Mon-yyyy') AS entryDate,NVL(TO_CHAR(a.GDT_EFFECTIVE_FRM,'dd-Mon-yyyy'),' ') AS effectiveFrom, NVL(TO_CHAR(a.GDT_EFFECTIVE_TO,'dd-Mon-yyyy'),' ') AS effectiveTo, (select HPMRSTR_PROFILE_NAME from HPMRT_PROFILE_TYPE_MST where HPMRNUM_PROFILE_TYPE\=a.HPMRNUM_PROFILE_TYPE AND gnum_hospital_code \= 100 AND gnum_isvalid \= 1)profileTypeDesc FROM HPMRT_PAT_PROFILE_DTL a,hpmrt_profile_access_dtl b WHERE a.HRGNUM_PUK \= ? AND a.GNUM_ISVALID \= ? AND TRUNC(SYSDATE) BETWEEN TRUNC(GDT_EFFECTIVE_FRM) AND TRUNC(NVL(GDT_EFFECTIVE_TO,SYSDATE)) AND a.hpmrnum_access_type \=? AND ? >\= a.hpmrnum_user_level AND a.HPMRNUM_PROFILE_STATUS\=? AND b.hpmrnum_profile_id \=a.hpmrnum_profile_id AND b.gnum_isvalid \= a.gnum_isvalid AND a.GNUM_HOSPITAL_CODE\=? AND b.GNUM_HOSPITAL_CODE\=a.GNUM_HOSPITAL_CODE AND b.HGNUM_DEPTUNITCODE in (SELECT GNUM_COLUMN_VALUE FROM GBLT_ROLE_SEAT_TABLE_DTL P, GBLT_METATABLE_COLUMN_MST Q WHERE P.GNUM_METATABLE_ID \= Q.GNUM_METATABLE_ID AND Q.GSTR_TABLE_NAME \= 'HGBT_UNIT_MST' AND GSTR_COLUMN_NAME \= 'HGNUM_DEPTUNITCODE' AND P.GNUM_SEATID \= Pkg_Usermgmt.fun_getseatid(?,a.GNUM_HOSPITAL_CODE)  AND P.GNUM_HOSPITAL_CODE\=a.GNUM_HOSPITAL_CODE)\t\t\t\t\t\t
INSERT.HPMRT_PROFILE_REVIEW_DTL=INSERT INTO HPMRT_PROFILE_REVIEW_DTL(HRGNUM_PUK, HIPNUM_SLNO, HRGNUM_ADMISSION_NO, HPMRNUM_PROFILE_ID, HPMRSTR_EMP_ID, HIPDT_REVIEW_DATETIME, GNUM_ISVALID, GNUM_SEAT_ID, GDT_ENTRY_DATE, GNUM_HOSPITAL_CODE, HIPSTR_REMARKS, GSTR_IP_ADD, HIPDT_REVIEW_TIME) VALUES(?,(SELECT NVL(MAX(HIPNUM_SLNO),0)+1 FROM HPMRT_PROFILE_REVIEW_DTL WHERE HRGNUM_PUK\=? AND HIPDT_REVIEW_DATETIME\=trunc(sysdate)),?,?,?,trunc(sysdate),?,?,sysdate,?,?,?,sysdate)
	   									
SELECT_PREVIOUS_PROFILE.HPMRT_PROFILE_REVIEW_DTL=SELECT a.HPMRSTR_EMP_ID as empId,TO_CHAR(a.HIPDT_REVIEW_TIME,'dd-Mon-yyyy hh24\:mi') as reviewTime,a.HIPSTR_REMARKS as remarks ,(SELECT Pkg_Bloodbank_Mst.emp_name_empidwise(a.GNUM_HOSPITAL_CODE,a.HPMRSTR_EMP_ID) FROM DUAL ) as empName FROM HPMRT_PROFILE_REVIEW_DTL a WHERE a.HRGNUM_PUK\=? AND a.HPMRNUM_PROFILE_ID\=? AND a.GNUM_HOSPITAL_CODE\=? AND a.GNUM_ISVALID\=?

SELECT_PATIENT_OPERATION_DETAIL.HOTT_OP_REQUEST_DTL.old= SELECT ot.hotnum_ot_req_no AS otReqNo,HOTNUM_ADMISSION_NO AS addmissionNo,ot.hgnum_deptunitcode AS departmentUnitCode,HRGNUM_EPISODE_CODE AS episodeCode,TO_CHAR (ot.hotdt_operation_date, 'dd-Mon-yyyy') opdate,(SELECT ahis_operationtheatre.get_ot_req_wise_opnames(ot.hotnum_ot_req_no \:\:character varying,ot.gnum_hospital_code \:\:character varying,? \:\:character varying) FROM DUAL) AS operationName,HRGNUM_VISIT_NO AS visitNo,GNUM_DEPT_CODE AS deptCode FROM HOTT_OP_REQUEST_DTL ot WHERE ot.hotnum_patient_acceptance IN (1, 2) AND ot.gnum_hospital_code \=? AND (ot.hotstr_ot_req_status > 12 OR ot.hotstr_ot_req_status \= 9) AND ot.hrgnum_puk \= ?  AND HRGNUM_EPISODE_CODE\=?
#modifed hotstr_ot_req_status not working DATE: 11.1.2017
SELECT_PATIENT_OPERATION_DETAIL.HOTT_OP_REQUEST_DTL= SELECT ot.hotnum_ot_req_no AS otReqNo,HOTNUM_ADMISSION_NO AS addmissionNo,ot.hgnum_deptunitcode AS departmentUnitCode,HRGNUM_EPISODE_CODE AS episodeCode,TO_CHAR (ot.hotdt_operation_date, 'dd-Mon-yyyy') opdate,(SELECT ahis_operationtheatre.get_ot_req_wise_opnames(ot.hotnum_ot_req_no \:\:character varying,ot.gnum_hospital_code \:\:character varying,? \:\:character varying) FROM DUAL) AS operationName,HRGNUM_VISIT_NO AS visitNo,GNUM_DEPT_CODE AS deptCode FROM HOTT_OP_REQUEST_DTL ot WHERE ot.gnum_hospital_code \=? AND ot.hrgnum_puk \= ?  AND HRGNUM_EPISODE_CODE\=?
														 	

														 	
														 
INSERT.HPMRT_PROFILE_OT_DTL= INSERT INTO HPMRT_PROFILE_OT_DTL(HPMRNUM_PROFILE_ID,HOTNUM_OT_REQ_NO,GNUM_ISVALID,GNUM_SEAT_ID,GNUM_HOSPITAL_CODE,GDT_ENTRY_DATE) VALUES(?,TO_CHAR(?),?,?,?,SYSDATE)\t

                     								
SELECT_OT_PROFILE_DTL.HPMRT_PROFILE_OT_DTL_old=SELECT ot.hotnum_ot_req_no AS otReqNo,HOTNUM_ADMISSION_NO AS addmissionNo,ot.hgnum_deptunitcode AS departmentUnitCode,HRGNUM_EPISODE_CODE AS episodeCode,TO_CHAR (ot.hotdt_operation_date, 'dd-Mon-yyyy') opdate,(SELECT ahis_operationtheatre.get_ot_req_wise_opnames(to_char(ot.hotnum_ot_req_no),to_char(ot.gnum_hospital_code),to_char(?)) FROM DUAL) AS operationName,HRGNUM_VISIT_NO AS visitNo,GNUM_DEPT_CODE AS deptCode FROM HOTT_OP_REQUEST_DTL ot WHERE ot.hotnum_patient_acceptance IN (1, 2) AND ot.gnum_hospital_code \=? AND (ot.hotstr_ot_req_status > 12 OR ot.hotstr_ot_req_status \= 9) AND ot.hrgnum_puk \= ? AND ot.hotnum_ot_req_no IN (SELECT HOTNUM_OT_REQ_NO FROM HPMRT_PROFILE_OT_DTL WHERE hpmrnum_profile_id \= ? AND GNUM_HOSPITAL_CODE\=? AND GNUM_ISVALID\=?)  ORDER BY ot.hotdt_operation_date DESC\t\t
	

SELECT_OT_PROFILE_DTL.HPMRT_PROFILE_OT_DTL=SELECT ot.hotnum_ot_req_no AS otReqNo,HOTNUM_ADMISSION_NO AS addmissionNo,ot.hgnum_deptunitcode AS departmentUnitCode,HRGNUM_EPISODE_CODE AS episodeCode,TO_CHAR (ot.hotdt_operation_date, 'dd-Mon-yyyy') opdate,HRGNUM_VISIT_NO AS visitNo,GNUM_DEPT_CODE AS deptCode FROM HOTT_OP_REQUEST_DTL ot WHERE ot.hotnum_patient_acceptance IN (1, 2) AND ot.gnum_hospital_code \=? AND (ot.hotstr_ot_req_status > 12 OR ot.hotstr_ot_req_status \= 9) AND ot.hrgnum_puk \= ? AND ot.hotnum_ot_req_no IN (SELECT HOTNUM_OT_REQ_NO FROM HPMRT_PROFILE_OT_DTL WHERE hpmrnum_profile_id \= ? AND GNUM_HOSPITAL_CODE\=? AND GNUM_ISVALID\=?)  ORDER BY ot.hotdt_operation_date DESC\t\t


													 
UPDATE_IS_VALID.HPMRT_PROFILE_OT_DTL=  	UPDATE HPMRT_PROFILE_OT_DTL SET GNUM_ISVALID=? WHERE HPMRNUM_PROFILE_ID=? AND GNUM_HOSPITAL_CODE=?
														 	
SELECT_PATIENT_ANC_DETAIL.HANCT_ANC_DTL=SELECT HRGNUM_PUK AS patCrNo, HANCSTR_ANC_NO AS ancNo, HANCNUM_GRAVIDA_NO AS gravidaNo, HRGNUM_EPISODE_CODE AS episodeCode, HRGNUM_VISIT_NO AS episodeVisitNo, HANCNUM_PARITY_NO AS parityNo, (SELECT HGNUM_DEPTUNITCODE FROM HRGT_EPISODE_DTL WHERE HRGNUM_PUK\=X.HRGNUM_PUK AND HRGNUM_EPISODE_CODE\=X.HRGNUM_EPISODE_CODE AND HRGNUM_VISIT_NO\=X.HRGNUM_VISIT_NO AND GNUM_ISVALID\=X.GNUM_ISVALID AND GNUM_HOSPITAL_CODE\=X.GNUM_HOSPITAL_CODE) AS departmentUnitCode,HANCNUM_ABORTUS_NO AS abortusNo, HRGNUM_ADMISSION_NO AS admissionNo, TO_CHAR(HANCDT_LMP,'dd-Mon-yyyy') AS lmpDate, HANCNUM_IS_ACTUAL_LMP AS isActualLMP, HANCNUM_MENSTRUAL_CYCLE_ID AS menstrualCycleId, TO_CHAR(HPMRDT_EDD,'dd-Mon-yyyy') AS expectedDeliveryDate, TO_CHAR(HPMRDT_ACTUAL_DD,'dd-Mon-yyyy') AS actualDeliveryDate, TO_CHAR(HANCDT_GESTATION_START_DATE,'dd-Mon-yyyy') AS gestationStartDate, DECODE(HANCDT_GESTATION_START_DATE,NULL,'',CEIL((SYSDATE-HANCDT_GESTATION_START_DATE)/7)) AS gestationPeriod, DECODE(HANCNUM_HIGHRISK_PREGNANCY,1,'Yes') AS isHighRiskPregnancy, HANCSTR_COMPLICATIONS AS complications, HANCNUM_DELIVERY_STATUS AS deliveryStatus, HPMRNUM_QUICKENING_WEEK AS quickeningWeek,TO_CHAR(HANCDT_DETECTION_DATE,'dd-Mon-yyyy') as detectionDate,HANCNUM_DETECTION_METHOD as detectionMethod, HPMRSTR_QUICKENING_REMARKS AS quickeningRemarks, TO_CHAR(HPMRDT_BOOKING_DATE,'dd-Mon-yyyy') AS bookingDate, HANCNUM_BOOKING_STATUS AS bookingStatus, HANCNUM_MENSTRUAL_CYCLE_DAYS AS menstrualCycleDays,DECODE(HANCNUM_ISCONTRACEPTIVE_USED,0,'No',1,'Yes')  AS isContraceptiveUsed, HANCSTR_CONTRACEPTIVE_REMARKS AS contraceptiveRemarks, DECODE(hancnum_antid_given,0,'No',1,'Yes') AS isAntiDGiven, TO_CHAR(HPMRDT_ULTRASOUND_EDD,'dd-Mon-yyyy') AS ultraSoundEDD FROM HANCT_ANC_DTL X WHERE HRGNUM_PUK\=? AND GNUM_ISVALID\=? AND GNUM_HOSPITAL_CODE\=? AND HANCNUM_DELIVERY_STATUS IS NULL AND HANCNUM_GRAVIDA_NO IN (SELECT MAX(HANCNUM_GRAVIDA_NO) FROM HANCT_ANC_DTL WHERE HRGNUM_PUK\=? AND GNUM_ISVALID\=? AND GNUM_HOSPITAL_CODE\=?)

#modifiedby NehaRajgariya Date:24Aug2016										 															
SELECT_PATIENT_ANC_DETAIL.HANCT_ANC_DTL.EMR	=SELECT HRGNUM_PUK AS patCrNo, HANCSTR_ANC_NO AS ancNo, HANCNUM_GRAVIDA_NO AS gravidaNo, HRGNUM_EPISODE_CODE AS episodeCode, HRGNUM_VISIT_NO AS episodeVisitNo, HANCNUM_PARITY_NO AS parityNo, (SELECT HGNUM_DEPTUNITCODE FROM HRGT_EPISODE_DTL WHERE HRGNUM_PUK\=X.HRGNUM_PUK AND HRGNUM_EPISODE_CODE\=X.HRGNUM_EPISODE_CODE AND HRGNUM_VISIT_NO\=X.HRGNUM_VISIT_NO AND GNUM_ISVALID\=X.GNUM_ISVALID AND GNUM_HOSPITAL_CODE\=X.GNUM_HOSPITAL_CODE) AS departmentUnitCode,HANCNUM_ABORTUS_NO AS abortusNo, HRGNUM_ADMISSION_NO AS admissionNo, TO_CHAR(HANCDT_LMP,'dd-Mon-yyyy') AS lmpDate, HANCNUM_IS_ACTUAL_LMP AS isActualLMP, HANCNUM_MENSTRUAL_CYCLE_ID AS menstrualCycleId, TO_CHAR(HPMRDT_EDD,'dd-Mon-yyyy') AS expectedDeliveryDate, TO_CHAR(HPMRDT_ACTUAL_DD,'dd-Mon-yyyy') AS actualDeliveryDate, TO_CHAR(HANCDT_GESTATION_START_DATE,'dd-Mon-yyyy') AS gestationStartDate, DECODE(HANCDT_GESTATION_START_DATE,NULL,'',CEIL (ahis_gbl_util.date_diff(SYSDATE,hancdt_gestation_start_date) / 7)) AS gestationperiod, DECODE(HANCNUM_HIGHRISK_PREGNANCY,1,'Yes') AS isHighRiskPregnancy, HANCSTR_COMPLICATIONS AS complications, HANCNUM_DELIVERY_STATUS AS deliveryStatus, HPMRNUM_QUICKENING_WEEK AS quickeningWeek,TO_CHAR(HANCDT_DETECTION_DATE,'dd-Mon-yyyy') as detectionDate,HANCNUM_DETECTION_METHOD as detectionMethod, HPMRSTR_QUICKENING_REMARKS AS quickeningRemarks, TO_CHAR(HPMRDT_BOOKING_DATE,'dd-Mon-yyyy') AS bookingDate, HANCNUM_BOOKING_STATUS AS bookingStatus, HANCNUM_MENSTRUAL_CYCLE_DAYS AS menstrualCycleDays,DECODE(HANCNUM_ISCONTRACEPTIVE_USED,0,'No',1,'Yes')  AS isContraceptiveUsed, HANCSTR_CONTRACEPTIVE_REMARKS AS contraceptiveRemarks, DECODE(hancnum_antid_given,0,'No',1,'Yes') AS isAntiDGiven, TO_CHAR(HPMRDT_ULTRASOUND_EDD,'dd-Mon-yyyy') AS ultraSoundEDD, gnum_hospital_code as hospitalCode  FROM HANCT_ANC_DTL X WHERE HRGNUM_PUK\=? AND GNUM_ISVALID\=? AND GNUM_HOSPITAL_CODE\=? AND HANCNUM_DELIVERY_STATUS IS NULL AND HANCNUM_GRAVIDA_NO IN (SELECT MAX(HANCNUM_GRAVIDA_NO) FROM HANCT_ANC_DTL WHERE HRGNUM_PUK\=? AND GNUM_ISVALID\=? AND GNUM_HOSPITAL_CODE\=?)
										 															
INSERT.HPMRT_PROFILE_IMAGE_DTL=       INSERT INTO HPMRT_PROFILE_IMAGE_DTL(HPMRNUM_PROFILE_ID, HOPSTR_IMAGE_NAME, HOPSTR_IMAGE_FILENAME, HOPSTR_REMARKS, HOPSTR_DIR_PATH, GNUM_ISVALID, GNUM_SEAT_ID, GDT_ENTRY_DATE, GNUM_HOSPITAL_CODE) \
	   									VALUES(?,?,?,?,?,?,?,sysdate,?)
	   									
SELECT_PROFILE_DTL.HPMRT_PROFILE_IMAGE_DTL=		SELECT HPMRNUM_PROFILE_ID as profileId,HOPSTR_IMAGE_NAME as imageName, HOPSTR_IMAGE_FILENAME as imageFileName, HOPSTR_REMARKS as remarks, HOPSTR_DIR_PATH as dirPath FROM HPMRT_PROFILE_IMAGE_DTL WHERE HPMRNUM_PROFILE_ID=? AND GNUM_HOSPITAL_CODE=? AND GNUM_ISVALID=?

UPDATE_IS_VALID.HPMRT_PROFILE_IMAGE_DTL=  	UPDATE HPMRT_PROFILE_IMAGE_DTL SET GNUM_ISVALID=? WHERE HPMRNUM_PROFILE_ID=? AND GNUM_HOSPITAL_CODE=?

INSERT.HPMRT_PROFILE_PROGRESS_DTL =INSERT INTO HPMRT_PROFILE_PROGRESS_DTL(HRGNUM_PUK, HPMRNUM_PROFILE_ID, HRGNUM_EPISODE_CODE, HIPDT_ROUND_DATE, HRGNUM_VISIT_NO, HRGNUM_ADMISSION_NO, HIPSTR_PROGRESS_NOTES, GNUM_ISVALID, GNUM_SEAT_ID, GDT_ENTRY_DATE, GNUM_HOSPITAL_CODE) VALUES(?,?,?,TO_DATE(?,'dd-Mon-yyyy hh24\:mi'),?,?,?,?,?,sysdate,?)

SELECT_PROFILE_DTL.HPMRT_PROFILE_PROGRESS_DTL=SELECT HPMRNUM_PROFILE_ID as profileId, TO_CHAR(HIPDT_ROUND_DATE,'dd-Mon-yyyy') as roundTime, HIPSTR_PROGRESS_NOTES as progressNote FROM HPMRT_PROFILE_PROGRESS_DTL WHERE HPMRNUM_PROFILE_ID\=? AND GNUM_HOSPITAL_CODE\=? AND GNUM_ISVALID\=?

UPDATE_IS_VALID.HPMRT_PROFILE_PROGRESS_DTL=  	UPDATE HPMRT_PROFILE_PROGRESS_DTL SET GNUM_ISVALID=? WHERE HPMRNUM_PROFILE_ID=? AND GNUM_HOSPITAL_CODE=?  	


INSERT.HPMRT_PROFILE_EXTEXAM_DTL =INSERT INTO HPMRT_PROFILE_EXTEXAM_DTL(HRGNUM_PUK, HPMRNUM_PROFILE_ID, HRGNUM_EPISODE_CODE, HRGDT_RECORD_DATE, HRGNUM_VISIT_NO, HRGNUM_ADMISSION_NO, HGSTR_PARA_VALUE, HGNUM_PARA_ID, GNUM_ISVALID, GNUM_SEAT_ID, GDT_ENTRY_DATE, GNUM_HOSPITAL_CODE) VALUES(?,?,?,TO_DATE(?,'dd-Mon-yyyy HH24\:mi'),?,?,?,?,?,?,sysdate,?)

SELECT_PROFILE_DTL.HPMRT_PROFILE_EXTEXAM_DTL=SELECT HPMRNUM_PROFILE_ID as profileId, TO_CHAR(HRGDT_RECORD_DATE,'dd-Mon-yyyy hh24\:mi') as recordDate,  HGNUM_PARA_ID as paraId,  HGSTR_PARA_VALUE AS paraValue, (SELECT HGSTR_PARA_NAME FROM HGBT_PARAMETER_MST WHERE HGNUM_PARA_ID\=X.HGNUM_PARA_ID AND GNUM_ISVALID\=1 AND GNUM_HOSPITAL_CODE\=X.GNUM_HOSPITAL_CODE) as paraName FROM HPMRT_PROFILE_EXTEXAM_DTL X WHERE HPMRNUM_PROFILE_ID\=? AND GNUM_HOSPITAL_CODE\=? AND GNUM_ISVALID\=?

UPDATE_IS_VALID.HPMRT_PROFILE_EXTEXAM_DTL=  	UPDATE HPMRT_PROFILE_EXTEXAM_DTL SET GNUM_ISVALID=? WHERE HPMRNUM_PROFILE_ID=? AND GNUM_HOSPITAL_CODE=?  	
												 
INSERT.HPMRT_PROFILE_DRUG_SCH_DTL	=	INSERT INTO HPMRT_PROFILE_DRUG_SCH_DTL (HPMRNUM_PROFILE_ID, HPMRNUM_ITEM_SRNO, HSTNUM_ITEM_ID, HGNUM_DOSE_ID, GNUM_SEAT_ID, HGSTR_DOSE_NAME, HGSTR_DOSE_TIME, GDT_ENTRY_DATE, HGNUM_ISEMPTY_STOMACH, GNUM_ISVALID, \
 										HGNUM_DOSE_SHIFT, GNUM_HOSPITAL_CODE) VALUES (?,?,?,?,?,?,?,SYSDATE,?,?,?,?)
 										
SELECT.MAX_SERIAL_NO.HPMRT_PROFILE_DRUG_ADVICE_DTL	=	SELECT NVL (MAX (hpmrnum_item_srno), 0) + 1  FROM hpmrt_profile_drug_advice_dtl WHERE hpmrnum_profile_id = ? AND gnum_hospital_code = ?

SELECT.HPMRT_PROFILE_DRUG_SCH_DTL =SELECT hpmrnum_profile_id profileId, hpmrnum_item_srno serialNo, hstnum_item_id itemId, hgnum_dose_id doseId, hgstr_dose_name doseName, hgstr_dose_time doseTime, hgnum_isempty_stomach as isEmptyStomach,hgnum_dose_shift doseShift FROM hpmrt_profile_drug_sch_dtl where HPMRNUM_PROFILE_ID\=? and GNUM_ISVALID\=? and GNUM_HOSPITAL_CODE\=?
       								
UPDATE_IS_VALID.HPMRT_PROFILE_DRUG_SCH_DTL	=	UPDATE HPMRT_PROFILE_DRUG_SCH_DTL SET GNUM_ISVALID=? WHERE HPMRNUM_PROFILE_ID=? AND GNUM_HOSPITAL_CODE=? 

INSERT.HOPT_CONSULTATION_PROFILE_DTL	=	INSERT INTO HOPT_CONSULTATION_PROFILE_DTL (HPMRNUM_PROFILE_ID, GNUM_ISVALID, HRGNUM_REQ_ID, GNUM_SEAT_ID, GDT_ENTRY_DATE, GNUM_HOSPITAL_CODE) values(?,?,?,?,sysdate,?)
#Commented by Dheeraj on 28-Nov-2018
#SELECT.BY_REQID.HOPT_CONSULTATION_PROFILE_DTL	=SELECT hpmrnum_profile_id profileId,(select HPMRSTR_PROFILE_HEADER from HPMRT_PAT_PROFILE_DTL where hpmrnum_profile_id\=a.hpmrnum_profile_id and GNUM_ISVALID\=a.GNUM_ISVALID and GNUM_ISVALID\=a.GNUM_ISVALID) profileHeader FROM hopt_consultation_profile_dtl a where HRGNUM_REQ_ID\=? and GNUM_ISVALID\=? and  GNUM_HOSPITAL_CODE\=? order by profileHeader

#Added by Dheeraj on 28-Nov-2018
SELECT.BY_REQID.HOPT_CONSULTATION_PROFILE_DTL	=SELECT hpmrnum_profile_id profileId,(select HPMRSTR_PROFILE_HEADER from HPMRT_PAT_PROFILE_DTL where hpmrnum_profile_id\=a.hpmrnum_profile_id and GNUM_ISVALID\=a.GNUM_ISVALID and GNUM_ISVALID\=a.GNUM_ISVALID) profileHeader FROM hopt_consultation_profile_dtl a where HRGNUM_REQ_ID\= (select coalesce (hrgnum_par_req_id,to_number(?)) from hopt_consultation_dtl where hrgnum_req_id \=?) and GNUM_ISVALID\=? and  GNUM_HOSPITAL_CODE\=? order by profileHeader
DYNAMIC_VISIT_SUMMARY.HEADER.1=Complaints
DYNAMIC_VISIT_SUMMARY.QUERY.1=SELECT (SELECT INITCAP(A.HGSTR_TEMPLATE_NAME) FROM HGBT_TEMPLATE_MST A WHERE A.HGNUM_TEMPLATE_ID\=X.HGNUM_TEMPLATE_ID AND A.GNUM_HOSPITAL_CODE\=100 AND A.GNUM_ISVALID\=X.GNUM_ISVALID) AS "Template", (SELECT INITCAP(B.HGSTR_PARA_NAME) FROM HGBT_PARAMETER_MST B WHERE B.HGNUM_PARA_ID\=X.HGNUM_PARA_ID AND B.GNUM_HOSPITAL_CODE\=100 AND B.GNUM_ISVALID\=X.GNUM_ISVALID) AS "Parameter", X.HGSTR_PARA_VALUE AS "Value" FROM HRGT_EPISODE_CLINICAL_DTL X WHERE X.HRGNUM_PUK\=? AND X.HRGNUM_EPISODE_CODE\=? AND X.HRGNUM_VISIT_NO\=? AND X.GNUM_HOSPITAL_CODE\=? AND X.GNUM_ISVALID\=? AND X.GNUM_DESK_MENU_ID\=? ORDER BY  X.HGNUM_TEMPLATE_ID, X.HGNUM_PARA_ID
								
DYNAMIC_VISIT_SUMMARY.HEADER.2=History
DYNAMIC_VISIT_SUMMARY.QUERY.2=SELECT (SELECT INITCAP(A.HGSTR_TEMPLATE_NAME) FROM HGBT_TEMPLATE_MST A WHERE A.HGNUM_TEMPLATE_ID\=X.HGNUM_TEMPLATE_ID AND A.GNUM_HOSPITAL_CODE\=100 AND A.GNUM_ISVALID\=X.GNUM_ISVALID) AS "Template", (SELECT INITCAP(B.HGSTR_PARA_NAME) FROM HGBT_PARAMETER_MST B WHERE B.HGNUM_PARA_ID\=X.HGNUM_PARA_ID AND B.GNUM_HOSPITAL_CODE\=100 AND B.GNUM_ISVALID\=X.GNUM_ISVALID) AS "Parameter", X.HGSTR_PARA_VALUE AS "Value" FROM HRGT_EPISODE_CLINICAL_DTL X WHERE X.HRGNUM_PUK\=? AND X.HRGNUM_EPISODE_CODE\=? AND X.HRGNUM_VISIT_NO\=? AND X.GNUM_HOSPITAL_CODE\=? AND X.GNUM_ISVALID\=? AND X.GNUM_DESK_MENU_ID\=? ORDER BY  X.HGNUM_TEMPLATE_ID, X.HGNUM_PARA_ID

DYNAMIC_VISIT_SUMMARY.HEADER.3=Examination
DYNAMIC_VISIT_SUMMARY.QUERY.3=SELECT (SELECT INITCAP(A.HGSTR_TEMPLATE_NAME) FROM HGBT_TEMPLATE_MST A WHERE A.HGNUM_TEMPLATE_ID\=X.HGNUM_TEMPLATE_ID AND A.GNUM_HOSPITAL_CODE\=100 AND A.GNUM_ISVALID\=X.GNUM_ISVALID) AS "Template", (SELECT INITCAP(B.HGSTR_PARA_NAME) FROM HGBT_PARAMETER_MST B WHERE B.HGNUM_PARA_ID\=X.HGNUM_PARA_ID AND B.GNUM_HOSPITAL_CODE\=100 AND B.GNUM_ISVALID\=X.GNUM_ISVALID) AS "Parameter", X.HGSTR_PARA_VALUE AS "Value" FROM HRGT_EPISODE_CLINICAL_DTL X WHERE X.HRGNUM_PUK\=? AND X.HRGNUM_EPISODE_CODE\=? AND X.HRGNUM_VISIT_NO\=? AND X.GNUM_HOSPITAL_CODE\=? AND X.GNUM_ISVALID\=? AND X.GNUM_DESK_MENU_ID\=? ORDER BY  X.HGNUM_TEMPLATE_ID, X.HGNUM_PARA_ID

DYNAMIC_VISIT_SUMMARY.HEADER.6=Diagnosis
DYNAMIC_VISIT_SUMMARY.QUERY.6=SELECT X.HRGNUM_DIAGNOSTIC_CODE AS "Disease Code", (SELECT INITCAP (A.HGBSTR_DISEASE) FROM HGBT_ICD_DISEASE_MST A WHERE UPPER(TRIM(A.HGBSTR_DISEASE_CODE)) \= UPPER(TRIM(X.HRGNUM_DIAGNOSTIC_CODE)) AND A.GNUM_HOSPITAL_CODE \= 100 AND A.GNUM_ISVALID \= X.GNUM_ISVALID and HGNUM_RECORD_TYPE\=0) AS "Disease Name", DECODE (X.HRGNUM_DIAGNOSIS_CODE_TYPE,0,'ICD',1,'Hospital','') AS "Type",(SELECT INITCAP (B.HGBSTR_DIAGNOSTIC_TYPE_NAME) FROM HGBT_DIAGNOSIS_TYPE_MST B WHERE B.HGBNUM_DIAGNOSTIC_TYPE_CODE \= X.GNUM_DIAGNOSTIC_TYPE_CODE AND B.GNUM_HOSPITAL_CODE \= 100 AND B.GNUM_ISVALID \= X.GNUM_ISVALID) AS "Diagnosis Type", (SELECT INITCAP (C.HGSTR_DISEASE_SITE) FROM HGBT_DISEASE_SITE_MST C WHERE C.HGNUM_DISEASE_SITE_ID \= X.HGNUM_DISEASE_SITE_ID AND C.GNUM_HOSPITAL_CODE \= 100 AND C.GNUM_ISVALID \= X.GNUM_ISVALID) AS "Disease Site", X.HRGSTR_REMARKS AS "Remark" FROM HRGT_EPISODE_DIAGNOSIS_DTL X WHERE X.HRGNUM_PUK\=? AND X.HRGNUM_EPISODE_CODE\=? AND X.HRGNUM_VISIT_NO \= ? AND X.GNUM_HOSPITAL_CODE \= ? AND X.GNUM_ISVALID \= ? AND -1 <> ? AND HBNUM_ISREPEAT IN (0, 1) ORDER BY X.HRGNUM_DIAGNOSTIC_CODE

#SELECT.QUERY_BYMENUID.FROMPROFILE_TYPETABMAPPING = SELECT INITCAP(A.HPMRSTR_DEFAULT_NAME) AS dynamicSummaryHeader,(SELECT INITCAP(X.GSTR_DESK_MENU_NAME) FROM GBLT_DESK_MENU_MST X WHERE X.GNUM_DESK_MENU_ID=B.GNUM_DESK_MENU_ID AND X.GNUM_HOSPITAL_CODE=A.GNUM_HOSPITAL_CODE AND X.GNUM_ISVALID=?) AS header, B.GNUM_DESK_MENU_ID AS deskMenuId, B.HPMRSTR_QUERY AS query \
#													FROM HPMRT_PROFILE_TYPE_MST A, HPMRT_PROFILE_TYPE_TABMAPPING B WHERE A.HPMRNUM_PROFILE_TYPE=B.HPMRNUM_PROFILE_TYPE AND A.GNUM_HOSPITAL_CODE=B.GNUM_HOSPITAL_CODE AND A.GNUM_HOSPITAL_CODE=? AND A.GNUM_ISVALID=? AND B.GNUM_ISVALID=? AND A.HPMRNUM_PROFILE_TYPE=? AND B.GNUM_DESK_MENU_ID IN (#) ORDER BY B.HPMRNUM_ORDER_BY

#modifiedby:NehaRajgariya Date7sept2016
SELECT.QUERY_BYMENUID.FROMPROFILE_TYPETABMAPPING = SELECT INITCAP(A.HPMRSTR_DEFAULT_NAME) AS dynamicSummaryHeader,(SELECT INITCAP(X.GSTR_DESK_MENU_NAME) FROM GBLT_DESK_MENU_MST X WHERE X.GNUM_DESK_MENU_ID\=B.GNUM_DESK_MENU_ID AND X.GNUM_HOSPITAL_CODE\=A.GNUM_HOSPITAL_CODE AND X.GNUM_ISVALID\=?) AS header, B.GNUM_DESK_MENU_ID AS deskMenuId, B.HPMRSTR_QUERY AS query FROM HPMRT_PROFILE_TYPE_MST A, HPMRT_PROFILE_TYPE_TABMAPPING B WHERE A.HPMRNUM_PROFILE_TYPE\=B.HPMRNUM_PROFILE_TYPE AND A.GNUM_HOSPITAL_CODE\=? AND A.GNUM_ISVALID\=? AND B.GNUM_ISVALID\=? AND A.HPMRNUM_PROFILE_TYPE\=? AND B.GNUM_DESK_MENU_ID IN (\#) ORDER BY B.HPMRNUM_ORDER_BY


#Modified by Manisha Gangwar Date: 17.3.2016
SELECT.CHART_PARA_BY_TYPE.HGBT_CHART_PARA_MST	=SELECT X.HGNUM_CHART_ID AS chartId, X.HGNUM_PARA_TYPE AS paraType, X.HGNUM_PARA_ID AS paraId, DECODE(X.HGNUM_PARA_TYPE,?,(SELECT INITCAP(HGSTR_PARA_NAME) FROM HGBT_PARAMETER_MST WHERE HGNUM_PARA_ID\=X.HGNUM_PARA_ID AND GNUM_HOSPITAL_CODE\=X.GNUM_HOSPITAL_CODE AND GNUM_ISVALID\=?),?,(SELECT INITCAP(HGSTR_PARAMETER) FROM HIVT_PARAMETER_MST WHERE HGNUM_PARAMETER_ID\=X.HGNUM_PARA_ID AND GNUM_ISVALID\=?),?,(SELECT INITCAP(HIPSTR_INTAKEOUT_PARA_NAME) FROM HIPD_INTAKEOUT_PARA_MST WHERE HIPNUM_INTAKEOUT_PARA_ID\=SUBSTR(X.HGNUM_PARA_ID,2,3) AND GNUM_HOSPITAL_CODE\=X.GNUM_HOSPITAL_CODE AND GNUM_ISVALID\=?)||DECODE(SUBSTR(X.HGNUM_PARA_ID,1,1),?,'(I)','(O)'),'') AS paraName, X.HGNUM_DISPLAY_ORDER AS displayOrder, X.HGNUM_ISGRAPH_BASED AS isGraphBased FROM HGBT_CHART_PARA_MST X WHERE X.HGNUM_CHART_ID\=? AND X.GNUM_HOSPITAL_CODE\=? AND X.GNUM_ISVALID\=? ORDER BY X.HGNUM_DISPLAY_ORDER

													
SELECT.CHART_PARA_BY_TYPE.HGBT_CHART_PARA_MST.OLD	=SELECT X.HGNUM_CHART_ID AS chartId, X.HGNUM_PARA_TYPE AS paraType, X.HGNUM_PARA_ID AS paraId, DECODE(X.HGNUM_PARA_TYPE,?,(SELECT INITCAP(HGSTR_PARA_NAME) FROM HGBT_PARAMETER_MST WHERE HGNUM_PARA_ID\=X.HGNUM_PARA_ID AND GNUM_HOSPITAL_CODE\=X.GNUM_HOSPITAL_CODE AND GNUM_ISVALID\=?),?,(SELECT INITCAP(HGSTR_PARAMETER) FROM HIVT_PARAMETER_MST WHERE HGNUM_PARAMETER_ID\=SUBSTR(X.HGNUM_PARA_ID,5,8) AND GNUM_HOSPITAL_CODE\=? AND GNUM_ISVALID\=?),?,(SELECT INITCAP(HIPSTR_INTAKEOUT_PARA_NAME) FROM HIPD_INTAKEOUT_PARA_MST WHERE HIPNUM_INTAKEOUT_PARA_ID\=SUBSTR(X.HGNUM_PARA_ID,2,3) AND GNUM_HOSPITAL_CODE\=X.GNUM_HOSPITAL_CODE AND GNUM_ISVALID\=?)||DECODE(SUBSTR(X.HGNUM_PARA_ID,1,1),?,'(I)','(O)'),'') AS paraName, X.HGNUM_DISPLAY_ORDER AS displayOrder, X.HGNUM_ISGRAPH_BASED AS isGraphBased FROM HGBT_CHART_PARA_MST X WHERE X.HGNUM_CHART_ID\=? AND X.GNUM_HOSPITAL_CODE\=? AND X.GNUM_ISVALID\=? ORDER BY X.HGNUM_DISPLAY_ORDER
#changed by manisha gangwar date: 17.3.2016
SELECT.CHART_PARA_BY_TYPE.WITH_RANGE.HGBT_CHART_PARA_MST	=SELECT X.HGNUM_CHART_ID AS chartId, X.HGNUM_PARA_TYPE AS paraType, X.HGNUM_PARA_ID AS paraId, DECODE(X.HGNUM_PARA_TYPE,?,(SELECT INITCAP(HGSTR_PARA_NAME) FROM HGBT_PARAMETER_MST WHERE HGNUM_PARA_ID\=X.HGNUM_PARA_ID AND GNUM_HOSPITAL_CODE\=X.GNUM_HOSPITAL_CODE AND GNUM_ISVALID\=?) || ' ' || DECODE((SELECT COUNT(*) FROM HGBT_PARA_RANGE_MST WHERE HGNUM_PARA_ID\=X.HGNUM_PARA_ID AND GNUM_HOSPITAL_CODE\=X.GNUM_HOSPITAL_CODE AND GNUM_ISVALID\=1 AND GNUM_GENDER_CODE IN(0,?) AND (? BETWEEN HGNUM_LOW_AGE AND HGNUM_HIGH_AGE)), 0, DECODE((SELECT COUNT(*) FROM HGBT_PARA_RANGE_MST WHERE HGNUM_PARA_ID\=X.HGNUM_PARA_ID AND GNUM_HOSPITAL_CODE\=X.GNUM_HOSPITAL_CODE AND GNUM_ISVALID\=1 AND GNUM_GENDER_CODE\=3),0,'', (SELECT '('||HGSTR_LOW_VALUE||'-'||HGSTR_HIGH_VALUE||' '||HGSTR_VALUE_UOM||')' FROM HGBT_PARA_RANGE_MST WHERE HGNUM_PARA_ID\=X.HGNUM_PARA_ID AND GNUM_HOSPITAL_CODE\=X.GNUM_HOSPITAL_CODE AND GNUM_ISVALID\=1 AND GNUM_GENDER_CODE\=3 AND (? BETWEEN HGNUM_LOW_AGE AND HGNUM_HIGH_AGE))), (SELECT '('||HGSTR_LOW_VALUE||'-'||HGSTR_HIGH_VALUE||' '||HGSTR_VALUE_UOM||')' FROM HGBT_PARA_RANGE_MST WHERE HGNUM_PARA_ID\=X.HGNUM_PARA_ID AND GNUM_HOSPITAL_CODE\=X.GNUM_HOSPITAL_CODE AND GNUM_ISVALID\=1 AND GNUM_GENDER_CODE IN (0,?) AND (? BETWEEN HGNUM_LOW_AGE AND HGNUM_HIGH_AGE))),?,(SELECT INITCAP(HGSTR_PARAMETER) FROM HIVT_PARAMETER_MST WHERE HGNUM_PARAMETER_ID\=X.HGNUM_PARA_ID AND GNUM_ISVALID\=?),?,(SELECT INITCAP(HIPSTR_INTAKEOUT_PARA_NAME) FROM HIPD_INTAKEOUT_PARA_MST WHERE HIPNUM_INTAKEOUT_PARA_ID\=SUBSTR(X.HGNUM_PARA_ID,2,3) AND GNUM_HOSPITAL_CODE\=X.GNUM_HOSPITAL_CODE AND GNUM_ISVALID\=?)||DECODE(SUBSTR(X.HGNUM_PARA_ID,1,1),?,'(I)','(O)'),'') AS paraName, X.HGNUM_DISPLAY_ORDER AS displayOrder, X.HGNUM_ISGRAPH_BASED AS isGraphBased FROM HGBT_CHART_PARA_MST X WHERE X.HGNUM_CHART_ID\=? AND X.GNUM_HOSPITAL_CODE\=? AND X.GNUM_ISVALID\=? ORDER BY X.HGNUM_DISPLAY_ORDER
#CHANGED BY MANISHA GANGWAR DATE:18.3.2016
SELECT.DYNAMIC_CHART_DATA.TEMPLATE.OPD	=SELECT TO_CHAR(X.GDT_ENTRY_DATE,'dd-Mon-yyyy') AS entryDate, X.HGNUM_PARA_ID AS paraId, X.HGSTR_PARA_VALUE AS paraValue, DECODE((SELECT COUNT(*) FROM HGBT_PARA_RANGE_MST WHERE HGNUM_PARA_ID\=X.HGNUM_PARA_ID AND GNUM_HOSPITAL_CODE\=X.GNUM_HOSPITAL_CODE AND GNUM_ISVALID\=1 AND GNUM_GENDER_CODE IN(0,?)AND (? BETWEEN HGNUM_LOW_AGE AND HGNUM_HIGH_AGE)), 0, DECODE((SELECT COUNT(*) FROM HGBT_PARA_RANGE_MST WHERE HGNUM_PARA_ID\=X.HGNUM_PARA_ID AND GNUM_HOSPITAL_CODE\=X.GNUM_HOSPITAL_CODE AND GNUM_ISVALID\=1 AND GNUM_GENDER_CODE\=3), 0,1,(SELECT COUNT(*) FROM HGBT_PARA_RANGE_MST WHERE HGNUM_PARA_ID\=X.HGNUM_PARA_ID AND GNUM_HOSPITAL_CODE\=X.GNUM_HOSPITAL_CODE AND GNUM_ISVALID\=1 AND GNUM_GENDER_CODE\=3 AND (TO_NUMBER(X.HGSTR_PARA_VALUE) BETWEEN TO_NUMBER(HGSTR_LOW_VALUE) AND TO_NUMBER(HGSTR_HIGH_VALUE)))),(SELECT COUNT(*) FROM HGBT_PARA_RANGE_MST WHERE HGNUM_PARA_ID\=X.HGNUM_PARA_ID AND GNUM_HOSPITAL_CODE\=X.GNUM_HOSPITAL_CODE AND GNUM_ISVALID\=1 AND GNUM_GENDER_CODE IN (0,?) AND (? BETWEEN HGNUM_LOW_AGE AND HGNUM_HIGH_AGE) AND (TO_NUMBER(X.HGSTR_PARA_VALUE) BETWEEN TO_NUMBER(HGSTR_LOW_VALUE) AND TO_NUMBER(HGSTR_HIGH_VALUE)))) AS flag FROM HRGT_EPISODE_CLINICAL_DTL X WHERE X.HRGNUM_PUK\=? AND X.HRGNUM_EPISODE_CODE\=? AND X.GNUM_HOSPITAL_CODE\=? AND X.GNUM_ISVALID\=1 AND X.HGNUM_PARA_ID IN (@) \# ORDER BY X.GDT_ENTRY_DATE
SELECT.DYNAMIC_CHART_DATA.TEMPLATE.OPD.CRITERIA	=	AND TRUNC(GDT_ENTRY_DATE)>=TO_DATE(?,'dd-Mon-yyyy') AND TRUNC(GDT_ENTRY_DATE)<=TO_DATE(?,'dd-Mon-yyyy')
 #CHANGED BY MANISHA GANGWAR DATE:18.3.2016
SELECT.DYNAMIC_CHART_DATA.TEMPLATE.IPD	=SELECT TO_CHAR(X.HRGDT_RECORD_DATE,'dd-Mon-yyyy hh24\:mi') AS entryDate, X.HGNUM_PARA_ID AS paraId, X.HGSTR_PARA_VALUE AS paraValue, DECODE((SELECT COUNT(*) FROM HGBT_PARA_RANGE_MST WHERE HGNUM_PARA_ID\=X.HGNUM_PARA_ID AND GNUM_HOSPITAL_CODE\=X.GNUM_HOSPITAL_CODE AND GNUM_ISVALID\=1 AND GNUM_GENDER_CODE IN(0,?) AND (? BETWEEN HGNUM_LOW_AGE AND HGNUM_HIGH_AGE)), 0, DECODE((SELECT COUNT(*) FROM HGBT_PARA_RANGE_MST WHERE HGNUM_PARA_ID\=X.HGNUM_PARA_ID AND GNUM_HOSPITAL_CODE\=X.GNUM_HOSPITAL_CODE AND GNUM_ISVALID\=1 AND GNUM_GENDER_CODE\=3), 0,1,(SELECT COUNT(*) FROM HGBT_PARA_RANGE_MST WHERE HGNUM_PARA_ID\=X.HGNUM_PARA_ID AND GNUM_HOSPITAL_CODE\=X.GNUM_HOSPITAL_CODE AND GNUM_ISVALID\=1 AND GNUM_GENDER_CODE\=3 AND (TO_NUMBER(X.HGSTR_PARA_VALUE) BETWEEN TO_NUMBER(HGSTR_LOW_VALUE) AND TO_NUMBER(HGSTR_HIGH_VALUE)))),(SELECT COUNT(*) FROM HGBT_PARA_RANGE_MST WHERE HGNUM_PARA_ID\=X.HGNUM_PARA_ID AND GNUM_HOSPITAL_CODE\=X.GNUM_HOSPITAL_CODE AND GNUM_ISVALID\=1 AND GNUM_GENDER_CODE IN (0,?) AND (? BETWEEN HGNUM_LOW_AGE AND HGNUM_HIGH_AGE) AND (TO_NUMBER(X.HGSTR_PARA_VALUE) BETWEEN TO_NUMBER(HGSTR_LOW_VALUE) AND TO_NUMBER(HGSTR_HIGH_VALUE)))) AS flag FROM HIPD_PAT_CLINICAL_DTL X WHERE X.HRGNUM_ADMISSION_NO\=? AND X.GNUM_HOSPITAL_CODE\=? AND X.GNUM_ISVALID\=1 AND X.HGNUM_PARA_ID IN (@) \# ORDER BY X.HRGDT_RECORD_DATE
SELECT.DYNAMIC_CHART_DATA.TEMPLATE.IPD.CRITERIA	=	AND TRUNC(HRGDT_RECORD_DATE)>=TO_DATE(?,'dd-Mon-yyyy') AND TRUNC(HRGDT_RECORD_DATE)<=TO_DATE(?,'dd-Mon-yyyy')
 
SELECT.DYNAMIC_CHART_DATA.INV.OLD	=SELECT TO_CHAR(Y.HIVT_REQUISITION_DATE,'dd-Mon-yyyy hh24\:mi') AS entryDate, X.HIVTNUM_TEST_PARAMETER_CODE AS paraId, X.HIVTSTR_VALUE AS paraValue,1 AS flag FROM HIVT_PARAMETER_DTL X, HIVT_REQUISITION_HEADER Y WHERE SUBSTR(X.HIVTNUM_REQ_DNO,1,18)\=SUBSTR(Y.HIVNUM_REQ_NO,1,18) AND X.HRGNUM_PUK\=? AND X.HRGSTR_EPISODE_CODE\=? AND X.HIVTNUM_TEST_PARAMETER_CODE IN (@) \# ORDER BY Y.HIVT_REQUISITION_DATE
									
#CHANGED BY MANISHA GANGWAR DATE:17.3.2016
SELECT.DYNAMIC_CHART_DATA.INV	=SELECT TO_CHAR(Y.HIVDT_REQUISITION_DATE,'dd-Mon-yyyy hh24\:mi') AS entryDate, X.HIVNUM_PARAMETER_CODE AS paraId, X.HIVTSTR_VALUE AS paraValue,1 AS flag FROM HIVT_PARAMETER_DTL X, HIVT_REQUISITION_HEADER Y WHERE SUBSTR(X.HIVTNUM_REQ_DNO,1,22)\=SUBSTR(Y.HIVNUM_REQ_NO,1,22) AND Y.HRGNUM_PUK\=? AND Y.gnum_EPISODE_CODE\=? AND X.HIVNUM_PARAMETER_CODE IN (@) AND Y.gnum_hospital_code\=X.gnum_hospital_code \# ORDER BY Y.HIVDT_REQUISITION_DATE
SELECT.DYNAMIC_CHART_DATA.INV.CRITERIA	=	AND Y.HIVDT_REQUISITION_DATE>=TO_DATE(?,'dd-Mon-yyyy') AND Y.HIVDT_REQUISITION_DATE<=TO_DATE(?,'dd-Mon-yyyy')

									
SELECT.DYNAMIC_CHART_DATA.INOUT	=SELECT TO_CHAR(X.HIPDT_INTAKEOUT_TIME,'dd-Mon-yyyy hh24\:mi') AS entryDate, X.HIPNUM_INTAKEOUT_MODE||X.HIPNUM_INTAKEOUT_PARA_ID AS paraId, X.HIPSTR_VOLUME AS paraValue,1 AS flag FROM HIPD_PAT_INTAKEOUT_DTL X WHERE X.HRGNUM_PUK\=? AND X.HRGNUM_EPISODE_CODE\=? AND X.HIPNUM_INTAKEOUT_MODE||X.HIPNUM_INTAKEOUT_PARA_ID IN (@) \# ORDER BY X.HIPDT_ENTRY_DATE
SELECT.DYNAMIC_CHART_DATA.INOUT.CRITERIA	=	AND X.HIPDT_ENTRY_DATE>=TO_DATE(?,'dd-Mon-yyyy') AND X.HIPDT_ENTRY_DATE<=TO_DATE(?,'dd-Mon-yyyy')

SELECT.CHARTS_DETAIL_BY_CATEGORY.HGBT_CHART_UNIT_MAPPING	=SELECT A.HGNUM_CHART_ID AS chartId, A.GNUM_HOSPITAL_CODE AS hospitalCode, A.HGNUM_SLNO AS slNo, A.HGSTR_CHART_NAME AS chartName, A.HGSTR_CHART_DESC AS chartDescription, A.GNUM_ISVALID AS isValid, A.HGNUM_CHART_CATEGORY AS chartCategory, A.HGNUM_GENERATION_TYPE AS generationType, A.GNUM_SEAT_ID AS seatID, A.GDT_ENTRY_DATE AS entryDate, A.HGSTR_BODY_QUERY AS bodyQuery, B.HGNUM_ISDEFAULT AS isDefault, A.GDT_LSTMOD_DATE AS lastModifyDate, A.HGSTR_FOOTER_QUERY AS footerQuery, A.GNUM_LSTMOD_SEATID AS lastModifiedSeatID, A.HGNUM_ISGRAPH AS isGraph FROM HGBT_CHART_MST A, HGBT_CHART_UNIT_MAPPING B WHERE A.HGNUM_CHART_ID\=B.HGNUM_CHART_ID AND A.GNUM_HOSPITAL_CODE\=100 AND B.HGNUM_DEPTUNITCODE\=? AND B.GNUM_HOSPITAL_CODE\=? AND B.GNUM_ISVALID\=? AND A.GNUM_ISVALID\=? AND A.HGNUM_CHART_CATEGORY IN (\#) 
 
 
SELECT.HGNUM_TEMPLATE_ID.HGBT_CONSENT_MAPPING=SELECT HGNUM_TEMPLATE_ID  FROM HGBT_CONSENT_MAPPING WHERE HGNUM_SERVICE_TYPE_ID\=?  AND HGSTR_SERVICE_ID\=? AND GNUM_HOSPITAL_CODE\=? AND GNUM_ISVALID\=1
INSERT_EXT_INV.HRGT_EPISODE_COMPLAINT_DTL = INSERT INTO HRGT_EPISODE_COMPLAINT_DTL(HRGNUM_PUK, HRGNUM_EPISODE_CODE, HRGNUM_SLNO, HRGDT_ENTRY_DATE, HRGDT_RECORD_DATE, HRGNUM_VISIT_NO, HRGNUM_ADMISSION_NO, HGSTR_PARA_VALUE, HGNUM_PARA_ID, GNUM_ISVALID, HGSTR_TEST_NAME, GNUM_SEAT_ID, GDT_ENTRY_DATE, HRGSTR_EXTLAB_NAME, GNUM_HOSPITAL_CODE, HRGSTR_EXTLAB_ADD, HRGSTR_EXTLAB_CONTACTNO, HRGSTR_MIN_VALUE, HRGSTR_MAX_VALUE, HRGSTR_REMARKS, HRGNUM_ENTRY_MODE,HRGNUM_FROM_LAB)VALUES(?,?,(SELECT NVL(MAX(HRGNUM_SLNO),0)+1 FROM HRGT_EPISODE_COMPLAINT_DTL WHERE HRGNUM_PUK \= ? AND TRUNC(HRGDT_ENTRY_DATE)\=TRUNC(SYSDATE)),SYSDATE,TO_DATE(?,'dd-Mon-yyyy hh24\:mi'),?,?,?,?,?,?,?,SYSDATE,?,?,?,?,?,?,?,?,?)
											
											
SELECT_ADDED_EXT_INV.HRGT_EPISODE_COMPLAINT_DTL = SELECT TO_CHAR(A.HRGDT_RECORD_DATE,'dd-Mon-yyyy hh24\:mi') as recordDate, NVL(A.HGSTR_PARA_VALUE,'-') as paraValue, A.HGNUM_PARA_ID as paraId, (SELECT HGSTR_PARA_NAME FROM HGBT_PARAMETER_MST WHERE HGNUM_PARA_ID\=A.HGNUM_PARA_ID AND GNUM_HOSPITAL_CODE\=?) as paraName, HRGNUM_PUK AS patCrNo, HRGNUM_EPISODE_CODE AS episodeCode, HRGNUM_VISIT_NO AS episodeVisitNo, HRGNUM_ADMISSION_NO AS patAdmNo, HGSTR_TEST_NAME AS testName, HRGSTR_EXTLAB_NAME AS extLabName, HRGSTR_EXTLAB_ADD AS extLabAdd, HRGSTR_EXTLAB_CONTACTNO AS extLabContactNo, HRGSTR_MIN_VALUE AS minValue, HRGSTR_MAX_VALUE AS maxValue, HRGSTR_REMARKS AS remarks, HRGNUM_ENTRY_MODE AS entryMode, HRGNUM_FROM_LAB AS testConductedFrom FROM HRGT_EPISODE_COMPLAINT_DTL A WHERE A.HRGNUM_PUK \= ? AND A.GNUM_ISVALID \= ? AND A.GNUM_HOSPITAL_CODE \= ? ORDER BY A.HRGDT_RECORD_DATE DESC
												
SELECT.HRGT_EPISODE_DIAGNOSIS_DTL =SELECT a.hrgnum_puk AS patCrNo, a.hrgnum_episode_code AS episodeCode,a.hrgnum_visit_no AS episodeVisitNo,a.hrgnum_admission_no AS patAdmNo, TO_CHAR (GDT_ENTRY_DATE, 'dd-Mon-yyyy') AS entrydate,a.hrgnum_diagnostic_code AS diagnosticCode, DECODE(a.hrgnum_diagnosis_code_type,0, (SELECT b.hgbstr_disease FROM hgbt_icd_disease_mst b WHERE TRIM(UPPER(a.hrgnum_diagnostic_code))\=TRIM(UPPER(b.hgbstr_disease_code)) AND b.gnum_isvalid \= 1 and b.HGNUM_RECORD_TYPE\=0),1, (SELECT c.hgbstr_disease_desc FROM hgbt_hospital_disease_mst c WHERE TRIM(UPPER(a.hrgnum_diagnostic_code))\=TRIM(UPPER(c.hgbstr_hospital_disease_code)) AND c.gnum_isvalid \= 1 AND c.gnum_hospital_code \= a.gnum_hospital_code) ) AS dignosisName, a.GNUM_DIAGNOSTIC_TYPE_CODE AS diagnosticTypeCode, (SELECT d.hgbstr_diagnostic_type_name FROM hgbt_diagnosis_type_mst d WHERE a.gnum_diagnostic_type_code \= d.hgbnum_diagnostic_type_code AND d.gnum_isvalid \= 1 AND d.gnum_hospital_code \= a.gnum_hospital_code) AS diagnosticTypeName, hrgstr_remarks AS remarks, TO_CHAR (hrgt_episode_date, 'dd-Mon-yyyy') AS episodedate, DECODE (hbnum_isrepeat, 0, 1, 1, 1, 2, 2) AS isrepeat FROM hrgt_episode_diagnosis_dtl a WHERE hrgnum_puk \= ? AND a.gnum_isvalid \= ? AND a.gnum_hospital_code \= ? AND a.hrgnum_episode_code\=? AND a.hrgnum_visit_no\=? AND A.HBNUM_ISREPEAT NOT IN (2,3) ORDER BY 1,2,3,4
                                            
DIAGNOSIS_DETAIL.HRGT_EPISODE_DIAGNOSIS_DTL= select A.hrgnum_diagnostic_code as diagnosticCode,B.hgstr_disease_site as dignosisName  FROM hrgt_episode_diagnosis_dtl A, hgbt_disease_site_mst B   WHERE A.hgnum_disease_site_id\=B.hgnum_disease_site_id AND A.GNUM_ISVALID\=1 AND A.GNUM_HOSPITAL_CODE\=? AND A.HRGNUM_PUK\=?  AND A.hrgnum_episode_code\=? AND hrgnum_visit_no\=?                                           

#AddedBy: NehaRajgariya Date:28July2016
SELECT_DIAGNOSIS_CODE.HGBT_UNIT_MST = select gnum_diagnosis_code_type from hgbt_unit_mst where hgnum_deptunitcode \= ?\tand gnum_isvalid\=1 and gnum_hospital_code\=?

#AddedBy: NehaRajgariya Date:25Jan2017 Purpose:OnePagePrescription
SELECT_PAT_DETAIL_ONE_PAGE_PRESCRIPTION = select p.hgnum_deptunitcode AS departmentunitcode,p.gnum_dept_code AS departmentcode,(SELECT p.gstr_dept_name || ' (' || p.hgstr_unitname || ')' AS departmentunitname ) as departmentUnitName, to_char(B.gdt_entry_date,'dd-Mon-yyyy') as visitdate, B.hrgstr_visit_reason as visitReason FROM HRGT_PATIENT_DTL A, hrgt_daily_patient_dtl P, hrgt_episode_dtl B WHERE A.HRGNUM_PUK=P.HRGNUM_PUK AND A.hrgnum_puk = B.hrgnum_puk AND B.gnum_isvalid = 1 AND P.GNUM_ISVALID= 1 AND A.HRGNUM_PUK = ? AND A.GNUM_ISVALID = 1 AND P.GNUM_HOSPITAL_CODE = ?

#Added BY: Shruti Shail Date:31-Jan-2017 Purpose: EMR Enhancement
CHK_EPISODE_TREATMENT.HRGT_EPISODE_DRUG_DTL = SELECT count(hstnum_item_id) FROM hrgt_episode_drug_dtl b WHERE hrgnum_puk \= ? AND gdt_entry_date \= (SELECT MAX (gdt_entry_date) FROM hrgt_episode_drug_dtl WHERE hrgnum_puk \= b.hrgnum_puk AND hrgnum_episode_code \= b.hrgnum_episode_code AND gnum_hospital_code \= b.gnum_hospital_code  AND gnum_isvalid \= b.gnum_isvalid)  AND gnum_isvalid \= ? 

CHK_EPISODE_DIAGNOSIS.HRGT_EPISDOE_DIAGNOSIS_DTL = SELECT COUNT(a.hrgnum_episode_code) FROM hrgt_episode_diagnosis_dtl a WHERE hrgnum_puk = ? AND a.gnum_isvalid = ?

CHK_EPISODE_ALLERGY.HRGT_EPISDOE_ALLERGY_DTL = SELECT count(HGSTR_ALLERGY_NAME) FROM HRGT_EPISODE_ALLERGY_DTL A WHERE HRGNUM_PUK= ? AND GNUM_ISVALID= ?

CHK_EPISODE_INVESTIGATION.HRGT_EPISODE_INVESTIGATION_DTL = Select count(gnum_test_code) from hivt_requisition_dtl a, hivt_requisition_header b where a.hivnum_req_no\=b.hivnum_req_no and b.gnum_isvalid\=? and a.gnum_hospital_code\=b.gnum_hospital_code and b.hrgnum_puk\=?

CHK_PROGRESS_NOTES.HIPD_DOCTOR_ROUND_DTL = SELECT COUNT(A.HIPDT_ROUND_TIME) FROM HIPD_DOCTOR_ROUND_DTL A WHERE a.HRGNUM_PUK\=? AND A.HIPNUM_VERIFY_FLAG\=1 AND A.GNUM_ISVALID \= ? AND a.hipstr_progress_notes is not null

CHK_VITAL_DETAILS.HIPD_PAT_CLINICAL_DTL = SELECT count(HRGDT_RECORD_DATE) FROM HIPD_PAT_CLINICAL_DTL A WHERE HRGNUM_PUK\=? AND A.GNUM_ISVALID\=?  AND HGNUM_TEMPLATE_ID IN (SELECT HGNUM_TEMPLATE_ID FROM HGBT_TEMPLATE_MST WHERE GNUM_HOSPITAL_CODE\=100 AND GNUM_ISVALID\=a.gnum_isvalid AND HGNUM_TEMPLATE_CATEGORY\=18)

CHK_EXTERNAL_INVESTIGATION.HRGT_EPISODE_EXTEXAM_DTL = SELECT count(a.hrgdt_record_date) FROM hrgt_episode_extexam_dtl a WHERE a.hrgnum_puk = ? AND a.gnum_isvalid = ?

CHK_PATIENT_COMPLAINTS_OPD.HRGT_EPISODE_CLINICAL_DTL = SELECT count(b.HGNUM_TEMPLATE_ID) FROM hrgt_episode_clinical_dtl a,hgbt_template_para_mst b WHERE hrgnum_puk \= ? AND a.gnum_isvalid \= ? AND a.hgnum_template_id \=b.hgnum_template_id AND a.hgnum_para_id\=b.hgnum_para_id and b.gnum_hospital_code \= 100 and  b.gnum_isvalid \= a.gnum_isvalid AND a.hgnum_template_id IN (SELECT hgnum_template_id FROM hgbt_template_mst WHERE gnum_hospital_code \= 100 AND gnum_isvalid \= a.gnum_isvalid AND hgnum_template_category \= 11) AND b.hgnum_col\=(select MIN(hgnum_col) from hgbt_template_para_mst where  hgnum_template_id \=b.hgnum_template_id AND hgnum_para_id\=b.hgnum_para_id and gnum_hospital_code \= 100 and gnum_isvalid \= a.gnum_isvalid) 

CHK_PATIENT_COMPLAINTS_IPD.HRGT_EPISODE_CLINICAL_DTL = SELECT  count(b.HGNUM_TEMPLATE_ID) FROM HIPD_PAT_CLINICAL_DTL B,hgbt_template_para_mst C WHERE hrgnum_puk \= ? AND b.gnum_isvalid \= ? AND b.hgnum_template_id \=c.hgnum_template_id AND b.hgnum_para_id\=c.hgnum_para_id and c.gnum_hospital_code \= 100 and  c.gnum_isvalid \= b.gnum_isvalid AND b.hgnum_template_id IN (SELECT hgnum_template_id FROM hgbt_template_mst WHERE gnum_hospital_code \= 100 AND gnum_isvalid \= B.gnum_isvalid AND hgnum_template_category \= 11) AND c.hgnum_col\=(select MIN(hgnum_col) from hgbt_template_para_mst where  hgnum_template_id \=b.hgnum_template_id AND hgnum_para_id\=b.hgnum_para_id and gnum_hospital_code \= 100 and gnum_isvalid \= b.gnum_isvalid) 

CHK_PATIENT_OPERATIONS.HOTT_OP_REQUEST_DTL = SELECT count(ot.hotnum_ot_req_no) FROM hott_op_request_dtl ot WHERE ot.hotnum_patient_acceptance IN (1, 2) AND ot.gnum_hospital_code \= ? AND (ot.hotstr_ot_req_status > 12 OR ot.hotstr_ot_req_status \= 9 AND ot.hotstr_ot_req_status <> 16) AND ot.hrgnum_puk \= ? AND EXISTS (SELECT 1 FROM HOTT_OP_RAISED_DTL WHERE GNUM_ISVALID\=1 AND HOTNUM_OT_REQ_NO \=ot.hotnum_ot_req_no AND GNUM_HOSPITAL_CODE\=ot.gnum_hospital_code AND HOTNUM_ISACTUAL_OPERATION\=1)

CHK_CHRONIC_DISEASE.HPMRT_PAT_ALERTS_DTL = SELECT count(a.hgnum_pat_alert_id) FROM hpmrt_pat_alerts_dtl a, hrgt_episode_alert_dtl b WHERE a.hrgnum_puk \= ? AND a.gnum_isvalid \= ?  AND a.hrgnum_puk \= b.hrgnum_puk AND a.hgnum_pat_alert_id \= b.hgnum_pat_alert_id AND b.hrgnum_isrevoked \= 0 

CHK_PATIENT_PROFILES.HPMRT_PAT_PROFILE_DTL = SELECT count(a.hpmrnum_profile_id ) FROM hpmrt_pat_profile_dtl a WHERE a.hrgnum_puk \= ? AND a.gnum_isvalid \= ? AND  a.HPMRNUM_PROFILE_STATUS\=2 

CHK_PATIENT_HISOTRY_OPD.HRGT_EPISODE_CLINICAL_DTL = SELECT count( b.HGNUM_TEMPLATE_ID) FROM hrgt_episode_clinical_dtl a,hgbt_template_para_mst b WHERE hrgnum_puk \= ? AND a.gnum_isvalid \= ? AND a.hgnum_template_id \=b.hgnum_template_id AND a.hgnum_para_id\=b.hgnum_para_id and b.gnum_hospital_code \= 100 and  b.gnum_isvalid \= a.gnum_isvalid AND a.hgnum_template_id IN (SELECT hgnum_template_id FROM hgbt_template_mst WHERE gnum_hospital_code \= 100 AND gnum_isvalid \= a.gnum_isvalid AND hgnum_template_category \= 12) AND b.hgnum_col\=(select MIN(hgnum_col) from hgbt_template_para_mst where  hgnum_template_id \=b.hgnum_template_id AND hgnum_para_id\=b.hgnum_para_id and gnum_hospital_code \= 100 and gnum_isvalid \= a.gnum_isvalid)

CHK_PATIENT_HISOTRY_IPD.HRGT_EPISODE_CLINICAL_DTL = SELECT  count( b.HGNUM_TEMPLATE_ID) FROM HIPD_PAT_CLINICAL_DTL B,hgbt_template_para_mst C WHERE hrgnum_puk \= ? AND b.gnum_isvalid \= ? AND b.hgnum_template_id \=c.hgnum_template_id AND b.hgnum_para_id\=c.hgnum_para_id and c.gnum_hospital_code \= 100 and  c.gnum_isvalid \= b.gnum_isvalid AND b.hgnum_template_id IN (SELECT hgnum_template_id FROM hgbt_template_mst WHERE gnum_hospital_code \= 100 AND gnum_isvalid \= B.gnum_isvalid AND hgnum_template_category \= 12) AND c.hgnum_col\=(select MIN(hgnum_col) from hgbt_template_para_mst where  hgnum_template_id \=b.hgnum_template_id AND hgnum_para_id\=b.hgnum_para_id and gnum_hospital_code \= 100 and gnum_isvalid \= b.gnum_isvalid) 

CHK_PATIENT_EXAMINATION_OPD.HRGT_EPISODE_CLINICAL_DTL = SELECT  count(b.HGNUM_TEMPLATE_ID) FROM hrgt_episode_clinical_dtl a,hgbt_template_para_mst b WHERE hrgnum_puk \= ? AND a.gnum_isvalid \= ?  AND a.hgnum_template_id \=b.hgnum_template_id AND a.hgnum_para_id\=b.hgnum_para_id and b.gnum_hospital_code \= 100 and  b.gnum_isvalid \= a.gnum_isvalid AND a.hgnum_template_id IN (SELECT hgnum_template_id FROM hgbt_template_mst WHERE gnum_hospital_code \= 100 AND gnum_isvalid \= a.gnum_isvalid AND hgnum_template_category \= 13)  AND b.hgnum_col\=(select MIN(hgnum_col) from hgbt_template_para_mst where  hgnum_template_id \=b.hgnum_template_id AND hgnum_para_id\=b.hgnum_para_id and gnum_hospital_code \= 100 and gnum_isvalid \= a.gnum_isvalid) 

CHK_INTAKE_DTL.HIPD_PAT_INTAKEOUT_DTL = SELECT COUNT(A.HIPNUM_INTAKEOUT_PARA_ID) FROM HIPD_PAT_INTAKEOUT_DTL A WHERE A.HRGNUM_PUK \= ? AND A.HIPNUM_INTAKEOUT_MODE \= 3 AND A.GNUM_ISVALID \= ?

CHK_OUTTAKE_DTL.HIPD_PAT_INTAKEOUT_DTL = SELECT COUNT(A.HIPNUM_INTAKEOUT_PARA_ID ) FROM HIPD_PAT_INTAKEOUT_DTL A WHERE A.HRGNUM_PUK \= ? AND A.HIPNUM_INTAKEOUT_MODE \= 1 AND A.GNUM_ISVALID \= ?

CHK_PATIENT_ANC.HANCT_ANC_DTL = SELECT count(HANCSTR_ANC_NO) FROM HANCT_ANC_DTL X WHERE HRGNUM_PUK\=? AND GNUM_ISVALID\=? AND GNUM_HOSPITAL_CODE\=? AND HANCNUM_DELIVERY_STATUS IS NULL AND HANCNUM_GRAVIDA_NO IN (SELECT MAX(HANCNUM_GRAVIDA_NO) FROM HANCT_ANC_DTL WHERE HRGNUM_PUK\=? AND GNUM_ISVALID\=1 AND GNUM_HOSPITAL_CODE\=?)

CHK_VISIT_NOTES.HRGT_EPISODE_VISIT_DTL =							

#Query added by Shruti Shail on 11-May-2017 for OPD Manual Profile
SELECT.HRGT_EPISODE_CLINICAL_DTL = SELECT DISTINCT TO_CHAR(GDT_ENTRY_DATE,'DD-Mon-YYYY HH24\:MI') AS RECORDDATE, HGNUM_PARA_ID AS PARAID,GNUM_DESK_MENU_ID AS DESKMENUID,HGNUM_TEMPLATE_ID AS TEMPLATEID, HGSTR_PARA_VALUE AS PARAVALUE FROM HRGT_EPISODE_CLINICAL_DTL WHERE HRGNUM_PUK\=? AND HRGNUM_EPISODE_CODE\=? AND GNUM_HOSPITAL_CODE\=?  AND  GNUM_ISVALID\=? ORDER BY HGNUM_TEMPLATE_ID,HGNUM_PARA_ID\t
									
									

# Added by VASU on 7-Nov-2017 For Patient Investigation View in Patient Profile
SELECT_INVESTIGATION_IPD_TEST.HIVT_RESULTVALIDATION_DTL = SELECT TO_CHAR (x.hivtnum_req_dno) AS reqdno,x.hivtnum_test_code AS testcode, (SELECT a.gstr_test_name FROM hivt_test_mst a WHERE a.gnum_test_code \= x.hivtnum_test_code AND gnum_isvalid \= 1) AS testname,x.hivnum_parameter_code as paracode,(SELECT a.hgstr_parameter FROM hivt_parameter_mst a WHERE a.hgnum_parameter_id \= x.hivnum_parameter_code  AND a.gnum_isvalid \= 1) AS parametername,x.hivtstr_value AS testValue,TO_CHAR (x.hivt_entry_date, 'dd-Mon-yyyy') AS visitdate,hivstr_referencerange,hivstr_ref_range as refrange,hivtnum_order,hivstr_uom FROM hivt_parameter_dtl x $$$


DELETE.HPMRT_PAT_PROFILE_DTL	=UPDATE HPMRT_PAT_PROFILE_DTL SET GNUM_ISVALID\=? WHERE HPMRNUM_PROFILE_ID\=? AND HPMRNUM_SLNO\=? AND GNUM_HOSPITAL_CODE\=?             \t\t\t\t\t\t\t\t\t

#Added by Vasu on 05.Nov.2018
INSERT.CREATE.HPMRT_PAT_PROFILE_DTL_FOR_SINGLE_PAGE_DISCHARGE	=INSERT INTO HPMRT_PAT_PROFILE_DTL (HPMRNUM_PROFILE_ID, HPMRNUM_SLNO, HRGNUM_PUK, HRGNUM_EPISODE_CODE, HRGNUM_VISIT_NO, HGNUM_DEPTUNITCODE, HRGNUM_ADMISSION_NO, HPMRSTR_PROFILE_HEADER, HPMRNUM_PROFILE_TYPE, HPMRNUM_ACCESS_TYPE, HPMRNUM_USER_LEVEL, HPMRSTR_PROFILE_REMARK, GNUM_ISVALID, GNUM_SEAT_ID, GDT_ENTRY_DATE, GDT_EFFECTIVE_FRM, GNUM_HOSPITAL_CODE,HPMRNUM_PROFILE_STATUS,hrgstr_profile_html_data,hpmrnum_isSinglePage) VALUES (?, (SELECT NVL(MAX(HPMRNUM_SLNO),0)+1 FROM HPMRT_PAT_PROFILE_DTL WHERE HPMRNUM_PROFILE_ID\=?), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, SYSDATE, SYSDATE,?,?,?,?)

#Added by Vasu on 13.Nov.2018
SELECT.HPMRT_PAT_PROFILE_DTL_FOR_SINGLE_PAGE_DISCHARGE = SELECT HPMRNUM_PROFILE_ID as profileId FROM HPMRT_PAT_PROFILE_DTL WHERE HRGNUM_PUK\=? AND HRGNUM_EPISODE_CODE\=? AND HRGNUM_VISIT_NO\=? AND GNUM_HOSPITAL_CODE\=? AND HPMRNUM_SLNO \=(SELECT MAX(HPMRNUM_SLNO) FROM hpmrt_pat_profile_dtl WHERE HRGNUM_PUK\=? AND HRGNUM_EPISODE_CODE\=? AND HRGNUM_VISIT_NO\=?)\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t

#Added by Vasu on 17.Jan.2019
UPDATE.HPMRT_PAT_PROFILE_DTL_FOR_SINGLE_PAGE_DISCHARGE = UPDATE hpmrt_pat_profile_dtl SET GNUM_ISVALID \= ? WHERE HPMRNUM_PROFILE_ID \= ? AND HRGNUM_PUK \= ? AND HPMRNUM_PROFILE_TYPE \= ? AND HPMRNUM_SLNO NOT IN(SELECT MAX(HPMRNUM_SLNO) FROM hpmrt_pat_profile_dtl WHERE HPMRNUM_PROFILE_ID \= ? AND HRGNUM_PUK \= ? AND HPMRNUM_PROFILE_TYPE \= ?)\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t

#By Vasu on 26.03.2019
INSERT.HINT_PHRMS_UPLOAD_ALGY_DTL_LOG  = INSERT INTO HINT_PHRMS_UPLOAD_ALGY_DTL_LOG( HRGNUM_PUK, GNUM_EPISODE_CODE, SCTNUM_ID_ALLERGRY, HIPNUM_ADMNO, GNUM_ISVALID, SCTNUM_ID_SENSITIVITY, GDT_ENTRY_DATE, SCTSTR_IDS_SYMPTOMS, GNUM_HOSPITAL_CODE, GSTR_IP_ADDRESS, SCTSTR_IDS_SITES, HGSTR_SYMTOM_DESC, HGSTR_ALLERGY_SITE, SCTSTR_IDS_ADVICE, HGSTR_ADVICE, HRGDT_DURATION_DATE, HGSTR_ALLERGY_NAME, HRGSTR_MOBILE_NO) \
										 VALUES(?, ?, ?, ?, ?, ?, SYSDATE, ?, ?, ?, ?, ?, ?, ?, ?, TRUNC(TRUNC(SYSDATE) - ?*365), ?, (SELECT hrgstr_mobile_no FROM HRGT_PATIENT_DTL WHERE HRGNUM_PUK \= ?))\t

#Added by Vasu on 27.March.2019
INSERT.hint_phrms_upload_drug_dtl_log	=INSERT INTO hint_phrms_upload_drug_dtl_log (HRGNUM_PUK, HRGNUM_EPISODE_CODE, HRGNUM_VISIT_NO, HRGNUM_S_NO, HRGNUM_ADMISSION_NO, HSTNUM_ITEM_ID, HSTSTR_ITEMBRAND_NAME, hstnum_itembrand_id, HGNUM_DOSE_ID, HGSTR_DOSE_NAME, HGNUM_FREQUENCY_ID, HGNUM_DAYS, HRGDT_START_DATE, HRGDT_END_DATE, HRGSTR_REMARKS, PSRSTR_EMP_NO, HBNUM_RX_CONTINUE, GNUM_SEAT_ID, GDT_ENTRY_DATE, GNUM_ISVALID, GNUM_HOSPITAL_CODE ,HGNUM_ISEMPTY_STOMACH,HGNUM_DRUG_ROUTE_ID,HGNUM_DOSE_QTY, HSTNUM_ISSUE_QTY, HSTNUM_REQUIRED_QTY,HRGNUM_ENTRY_MODE,HSTSTR_ITEM_NAME,hstnum_itemtype_id,hrgstr_mobile_no) VALUES (?,?,?,(SELECT NVL(MAX(HRGNUM_S_NO),0)+1 FROM HRGT_EPISODE_DRUG_DTL WHERE HRGNUM_PUK\=? AND HRGNUM_EPISODE_CODE\=? AND HRGNUM_VISIT_NO\=?),?,?,?,?,?,?,?,?,to_date(? ,'dd-mm-yyyy hh24\:mi')+?, TRUNC(SYSDATE)+?+?-1,?,?,?,?,to_date(?,'dd-MM-yyyy hh24\:mi'),?,?,?,?,?,?,?,? , (SELECT pkg_opd_func.get_drugitem_name('','',?,'','')),?,(SELECT hrgstr_mobile_no FROM HRGT_PATIENT_DTL WHERE HRGNUM_PUK \= ?)) 

#Added By Shweta on 15-May-2019
SELECT_OTHER_TREATMENT_DETAIL = SELECT hgstr_ext_treatment_name AS extTreatment,hgnum_dose_id AS doseid, '-' AS dosename,hgnum_frequency_id AS frequencyid, (SELECT UPPER (hgstr_frequency_name) FROM hgbt_drug_frequency_mst a WHERE a.hgnum_frequency_id \= b.hgnum_frequency_id AND a.gnum_hospital_code \= 100 AND a.gnum_isvalid \= b.gnum_isvalid AND gnum_isvalid \= 1) AS frequencyname,TO_CHAR (hrgdt_start_date, 'dd-Mon-yyyy') AS startdate,TO_CHAR (hrgdt_end_date, 'dd-Mon-yyyy') AS enddate, hrgnum_admission_no AS admissionno, hrgnum_visit_no AS episodevisitno, hgnum_days AS days, hrgstr_remarks AS remarks, psrstr_emp_no AS empno,hbnum_rx_continue AS rxcontinue, '0' AS isemptystomach,'0' AS drugrouteid,hrgnum_episode_code as episodeCode,HRGNUM_VISIT_NO as episodeVisitNo,  (SELECT HGNUM_DEPTUNITCODE FROM HRGT_EPISODE_DTL WHERE HRGNUM_PUK\=B.HRGNUM_PUK AND HRGNUM_EPISODE_CODE\=B.HRGNUM_EPISODE_CODE AND HRGNUM_VISIT_NO\=B.HRGNUM_VISIT_NO  AND GNUM_ISVALID\=B.GNUM_ISVALID AND GNUM_HOSPITAL_CODE\=B.GNUM_HOSPITAL_CODE) AS departmentUnitCode, b.gnum_hospital_code as hospitalCode FROM  hrgt_episode_exttreatment_dtl b WHERE hrgnum_puk \= ? AND hbnum_rx_continue\=1 AND gdt_entry_date \= (SELECT MAX (gdt_entry_date) FROM hrgt_episode_exttreatment_dtl WHERE hrgnum_puk \= b.hrgnum_puk AND hrgnum_episode_code \= b.hrgnum_episode_code  AND gnum_hospital_code \= b.gnum_hospital_code  AND gnum_isvalid \= b.gnum_isvalid)  AND gnum_isvalid \= ?     
								
#Added By Shweta on 28-06-2019															
SELECT.PAT_EPI_CLI_DATA_TEMP_WISE.HRGT_PAT_VITALS_DTL=SELECT HGNUM_TEMPLATE_ID AS templateId,HGNUM_VITAL_ID AS paraId, nvl(HSTR_VITAL_VALUE,'-') AS paraValue, NVL((SELECT A.HGSTR_PARENT_PARA FROM HGBT_PARAMETER_MST A WHERE A.HGNUM_PARA_ID\=X.HGNUM_VITAL_ID AND A.GNUM_HOSPITAL_CODE\=?),'') AS paraParentId,(select hgstr_para_name from hgbt_parameter_mst where hgnum_para_id\=HGNUM_VITAL_ID) as paraName FROM HRGT_PAT_VITALS_DTL X WHERE HRGNUM_PUK\=? AND HRGNUM_EPISODE_CODE\=? AND HRGNUM_VISIT_NO\=? AND HGNUM_TEMPLATE_ID IN (\#) AND GNUM_HOSPITAL_CODE\=? AND GNUM_ISVALID\=?

#Added By Shweta on 11-07-2019
SELECT.PATIENT_FINAL_CLINICAL_DATA.HGBT.HRGT=SELECT HGNUM_TEMPLATE_ID AS TEMPLATEID, HGNUM_VITAL_ID AS PARAID, HSTR_VITAL_VALUE AS PARAVALUE FROM hrgt_pat_vitals_dtl A WHERE HRGNUM_PUK\=? AND HRGNUM_EPISODE_CODE\=? AND HRGNUM_VISIT_NO\=? AND  GNUM_HOSPITAL_CODE\=? AND GNUM_ISVALID\=? UNION SELECT B.HGNUM_TEMPLATE_ID AS TEMPLATEID, C.HGNUM_VITAL_ID AS PARAID, C.HSTR_VITAL_VALUE AS PARAVALUE FROM HGBT_TEMPLATE_PARA_MST B, hrgt_pat_vitals_dtl C WHERE C.HRGNUM_PUK\=? AND B.HGNUM_TEMPLATE_ID IN (\#) AND B.HGNUM_PARA_ID\=C.HGNUM_VITAL_ID AND B.GNUM_HOSPITAL_CODE\=C.GNUM_HOSPITAL_CODE AND C.GNUM_HOSPITAL_CODE\=? AND B.gnum_hospital_code \= ? AND B.GNUM_ISVALID\=? AND C.GNUM_ISVALID\=? 

#Added by Vasu on 31.July.2019
UPDATE.HRGT_EPISODE_DRUG_DTL_FOR_SINGLE_PAGE = update HRGT_EPISODE_DRUG_DTL set GNUM_ISVALID\=? where HRGNUM_PUK\=? and HRGNUM_EPISODE_CODE\=? and HRGNUM_VISIT_NO\=? and HRGNUM_S_NO\=?   and GNUM_HOSPITAL_CODE\=? and GNUM_ISVALID\=? 

								
#Added by Vasu on 06.Aug.2019
SELECT_ADDED_EXT_INV.HRGT_EPISODE_EXTINV_DTL_SPD = SELECT TO_CHAR(A.HRGDT_RECORD_DATE,'dd-Mon-yyyy hh24\:mi') as recordDate, A.HGSTR_PARA_VALUE as paraValue, A.HGNUM_PARA_ID as paraId,A.hrgstr_para_name as paraName,hrgnum_test_code as selTestCode,hgstr_test_name as selTestName,hrgnum_slno as slno FROM HRGT_EPISODE_EXTEXAM_DTL A WHERE A.HRGNUM_PUK \= ? AND A.GNUM_ISVALID \= ? AND A.GNUM_HOSPITAL_CODE \= ? ORDER BY A.HRGDT_RECORD_DATE DESC\t\t\t\t\t\t\t\t\t\t\t

#Added by Vasu on 26.Dec.2019
SELECT_INVESTIGATION.HIVT_REQUISITION_DTL.HIVT_REQUISITION_HEADER_SINGLE_PAGE = Select hivtnum_req_dno AS reqDNo ,a.gnum_lab_code as labCode, a.gnum_lab_code||a.gnum_test_code as labTestCode, b.HGNUM_VISITNO, pkg_inv_fun.fun_lab_name(a.gnum_lab_code,a.gnum_hospital_code) as labName, gnum_test_code as prvTestCode, pkg_inv_fun.fun_test_name(gnum_test_code) as testName, gbnum_priority_code, decode(GBNUM_PRIORITY_CODE,1,'Normal',2,'Urgent',3,'Low') as priority, to_char(hivt_entry_date,'dd-Mon-yyyy') as visitDate, decode(pkg_inv_fun.fun_test_type(gnum_test_code),'P','Patient Based','S', 'Sample Based', 'I','Slide Based') as sampleCode, hivnum_reqdtl_status as resultStatusCode, DECODE(hivnum_reqdtl_status,2,'Requisition Raised',3,'Sample Collected',4,'Packing List Generated',5,'Requisition Raised', 6,'Sample/Patient Accepted', 7,'Result Entered', 8,'Result Validated',9,'Patient Rejected',10,'Test Rescheduled',11,'Test Rescheduled',12,'Sample Cancelled',13,'Ready For Report Printing',14,'Result Printed', 15,'Test Cancelled',16,'Test Deleted',26,'Report Generated',55,'Test Advised',17,'Machine Processing',18,'Machine Processing') resultStatus, pkg_inv_fun.fun_sample_name(gnum_sample_code) sampleName, gnum_sample_code,to_char(hivt_entry_date,'MMddyyyy') as sortReqDate, nvl(hivstr_report_url,'') as reportURL, a.gnum_hospital_code as HospitalCode, b.gnum_episode_code as EpisodeCode, nvl(to_char(b.hipnum_admno),'') as PatAdmNo,b.hgnum_deptunitcode as DepartmentUnitCode, nvl(b.hgnum_visitno,0) as EpisodeVisitNo from hivt_requisition_dtl a, hivt_requisition_header b where a.hivnum_req_no\=b.hivnum_req_no and b.gnum_isvalid\=1 and a.gnum_hospital_code\=b.gnum_hospital_code and b.hrgnum_puk\=? and a.hivnum_reqdtl_status not in(3,6,12,15,16) and trunc(b.hivdt_entry_date) \= trunc(sysdate)\t\t\t\t\t