
SELECT.PAT.ACCEPTANCE.HIVT_REQUISITION_HEADER = SELECT distinct(HIVNUM_REQ_NO), TO_CHAR(hivdt_requisition_date_reqd, 'DD-Mon-YYYY hh24:mi') AS requisitionDate ,HRGNUM_PUK_reqd AS patCRNo ,GSTR_DEPT_NAME_reqd || '' || HGSTR_UNIT_NAME_reqd AS patUnitName ,( SELECT GSTR_LAB_NAME FROM HIVT_LABORATORY_MST WHERE gnum_isvalid = 1 AND GNUM_HOSPITAL_CODE = a.GNUM_HOSPITAL_CODE AND GNUM_LAB_CODE = a.GNUM_LAB_CODE ) AS patLabName ,HIVNUM_REQ_NO AS requisitionNo ,( SELECT array_agg(gstr_test_name) FROM hivt_test_mst x ,HIVT_REQUISITION_DTL y WHERE x.gnum_test_code\ = y.gnum_test_code AND y.HIVNUM_REQDTL_STATUS IN ( ? ,? ) AND y.GNUM_HOSPITAL_CODE = A.GNUM_HOSPITAL_CODE AND y.HIVNUM_REQ_NO = A.HIVNUM_REQ_NO AND x.GNUM_ISVALID = 1 ) AS testName ,GSTR_GENDER_CODE_reqd AS patGender ,LTRIM(RTRIM(HIVSTR_AGE_reqd)) AS patAge ,DECODE(HBNUM_REQUISITION_TYPE_reqd, 2, 'IPD', 1, 'OPD', 3, 'Emergency', 4, 'Special') AS patStatus ,( SELECT hapnum_apt_id FROM hapt_appointment_dtl WHERE hapnum_apt_no = ( SELECT hapnum_app_ref_no FROM hivt_requisition_dtl d WHERE d.HIVNUM_REQ_NO = a.HIVNUM_REQ_NO limit 1 ) AND hapnum_apt_id = 4 ) AS apttype ,hivstr_appointment_time AS apttime ,HIVNUM_REQ_NO AS patReqNo ,HRGNUM_PUK_reqd AS patPuk ,HGNUM_VISITNO_reqd ,GNUM_LAB_CODE AS labCode ,to_char(HIVDT_REQUISITION_DATE_reqd, 'DD-Mon-YYYY') AS patReqDate ,HRGDT_DOB_reqd ,HIVNUM_REQHEADER_STATUS_reqd ,GNUM_EPISODE_CODE_reqd ,INITCAP(HRGSTR_PATNAME_reqd) AS patName ,HBNUM_REQUISITION_TYPE_reqd ,to_char(HGNUM_VISIT_DATE_reqd, 'DD-Mon-YYYY') AS patVisitDat ,HIPNUM_ADMNO_reqd ,NVL(HIVSTR_ADDRESS_reqd, '-') AS address ,HIPNUM_WARDCODE_reqd ,NVL(HRGSTR_MOBILE_NO_reqd, '-') AS mobileNo ,NVL(HRGSTR_EMAIL_ID_reqd, '-') AS emailId ,HIPNUM_ROOM_CODE_reqd ,HIPNUM_BED_CODE_reqd ,HRGSTR_MLC_NO_reqd ,NVL(HIPSTR_BED_NAME_reqd, '-') AS patBedName ,NVL(HIPSTR_ROOM_NAME_reqd, '-') AS patRoomName ,NVL(HIPSTR_WARD_NAME_reqd, '-') AS patWardName ,HGNUM_DEPT_CODE_reqd ,HGNUM_DEPTUNITCODE_reqd ,NVL(HGSTR_ORDERED_BY_DOC_NAME_reqd, '-') AS patOrderByDoc ,pkg_clinical_util_fun.get_pat_category_name(a.GNUM_HOSPITAL_CODE, a.hgnum_patient_cat_code_reqd) AS patCategory ,gbnum_priority_code as priorityCode ,decode(a.GBNUM_PRIORITY_CODE, 1, 'Normal', 2, 'Urgent', 3, 'Low') AS priorityName ,( SELECT hmistr_machine_name FROM hmit_machine_mst WHERE gnum_isvalid = 1 AND hminum_machine_id = a.gnum_machine_code AND gnum_hospital_code = a.gnum_hospital_code ) AS machineName ,( SELECT hmistr_machine_name FROM hmit_machine_mst ss WHERE hminum_machine_id = gnum_machine_code AND ss.gnum_hospital_code = a.gnum_hospital_code AND gnum_isvalid = 1 ) AS machineCode, TO_CHAR(hivtdt_pat_accpt_date_time, 'DD-Mon-YYYY hh24:mi') AS patAccepDate, CONCAT ( CONCAT ( hivnum_temp_sample_no ,'/' ) ,hgstr_daily_labno ) AS tempSampleNo ,hivnum_sample_no AS sampleNo ,hgstr_daily_labno AS labno FROM HIVT_REQUISITION_DTL A WHERE GNUM_HOSPITAL_CODE = ? AND a.gnum_lab_code IN ( SELECT gnum_column_value FROM gblt_role_seat_table_dtl p WHERE p.gbl_isvalid = 1 AND p.gnum_module_id = 15 AND p.gstr_table_name = 'HIVT_LABORATORY_MST' AND p.gstr_column_name = 'GNUM_LAB_CODE' AND p.gnum_seatid = ? AND p.gnum_hospital_code = ? )

#Added By PrashantMi
SELECT.GNUM_USERID.HIVT_RADIOLOGY_MST=select gnum_userid, gstr_usr_name ||' ('|| psrstr_emp_no ||')', gstr_user_name from hivt_radiology_user_mst where gnum_hospital_code=?;
