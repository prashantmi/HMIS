/*** Property File for Investigation Tracking By PrashantMi***/

#--------------------Queries For Investigation Tracking List Start---------------------------------------------------------------------------------------------------------------------------#

#Added By Prashant For Fetching OPD Patient Details By Bill No.   hivt_is_pat_newborn isNewBorn, hivt_is_pat_pregnant isPregnant, hivt_is_pat_vip isVip,
SELECT_INV_TRACKING_PAT_DETAILS_OPD_ONBILLNO_HIVT_REQUISITION_DTL= SELECT hrgnum_isunknown as isUnknown, hrgnum_is_dead isDead, (select string_agg(hrgstr_mlc_no,',') from hrgt_patient_mlc_dtl where gnum_isvalid=1 and hrgnum_puk=a.hrgnum_puk and GNUM_HOSPITAL_CODE = a.GNUM_HOSPITAL_CODE) isMlc, a.hrgnum_puk AS crNumber, initcap(a.hrgstr_fname) AS patFirstName, NVL(initcap(a.hrgstr_mname),' ') AS patMiddleName, NVL(initcap(a.hrgstr_lname),' ') AS patLastName, (NVL(initcap(a.hrgstr_fname),' ')||' '||NVL(initcap(a.hrgstr_mname),' ')||' '||NVL(initcap(a.hrgstr_lname),' ')) as patName ,NVL(initcap(a.hrgstr_father_name),'-') AS patGuardianName, a.hgnum_pat_status_code AS patStatusCode, hgnum_patient_cat_code AS patCategoryCode, pkg_reg_util.DOB_AGE_ON(a.hrgdt_dob,'') AS patAge, initcap(a.hrgstr_spousename) AS patHusbandName, gstr_gender_code AS patGenderCode, pkg_clinical_util_fun.get_pat_category_name(a.GNUM_HOSPITAL_CODE,a.hgnum_patient_cat_code) AS patCategory, NVL(TO_CHAR(hrgdt_dob,'dd-Mon-yyyy'),'') as patDOB, NVL(hrgbl_is_actual_dob,0) as isActualDob, pkg_clinical_util_fun.get_gender_name(gstr_gender_code) AS patGender, DECODE (hgnum_pat_status_code, 3, 'Emergency OPD', 2, 'IPD', 1, 'OPD',4,'Special' ) AS patStatus ,NVL(hrgstr_mobile_no,'') as patMobileNo, NVL(hrgstr_address_line1,' ')||' '||NVL(hrgstr_sub_locality1,' ')||' '||NVL(hrgstr_city_location,' ')||' '||NVL(hrgstr_city,' ')||' '||NVL(hrgstr_district,' ')||' '||NVL(hrgstr_state_name,' ')||' '||NVL(gstr_country_name,' ') as patAddress, DECODE (SIGN (DATE_PART('day',TO_DATE (to_CHAR(hrgdt_primarycat_validupto::timestamp,'DD-MM-YYYY'), 'DD-MM-YYYY') -TO_DATE (TO_CHAR(SYSDATE,'DD-MM-YYYY'), 'DD-MM-YYYY')) ), 1, 0, -1, 1, 0) isCatExpired,NVL(hrgstr_email_id,'-') as patEmailId FROM hrgt_patient_dtl a WHERE gnum_isvalid=1 and hrgnum_puk = (select hrgnum_puk_reqd from hivt_requisition_dtl where gnum_bill_no=? limit 1)

#Added By Prashant For Fetching IPD Patient Details By Bill No.
SELECT_INV_TRACKING_PAT_DETAILS_IPD_ONBILLNO_HIVT_REQUISITION_DTL= SELECT hrgnum_puk as crNumber,to_char(hipdt_admdatetime,'dd-Mon-yyyy') as admissionDate,gnum_deptunit_code as patDeptUnitCode, hrgnum_visit_no as patVisitNo, hrgnum_episode_code as patEpisodeCode ,hpad.gnum_dept_code AS admittedDepartmentCode, hpad.hipnum_admno AS patAdmissionNo, pkg_clinical_util_fun.get_deptunit_name(hpad.gnum_hospital_code,hpad.gnum_deptunit_code) AS patDeptUnit, pkg_clinical_util_fun.get_dept_name(hpad.gnum_hospital_code,hpad.gnum_dept_code) AS admittedDepartmentName, hpad.hipnum_ward_code AS patWardCode, hpad.gnum_dept_code AS admittedDepartmentCode,(SELECT INITCAP(hipstr_ward_name) FROM hipt_ward_mst hwm WHERE gnum_isvalid =1 and hipnum_ward_code = hpad.hipnum_ward_code and GNUM_HOSPITAL_CODE=hpad.GNUM_HOSPITAL_CODE) as patWardName, hpad.hipnum_room_code AS patRoomNo,(SELECT INITCAP(hipstr_room_desc) FROM hipt_room_config_mst WHERE gnum_isvalid=1 and hipnum_room_no = hpad.hipnum_room_code and GNUM_HOSPITAL_CODE=hpad.GNUM_HOSPITAL_CODE) as patRoomName, hpad.hipnum_bed_code as bedCode, ipd_mst.GETBEDNAME(hpad.hipnum_bed_code,gnum_hospital_code) AS bedName, gnum_hospital_code as hospitalCode,(SELECT INITCAP(str_emp_full_name) FROM PIST_EMP_registration_DTL WHERE gnum_isvalid=1 and GNUM_HOSPITAL_CODE = hpad.gnum_hospital_code AND STR_EMP_NO = hpad.hIPNUM_CONSULTANT_ID ) as consultantName, (select hrgstr_mlc_no from hrgt_patient_mlc_dtl where gnum_isvalid=1 and hrgnum_visit_no=hpad.hrgnum_visit_no and hrgnum_episode_code =hpad.hrgnum_episode_code and hrgnum_puk=hpad.hrgnum_puk and GNUM_HOSPITAL_CODE = hpad.GNUM_HOSPITAL_CODE) as patMlcNo, NVL(CONCATSTRING( 'SELECT m.dignosisName || ''(''|| diagnosticTypeName ||'')'' FROM ( SELECT DECODE(X.HRGNUM_DIAGNOSIS_CODE_TYPE,0, (SELECT INITCAP(HGBSTR_DISEASE) FROM HGBT_ICD_DISEASE_MST WHERE TRIM(HGBSTR_DISEASE_CODE)=TRIM(X.HRGNUM_DIAGNOSTIC_CODE) AND GNUM_HOSPITAL_CODE=100 AND HGNUM_RECORD_TYPE=0 AND GNUM_ISVALID=1), 1,(SELECT INITCAP(HGBSTR_DISEASE_DESC) FROM HGBT_HOSPITAL_DISEASE_MST WHERE GNUM_HOSPITAL_CODE=X.GNUM_HOSPITAL_CODE AND TRIM (HGBSTR_HOSPITAL_DISEASE_CODE) =TRIM(X.HRGNUM_DIAGNOSTIC_CODE) AND GNUM_ISVALID=1)) AS dignosisName, (SELECT INITCAP(HGBSTR_DIAGNOSTIC_TYPE_NAME) FROM HGBT_DIAGNOSIS_TYPE_MST WHERE GNUM_HOSPITAL_CODE=100 AND HGBNUM_DIAGNOSTIC_TYPE_CODE=X.GNUM_DIAGNOSTIC_TYPE_CODE AND GNUM_ISVALID=1) AS diagnosticTypeName FROM HRGT_EPISODE_DIAGNOSIS_DTL X WHERE X.HRGNUM_EPISODE_CODE ='''||hpad.hrgnum_episode_code||''' AND X.HRGNUM_PUK ='''||hpad.HRGNUM_PUK||''' AND X.GNUM_HOSPITAL_CODE = '''||hpad.gnum_hospital_code||''' and x.hrgnum_visit_no='''||hpad.hrgnum_visit_no||''' AND X.HBNUM_ISREPEAT IN (0,1) AND gnum_isvalid = 1 ) m',','),'-') AS diagnosis, BILL_MST.GET_PAT_ACCOUNTNO(hpad.GNUM_HOSPITAL_CODE::character varying,2::character varying,hpad.HRGNUM_PUK::character varying) as patAccNo FROM HIPT_PATADMISSION_DTL hpad WHERE GNUM_ISVALID = 1 AND HIPDT_ADMSTATUS_CODE NOT IN (13,14,16) AND GNUM_HOSPITAL_CODE = ?  AND HIPDT_DISDATETIME IS NULL and hrgnum_puk = (select hrgnum_puk_reqd from hivt_requisition_dtl where gnum_bill_no=? limit 1)

#Added By Prashant For Fetching Inv. Sample Based Test Tracking List By Bill No.
SELECT_INV_TRACKING_REPORT_SAMPLEBASED_TEST_ONBILLNO_HIVT_REQUISITION_DTL= SELECT  hivnum_req_no AS requisitionNo, hivtnum_req_dno requisitionDNo, a.gnum_lab_code AS labCode ,( SELECT GSTR_LAB_NAME FROM HIVT_LABORATORY_MST c WHERE c.gnum_isvalid = 1 AND c.GNUM_HOSPITAL_CODE = a.GNUM_HOSPITAL_CODE AND c.GNUM_LAB_CODE = a.GNUM_LAB_CODE ) AS labName ,a.gnum_test_code AS testCode ,( SELECT b.gstr_test_name FROM hivt_test_mst b WHERE b.gnum_isvalid = 1 AND b.gnum_test_code = a.gnum_test_code ) AS testName ,hgnum_group_code AS groupCode ,decode(hgnum_group_code, NULL, '', pkg_inv_fun.getgroupname(a.hgnum_group_code::CHARACTER VARYING, a.gnum_hospital_code)) AS groupName ,TO_CHAR(a.hivdt_requisition_date_reqd, 'DD-Mon-YYYY hh24:mi') AS requisitionDate ,DECODE(a.hivnum_reqdtl_status, 2, 'Requisition Raised', 3, 'Sample Collected', 4, 'Packing List Generated', 5, 'Requisition Raised', 6, 'Sample Accepted', 7, 'Result Entered', 8, 'Result Validated', 9, 'Patient Rejected', 10, 'Test Resceduled', 11, 'Test Rescheduled', 12, 'Sample Cancelled', 13, 'Waiting For Report', 14, 'Result Printed', 15, 'Test Cancelled', 16, 'Test Deleted', 26, 'Report Generated', 55, 'Test Advised', 17, 'Machine Processing', 18, 'Machine Processing', 27, ' Draft- Result Entry', 28, 'Draft-Result Validation') AS requisitionStatus ,hivnum_reqdtl_status as requisitionStatusCode, gbnum_priority_code ,decode(a.GBNUM_PRIORITY_CODE, 1, 'Normal', 2, 'Urgent', 3, 'Low') AS priorityName ,gnum_seat_id AS requestSeatID ,( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = a.gnum_seat_id AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS requisitionBy, ( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = hivtnum_test_delete_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS testDeleteSeatID ,TO_CHAR(a.hivtdt_test_delete_date, 'DD-Mon-YYYY hh24:mi') AS testDeleteDate ,hgstr_ordered_by_doc_reqd AS advisedByDoc, gstr_dept_name_reqd as advisedByDept, gnum_bill_no AS billNo ,'-' AS billDate ,a.hivnum_temp_sample_no AS sampleNo ,TO_CHAR(hivdt_coll_date_time, 'DD-Mon-YYYY hh24:mi') AS sampleCollDate ,( SELECT gstr_Sample_name FROM hivt_sample_mst WHERE gnum_isvalid = 1 AND gnum_sample_code = a.gnum_sample_code ) AS sampleName ,( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = hivnum_collection_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS sampleCollBy ,( SELECT gstr_area_name FROM hivt_collection_area_mst WHERE gnum_isvalid = 1 AND gnum_hospital_Code = a.gnum_hospital_code AND gnum_area_code = a.hivnum_sample_col_area_code ) AS collectionArea ,( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = hivnum_packing_list_seat_id AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS packingListBy ,TO_CHAR(hivtdt_packinglist_date_time, 'DD-Mon-YYYY hh24:mi') AS packingListDateTime ,hivnum_packing_list_no AS packingListNo ,hgstr_daily_labno as labNo ,( SELECT hmistr_machine_name FROM hmit_machine_mst WHERE gnum_isvalid = 1 AND hminum_machine_id = a.gnum_machine_code AND gnum_hospital_code = a.gnum_hospital_code ) AS machineName ,TO_CHAR(hivdt_acceptance_date_time, 'DD-Mon-YYYY hh24:mi') AS sampleAccepDate ,( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = hivdt_acceptance_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS sampleAccepBy ,TO_CHAR(hivtdt_cancellation_date, 'DD-Mon-YYYY hh24:mi') AS sampleRejecDate ,( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = a.hivtnum_cancellation_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS sampleRejecBy ,( SELECT hgstr_rejectionreason FROM hivt_Rejectionreason_mst WHERE gnum_isvalid = 1 AND hivnum_acceptance_type = 1 AND hgnum_rejectionreason_id = hivnum_sam_rejection_reason ) AS sampleRejecReason ,TO_CHAR(hivdt_result_date, 'DD-Mon-YYYY hh24:mi') resultEntryDate ,( SELECT   gstr_user_name FROM gblt_user_mst WHERE gnum_userid = a.hivnum_result_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS resultEntryBy  ,TO_CHAR(hivtdt_res_val_date, 'DD-Mon-YYYY hh24:mi') resultValDate ,( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = a.hivtnum_res_val_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS resultValBy ,TO_CHAR(hivtdt_res_reval_date, 'DD-Mon-YYYY hh24:mi') resultReValDate ,( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = a.hivtnum_res_reval_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS resultReValBy ,hivstr_report_url as reportURL ,TO_CHAR(hivdt_report_date, 'DD-Mon-YYYY hh24:mi') reportGenerationDate, (hivdt_report_date - hivdt_coll_date_time) as turnAroundTime, TO_CHAR(hivtdt_res_print_date, 'DD-Mon-YYYY hh24:mi') reportPrintDate ,( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = a.hivtnum_res_print_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS reportPrintBy ,decode(is_addendum, 1, 'Addendum/AmmendmentReport', 0, '-') ,TO_CHAR(hivdt_reportchange_date, 'DD-Mon-YYYY hh24:mi') reportChangeDate ,( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = a.hivnum_reportchange_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS ReportChangeBy ,hivstr_addendum_remark_reqd AS remark ,TO_CHAR(hivdt_draft_req_datetime, 'DD-Mon-YYYY hh24:mi') draftChangeDate ,( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = a.hivnum_draft_req_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS reportDraftBy, nvl(hgnum_group_type,'0') as isGroup, decode(hgnum_group_type,null,BILL_MST.GETCHARGEDETAILS (10::character varying,a.gnum_hospital_code::character varying,hipnum_wardcode_reqd::character varying,hgnum_patient_cat_code_reqd::character varying,decode(hbnum_requisition_type_reqd,2,'2','1')::character varying,(select hblnum_tariff_id from hblt_tariff_mst where gstr_tariff_id=a.gnum_test_code and gnum_hospital_code=a.gnum_hospital_code and gnum_isvalid=1 and sblnum_service_id=1)::character varying),1,BILL_MST.GETCHARGEDETAILS (10::character varying,a.gnum_hospital_code::character varying,hipnum_wardcode_reqd::character varying,hgnum_patient_cat_code_reqd::character varying,decode(hbnum_requisition_type_reqd,2,'2','1')::character varying,(select hblnum_tariff_id from hblt_tariff_mst where gstr_tariff_id=(a.gnum_lab_code||''||a.hgnum_group_code)  and gnum_hospital_code=a.gnum_hospital_code and gnum_isvalid=1 and sblnum_service_id=4)::character varying)) as testRateDetail, Bill_Interface.func_online_bill_dtl (a.gnum_hospital_code::character varying, DECODE (NVL(a.HGNUM_GROUP_TYPE,11), NULL, a.gnum_test_code,11, a.gnum_test_code, 1,a.gnum_lab_code||a.HGNUM_GROUP_CODE, 2, a.gnum_lab_code||a.HGNUM_GROUP_CODE, 3, a.gnum_test_code)::character VARYING, DECODE (DECODE (HBNUM_REQUISITION_TYPE_reqd,2, '1', 1, '2','3' ), 1, 2, 2, 1, 3, 1 )::character varying, DECODE (NVL(a.HGNUM_GROUP_TYPE,11), 0, 1,NULL,1,11,1, 1, 4, 2, 4, 3, 1 )::character varying, (a.HIVNUM_REQ_NO||'!')::CHARACTER VARYING) as billDetail ,concatstring( 'Select k.hivnum_parameter_code||''#''|| (select INITCAP(hgstr_parameter) from hivt_parameter_mst where gnum_isvalid=1 and hgnum_parameter_id=k.hivnum_parameter_code)||''#''||k.hivtstr_value from hivt_parameter_dtl k where k.gnum_isvalid=1 and k.hivtnum_test_code = '''||a.gnum_test_code ||''' and k.hivtnum_req_dno='''|| a.hivtnum_req_dno ||''' and k.gnum_hospital_code=''' || a.gnum_hospital_code||'''' , ',' ) AS testParameterName FROM hivt_requisition_dtl a WHERE a.gnum_test_code IN ( SELECT gnum_test_code FROM hivt_test_mst WHERE gnum_isvalid = 1 AND gstr_test_type = 'S' ) AND a.gnum_bill_no = ? AND gnum_hospital_code = ? ORDER BY hivdt_requisition_date_reqd DESC, groupName, a.hivnum_temp_sample_no DESC

#Added By Prashant For Fetching Inv. Patient Based Test Tracking List By Bill No.
SELECT_INV_TRACKING_REPORT_PATIENTBASED_TEST_ONBILLNO_HIVT_REQUISITION_DTL= SELECT hivnum_req_no AS requisitionNo, hivtnum_req_dno requisitionDNo, a.gnum_lab_code AS labCode ,( SELECT GSTR_LAB_NAME FROM HIVT_LABORATORY_MST c WHERE c.gnum_isvalid = 1 AND c.GNUM_HOSPITAL_CODE = a.GNUM_HOSPITAL_CODE AND c.GNUM_LAB_CODE = a.GNUM_LAB_CODE ) AS labName ,a.gnum_test_code AS testCode ,( SELECT b.gstr_test_name FROM hivt_test_mst b WHERE b.gnum_isvalid = 1 AND b.gnum_test_code = a.gnum_test_code ) AS testName ,hgnum_group_code AS groupCode ,decode(hgnum_group_code, NULL, '', pkg_inv_fun.getgroupname(a.hgnum_group_code::CHARACTER VARYING, a.gnum_hospital_code)) AS groupName ,TO_CHAR(a.hivdt_requisition_date_reqd, 'DD-Mon-YYYY hh24:mi') AS requisitionDate ,DECODE(a.hivnum_reqdtl_status, 2, 'Requisition Raised', 3, 'Sample Collected', 4, 'Packing List Generated', 5, 'Requisition Raised', 6, 'Patient Accepted', 7, 'Result Entered', 8, 'Result Validated', 9, 'Patient Rejected', 10, 'Test Resceduled', 11, 'Test Rescheduled', 12, 'Sample Cancelled', 13, 'Waiting For Report', 14, 'Result Printed', 15, 'Test Cancelled', 16, 'Test Deleted', 26, 'Report Generated', 55, 'Test Advised', 17, 'Machine Processing', 18, 'Machine Processing', 27, ' Draft- Result Entry', 28, 'Draft-Result Validation') AS requisitionStatus ,hivnum_reqdtl_status as requisitionStatusCode, gbnum_priority_code ,decode(a.GBNUM_PRIORITY_CODE, 1, 'Normal', 2, 'Urgent', 3, 'Low') AS priorityName ,gnum_seat_id AS requestSeatID ,( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = a.gnum_seat_id AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS requisitionBy, ( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = hivtnum_test_delete_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS testDeleteSeatID ,TO_CHAR(a.hivtdt_test_delete_date, 'DD-Mon-YYYY hh24:mi') AS testDeleteDate ,hivstr_site AS site ,hgstr_ordered_by_doc_reqd as advisedByDoc, gstr_dept_name_reqd as advisedByDept, (gnum_bill_no) AS billNo ,'-' AS billDate ,( SELECT gstr_area_name FROM hivt_collection_area_mst WHERE gnum_isvalid = 1 AND gnum_hospital_Code = a.gnum_hospital_code AND gnum_area_code = a.hivnum_sample_col_area_code ) AS collectionArea ,hgstr_daily_labno AS accessionNo ,( SELECT hmistr_machine_name FROM hmit_machine_mst WHERE gnum_isvalid = 1 AND hminum_machine_id = a.gnum_machine_code AND gnum_hospital_code = a.gnum_hospital_code ) AS machineName ,( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = hivdt_acceptance_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS patientAccepBy ,TO_CHAR(hivtdt_pat_accpt_date_time, 'DD-Mon-YYYY hh24:mi') AS patientAccepDate ,TO_CHAR(hivtdt_cancellation_date, 'DD-Mon-YYYY hh24:mi') AS patientRejecDate ,( SELECT hivtnum_cancellation_seatid FROM gblt_user_mst WHERE gnum_userid = hivdt_acceptance_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS patientRejecBy ,( SELECT hgstr_rejectionreason FROM hivt_Rejectionreason_mst WHERE gnum_isvalid = 1 AND hivnum_acceptance_type = 2 AND hgnum_rejectionreason_id = hivnum_pat_rejection_reason ) AS patientRejecReason ,TO_CHAR(hivdt_result_date, 'DD-Mon-YYYY hh24:mi') resultEntryDate ,( SELECT   gstr_user_name FROM gblt_user_mst WHERE gnum_userid = a.hivnum_result_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS resultEntryBy  ,TO_CHAR(hivtdt_res_modify_date, 'DD-Mon-YYYY hh24:mi') resultModDate ,( SELECT hivtnum_res_modify_seatid FROM gblt_user_mst WHERE gnum_userid = hivdt_acceptance_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS resModSeatId ,TO_CHAR(hivtdt_res_val_date, 'DD-Mon-YYYY hh24:mi') resultValDate ,( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = a.hivtnum_res_val_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS resultValBy ,TO_CHAR(hivtdt_res_reval_date, 'DD-Mon-YYYY hh24:mi') resultReValDate ,( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = a.hivtnum_res_reval_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS resultReValBy ,hivstr_report_url as reportURL ,TO_CHAR(hivdt_report_date, 'DD-Mon-YYYY hh24:mi') reportGenerationDate, (hivdt_report_date - hivtdt_pat_accpt_date_time) as turnAroundTime, TO_CHAR(hivtdt_res_print_date, 'DD-Mon-YYYY hh24:mi') reportPrintDate ,( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = a.hivtnum_res_print_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS reportPrintBy ,decode(is_addendum, 1, 'Addendum/AmmendmentReport', 0, '-') ,TO_CHAR(hivdt_reportchange_date, 'DD-Mon-YYYY hh24:mi') reportChangeDate ,( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = a.hivnum_reportchange_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS ReportChangeBy ,hivstr_addendum_remark_reqd AS remark ,TO_CHAR(hivdt_draft_req_datetime, 'DD-Mon-YYYY hh24:mi') draftChangeDate ,( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = a.hivnum_draft_req_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS reportDraftBy, nvl(hgnum_group_type,'0') as isGroup, decode(hgnum_group_type,null,BILL_MST.GETCHARGEDETAILS (10::character varying,a.gnum_hospital_code::character varying,hipnum_wardcode_reqd::character varying,hgnum_patient_cat_code_reqd::character varying,decode(hbnum_requisition_type_reqd,2,'2','1')::character varying,(select hblnum_tariff_id from hblt_tariff_mst where gstr_tariff_id=a.gnum_test_code and gnum_hospital_code=a.gnum_hospital_code and gnum_isvalid=1 and sblnum_service_id=1)::character varying),1,BILL_MST.GETCHARGEDETAILS (10::character varying,a.gnum_hospital_code::character varying,hipnum_wardcode_reqd::character varying,hgnum_patient_cat_code_reqd::character varying,decode(hbnum_requisition_type_reqd,2,'2','1')::character varying,(select hblnum_tariff_id from hblt_tariff_mst where gstr_tariff_id=(a.gnum_lab_code||''||a.hgnum_group_code)  and gnum_hospital_code=a.gnum_hospital_code and gnum_isvalid=1 and sblnum_service_id=4)::character varying)) as testRateDetail, Bill_Interface.func_online_bill_dtl (a.gnum_hospital_code::character varying, DECODE (NVL(a.HGNUM_GROUP_TYPE,11), NULL, a.gnum_test_code,11, a.gnum_test_code, 1,a.gnum_lab_code||a.HGNUM_GROUP_CODE, 2, a.gnum_lab_code||a.HGNUM_GROUP_CODE, 3, a.gnum_test_code)::character VARYING, DECODE (DECODE (HBNUM_REQUISITION_TYPE_reqd,2, '1', 1, '2','3' ), 1, 2, 2, 1, 3, 1 )::character varying, DECODE (NVL(a.HGNUM_GROUP_TYPE,11), 0, 1,NULL,1,11,1, 1, 4, 2, 4, 3, 1 )::character varying, (a.HIVNUM_REQ_NO||'!')::CHARACTER VARYING) as billDetail ,concatstring( 'Select k.hivnum_parameter_code||''#''|| (select INITCAP(hgstr_parameter) from hivt_parameter_mst where gnum_isvalid=1 and hgnum_parameter_id=k.hivnum_parameter_code)||''#''||k.hivtstr_value from hivt_parameter_dtl k where k.gnum_isvalid=1 and k.hivtnum_test_code = '''||a.gnum_test_code ||''' and k.hivtnum_req_dno='''|| a.hivtnum_req_dno ||''' and k.gnum_hospital_code=''' || a.gnum_hospital_code||'''' , ',' ) AS testParameterName FROM hivt_requisition_dtl a WHERE a.gnum_test_code IN ( SELECT gnum_test_code FROM hivt_test_mst WHERE gnum_isvalid = 1 AND gstr_test_type = 'P' ) AND a.gnum_bill_no = ? AND gnum_hospital_code = ? ORDER BY hivdt_requisition_date_reqd DESC, groupName, a.hivnum_temp_sample_no DESC

#Added By Prashant For Fetching Inv. Test Parameter List By Cr. No.
SELECT_INV_TRACKING_REPORT_TESTPARAM_ONBILLNO_HIVT_REQUISITION_DTL = SELECT hivnum_req_no AS requisitionNo, hivtnum_req_dno requisitionDNo, a.gnum_test_code AS testCode ,( SELECT b.gstr_test_name FROM hivt_test_mst b WHERE b.gnum_isvalid = 1 AND b.gnum_test_code = a.gnum_test_code ) AS testName ,hgnum_group_code AS groupCode ,decode(hgnum_group_code, NULL, '', pkg_inv_fun.getgroupname(a.hgnum_group_code::CHARACTER VARYING, a.gnum_hospital_code)) AS groupName ,TO_CHAR(a.hivdt_requisition_date_reqd, 'DD-Mon-YYYY hh24:mi') AS requisitionDate ,DECODE(a.hivnum_reqdtl_status, 2, 'Requisition Raised', 3, 'Sample Collected', 4, 'Packing List Generated', 5, 'Requisition Raised', 6, 'Sample Accepted', 7, 'Result Entered', 8, 'Result Validated', 9, 'Patient Rejected', 10, 'Test Resceduled', 11, 'Test Rescheduled', 12, 'Sample Cancelled', 13, 'Waiting For Report', 14, 'Result Printed', 15, 'Test Cancelled', 16, 'Test Deleted', 26, 'Report Generated', 55, 'Test Advised', 17, 'Machine Processing', 18, 'Machine Processing', 27, ' Draft- Result Entry', 28, 'Draft-Result Validation') AS requisitionStatus ,hivnum_reqdtl_status AS requisitionStatusCode ,a.hivnum_temp_sample_no AS sampleNo ,( SELECT gstr_Sample_name FROM hivt_sample_mst WHERE gnum_isvalid = 1 AND gnum_sample_code = a.gnum_sample_code ) AS sampleName , hgstr_daily_labno AS accessionNo ,( SELECT hmistr_machine_name FROM hmit_machine_mst WHERE gnum_isvalid = 1 AND hminum_machine_id = a.gnum_machine_code AND gnum_hospital_code = a.gnum_hospital_code ) AS machineName, TO_CHAR(hivdt_result_date, 'DD-Mon-YYYY hh24:mi') resultEntryDate ,TO_CHAR(hivtdt_res_val_date, 'DD-Mon-YYYY hh24:mi') resultValDate ,TO_CHAR(hivtdt_res_reval_date, 'DD-Mon-YYYY hh24:mi') resultValidDate ,TO_CHAR(hivdt_reportchange_date, 'DD-Mon-YYYY hh24:mi') reportChangeDate ,NVL(hgnum_group_type,'0') AS isGroup ,concatstring('Select k.hivnum_parameter_code||''#''|| (select INITCAP(hgstr_parameter) from hivt_parameter_mst where gnum_isvalid=1 and hgnum_parameter_id=k.hivnum_parameter_code)||''#''||k.hivtstr_value ||''#''||nvl(hivstr_referencerange,'''')||''#''||nvl(hivt_isinrefrange,''0'') from hivt_parameter_dtl k where k.gnum_isvalid=1 and k.hivtnum_test_code = ''' || a.gnum_test_code || ''' and k.hivtnum_req_dno=''' || a.hivtnum_req_dno || ''' and k.gnum_hospital_code=''' || a.gnum_hospital_code || '''', ',') AS testParameterDetails FROM hivt_requisition_dtl a WHERE a.gnum_bill_no = ? AND gnum_hospital_code = ? ORDER BY hivdt_requisition_date_reqd desc, testCode,groupCode ,a.hivnum_temp_sample_no DESC



#Added By Prashant For Fetching OPD Patient Details By Cr. No.
SELECT_INV_TRACKING_PAT_DETAILS_OPD_ONCRNO_HIVT_REQUISITION_DTL= SELECT hrgnum_isunknown as isUnknown, hrgnum_is_dead isDead, (select string_agg(hrgstr_mlc_no,',') from hrgt_patient_mlc_dtl where gnum_isvalid=1 and hrgnum_puk=a.hrgnum_puk and GNUM_HOSPITAL_CODE = a.GNUM_HOSPITAL_CODE) isMlc, a.hrgnum_puk AS crNumber, initcap(a.hrgstr_fname) AS patFirstName, NVL(initcap(a.hrgstr_mname),' ') AS patMiddleName, NVL(initcap(a.hrgstr_lname),' ') AS patLastName, (NVL(initcap(a.hrgstr_fname),' ')||' '||NVL(initcap(a.hrgstr_mname),' ')||' '||NVL(initcap(a.hrgstr_lname),' ')) as patName ,NVL(initcap(a.hrgstr_father_name),'-') AS patGuardianName, a.hgnum_pat_status_code AS patStatusCode, hgnum_patient_cat_code AS patCategoryCode, pkg_reg_util.DOB_AGE_ON(a.hrgdt_dob,'') AS patAge, initcap(a.hrgstr_spousename) AS patHusbandName, gstr_gender_code AS patGenderCode, pkg_clinical_util_fun.get_pat_category_name(a.GNUM_HOSPITAL_CODE,a.hgnum_patient_cat_code) AS patCategory, NVL(TO_CHAR(hrgdt_dob,'dd-Mon-yyyy'),'') as patDOB, NVL(hrgbl_is_actual_dob,0) as isActualDob, pkg_clinical_util_fun.get_gender_name(gstr_gender_code) AS patGender, DECODE (hgnum_pat_status_code, 3, 'Emergency OPD', 2, 'IPD', 1, 'OPD',4,'Special' ) AS patStatus ,NVL(hrgstr_mobile_no,'') as patMobileNo, NVL(hrgstr_address_line1,' ')||' '||NVL(hrgstr_sub_locality1,' ')||' '||NVL(hrgstr_city_location,' ')||' '||NVL(hrgstr_city,' ')||' '||NVL(hrgstr_district,' ')||' '||NVL(hrgstr_state_name,' ')||' '||NVL(gstr_country_name,' ') as patAddress, DECODE (SIGN (DATE_PART('day',TO_DATE (to_CHAR(hrgdt_primarycat_validupto::timestamp,'DD-MM-YYYY'), 'DD-MM-YYYY') -TO_DATE (TO_CHAR(SYSDATE,'DD-MM-YYYY'), 'DD-MM-YYYY')) ), 1, 0, -1, 1, 0) isCatExpired,NVL(hrgstr_email_id,'-') as patEmailId FROM hrgt_patient_dtl a WHERE gnum_isvalid=1 and hrgnum_puk = ?

#Added By Prashant For Fetching IPD Patient Details By Cr. No.
SELECT_INV_TRACKING_PAT_DETAILS_IPD_ONCRNO_HIVT_REQUISITION_DTL= SELECT hrgnum_puk as crNumber,to_char(hipdt_admdatetime,'dd-Mon-yyyy') as admissionDate,gnum_deptunit_code as patDeptUnitCode, hrgnum_visit_no as patVisitNo, hrgnum_episode_code as patEpisodeCode ,hpad.gnum_dept_code AS admittedDepartmentCode, hpad.hipnum_admno AS patAdmissionNo, pkg_clinical_util_fun.get_deptunit_name(hpad.gnum_hospital_code,hpad.gnum_deptunit_code) AS patDeptUnit, pkg_clinical_util_fun.get_dept_name(hpad.gnum_hospital_code,hpad.gnum_dept_code) AS admittedDepartmentName, hpad.hipnum_ward_code AS patWardCode, hpad.gnum_dept_code AS admittedDepartmentCode,(SELECT INITCAP(hipstr_ward_name) FROM hipt_ward_mst hwm WHERE gnum_isvalid =1 and hipnum_ward_code = hpad.hipnum_ward_code and GNUM_HOSPITAL_CODE=hpad.GNUM_HOSPITAL_CODE) as patWardName, hpad.hipnum_room_code AS patRoomNo,(SELECT INITCAP(hipstr_room_desc) FROM hipt_room_config_mst WHERE gnum_isvalid=1 and hipnum_room_no = hpad.hipnum_room_code and GNUM_HOSPITAL_CODE=hpad.GNUM_HOSPITAL_CODE) as patRoomName, hpad.hipnum_bed_code as bedCode, ipd_mst.GETBEDNAME(hpad.hipnum_bed_code,gnum_hospital_code) AS bedName, gnum_hospital_code as hospitalCode,(SELECT INITCAP(str_emp_full_name) FROM PIST_EMP_registration_DTL WHERE gnum_isvalid=1 and GNUM_HOSPITAL_CODE = hpad.gnum_hospital_code AND STR_EMP_NO = hpad.hIPNUM_CONSULTANT_ID ) as consultantName, (select hrgstr_mlc_no from hrgt_patient_mlc_dtl where gnum_isvalid=1 and hrgnum_visit_no=hpad.hrgnum_visit_no and hrgnum_episode_code =hpad.hrgnum_episode_code and hrgnum_puk=hpad.hrgnum_puk and GNUM_HOSPITAL_CODE = hpad.GNUM_HOSPITAL_CODE) as patMlcNo, NVL(CONCATSTRING( 'SELECT m.dignosisName || ''(''|| diagnosticTypeName ||'')'' FROM ( SELECT DECODE(X.HRGNUM_DIAGNOSIS_CODE_TYPE,0, (SELECT INITCAP(HGBSTR_DISEASE) FROM HGBT_ICD_DISEASE_MST WHERE TRIM(HGBSTR_DISEASE_CODE)=TRIM(X.HRGNUM_DIAGNOSTIC_CODE) AND GNUM_HOSPITAL_CODE=100 AND HGNUM_RECORD_TYPE=0 AND GNUM_ISVALID=1), 1,(SELECT INITCAP(HGBSTR_DISEASE_DESC) FROM HGBT_HOSPITAL_DISEASE_MST WHERE GNUM_HOSPITAL_CODE=X.GNUM_HOSPITAL_CODE AND TRIM (HGBSTR_HOSPITAL_DISEASE_CODE) =TRIM(X.HRGNUM_DIAGNOSTIC_CODE) AND GNUM_ISVALID=1)) AS dignosisName, (SELECT INITCAP(HGBSTR_DIAGNOSTIC_TYPE_NAME) FROM HGBT_DIAGNOSIS_TYPE_MST WHERE GNUM_HOSPITAL_CODE=100 AND HGBNUM_DIAGNOSTIC_TYPE_CODE=X.GNUM_DIAGNOSTIC_TYPE_CODE AND GNUM_ISVALID=1) AS diagnosticTypeName FROM HRGT_EPISODE_DIAGNOSIS_DTL X WHERE X.HRGNUM_EPISODE_CODE ='''||hpad.hrgnum_episode_code||''' AND X.HRGNUM_PUK ='''||hpad.HRGNUM_PUK||''' AND X.GNUM_HOSPITAL_CODE = '''||hpad.gnum_hospital_code||''' and x.hrgnum_visit_no='''||hpad.hrgnum_visit_no||''' AND X.HBNUM_ISREPEAT IN (0,1) AND gnum_isvalid = 1 ) m',','),'-') AS diagnosis, BILL_MST.GET_PAT_ACCOUNTNO(hpad.GNUM_HOSPITAL_CODE::character varying,2::character varying,hpad.HRGNUM_PUK::character varying) as patAccNo FROM HIPT_PATADMISSION_DTL hpad WHERE GNUM_ISVALID = 1 AND HIPDT_ADMSTATUS_CODE NOT IN (13,14,16) AND GNUM_HOSPITAL_CODE = ?  AND HIPDT_DISDATETIME IS NULL AND HRGNUM_PUK = ?

#Added By Prashant For Fetching Inv. Sample Based Test Tracking List By Cr. No.
SELECT_INV_TRACKING_REPORT_SAMPLEBASED_TEST_ONCRNO_HIVT_REQUISITION_DTL= SELECT hivnum_req_no AS requisitionNo, hivtnum_req_dno requisitionDNo, a.gnum_lab_code AS labCode ,( SELECT GSTR_LAB_NAME FROM HIVT_LABORATORY_MST c WHERE c.gnum_isvalid = 1 AND c.GNUM_HOSPITAL_CODE = a.GNUM_HOSPITAL_CODE AND c.GNUM_LAB_CODE = a.GNUM_LAB_CODE ) AS labName ,a.gnum_test_code AS testCode ,( SELECT b.gstr_test_name FROM hivt_test_mst b WHERE b.gnum_isvalid = 1 AND b.gnum_test_code = a.gnum_test_code ) AS testName ,hgnum_group_code AS groupCode ,decode(hgnum_group_code, NULL, '', pkg_inv_fun.getgroupname(a.hgnum_group_code::CHARACTER VARYING, a.gnum_hospital_code)) AS groupName ,TO_CHAR(a.hivdt_requisition_date_reqd, 'DD-Mon-YYYY hh24:mi') AS requisitionDate ,DECODE(a.hivnum_reqdtl_status, 2, 'Requisition Raised', 3, 'Sample Collected', 4, 'Packing List Generated', 5, 'Requisition Raised', 6, 'Sample Accepted', 7, 'Result Entered', 8, 'Result Validated', 9, 'Patient Rejected', 10, 'Test Resceduled', 11, 'Test Rescheduled', 12, 'Sample Cancelled', 13, 'Waiting For Report', 14, 'Result Printed', 15, 'Test Cancelled', 16, 'Test Deleted', 26, 'Report Generated', 55, 'Test Advised', 17, 'Machine Processing', 18, 'Machine Processing', 27, ' Draft- Result Entry', 28, 'Draft-Result Validation') AS requisitionStatus ,hivnum_reqdtl_status as requisitionStatusCode, gbnum_priority_code ,decode(a.GBNUM_PRIORITY_CODE, 1, 'Normal', 2, 'Urgent', 3, 'Low') AS priorityName ,gnum_seat_id AS requestSeatID ,( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = a.gnum_seat_id AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS requisitionBy, ( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = hivtnum_test_delete_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS testDeleteSeatID ,TO_CHAR(a.hivtdt_test_delete_date, 'DD-Mon-YYYY hh24:mi') AS testDeleteDate ,hgstr_ordered_by_doc_reqd AS advisedByDoc, gstr_dept_name_reqd as advisedByDept, gnum_bill_no AS billNo ,'-' AS billDate ,a.hivnum_temp_sample_no AS sampleNo ,TO_CHAR(hivdt_coll_date_time, 'DD-Mon-YYYY hh24:mi') AS sampleCollDate ,( SELECT gstr_Sample_name FROM hivt_sample_mst WHERE gnum_isvalid = 1 AND gnum_sample_code = a.gnum_sample_code ) AS sampleName ,( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = hivnum_collection_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS sampleCollBy ,( SELECT gstr_area_name FROM hivt_collection_area_mst WHERE gnum_isvalid = 1 AND gnum_hospital_Code = a.gnum_hospital_code AND gnum_area_code = a.hivnum_sample_col_area_code ) AS collectionArea ,( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = hivnum_packing_list_seat_id AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS packingListBy ,TO_CHAR(hivtdt_packinglist_date_time, 'DD-Mon-YYYY hh24:mi') AS packingListDateTime ,hivnum_packing_list_no AS packingListNo ,hgstr_daily_labno as labNo ,( SELECT hmistr_machine_name FROM hmit_machine_mst WHERE gnum_isvalid = 1 AND hminum_machine_id = a.gnum_machine_code AND gnum_hospital_code = a.gnum_hospital_code ) AS machineName ,TO_CHAR(hivdt_acceptance_date_time, 'DD-Mon-YYYY hh24:mi') AS sampleAccepDate ,( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = hivdt_acceptance_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS sampleAccepBy ,TO_CHAR(hivtdt_cancellation_date, 'DD-Mon-YYYY hh24:mi') AS sampleRejecDate ,( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = a.hivtnum_cancellation_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS sampleRejecBy ,( SELECT hgstr_rejectionreason FROM hivt_Rejectionreason_mst WHERE gnum_isvalid = 1 AND hivnum_acceptance_type = 1 AND hgnum_rejectionreason_id = hivnum_sam_rejection_reason ) AS sampleRejecReason ,TO_CHAR(hivdt_result_date, 'DD-Mon-YYYY hh24:mi') resultEntryDate ,( SELECT   gstr_user_name FROM gblt_user_mst WHERE gnum_userid = a.hivnum_result_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS resultEntryBy  ,TO_CHAR(hivtdt_res_val_date, 'DD-Mon-YYYY hh24:mi') resultValDate ,( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = a.hivtnum_res_val_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS resultValBy,TO_CHAR(hivtdt_res_reval_date, 'DD-Mon-YYYY hh24:mi') resultReValDate ,( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = a.hivtnum_res_reval_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS resultReValBy ,hivstr_report_url as reportURL ,TO_CHAR(hivdt_report_date, 'DD-Mon-YYYY hh24:mi') reportGenerationDate, (hivdt_report_date - hivdt_coll_date_time) as turnAroundTime, TO_CHAR(hivtdt_res_print_date, 'DD-Mon-YYYY hh24:mi') reportPrintDate ,( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = a.hivtnum_res_print_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS reportPrintBy ,decode(is_addendum, 1, 'Addendum/AmmendmentReport', 0, '-') ,TO_CHAR(hivdt_reportchange_date, 'DD-Mon-YYYY hh24:mi') reportChangeDate ,( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = a.hivnum_reportchange_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS ReportChangeBy ,hivstr_addendum_remark_reqd AS remark ,TO_CHAR(hivdt_draft_req_datetime, 'DD-Mon-YYYY hh24:mi') draftChangeDate ,( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = a.hivnum_draft_req_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS reportDraftBy, nvl(hgnum_group_type,'0') as isGroup, decode(hgnum_group_type,null,BILL_MST.GETCHARGEDETAILS (10::character varying,a.gnum_hospital_code::character varying,hipnum_wardcode_reqd::character varying,hgnum_patient_cat_code_reqd::character varying,decode(hbnum_requisition_type_reqd,2,'2','1')::character varying,(select hblnum_tariff_id from hblt_tariff_mst where gstr_tariff_id=a.gnum_test_code and gnum_hospital_code=a.gnum_hospital_code and gnum_isvalid=1 and sblnum_service_id=1)::character varying),1,BILL_MST.GETCHARGEDETAILS (10::character varying,a.gnum_hospital_code::character varying,hipnum_wardcode_reqd::character varying,hgnum_patient_cat_code_reqd::character varying,decode(hbnum_requisition_type_reqd,2,'2','1')::character varying,(select hblnum_tariff_id from hblt_tariff_mst where gstr_tariff_id=(a.gnum_lab_code||''||a.hgnum_group_code)  and gnum_hospital_code=a.gnum_hospital_code and gnum_isvalid=1 and sblnum_service_id=4)::character varying)) as testRateDetail, Bill_Interface.func_online_bill_dtl (a.gnum_hospital_code::character varying, DECODE (NVL(a.HGNUM_GROUP_TYPE,11), NULL, a.gnum_test_code,11, a.gnum_test_code, 1,a.gnum_lab_code||a.HGNUM_GROUP_CODE, 2, a.gnum_lab_code||a.HGNUM_GROUP_CODE, 3, a.gnum_test_code)::character VARYING, DECODE (DECODE (HBNUM_REQUISITION_TYPE_reqd,2, '1', 1, '2','3' ), 1, 2, 2, 1, 3, 1 )::character varying, DECODE (NVL(a.HGNUM_GROUP_TYPE,11), 0, 1,NULL,1,11,1, 1, 4, 2, 4, 3, 1 )::character varying, (a.HIVNUM_REQ_NO||'!')::CHARACTER VARYING) as billDetail ,concatstring( 'Select k.hivnum_parameter_code||''#''|| (select INITCAP(hgstr_parameter) from hivt_parameter_mst where gnum_isvalid=1 and hgnum_parameter_id=k.hivnum_parameter_code)||''#''||k.hivtstr_value from hivt_parameter_dtl k where k.gnum_isvalid=1 and k.hivtnum_test_code = '''||a.gnum_test_code ||''' and k.hivtnum_req_dno='''|| a.hivtnum_req_dno ||''' and k.gnum_hospital_code=''' || a.gnum_hospital_code||'''' , ',' ) AS testParameterName FROM hivt_requisition_dtl a WHERE a.gnum_test_code IN ( SELECT gnum_test_code FROM hivt_test_mst WHERE gnum_isvalid = 1 AND gstr_test_type = 'S' ) AND a.hrgnum_puk_reqd = ? AND gnum_hospital_code = ? and decode(?,'1',a.gnum_test_code=? and (hgnum_group_type=0 OR hgnum_group_type Is NULL),'2',hgnum_group_code=? and hgnum_group_type=1,'0',gnum_isvalid_reqd=1) ORDER BY hivdt_requisition_date_reqd DESC, groupName, a.hivnum_temp_sample_no DESC

#Added By Prashant For Fetching Inv. Patient Based Test Tracking List By Cr. No.
SELECT_INV_TRACKING_REPORT_PATIENTBASED_TEST_ONCRNO_HIVT_REQUISITION_DTL= SELECT hivnum_req_no AS requisitionNo, hivtnum_req_dno requisitionDNo, a.gnum_lab_code AS labCode ,( SELECT GSTR_LAB_NAME FROM HIVT_LABORATORY_MST c WHERE c.gnum_isvalid = 1 AND c.GNUM_HOSPITAL_CODE = a.GNUM_HOSPITAL_CODE AND c.GNUM_LAB_CODE = a.GNUM_LAB_CODE ) AS labName ,a.gnum_test_code AS testCode ,( SELECT b.gstr_test_name FROM hivt_test_mst b WHERE b.gnum_isvalid = 1 AND b.gnum_test_code = a.gnum_test_code ) AS testName ,hgnum_group_code AS groupCode ,decode(hgnum_group_code, NULL, '', pkg_inv_fun.getgroupname(a.hgnum_group_code::CHARACTER VARYING, a.gnum_hospital_code)) AS groupName ,TO_CHAR(a.hivdt_requisition_date_reqd, 'DD-Mon-YYYY hh24:mi') AS requisitionDate ,DECODE(a.hivnum_reqdtl_status, 2, 'Requisition Raised', 3, 'Sample Collected', 4, 'Packing List Generated', 5, 'Requisition Raised', 6, 'Patient Accepted', 7, 'Result Entered', 8, 'Result Validated', 9, 'Patient Rejected', 10, 'Test Resceduled', 11, 'Test Rescheduled', 12, 'Sample Cancelled', 13, 'Waiting For Report', 14, 'Result Printed', 15, 'Test Cancelled', 16, 'Test Deleted', 26, 'Report Generated', 55, 'Test Advised', 17, 'Machine Processing', 18, 'Machine Processing', 27, ' Draft- Result Entry', 28, 'Draft-Result Validation') AS requisitionStatus ,hivnum_reqdtl_status as requisitionStatusCode, gbnum_priority_code ,decode(a.GBNUM_PRIORITY_CODE, 1, 'Normal', 2, 'Urgent', 3, 'Low') AS priorityName ,gnum_seat_id AS requestSeatID ,( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = a.gnum_seat_id AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS requisitionBy,( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = hivtnum_test_delete_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS testDeleteSeatID ,TO_CHAR(a.hivtdt_test_delete_date, 'DD-Mon-YYYY hh24:mi') AS testDeleteDate ,hivstr_site AS site ,hgstr_ordered_by_doc_reqd as advisedByDoc, gstr_dept_name_reqd as advisedByDept, (gnum_bill_no) AS billNo ,'-' AS billDate ,( SELECT gstr_area_name FROM hivt_collection_area_mst WHERE gnum_isvalid = 1 AND gnum_hospital_Code = a.gnum_hospital_code AND gnum_area_code = a.hivnum_sample_col_area_code ) AS collectionArea ,hgstr_daily_labno AS accessionNo ,( SELECT hmistr_machine_name FROM hmit_machine_mst WHERE gnum_isvalid = 1 AND hminum_machine_id = a.gnum_machine_code AND gnum_hospital_code = a.gnum_hospital_code ) AS machineName ,( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = hivdt_acceptance_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS patientAccepBy ,TO_CHAR(hivtdt_pat_accpt_date_time, 'DD-Mon-YYYY hh24:mi') AS patientAccepDate ,TO_CHAR(hivtdt_cancellation_date, 'DD-Mon-YYYY hh24:mi') AS patientRejecDate ,( SELECT hivtnum_cancellation_seatid FROM gblt_user_mst WHERE gnum_userid = hivdt_acceptance_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS patientRejecBy ,( SELECT hgstr_rejectionreason FROM hivt_Rejectionreason_mst WHERE gnum_isvalid = 1 AND hivnum_acceptance_type = 2 AND hgnum_rejectionreason_id = hivnum_pat_rejection_reason ) AS patientRejecReason ,TO_CHAR(hivdt_result_date, 'DD-Mon-YYYY hh24:mi') resultEntryDate ,( SELECT   gstr_user_name FROM gblt_user_mst WHERE gnum_userid = a.hivnum_result_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS resultEntryBy  ,TO_CHAR(hivtdt_res_modify_date, 'DD-Mon-YYYY hh24:mi') resultModDate ,( SELECT hivtnum_res_modify_seatid FROM gblt_user_mst WHERE gnum_userid = hivdt_acceptance_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS resModSeatId ,TO_CHAR(hivtdt_res_val_date, 'DD-Mon-YYYY hh24:mi') resultValDate ,( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = a.hivtnum_res_val_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS resultValBy ,TO_CHAR(hivtdt_res_reval_date, 'DD-Mon-YYYY hh24:mi') resultReValDate ,( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = a.hivtnum_res_reval_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS resultReValBy ,hivstr_report_url as reportURL ,TO_CHAR(hivdt_report_date, 'DD-Mon-YYYY hh24:mi') reportGenerationDate, (hivdt_report_date - hivtdt_pat_accpt_date_time) as turnAroundTime, TO_CHAR(hivtdt_res_print_date, 'DD-Mon-YYYY hh24:mi') reportPrintDate ,( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = a.hivtnum_res_print_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS reportPrintBy ,decode(is_addendum, 1, 'Addendum/AmmendmentReport', 0, '-') ,TO_CHAR(hivdt_reportchange_date, 'DD-Mon-YYYY hh24:mi') reportChangeDate ,( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = a.hivnum_reportchange_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS ReportChangeBy ,hivstr_addendum_remark_reqd AS remark ,TO_CHAR(hivdt_draft_req_datetime, 'DD-Mon-YYYY hh24:mi') draftChangeDate ,( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = a.hivnum_draft_req_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS reportDraftBy, nvl(hgnum_group_type,'0') as isGroup, decode(hgnum_group_type,null,BILL_MST.GETCHARGEDETAILS (10::character varying,a.gnum_hospital_code::character varying,hipnum_wardcode_reqd::character varying,hgnum_patient_cat_code_reqd::character varying,decode(hbnum_requisition_type_reqd,2,'2','1')::character varying,(select hblnum_tariff_id from hblt_tariff_mst where gstr_tariff_id=a.gnum_test_code and gnum_hospital_code=a.gnum_hospital_code and gnum_isvalid=1 and sblnum_service_id=1)::character varying),1,BILL_MST.GETCHARGEDETAILS (10::character varying,a.gnum_hospital_code::character varying,hipnum_wardcode_reqd::character varying,hgnum_patient_cat_code_reqd::character varying,decode(hbnum_requisition_type_reqd,2,'2','1')::character varying,(select hblnum_tariff_id from hblt_tariff_mst where gstr_tariff_id=(a.gnum_lab_code||''||a.hgnum_group_code)  and gnum_hospital_code=a.gnum_hospital_code and gnum_isvalid=1 and sblnum_service_id=4)::character varying)) as testRateDetail, Bill_Interface.func_online_bill_dtl (a.gnum_hospital_code::character varying, DECODE (NVL(a.HGNUM_GROUP_TYPE,11), NULL, a.gnum_test_code,11, a.gnum_test_code, 1,a.gnum_lab_code||a.HGNUM_GROUP_CODE, 2, a.gnum_lab_code||a.HGNUM_GROUP_CODE, 3, a.gnum_test_code)::character VARYING, DECODE (DECODE (HBNUM_REQUISITION_TYPE_reqd,2, '1', 1, '2','3' ), 1, 2, 2, 1, 3, 1 )::character varying, DECODE (NVL(a.HGNUM_GROUP_TYPE,11), 0, 1,NULL,1,11,1, 1, 4, 2, 4, 3, 1 )::character varying, (a.HIVNUM_REQ_NO||'!')::CHARACTER VARYING) as billDetail ,concatstring( 'Select k.hivnum_parameter_code||''#''|| (select INITCAP(hgstr_parameter) from hivt_parameter_mst where gnum_isvalid=1 and hgnum_parameter_id=k.hivnum_parameter_code)||''#''||k.hivtstr_value from hivt_parameter_dtl k where k.gnum_isvalid=1 and k.hivtnum_test_code = '''||a.gnum_test_code ||''' and k.hivtnum_req_dno='''|| a.hivtnum_req_dno ||''' and k.gnum_hospital_code=''' || a.gnum_hospital_code||'''' , ',' ) AS testParameterName FROM hivt_requisition_dtl a WHERE a.gnum_test_code IN ( SELECT gnum_test_code FROM hivt_test_mst WHERE gnum_isvalid = 1 AND gstr_test_type = 'P' ) AND a.hrgnum_puk_reqd = ? AND gnum_hospital_code = ? and decode(?,'1',a.gnum_test_code=? and (hgnum_group_type=0 OR hgnum_group_type Is NULL),'2',hgnum_group_code=? and hgnum_group_type=1,'0',gnum_isvalid_reqd=1) ORDER BY hivdt_requisition_date_reqd DESC, groupName, a.hivnum_temp_sample_no DESC 

#Added By Prashant For Fetching Inv. Test Parameter List By Cr. No.
SELECT_INV_TRACKING_REPORT_TESTPARAM_ONCRNO_HIVT_REQUISITION_DTL= SELECT hivnum_req_no AS requisitionNo, hivtnum_req_dno requisitionDNo, a.gnum_test_code AS testCode ,( SELECT b.gstr_test_name FROM hivt_test_mst b WHERE b.gnum_isvalid = 1 AND b.gnum_test_code = a.gnum_test_code ) AS testName ,hgnum_group_code AS groupCode ,decode(hgnum_group_code, NULL, '', pkg_inv_fun.getgroupname(a.hgnum_group_code::CHARACTER VARYING, a.gnum_hospital_code)) AS groupName ,TO_CHAR(a.hivdt_requisition_date_reqd, 'DD-Mon-YYYY hh24:mi') AS requisitionDate ,DECODE(a.hivnum_reqdtl_status, 2, 'Requisition Raised', 3, 'Sample Collected', 4, 'Packing List Generated', 5, 'Requisition Raised', 6, 'Sample Accepted', 7, 'Result Entered', 8, 'Result Validated', 9, 'Patient Rejected', 10, 'Test Resceduled', 11, 'Test Rescheduled', 12, 'Sample Cancelled', 13, 'Waiting For Report', 14, 'Result Printed', 15, 'Test Cancelled', 16, 'Test Deleted', 26, 'Report Generated', 55, 'Test Advised', 17, 'Machine Processing', 18, 'Machine Processing', 27, ' Draft- Result Entry', 28, 'Draft-Result Validation') AS requisitionStatus ,hivnum_reqdtl_status AS requisitionStatusCode ,a.hivnum_temp_sample_no AS sampleNo ,( SELECT gstr_Sample_name FROM hivt_sample_mst WHERE gnum_isvalid = 1 AND gnum_sample_code = a.gnum_sample_code ) AS sampleName , hgstr_daily_labno AS accessionNo ,( SELECT hmistr_machine_name FROM hmit_machine_mst WHERE gnum_isvalid = 1 AND hminum_machine_id = a.gnum_machine_code AND gnum_hospital_code = a.gnum_hospital_code ) AS machineName, TO_CHAR(hivdt_result_date, 'DD-Mon-YYYY hh24:mi') resultEntryDate ,TO_CHAR(hivtdt_res_val_date, 'DD-Mon-YYYY hh24:mi') resultValDate ,TO_CHAR(hivtdt_res_reval_date, 'DD-Mon-YYYY hh24:mi') resultValidDate ,TO_CHAR(hivdt_reportchange_date, 'DD-Mon-YYYY hh24:mi') reportChangeDate ,NVL(hgnum_group_type,'0') AS isGroup ,concatstring('Select k.hivnum_parameter_code||''#''|| (select INITCAP(hgstr_parameter) from hivt_parameter_mst where gnum_isvalid=1 and hgnum_parameter_id=k.hivnum_parameter_code)||''#''||k.hivtstr_value ||''#''||nvl(hivstr_referencerange,'''')||''#''||nvl(hivt_isinrefrange,''0'') from hivt_parameter_dtl k where k.gnum_isvalid=1 and k.hivtnum_test_code = ''' || a.gnum_test_code || ''' and k.hivtnum_req_dno=''' || a.hivtnum_req_dno || ''' and k.gnum_hospital_code=''' || a.gnum_hospital_code || '''', ',') AS testParameterDetails FROM hivt_requisition_dtl a WHERE a.hrgnum_puk_reqd = ? AND gnum_hospital_code = ? and decode(?,'1',a.gnum_test_code=? and (hgnum_group_type=0 OR hgnum_group_type Is NULL),'2',hgnum_group_code=? and hgnum_group_type=1,'0',gnum_isvalid_reqd=1) ORDER BY hivdt_requisition_date_reqd desc, testCode,groupCode ,a.hivnum_temp_sample_no DESC



#Added By Prashant For Fetching Patient Details By Sample No.
SELECT_INV_TRACKING_PAT_DETAILS_ONSAMPLENO_HIVT_REQUISITION_DTL=

#Added By Prashant For Fetching Inv. Sample Based Test Tracking List By Sample No.
SELECT_INV_TRACKING_REPORT_SAMPLEBASED_TEST_ONSAMPLENO_HIVT_REQUISITION_DTL=

#Added By Prashant For Fetching Inv. Patient Based Test Tracking List By Sample No.
SELECT_INV_TRACKING_REPORT_PATIENTBASED_TEST_ONLABNO_HIVT_REQUISITION_DTL=

#Added By Prashant For Fetching Test Avg Turn Around Time with test code
SELECT_INV_TRACKING_REPORT.TURN_AROUND_TIME.HIVT_TEST_MST= select gnum_test_code as testCode, gnum_turnaround_time as turnAroundTime from hivt_test_mst where gnum_isvalid=1;

#--------------------Queries For Investigation Tracking List End---------------------------------------------------------------------------------------------------------------------------#

#Added By chandan
SELECT_INV_TRACKING_REPORT_SAMPLEBASED_TEST_ONCRNO_HIVT_REQUISITION_DTL_REPORTS= SELECT hivnum_req_no AS requisitionNo, hivtnum_req_dno requisitionDNo, a.gnum_lab_code AS labCode ,( SELECT GSTR_LAB_NAME FROM HIVT_LABORATORY_MST c WHERE c.gnum_isvalid = 1 AND c.GNUM_HOSPITAL_CODE = a.GNUM_HOSPITAL_CODE AND c.GNUM_LAB_CODE = a.GNUM_LAB_CODE ) AS labName ,a.gnum_test_code AS testCode ,( SELECT b.gstr_test_name FROM hivt_test_mst b WHERE b.gnum_isvalid = 1 AND b.gnum_test_code = a.gnum_test_code ) AS testName ,hgnum_group_code AS groupCode ,decode(hgnum_group_code, NULL, '', pkg_inv_fun.getgroupname(a.hgnum_group_code::CHARACTER VARYING, a.gnum_hospital_code)) AS groupName ,TO_CHAR(a.hivdt_requisition_date_reqd, 'DD-Mon-YYYY hh24:mi') AS requisitionDate ,DECODE(a.hivnum_reqdtl_status, 2, 'Requisition Raised', 3, 'Sample Collected', 4, 'Packing List Generated', 5, 'Requisition Raised', 6, 'Sample Accepted', 7, 'Result Entered', 8, 'Result Validated', 9, 'Patient Rejected', 10, 'Test Resceduled', 11, 'Test Rescheduled', 12, 'Sample Cancelled', 13, 'Waiting For Report', 14, 'Result Printed', 15, 'Test Cancelled', 16, 'Test Deleted', 26, 'Report Generated', 55, 'Test Advised', 17, 'Machine Processing', 18, 'Machine Processing', 27, ' Draft- Result Entry', 28, 'Draft-Result Validation') AS requisitionStatus ,hivnum_reqdtl_status as requisitionStatusCode, gbnum_priority_code ,decode(a.GBNUM_PRIORITY_CODE, 1, 'Normal', 2, 'Urgent', 3, 'Low') AS priorityName ,gnum_seat_id AS requestSeatID ,( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = a.gnum_seat_id AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS requisitionBy, ( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = hivtnum_test_delete_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS testDeleteSeatID ,TO_CHAR(a.hivtdt_test_delete_date, 'DD-Mon-YYYY hh24:mi') AS testDeleteDate ,hgstr_ordered_by_doc_reqd AS advisedByDoc, gstr_dept_name_reqd as advisedByDept, gnum_bill_no AS billNo ,'-' AS billDate ,a.hivnum_temp_sample_no AS sampleNo ,TO_CHAR(hivdt_coll_date_time, 'DD-Mon-YYYY hh24:mi') AS sampleCollDate ,( SELECT gstr_Sample_name FROM hivt_sample_mst WHERE gnum_isvalid = 1 AND gnum_sample_code = a.gnum_sample_code ) AS sampleName ,( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = hivnum_collection_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS sampleCollBy ,( SELECT gstr_area_name FROM hivt_collection_area_mst WHERE gnum_isvalid = 1 AND gnum_hospital_Code = a.gnum_hospital_code AND gnum_area_code = a.hivnum_sample_col_area_code ) AS collectionArea ,( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = hivnum_packing_list_seat_id AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS packingListBy ,TO_CHAR(hivtdt_packinglist_date_time, 'DD-Mon-YYYY hh24:mi') AS packingListDateTime ,hivnum_packing_list_no AS packingListNo ,hgstr_daily_labno as labNo ,( SELECT hmistr_machine_name FROM hmit_machine_mst WHERE gnum_isvalid = 1 AND hminum_machine_id = a.gnum_machine_code AND gnum_hospital_code = a.gnum_hospital_code ) AS machineName ,TO_CHAR(hivdt_acceptance_date_time, 'DD-Mon-YYYY hh24:mi') AS sampleAccepDate ,( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = hivdt_acceptance_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS sampleAccepBy ,TO_CHAR(hivtdt_cancellation_date, 'DD-Mon-YYYY hh24:mi') AS sampleRejecDate ,( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = a.hivtnum_cancellation_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS sampleRejecBy ,( SELECT hgstr_rejectionreason FROM hivt_Rejectionreason_mst WHERE gnum_isvalid = 1 AND hivnum_acceptance_type = 1 AND hgnum_rejectionreason_id = hivnum_sam_rejection_reason ) AS sampleRejecReason ,TO_CHAR(hivdt_result_date, 'DD-Mon-YYYY hh24:mi') resultEntryDate ,( SELECT   gstr_user_name FROM gblt_user_mst WHERE gnum_userid = a.hivnum_result_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS resultEntryBy  ,TO_CHAR(hivtdt_res_val_date, 'DD-Mon-YYYY hh24:mi') resultValDate ,( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = a.hivtnum_res_val_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS resultValBy,TO_CHAR(hivtdt_res_reval_date, 'DD-Mon-YYYY hh24:mi') resultReValDate ,( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = a.hivtnum_res_reval_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS resultReValBy ,hivstr_report_url as reportURL ,TO_CHAR(hivdt_report_date, 'DD-Mon-YYYY hh24:mi') reportGenerationDate, (hivdt_report_date - hivdt_coll_date_time) as turnAroundTime, TO_CHAR(hivtdt_res_print_date, 'DD-Mon-YYYY hh24:mi') reportPrintDate ,( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = a.hivtnum_res_print_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS reportPrintBy ,decode(is_addendum, 1, 'Addendum/AmmendmentReport', 0, '-') ,TO_CHAR(hivdt_reportchange_date, 'DD-Mon-YYYY hh24:mi') reportChangeDate ,( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = a.hivnum_reportchange_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS ReportChangeBy ,hivstr_addendum_remark_reqd AS remark ,TO_CHAR(hivdt_draft_req_datetime, 'DD-Mon-YYYY hh24:mi') draftChangeDate ,( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = a.hivnum_draft_req_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS reportDraftBy, nvl(hgnum_group_type,'0') as isGroup, decode(hgnum_group_type,null,BILL_MST.GETCHARGEDETAILS (10::character varying,a.gnum_hospital_code::character varying,hipnum_wardcode_reqd::character varying,hgnum_patient_cat_code_reqd::character varying,decode(hbnum_requisition_type_reqd,2,'2','1')::character varying,(select hblnum_tariff_id from hblt_tariff_mst where gstr_tariff_id=a.gnum_test_code and gnum_hospital_code=a.gnum_hospital_code and gnum_isvalid=1 and sblnum_service_id=1)::character varying),1,BILL_MST.GETCHARGEDETAILS (10::character varying,a.gnum_hospital_code::character varying,hipnum_wardcode_reqd::character varying,hgnum_patient_cat_code_reqd::character varying,decode(hbnum_requisition_type_reqd,2,'2','1')::character varying,(select hblnum_tariff_id from hblt_tariff_mst where gstr_tariff_id=(a.gnum_lab_code||''||a.hgnum_group_code)  and gnum_hospital_code=a.gnum_hospital_code and gnum_isvalid=1 and sblnum_service_id=4)::character varying)) as testRateDetail, Bill_Interface.func_online_bill_dtl (a.gnum_hospital_code::character varying, DECODE (NVL(a.HGNUM_GROUP_TYPE,11), NULL, a.gnum_test_code,11, a.gnum_test_code, 1,a.gnum_lab_code||a.HGNUM_GROUP_CODE, 2, a.gnum_lab_code||a.HGNUM_GROUP_CODE, 3, a.gnum_test_code)::character VARYING, DECODE (DECODE (HBNUM_REQUISITION_TYPE_reqd,2, '1', 1, '2','3' ), 1, 2, 2, 1, 3, 1 )::character varying, DECODE (NVL(a.HGNUM_GROUP_TYPE,11), 0, 1,NULL,1,11,1, 1, 4, 2, 4, 3, 1 )::character varying, (a.HIVNUM_REQ_NO||'!')::CHARACTER VARYING) as billDetail ,concatstring( 'Select k.hivnum_parameter_code||''#''|| (select INITCAP(hgstr_parameter) from hivt_parameter_mst where gnum_isvalid=1 and hgnum_parameter_id=k.hivnum_parameter_code)||''#''||k.hivtstr_value from hivt_parameter_dtl k where k.gnum_isvalid=1 and k.hivtnum_test_code = '''||a.gnum_test_code ||''' and k.hivtnum_req_dno='''|| a.hivtnum_req_dno ||''' and k.gnum_hospital_code=''' || a.gnum_hospital_code||'''' , ',' ) AS testParameterName FROM hivt_requisition_dtl a WHERE a.gnum_test_code IN ( SELECT gnum_test_code FROM hivt_test_mst WHERE gnum_isvalid = 1 AND gstr_test_type = 'S' ) AND a.hrgnum_puk_reqd = ? AND gnum_hospital_code = ? and hivnum_req_no=? and hivnum_reqdtl_status not in (16,12,9,14,26) ORDER BY hivdt_requisition_date_reqd DESC, groupName, a.hivnum_temp_sample_no DESC

#Added By chandan
SELECT_INV_TRACKING_REPORT_PATIENTBASED_TEST_ONCRNO_HIVT_REQUISITION_DTL_REPORTS= SELECT hivnum_req_no AS requisitionNo, hivtnum_req_dno requisitionDNo, a.gnum_lab_code AS labCode ,( SELECT GSTR_LAB_NAME FROM HIVT_LABORATORY_MST c WHERE c.gnum_isvalid = 1 AND c.GNUM_HOSPITAL_CODE = a.GNUM_HOSPITAL_CODE AND c.GNUM_LAB_CODE = a.GNUM_LAB_CODE ) AS labName ,a.gnum_test_code AS testCode ,( SELECT b.gstr_test_name FROM hivt_test_mst b WHERE b.gnum_isvalid = 1 AND b.gnum_test_code = a.gnum_test_code ) AS testName ,hgnum_group_code AS groupCode ,decode(hgnum_group_code, NULL, '', pkg_inv_fun.getgroupname(a.hgnum_group_code::CHARACTER VARYING, a.gnum_hospital_code)) AS groupName ,TO_CHAR(a.hivdt_requisition_date_reqd, 'DD-Mon-YYYY hh24:mi') AS requisitionDate ,DECODE(a.hivnum_reqdtl_status, 2, 'Requisition Raised', 3, 'Sample Collected', 4, 'Packing List Generated', 5, 'Requisition Raised', 6, 'Patient Accepted', 7, 'Result Entered', 8, 'Result Validated', 9, 'Patient Rejected', 10, 'Test Resceduled', 11, 'Test Rescheduled', 12, 'Sample Cancelled', 13, 'Waiting For Report', 14, 'Result Printed', 15, 'Test Cancelled', 16, 'Test Deleted', 26, 'Report Generated', 55, 'Test Advised', 17, 'Machine Processing', 18, 'Machine Processing', 27, ' Draft- Result Entry', 28, 'Draft-Result Validation') AS requisitionStatus ,hivnum_reqdtl_status as requisitionStatusCode, gbnum_priority_code ,decode(a.GBNUM_PRIORITY_CODE, 1, 'Normal', 2, 'Urgent', 3, 'Low') AS priorityName ,gnum_seat_id AS requestSeatID ,( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = a.gnum_seat_id AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS requisitionBy,( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = hivtnum_test_delete_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS testDeleteSeatID ,TO_CHAR(a.hivtdt_test_delete_date, 'DD-Mon-YYYY hh24:mi') AS testDeleteDate ,hivstr_site AS site ,hgstr_ordered_by_doc_reqd as advisedByDoc, gstr_dept_name_reqd as advisedByDept, (gnum_bill_no) AS billNo ,'-' AS billDate ,( SELECT gstr_area_name FROM hivt_collection_area_mst WHERE gnum_isvalid = 1 AND gnum_hospital_Code = a.gnum_hospital_code AND gnum_area_code = a.hivnum_sample_col_area_code ) AS collectionArea ,hgstr_daily_labno AS accessionNo ,( SELECT hmistr_machine_name FROM hmit_machine_mst WHERE gnum_isvalid = 1 AND hminum_machine_id = a.gnum_machine_code AND gnum_hospital_code = a.gnum_hospital_code ) AS machineName ,( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = hivdt_acceptance_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS patientAccepBy ,TO_CHAR(hivtdt_pat_accpt_date_time, 'DD-Mon-YYYY hh24:mi') AS patientAccepDate ,TO_CHAR(hivtdt_cancellation_date, 'DD-Mon-YYYY hh24:mi') AS patientRejecDate ,( SELECT hivtnum_cancellation_seatid FROM gblt_user_mst WHERE gnum_userid = hivdt_acceptance_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS patientRejecBy ,( SELECT hgstr_rejectionreason FROM hivt_Rejectionreason_mst WHERE gnum_isvalid = 1 AND hivnum_acceptance_type = 2 AND hgnum_rejectionreason_id = hivnum_pat_rejection_reason ) AS patientRejecReason ,TO_CHAR(hivdt_result_date, 'DD-Mon-YYYY hh24:mi') resultEntryDate ,( SELECT   gstr_user_name FROM gblt_user_mst WHERE gnum_userid = a.hivnum_result_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS resultEntryBy  ,TO_CHAR(hivtdt_res_modify_date, 'DD-Mon-YYYY hh24:mi') resultModDate ,( SELECT hivtnum_res_modify_seatid FROM gblt_user_mst WHERE gnum_userid = hivdt_acceptance_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS resModSeatId ,TO_CHAR(hivtdt_res_val_date, 'DD-Mon-YYYY hh24:mi') resultValDate ,( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = a.hivtnum_res_val_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS resultValBy ,TO_CHAR(hivtdt_res_reval_date, 'DD-Mon-YYYY hh24:mi') resultReValDate ,( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = a.hivtnum_res_reval_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS resultReValBy ,hivstr_report_url as reportURL ,TO_CHAR(hivdt_report_date, 'DD-Mon-YYYY hh24:mi') reportGenerationDate, (hivdt_report_date - hivtdt_pat_accpt_date_time) as turnAroundTime, TO_CHAR(hivtdt_res_print_date, 'DD-Mon-YYYY hh24:mi') reportPrintDate ,( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = a.hivtnum_res_print_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS reportPrintBy ,decode(is_addendum, 1, 'Addendum/AmmendmentReport', 0, '-') ,TO_CHAR(hivdt_reportchange_date, 'DD-Mon-YYYY hh24:mi') reportChangeDate ,( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = a.hivnum_reportchange_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS ReportChangeBy ,hivstr_addendum_remark_reqd AS remark ,TO_CHAR(hivdt_draft_req_datetime, 'DD-Mon-YYYY hh24:mi') draftChangeDate ,( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = a.hivnum_draft_req_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS reportDraftBy, nvl(hgnum_group_type,'0') as isGroup, decode(hgnum_group_type,null,BILL_MST.GETCHARGEDETAILS (10::character varying,a.gnum_hospital_code::character varying,hipnum_wardcode_reqd::character varying,hgnum_patient_cat_code_reqd::character varying,decode(hbnum_requisition_type_reqd,2,'2','1')::character varying,(select hblnum_tariff_id from hblt_tariff_mst where gstr_tariff_id=a.gnum_test_code and gnum_hospital_code=a.gnum_hospital_code and gnum_isvalid=1 and sblnum_service_id=1)::character varying),1,BILL_MST.GETCHARGEDETAILS (10::character varying,a.gnum_hospital_code::character varying,hipnum_wardcode_reqd::character varying,hgnum_patient_cat_code_reqd::character varying,decode(hbnum_requisition_type_reqd,2,'2','1')::character varying,(select hblnum_tariff_id from hblt_tariff_mst where gstr_tariff_id=(a.gnum_lab_code||''||a.hgnum_group_code)  and gnum_hospital_code=a.gnum_hospital_code and gnum_isvalid=1 and sblnum_service_id=4)::character varying)) as testRateDetail, Bill_Interface.func_online_bill_dtl (a.gnum_hospital_code::character varying, DECODE (NVL(a.HGNUM_GROUP_TYPE,11), NULL, a.gnum_test_code,11, a.gnum_test_code, 1,a.gnum_lab_code||a.HGNUM_GROUP_CODE, 2, a.gnum_lab_code||a.HGNUM_GROUP_CODE, 3, a.gnum_test_code)::character VARYING, DECODE (DECODE (HBNUM_REQUISITION_TYPE_reqd,2, '1', 1, '2','3' ), 1, 2, 2, 1, 3, 1 )::character varying, DECODE (NVL(a.HGNUM_GROUP_TYPE,11), 0, 1,NULL,1,11,1, 1, 4, 2, 4, 3, 1 )::character varying, (a.HIVNUM_REQ_NO||'!')::CHARACTER VARYING) as billDetail ,concatstring( 'Select k.hivnum_parameter_code||''#''|| (select INITCAP(hgstr_parameter) from hivt_parameter_mst where gnum_isvalid=1 and hgnum_parameter_id=k.hivnum_parameter_code)||''#''||k.hivtstr_value from hivt_parameter_dtl k where k.gnum_isvalid=1 and k.hivtnum_test_code = '''||a.gnum_test_code ||''' and k.hivtnum_req_dno='''|| a.hivtnum_req_dno ||''' and k.gnum_hospital_code=''' || a.gnum_hospital_code||'''' , ',' ) AS testParameterName FROM hivt_requisition_dtl a WHERE a.gnum_test_code IN ( SELECT gnum_test_code FROM hivt_test_mst WHERE gnum_isvalid = 1 AND gstr_test_type = 'P' ) AND a.hrgnum_puk_reqd = ? AND gnum_hospital_code = ?  and hivnum_reqdtl_status not in (16,12,9,14,26) and hivnum_req_no=?  ORDER BY hivdt_requisition_date_reqd DESC, groupName, a.hivnum_temp_sample_no DESC 

#Added By chandan
SELECT_INV_TRACKING_REPORT_TESTPARAM_ONCRNO_HIVT_REQUISITION_DTL_REPORTS= SELECT hivnum_req_no AS requisitionNo, hivtnum_req_dno requisitionDNo, a.gnum_test_code AS testCode ,( SELECT b.gstr_test_name FROM hivt_test_mst b WHERE b.gnum_isvalid = 1 AND b.gnum_test_code = a.gnum_test_code ) AS testName ,hgnum_group_code AS groupCode ,decode(hgnum_group_code, NULL, '', pkg_inv_fun.getgroupname(a.hgnum_group_code::CHARACTER VARYING, a.gnum_hospital_code)) AS groupName ,TO_CHAR(a.hivdt_requisition_date_reqd, 'DD-Mon-YYYY hh24:mi') AS requisitionDate ,DECODE(a.hivnum_reqdtl_status, 2, 'Requisition Raised', 3, 'Sample Collected', 4, 'Packing List Generated', 5, 'Requisition Raised', 6, 'Sample Accepted', 7, 'Result Entered', 8, 'Result Validated', 9, 'Patient Rejected', 10, 'Test Resceduled', 11, 'Test Rescheduled', 12, 'Sample Cancelled', 13, 'Waiting For Report', 14, 'Result Printed', 15, 'Test Cancelled', 16, 'Test Deleted', 26, 'Report Generated', 55, 'Test Advised', 17, 'Machine Processing', 18, 'Machine Processing', 27, ' Draft- Result Entry', 28, 'Draft-Result Validation') AS requisitionStatus ,hivnum_reqdtl_status AS requisitionStatusCode ,a.hivnum_temp_sample_no AS sampleNo ,( SELECT gstr_Sample_name FROM hivt_sample_mst WHERE gnum_isvalid = 1 AND gnum_sample_code = a.gnum_sample_code ) AS sampleName , hgstr_daily_labno AS accessionNo ,( SELECT hmistr_machine_name FROM hmit_machine_mst WHERE gnum_isvalid = 1 AND hminum_machine_id = a.gnum_machine_code AND gnum_hospital_code = a.gnum_hospital_code ) AS machineName, TO_CHAR(hivdt_result_date, 'DD-Mon-YYYY hh24:mi') resultEntryDate ,TO_CHAR(hivtdt_res_val_date, 'DD-Mon-YYYY hh24:mi') resultValDate ,TO_CHAR(hivtdt_res_reval_date, 'DD-Mon-YYYY hh24:mi') resultValidDate ,TO_CHAR(hivdt_reportchange_date, 'DD-Mon-YYYY hh24:mi') reportChangeDate ,NVL(hgnum_group_type,'0') AS isGroup ,concatstring('Select k.hivnum_parameter_code||''#''|| (select INITCAP(hgstr_parameter) from hivt_parameter_mst where gnum_isvalid=1 and hgnum_parameter_id=k.hivnum_parameter_code)||''#''||k.hivtstr_value ||''#''||nvl(hivstr_referencerange,'''')||''#''||nvl(hivt_isinrefrange,''0'') from hivt_parameter_dtl k where k.gnum_isvalid=1 and k.hivtnum_test_code = ''' || a.gnum_test_code || ''' and k.hivtnum_req_dno=''' || a.hivtnum_req_dno || ''' and k.gnum_hospital_code=''' || a.gnum_hospital_code || '''', ',') AS testParameterDetails FROM hivt_requisition_dtl a WHERE a.hrgnum_puk_reqd = ? AND gnum_hospital_code = ? and hivnum_reqdtl_status not in (16,12,9,14,26) and hivnum_req_no=? ORDER BY hivdt_requisition_date_reqd desc, testCode,groupCode ,a.hivnum_temp_sample_no DESC


#Added By chandan
SELECT_INV_TRACKING_REPORT_SAMPLEBASED_TEST_ONCRNO_HIVT_REQUISITION_DTL_REPORTS_GENE= SELECT hivnum_req_no AS requisitionNo, hivtnum_req_dno requisitionDNo, a.gnum_lab_code AS labCode ,( SELECT GSTR_LAB_NAME FROM HIVT_LABORATORY_MST c WHERE c.gnum_isvalid = 1 AND c.GNUM_HOSPITAL_CODE = a.GNUM_HOSPITAL_CODE AND c.GNUM_LAB_CODE = a.GNUM_LAB_CODE ) AS labName ,a.gnum_test_code AS testCode ,( SELECT b.gstr_test_name FROM hivt_test_mst b WHERE b.gnum_isvalid = 1 AND b.gnum_test_code = a.gnum_test_code ) AS testName ,hgnum_group_code AS groupCode ,decode(hgnum_group_code, NULL, '', pkg_inv_fun.getgroupname(a.hgnum_group_code::CHARACTER VARYING, a.gnum_hospital_code)) AS groupName ,TO_CHAR(a.hivdt_requisition_date_reqd, 'DD-Mon-YYYY hh24:mi') AS requisitionDate ,DECODE(a.hivnum_reqdtl_status, 2, 'Requisition Raised', 3, 'Sample Collected', 4, 'Packing List Generated', 5, 'Requisition Raised', 6, 'Sample Accepted', 7, 'Result Entered', 8, 'Result Validated', 9, 'Patient Rejected', 10, 'Test Resceduled', 11, 'Test Rescheduled', 12, 'Sample Cancelled', 13, 'Waiting For Report', 14, 'Result Printed', 15, 'Test Cancelled', 16, 'Test Deleted', 26, 'Report Generated', 55, 'Test Advised', 17, 'Machine Processing', 18, 'Machine Processing', 27, ' Draft- Result Entry', 28, 'Draft-Result Validation') AS requisitionStatus ,hivnum_reqdtl_status as requisitionStatusCode, gbnum_priority_code ,decode(a.GBNUM_PRIORITY_CODE, 1, 'Normal', 2, 'Urgent', 3, 'Low') AS priorityName ,gnum_seat_id AS requestSeatID ,( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = a.gnum_seat_id AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS requisitionBy, ( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = hivtnum_test_delete_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS testDeleteSeatID ,TO_CHAR(a.hivtdt_test_delete_date, 'DD-Mon-YYYY hh24:mi') AS testDeleteDate ,hgstr_ordered_by_doc_reqd AS advisedByDoc, gstr_dept_name_reqd as advisedByDept, gnum_bill_no AS billNo ,'-' AS billDate ,a.hivnum_temp_sample_no AS sampleNo ,TO_CHAR(hivdt_coll_date_time, 'DD-Mon-YYYY hh24:mi') AS sampleCollDate ,( SELECT gstr_Sample_name FROM hivt_sample_mst WHERE gnum_isvalid = 1 AND gnum_sample_code = a.gnum_sample_code ) AS sampleName ,( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = hivnum_collection_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS sampleCollBy ,( SELECT gstr_area_name FROM hivt_collection_area_mst WHERE gnum_isvalid = 1 AND gnum_hospital_Code = a.gnum_hospital_code AND gnum_area_code = a.hivnum_sample_col_area_code ) AS collectionArea ,( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = hivnum_packing_list_seat_id AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS packingListBy ,TO_CHAR(hivtdt_packinglist_date_time, 'DD-Mon-YYYY hh24:mi') AS packingListDateTime ,hivnum_packing_list_no AS packingListNo ,hgstr_daily_labno as labNo ,( SELECT hmistr_machine_name FROM hmit_machine_mst WHERE gnum_isvalid = 1 AND hminum_machine_id = a.gnum_machine_code AND gnum_hospital_code = a.gnum_hospital_code ) AS machineName ,TO_CHAR(hivdt_acceptance_date_time, 'DD-Mon-YYYY hh24:mi') AS sampleAccepDate ,( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = hivdt_acceptance_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS sampleAccepBy ,TO_CHAR(hivtdt_cancellation_date, 'DD-Mon-YYYY hh24:mi') AS sampleRejecDate ,( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = a.hivtnum_cancellation_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS sampleRejecBy ,( SELECT hgstr_rejectionreason FROM hivt_Rejectionreason_mst WHERE gnum_isvalid = 1 AND hivnum_acceptance_type = 1 AND hgnum_rejectionreason_id = hivnum_sam_rejection_reason ) AS sampleRejecReason ,TO_CHAR(hivdt_result_date, 'DD-Mon-YYYY hh24:mi') resultEntryDate ,( SELECT   gstr_user_name FROM gblt_user_mst WHERE gnum_userid = a.hivnum_result_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS resultEntryBy  ,TO_CHAR(hivtdt_res_val_date, 'DD-Mon-YYYY hh24:mi') resultValDate ,( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = a.hivtnum_res_val_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS resultValBy,TO_CHAR(hivtdt_res_reval_date, 'DD-Mon-YYYY hh24:mi') resultReValDate ,( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = a.hivtnum_res_reval_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS resultReValBy ,hivstr_report_url as reportURL ,TO_CHAR(hivdt_report_date, 'DD-Mon-YYYY hh24:mi') reportGenerationDate, (hivdt_report_date - hivdt_coll_date_time) as turnAroundTime, TO_CHAR(hivtdt_res_print_date, 'DD-Mon-YYYY hh24:mi') reportPrintDate ,( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = a.hivtnum_res_print_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS reportPrintBy ,decode(is_addendum, 1, 'Addendum/AmmendmentReport', 0, '-') ,TO_CHAR(hivdt_reportchange_date, 'DD-Mon-YYYY hh24:mi') reportChangeDate ,( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = a.hivnum_reportchange_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS ReportChangeBy ,hivstr_addendum_remark_reqd AS remark ,TO_CHAR(hivdt_draft_req_datetime, 'DD-Mon-YYYY hh24:mi') draftChangeDate ,( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = a.hivnum_draft_req_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS reportDraftBy, nvl(hgnum_group_type,'0') as isGroup, decode(hgnum_group_type,null,BILL_MST.GETCHARGEDETAILS (10::character varying,a.gnum_hospital_code::character varying,hipnum_wardcode_reqd::character varying,hgnum_patient_cat_code_reqd::character varying,decode(hbnum_requisition_type_reqd,2,'2','1')::character varying,(select hblnum_tariff_id from hblt_tariff_mst where gstr_tariff_id=a.gnum_test_code and gnum_hospital_code=a.gnum_hospital_code and gnum_isvalid=1 and sblnum_service_id=1)::character varying),1,BILL_MST.GETCHARGEDETAILS (10::character varying,a.gnum_hospital_code::character varying,hipnum_wardcode_reqd::character varying,hgnum_patient_cat_code_reqd::character varying,decode(hbnum_requisition_type_reqd,2,'2','1')::character varying,(select hblnum_tariff_id from hblt_tariff_mst where gstr_tariff_id=(a.gnum_lab_code||''||a.hgnum_group_code)  and gnum_hospital_code=a.gnum_hospital_code and gnum_isvalid=1 and sblnum_service_id=4)::character varying)) as testRateDetail, Bill_Interface.func_online_bill_dtl (a.gnum_hospital_code::character varying, DECODE (NVL(a.HGNUM_GROUP_TYPE,11), NULL, a.gnum_test_code,11, a.gnum_test_code, 1,a.gnum_lab_code||a.HGNUM_GROUP_CODE, 2, a.gnum_lab_code||a.HGNUM_GROUP_CODE, 3, a.gnum_test_code)::character VARYING, DECODE (DECODE (HBNUM_REQUISITION_TYPE_reqd,2, '1', 1, '2','3' ), 1, 2, 2, 1, 3, 1 )::character varying, DECODE (NVL(a.HGNUM_GROUP_TYPE,11), 0, 1,NULL,1,11,1, 1, 4, 2, 4, 3, 1 )::character varying, (a.HIVNUM_REQ_NO||'!')::CHARACTER VARYING) as billDetail ,concatstring( 'Select k.hivnum_parameter_code||''#''|| (select INITCAP(hgstr_parameter) from hivt_parameter_mst where gnum_isvalid=1 and hgnum_parameter_id=k.hivnum_parameter_code)||''#''||k.hivtstr_value from hivt_parameter_dtl k where k.gnum_isvalid=1 and k.hivtnum_test_code = '''||a.gnum_test_code ||''' and k.hivtnum_req_dno='''|| a.hivtnum_req_dno ||''' and k.gnum_hospital_code=''' || a.gnum_hospital_code||'''' , ',' ) AS testParameterName FROM hivt_requisition_dtl a WHERE a.gnum_test_code IN ( SELECT gnum_test_code FROM hivt_test_mst WHERE gnum_isvalid = 1 AND gstr_test_type = 'S' ) AND a.hrgnum_puk_reqd = ? AND gnum_hospital_code = ? and hivnum_req_no=? and hivnum_reqdtl_status  in (16,12,9,14,26) ORDER BY hivdt_requisition_date_reqd DESC, groupName, a.hivnum_temp_sample_no DESC

#Added By chandan
SELECT_INV_TRACKING_REPORT_SAMPLEBASED_TEST_ONCRNO_HIVT_REQUISITION_DTL_REPORTS_GENE1= SELECT hivnum_req_no AS requisitionNo, hivtnum_req_dno requisitionDNo, a.gnum_lab_code AS labCode ,( SELECT GSTR_LAB_NAME FROM HIVT_LABORATORY_MST c WHERE c.gnum_isvalid = 1 AND c.GNUM_HOSPITAL_CODE = a.GNUM_HOSPITAL_CODE AND c.GNUM_LAB_CODE = a.GNUM_LAB_CODE ) AS labName ,a.gnum_test_code AS testCode ,( SELECT b.gstr_test_name FROM hivt_test_mst b WHERE b.gnum_isvalid = 1 AND b.gnum_test_code = a.gnum_test_code ) AS testName ,hgnum_group_code AS groupCode ,decode(hgnum_group_code, NULL, '', pkg_inv_fun.getgroupname(a.hgnum_group_code::CHARACTER VARYING, a.gnum_hospital_code)) AS groupName ,TO_CHAR(a.hivdt_requisition_date_reqd, 'DD-Mon-YYYY hh24:mi') AS requisitionDate ,DECODE(a.hivnum_reqdtl_status, 2, 'Requisition Raised', 3, 'Sample Collected', 4, 'Packing List Generated', 5, 'Requisition Raised', 6, 'Sample Accepted', 7, 'Result Entered', 8, 'Result Validated', 9, 'Patient Rejected', 10, 'Test Resceduled', 11, 'Test Rescheduled', 12, 'Sample Cancelled', 13, 'Waiting For Report', 14, 'Result Printed', 15, 'Test Cancelled', 16, 'Test Deleted', 26, 'Report Generated', 55, 'Test Advised', 17, 'Machine Processing', 18, 'Machine Processing', 27, ' Draft- Result Entry', 28, 'Draft-Result Validation') AS requisitionStatus ,hivnum_reqdtl_status as requisitionStatusCode, gbnum_priority_code ,decode(a.GBNUM_PRIORITY_CODE, 1, 'Normal', 2, 'Urgent', 3, 'Low') AS priorityName ,gnum_seat_id AS requestSeatID ,( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = a.gnum_seat_id AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS requisitionBy, ( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = hivtnum_test_delete_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS testDeleteSeatID ,TO_CHAR(a.hivtdt_test_delete_date, 'DD-Mon-YYYY hh24:mi') AS testDeleteDate ,hgstr_ordered_by_doc_reqd AS advisedByDoc, gstr_dept_name_reqd as advisedByDept, gnum_bill_no AS billNo ,'-' AS billDate ,a.hivnum_temp_sample_no AS sampleNo ,TO_CHAR(hivdt_coll_date_time, 'DD-Mon-YYYY hh24:mi') AS sampleCollDate ,( SELECT gstr_Sample_name FROM hivt_sample_mst WHERE gnum_isvalid = 1 AND gnum_sample_code = a.gnum_sample_code ) AS sampleName ,( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = hivnum_collection_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS sampleCollBy ,( SELECT gstr_area_name FROM hivt_collection_area_mst WHERE gnum_isvalid = 1 AND gnum_hospital_Code = a.gnum_hospital_code AND gnum_area_code = a.hivnum_sample_col_area_code ) AS collectionArea ,( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = hivnum_packing_list_seat_id AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS packingListBy ,TO_CHAR(hivtdt_packinglist_date_time, 'DD-Mon-YYYY hh24:mi') AS packingListDateTime ,hivnum_packing_list_no AS packingListNo ,hgstr_daily_labno as labNo ,( SELECT hmistr_machine_name FROM hmit_machine_mst WHERE gnum_isvalid = 1 AND hminum_machine_id = a.gnum_machine_code AND gnum_hospital_code = a.gnum_hospital_code ) AS machineName ,TO_CHAR(hivdt_acceptance_date_time, 'DD-Mon-YYYY hh24:mi') AS sampleAccepDate ,( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = hivdt_acceptance_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS sampleAccepBy ,TO_CHAR(hivtdt_cancellation_date, 'DD-Mon-YYYY hh24:mi') AS sampleRejecDate ,( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = a.hivtnum_cancellation_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS sampleRejecBy ,( SELECT hgstr_rejectionreason FROM hivt_Rejectionreason_mst WHERE gnum_isvalid = 1 AND hivnum_acceptance_type = 1 AND hgnum_rejectionreason_id = hivnum_sam_rejection_reason ) AS sampleRejecReason ,TO_CHAR(hivdt_result_date, 'DD-Mon-YYYY hh24:mi') resultEntryDate ,( SELECT   gstr_user_name FROM gblt_user_mst WHERE gnum_userid = a.hivnum_result_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS resultEntryBy  ,TO_CHAR(hivtdt_res_val_date, 'DD-Mon-YYYY hh24:mi') resultValDate ,( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = a.hivtnum_res_val_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS resultValBy,TO_CHAR(hivtdt_res_reval_date, 'DD-Mon-YYYY hh24:mi') resultReValDate ,( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = a.hivtnum_res_reval_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS resultReValBy ,hivstr_report_url as reportURL ,TO_CHAR(hivdt_report_date, 'DD-Mon-YYYY hh24:mi') reportGenerationDate, (hivdt_report_date - hivdt_coll_date_time) as turnAroundTime, TO_CHAR(hivtdt_res_print_date, 'DD-Mon-YYYY hh24:mi') reportPrintDate ,( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = a.hivtnum_res_print_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS reportPrintBy ,decode(is_addendum, 1, 'Addendum/AmmendmentReport', 0, '-') ,TO_CHAR(hivdt_reportchange_date, 'DD-Mon-YYYY hh24:mi') reportChangeDate ,( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = a.hivnum_reportchange_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS ReportChangeBy ,hivstr_addendum_remark_reqd AS remark ,TO_CHAR(hivdt_draft_req_datetime, 'DD-Mon-YYYY hh24:mi') draftChangeDate ,( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = a.hivnum_draft_req_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS reportDraftBy, nvl(hgnum_group_type,'0') as isGroup, decode(hgnum_group_type,null,BILL_MST.GETCHARGEDETAILS (10::character varying,a.gnum_hospital_code::character varying,hipnum_wardcode_reqd::character varying,hgnum_patient_cat_code_reqd::character varying,decode(hbnum_requisition_type_reqd,2,'2','1')::character varying,(select hblnum_tariff_id from hblt_tariff_mst where gstr_tariff_id=a.gnum_test_code and gnum_hospital_code=a.gnum_hospital_code and gnum_isvalid=1 and sblnum_service_id=1)::character varying),1,BILL_MST.GETCHARGEDETAILS (10::character varying,a.gnum_hospital_code::character varying,hipnum_wardcode_reqd::character varying,hgnum_patient_cat_code_reqd::character varying,decode(hbnum_requisition_type_reqd,2,'2','1')::character varying,(select hblnum_tariff_id from hblt_tariff_mst where gstr_tariff_id=(a.gnum_lab_code||''||a.hgnum_group_code)  and gnum_hospital_code=a.gnum_hospital_code and gnum_isvalid=1 and sblnum_service_id=4)::character varying)) as testRateDetail, Bill_Interface.func_online_bill_dtl (a.gnum_hospital_code::character varying, DECODE (NVL(a.HGNUM_GROUP_TYPE,11), NULL, a.gnum_test_code,11, a.gnum_test_code, 1,a.gnum_lab_code||a.HGNUM_GROUP_CODE, 2, a.gnum_lab_code||a.HGNUM_GROUP_CODE, 3, a.gnum_test_code)::character VARYING, DECODE (DECODE (HBNUM_REQUISITION_TYPE_reqd,2, '1', 1, '2','3' ), 1, 2, 2, 1, 3, 1 )::character varying, DECODE (NVL(a.HGNUM_GROUP_TYPE,11), 0, 1,NULL,1,11,1, 1, 4, 2, 4, 3, 1 )::character varying, (a.HIVNUM_REQ_NO||'!')::CHARACTER VARYING) as billDetail ,concatstring( 'Select k.hivnum_parameter_code||''#''|| (select INITCAP(hgstr_parameter) from hivt_parameter_mst where gnum_isvalid=1 and hgnum_parameter_id=k.hivnum_parameter_code)||''#''||k.hivtstr_value from hivt_parameter_dtl k where k.gnum_isvalid=1 and k.hivtnum_test_code = '''||a.gnum_test_code ||''' and k.hivtnum_req_dno='''|| a.hivtnum_req_dno ||''' and k.gnum_hospital_code=''' || a.gnum_hospital_code||'''' , ',' ) AS testParameterName FROM hivt_requisition_dtl a WHERE a.gnum_test_code IN ( SELECT gnum_test_code FROM hivt_test_mst WHERE gnum_isvalid = 1 AND gstr_test_type = 'S' ) AND a.hrgnum_puk_reqd = ? AND gnum_hospital_code = ? and hivnum_req_no=? and hivnum_reqdtl_status  in (2) ORDER BY hivdt_requisition_date_reqd DESC, groupName, a.hivnum_temp_sample_no DESC

#Added By chandan
SELECT_INV_TRACKING_REPORT_PATIENTBASED_TEST_ONCRNO_HIVT_REQUISITION_DTL_REPORTS_GENE= SELECT hivnum_req_no AS requisitionNo, hivtnum_req_dno requisitionDNo, a.gnum_lab_code AS labCode ,( SELECT GSTR_LAB_NAME FROM HIVT_LABORATORY_MST c WHERE c.gnum_isvalid = 1 AND c.GNUM_HOSPITAL_CODE = a.GNUM_HOSPITAL_CODE AND c.GNUM_LAB_CODE = a.GNUM_LAB_CODE ) AS labName ,a.gnum_test_code AS testCode ,( SELECT b.gstr_test_name FROM hivt_test_mst b WHERE b.gnum_isvalid = 1 AND b.gnum_test_code = a.gnum_test_code ) AS testName ,hgnum_group_code AS groupCode ,decode(hgnum_group_code, NULL, '', pkg_inv_fun.getgroupname(a.hgnum_group_code::CHARACTER VARYING, a.gnum_hospital_code)) AS groupName ,TO_CHAR(a.hivdt_requisition_date_reqd, 'DD-Mon-YYYY hh24:mi') AS requisitionDate ,DECODE(a.hivnum_reqdtl_status, 2, 'Requisition Raised', 3, 'Sample Collected', 4, 'Packing List Generated', 5, 'Requisition Raised', 6, 'Patient Accepted', 7, 'Result Entered', 8, 'Result Validated', 9, 'Patient Rejected', 10, 'Test Resceduled', 11, 'Test Rescheduled', 12, 'Sample Cancelled', 13, 'Waiting For Report', 14, 'Result Printed', 15, 'Test Cancelled', 16, 'Test Deleted', 26, 'Report Generated', 55, 'Test Advised', 17, 'Machine Processing', 18, 'Machine Processing', 27, ' Draft- Result Entry', 28, 'Draft-Result Validation') AS requisitionStatus ,hivnum_reqdtl_status as requisitionStatusCode, gbnum_priority_code ,decode(a.GBNUM_PRIORITY_CODE, 1, 'Normal', 2, 'Urgent', 3, 'Low') AS priorityName ,gnum_seat_id AS requestSeatID ,( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = a.gnum_seat_id AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS requisitionBy,( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = hivtnum_test_delete_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS testDeleteSeatID ,TO_CHAR(a.hivtdt_test_delete_date, 'DD-Mon-YYYY hh24:mi') AS testDeleteDate ,hivstr_site AS site ,hgstr_ordered_by_doc_reqd as advisedByDoc, gstr_dept_name_reqd as advisedByDept, (gnum_bill_no) AS billNo ,'-' AS billDate ,( SELECT gstr_area_name FROM hivt_collection_area_mst WHERE gnum_isvalid = 1 AND gnum_hospital_Code = a.gnum_hospital_code AND gnum_area_code = a.hivnum_sample_col_area_code ) AS collectionArea ,hgstr_daily_labno AS accessionNo ,( SELECT hmistr_machine_name FROM hmit_machine_mst WHERE gnum_isvalid = 1 AND hminum_machine_id = a.gnum_machine_code AND gnum_hospital_code = a.gnum_hospital_code ) AS machineName ,( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = hivdt_acceptance_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS patientAccepBy ,TO_CHAR(hivtdt_pat_accpt_date_time, 'DD-Mon-YYYY hh24:mi') AS patientAccepDate ,TO_CHAR(hivtdt_cancellation_date, 'DD-Mon-YYYY hh24:mi') AS patientRejecDate ,( SELECT hivtnum_cancellation_seatid FROM gblt_user_mst WHERE gnum_userid = hivdt_acceptance_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS patientRejecBy ,( SELECT hgstr_rejectionreason FROM hivt_Rejectionreason_mst WHERE gnum_isvalid = 1 AND hivnum_acceptance_type = 2 AND hgnum_rejectionreason_id = hivnum_pat_rejection_reason ) AS patientRejecReason ,TO_CHAR(hivdt_result_date, 'DD-Mon-YYYY hh24:mi') resultEntryDate ,( SELECT   gstr_user_name FROM gblt_user_mst WHERE gnum_userid = a.hivnum_result_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS resultEntryBy  ,TO_CHAR(hivtdt_res_modify_date, 'DD-Mon-YYYY hh24:mi') resultModDate ,( SELECT hivtnum_res_modify_seatid FROM gblt_user_mst WHERE gnum_userid = hivdt_acceptance_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS resModSeatId ,TO_CHAR(hivtdt_res_val_date, 'DD-Mon-YYYY hh24:mi') resultValDate ,( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = a.hivtnum_res_val_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS resultValBy ,TO_CHAR(hivtdt_res_reval_date, 'DD-Mon-YYYY hh24:mi') resultReValDate ,( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = a.hivtnum_res_reval_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS resultReValBy ,hivstr_report_url as reportURL ,TO_CHAR(hivdt_report_date, 'DD-Mon-YYYY hh24:mi') reportGenerationDate, (hivdt_report_date - hivtdt_pat_accpt_date_time) as turnAroundTime, TO_CHAR(hivtdt_res_print_date, 'DD-Mon-YYYY hh24:mi') reportPrintDate ,( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = a.hivtnum_res_print_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS reportPrintBy ,decode(is_addendum, 1, 'Addendum/AmmendmentReport', 0, '-') ,TO_CHAR(hivdt_reportchange_date, 'DD-Mon-YYYY hh24:mi') reportChangeDate ,( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = a.hivnum_reportchange_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS ReportChangeBy ,hivstr_addendum_remark_reqd AS remark ,TO_CHAR(hivdt_draft_req_datetime, 'DD-Mon-YYYY hh24:mi') draftChangeDate ,( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = a.hivnum_draft_req_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS reportDraftBy, nvl(hgnum_group_type,'0') as isGroup, decode(hgnum_group_type,null,BILL_MST.GETCHARGEDETAILS (10::character varying,a.gnum_hospital_code::character varying,hipnum_wardcode_reqd::character varying,hgnum_patient_cat_code_reqd::character varying,decode(hbnum_requisition_type_reqd,2,'2','1')::character varying,(select hblnum_tariff_id from hblt_tariff_mst where gstr_tariff_id=a.gnum_test_code and gnum_hospital_code=a.gnum_hospital_code and gnum_isvalid=1 and sblnum_service_id=1)::character varying),1,BILL_MST.GETCHARGEDETAILS (10::character varying,a.gnum_hospital_code::character varying,hipnum_wardcode_reqd::character varying,hgnum_patient_cat_code_reqd::character varying,decode(hbnum_requisition_type_reqd,2,'2','1')::character varying,(select hblnum_tariff_id from hblt_tariff_mst where gstr_tariff_id=(a.gnum_lab_code||''||a.hgnum_group_code)  and gnum_hospital_code=a.gnum_hospital_code and gnum_isvalid=1 and sblnum_service_id=4)::character varying)) as testRateDetail, Bill_Interface.func_online_bill_dtl (a.gnum_hospital_code::character varying, DECODE (NVL(a.HGNUM_GROUP_TYPE,11), NULL, a.gnum_test_code,11, a.gnum_test_code, 1,a.gnum_lab_code||a.HGNUM_GROUP_CODE, 2, a.gnum_lab_code||a.HGNUM_GROUP_CODE, 3, a.gnum_test_code)::character VARYING, DECODE (DECODE (HBNUM_REQUISITION_TYPE_reqd,2, '1', 1, '2','3' ), 1, 2, 2, 1, 3, 1 )::character varying, DECODE (NVL(a.HGNUM_GROUP_TYPE,11), 0, 1,NULL,1,11,1, 1, 4, 2, 4, 3, 1 )::character varying, (a.HIVNUM_REQ_NO||'!')::CHARACTER VARYING) as billDetail ,concatstring( 'Select k.hivnum_parameter_code||''#''|| (select INITCAP(hgstr_parameter) from hivt_parameter_mst where gnum_isvalid=1 and hgnum_parameter_id=k.hivnum_parameter_code)||''#''||k.hivtstr_value from hivt_parameter_dtl k where k.gnum_isvalid=1 and k.hivtnum_test_code = '''||a.gnum_test_code ||''' and k.hivtnum_req_dno='''|| a.hivtnum_req_dno ||''' and k.gnum_hospital_code=''' || a.gnum_hospital_code||'''' , ',' ) AS testParameterName FROM hivt_requisition_dtl a WHERE a.gnum_test_code IN ( SELECT gnum_test_code FROM hivt_test_mst WHERE gnum_isvalid = 1 AND gstr_test_type = 'P' ) AND a.hrgnum_puk_reqd = ? AND gnum_hospital_code = ?  and hivnum_reqdtl_status  in (16,12,9,14,26) and hivnum_req_no=?  ORDER BY hivdt_requisition_date_reqd DESC, groupName, a.hivnum_temp_sample_no DESC 

#Added By chandan
SELECT_INV_TRACKING_REPORT_PATIENTBASED_TEST_ONCRNO_HIVT_REQUISITION_DTL_REPORTS_GENE1= SELECT hivnum_req_no AS requisitionNo, hivtnum_req_dno requisitionDNo, a.gnum_lab_code AS labCode ,( SELECT GSTR_LAB_NAME FROM HIVT_LABORATORY_MST c WHERE c.gnum_isvalid = 1 AND c.GNUM_HOSPITAL_CODE = a.GNUM_HOSPITAL_CODE AND c.GNUM_LAB_CODE = a.GNUM_LAB_CODE ) AS labName ,a.gnum_test_code AS testCode ,( SELECT b.gstr_test_name FROM hivt_test_mst b WHERE b.gnum_isvalid = 1 AND b.gnum_test_code = a.gnum_test_code ) AS testName ,hgnum_group_code AS groupCode ,decode(hgnum_group_code, NULL, '', pkg_inv_fun.getgroupname(a.hgnum_group_code::CHARACTER VARYING, a.gnum_hospital_code)) AS groupName ,TO_CHAR(a.hivdt_requisition_date_reqd, 'DD-Mon-YYYY hh24:mi') AS requisitionDate ,DECODE(a.hivnum_reqdtl_status, 2, 'Requisition Raised', 3, 'Sample Collected', 4, 'Packing List Generated', 5, 'Requisition Raised', 6, 'Patient Accepted', 7, 'Result Entered', 8, 'Result Validated', 9, 'Patient Rejected', 10, 'Test Resceduled', 11, 'Test Rescheduled', 12, 'Sample Cancelled', 13, 'Waiting For Report', 14, 'Result Printed', 15, 'Test Cancelled', 16, 'Test Deleted', 26, 'Report Generated', 55, 'Test Advised', 17, 'Machine Processing', 18, 'Machine Processing', 27, ' Draft- Result Entry', 28, 'Draft-Result Validation') AS requisitionStatus ,hivnum_reqdtl_status as requisitionStatusCode, gbnum_priority_code ,decode(a.GBNUM_PRIORITY_CODE, 1, 'Normal', 2, 'Urgent', 3, 'Low') AS priorityName ,gnum_seat_id AS requestSeatID ,( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = a.gnum_seat_id AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS requisitionBy,( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = hivtnum_test_delete_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS testDeleteSeatID ,TO_CHAR(a.hivtdt_test_delete_date, 'DD-Mon-YYYY hh24:mi') AS testDeleteDate ,hivstr_site AS site ,hgstr_ordered_by_doc_reqd as advisedByDoc, gstr_dept_name_reqd as advisedByDept, (gnum_bill_no) AS billNo ,'-' AS billDate ,( SELECT gstr_area_name FROM hivt_collection_area_mst WHERE gnum_isvalid = 1 AND gnum_hospital_Code = a.gnum_hospital_code AND gnum_area_code = a.hivnum_sample_col_area_code ) AS collectionArea ,hgstr_daily_labno AS accessionNo ,( SELECT hmistr_machine_name FROM hmit_machine_mst WHERE gnum_isvalid = 1 AND hminum_machine_id = a.gnum_machine_code AND gnum_hospital_code = a.gnum_hospital_code ) AS machineName ,( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = hivdt_acceptance_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS patientAccepBy ,TO_CHAR(hivtdt_pat_accpt_date_time, 'DD-Mon-YYYY hh24:mi') AS patientAccepDate ,TO_CHAR(hivtdt_cancellation_date, 'DD-Mon-YYYY hh24:mi') AS patientRejecDate ,( SELECT hivtnum_cancellation_seatid FROM gblt_user_mst WHERE gnum_userid = hivdt_acceptance_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS patientRejecBy ,( SELECT hgstr_rejectionreason FROM hivt_Rejectionreason_mst WHERE gnum_isvalid = 1 AND hivnum_acceptance_type = 2 AND hgnum_rejectionreason_id = hivnum_pat_rejection_reason ) AS patientRejecReason ,TO_CHAR(hivdt_result_date, 'DD-Mon-YYYY hh24:mi') resultEntryDate ,( SELECT   gstr_user_name FROM gblt_user_mst WHERE gnum_userid = a.hivnum_result_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS resultEntryBy  ,TO_CHAR(hivtdt_res_modify_date, 'DD-Mon-YYYY hh24:mi') resultModDate ,( SELECT hivtnum_res_modify_seatid FROM gblt_user_mst WHERE gnum_userid = hivdt_acceptance_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS resModSeatId ,TO_CHAR(hivtdt_res_val_date, 'DD-Mon-YYYY hh24:mi') resultValDate ,( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = a.hivtnum_res_val_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS resultValBy ,TO_CHAR(hivtdt_res_reval_date, 'DD-Mon-YYYY hh24:mi') resultReValDate ,( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = a.hivtnum_res_reval_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS resultReValBy ,hivstr_report_url as reportURL ,TO_CHAR(hivdt_report_date, 'DD-Mon-YYYY hh24:mi') reportGenerationDate, (hivdt_report_date - hivtdt_pat_accpt_date_time) as turnAroundTime, TO_CHAR(hivtdt_res_print_date, 'DD-Mon-YYYY hh24:mi') reportPrintDate ,( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = a.hivtnum_res_print_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS reportPrintBy ,decode(is_addendum, 1, 'Addendum/AmmendmentReport', 0, '-') ,TO_CHAR(hivdt_reportchange_date, 'DD-Mon-YYYY hh24:mi') reportChangeDate ,( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = a.hivnum_reportchange_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS ReportChangeBy ,hivstr_addendum_remark_reqd AS remark ,TO_CHAR(hivdt_draft_req_datetime, 'DD-Mon-YYYY hh24:mi') draftChangeDate ,( SELECT gstr_user_name FROM gblt_user_mst WHERE gnum_userid = a.hivnum_draft_req_seatid AND gnum_isvalid = 1 AND gnum_hospital_code = a.gnum_hospital_code ) AS reportDraftBy, nvl(hgnum_group_type,'0') as isGroup, decode(hgnum_group_type,null,BILL_MST.GETCHARGEDETAILS (10::character varying,a.gnum_hospital_code::character varying,hipnum_wardcode_reqd::character varying,hgnum_patient_cat_code_reqd::character varying,decode(hbnum_requisition_type_reqd,2,'2','1')::character varying,(select hblnum_tariff_id from hblt_tariff_mst where gstr_tariff_id=a.gnum_test_code and gnum_hospital_code=a.gnum_hospital_code and gnum_isvalid=1 and sblnum_service_id=1)::character varying),1,BILL_MST.GETCHARGEDETAILS (10::character varying,a.gnum_hospital_code::character varying,hipnum_wardcode_reqd::character varying,hgnum_patient_cat_code_reqd::character varying,decode(hbnum_requisition_type_reqd,2,'2','1')::character varying,(select hblnum_tariff_id from hblt_tariff_mst where gstr_tariff_id=(a.gnum_lab_code||''||a.hgnum_group_code)  and gnum_hospital_code=a.gnum_hospital_code and gnum_isvalid=1 and sblnum_service_id=4)::character varying)) as testRateDetail, Bill_Interface.func_online_bill_dtl (a.gnum_hospital_code::character varying, DECODE (NVL(a.HGNUM_GROUP_TYPE,11), NULL, a.gnum_test_code,11, a.gnum_test_code, 1,a.gnum_lab_code||a.HGNUM_GROUP_CODE, 2, a.gnum_lab_code||a.HGNUM_GROUP_CODE, 3, a.gnum_test_code)::character VARYING, DECODE (DECODE (HBNUM_REQUISITION_TYPE_reqd,2, '1', 1, '2','3' ), 1, 2, 2, 1, 3, 1 )::character varying, DECODE (NVL(a.HGNUM_GROUP_TYPE,11), 0, 1,NULL,1,11,1, 1, 4, 2, 4, 3, 1 )::character varying, (a.HIVNUM_REQ_NO||'!')::CHARACTER VARYING) as billDetail ,concatstring( 'Select k.hivnum_parameter_code||''#''|| (select INITCAP(hgstr_parameter) from hivt_parameter_mst where gnum_isvalid=1 and hgnum_parameter_id=k.hivnum_parameter_code)||''#''||k.hivtstr_value from hivt_parameter_dtl k where k.gnum_isvalid=1 and k.hivtnum_test_code = '''||a.gnum_test_code ||''' and k.hivtnum_req_dno='''|| a.hivtnum_req_dno ||''' and k.gnum_hospital_code=''' || a.gnum_hospital_code||'''' , ',' ) AS testParameterName FROM hivt_requisition_dtl a WHERE a.gnum_test_code IN ( SELECT gnum_test_code FROM hivt_test_mst WHERE gnum_isvalid = 1 AND gstr_test_type = 'P' ) AND a.hrgnum_puk_reqd = ? AND gnum_hospital_code = ?  and hivnum_reqdtl_status  in (2) and hivnum_req_no=?  ORDER BY hivdt_requisition_date_reqd DESC, groupName, a.hivnum_temp_sample_no DESC 


#Added By chandan
SELECT_INV_TRACKING_REPORT_TESTPARAM_ONCRNO_HIVT_REQUISITION_DTL_REPORTS_GENE= SELECT hivnum_req_no AS requisitionNo, hivtnum_req_dno requisitionDNo, a.gnum_test_code AS testCode ,( SELECT b.gstr_test_name FROM hivt_test_mst b WHERE b.gnum_isvalid = 1 AND b.gnum_test_code = a.gnum_test_code ) AS testName ,hgnum_group_code AS groupCode ,decode(hgnum_group_code, NULL, '', pkg_inv_fun.getgroupname(a.hgnum_group_code::CHARACTER VARYING, a.gnum_hospital_code)) AS groupName ,TO_CHAR(a.hivdt_requisition_date_reqd, 'DD-Mon-YYYY hh24:mi') AS requisitionDate ,DECODE(a.hivnum_reqdtl_status, 2, 'Requisition Raised', 3, 'Sample Collected', 4, 'Packing List Generated', 5, 'Requisition Raised', 6, 'Sample Accepted', 7, 'Result Entered', 8, 'Result Validated', 9, 'Patient Rejected', 10, 'Test Resceduled', 11, 'Test Rescheduled', 12, 'Sample Cancelled', 13, 'Waiting For Report', 14, 'Result Printed', 15, 'Test Cancelled', 16, 'Test Deleted', 26, 'Report Generated', 55, 'Test Advised', 17, 'Machine Processing', 18, 'Machine Processing', 27, ' Draft- Result Entry', 28, 'Draft-Result Validation') AS requisitionStatus ,hivnum_reqdtl_status AS requisitionStatusCode ,a.hivnum_temp_sample_no AS sampleNo ,( SELECT gstr_Sample_name FROM hivt_sample_mst WHERE gnum_isvalid = 1 AND gnum_sample_code = a.gnum_sample_code ) AS sampleName , hgstr_daily_labno AS accessionNo ,( SELECT hmistr_machine_name FROM hmit_machine_mst WHERE gnum_isvalid = 1 AND hminum_machine_id = a.gnum_machine_code AND gnum_hospital_code = a.gnum_hospital_code ) AS machineName, TO_CHAR(hivdt_result_date, 'DD-Mon-YYYY hh24:mi') resultEntryDate ,TO_CHAR(hivtdt_res_val_date, 'DD-Mon-YYYY hh24:mi') resultValDate ,TO_CHAR(hivtdt_res_reval_date, 'DD-Mon-YYYY hh24:mi') resultValidDate ,TO_CHAR(hivdt_reportchange_date, 'DD-Mon-YYYY hh24:mi') reportChangeDate ,NVL(hgnum_group_type,'0') AS isGroup ,concatstring('Select k.hivnum_parameter_code||''#''|| (select INITCAP(hgstr_parameter) from hivt_parameter_mst where gnum_isvalid=1 and hgnum_parameter_id=k.hivnum_parameter_code)||''#''||k.hivtstr_value ||''#''||nvl(hivstr_referencerange,'''')||''#''||nvl(hivt_isinrefrange,''0'') from hivt_parameter_dtl k where k.gnum_isvalid=1 and k.hivtnum_test_code = ''' || a.gnum_test_code || ''' and k.hivtnum_req_dno=''' || a.hivtnum_req_dno || ''' and k.gnum_hospital_code=''' || a.gnum_hospital_code || '''', ',') AS testParameterDetails FROM hivt_requisition_dtl a WHERE a.hrgnum_puk_reqd = ? AND gnum_hospital_code = ? and hivnum_reqdtl_status  in (16,12,9,14,26) and hivnum_req_no=? ORDER BY hivdt_requisition_date_reqd desc, testCode,groupCode ,a.hivnum_temp_sample_no DESC

#Added By chandan
SELECT_INV_TRACKING_REPORT_TESTPARAM_ONCRNO_HIVT_REQUISITION_DTL_REPORTS_GENE1= SELECT hivnum_req_no AS requisitionNo, hivtnum_req_dno requisitionDNo, a.gnum_test_code AS testCode ,( SELECT b.gstr_test_name FROM hivt_test_mst b WHERE b.gnum_isvalid = 1 AND b.gnum_test_code = a.gnum_test_code ) AS testName ,hgnum_group_code AS groupCode ,decode(hgnum_group_code, NULL, '', pkg_inv_fun.getgroupname(a.hgnum_group_code::CHARACTER VARYING, a.gnum_hospital_code)) AS groupName ,TO_CHAR(a.hivdt_requisition_date_reqd, 'DD-Mon-YYYY hh24:mi') AS requisitionDate ,DECODE(a.hivnum_reqdtl_status, 2, 'Requisition Raised', 3, 'Sample Collected', 4, 'Packing List Generated', 5, 'Requisition Raised', 6, 'Sample Accepted', 7, 'Result Entered', 8, 'Result Validated', 9, 'Patient Rejected', 10, 'Test Resceduled', 11, 'Test Rescheduled', 12, 'Sample Cancelled', 13, 'Waiting For Report', 14, 'Result Printed', 15, 'Test Cancelled', 16, 'Test Deleted', 26, 'Report Generated', 55, 'Test Advised', 17, 'Machine Processing', 18, 'Machine Processing', 27, ' Draft- Result Entry', 28, 'Draft-Result Validation') AS requisitionStatus ,hivnum_reqdtl_status AS requisitionStatusCode ,a.hivnum_temp_sample_no AS sampleNo ,( SELECT gstr_Sample_name FROM hivt_sample_mst WHERE gnum_isvalid = 1 AND gnum_sample_code = a.gnum_sample_code ) AS sampleName , hgstr_daily_labno AS accessionNo ,( SELECT hmistr_machine_name FROM hmit_machine_mst WHERE gnum_isvalid = 1 AND hminum_machine_id = a.gnum_machine_code AND gnum_hospital_code = a.gnum_hospital_code ) AS machineName, TO_CHAR(hivdt_result_date, 'DD-Mon-YYYY hh24:mi') resultEntryDate ,TO_CHAR(hivtdt_res_val_date, 'DD-Mon-YYYY hh24:mi') resultValDate ,TO_CHAR(hivtdt_res_reval_date, 'DD-Mon-YYYY hh24:mi') resultValidDate ,TO_CHAR(hivdt_reportchange_date, 'DD-Mon-YYYY hh24:mi') reportChangeDate ,NVL(hgnum_group_type,'0') AS isGroup ,concatstring('Select k.hivnum_parameter_code||''#''|| (select INITCAP(hgstr_parameter) from hivt_parameter_mst where gnum_isvalid=1 and hgnum_parameter_id=k.hivnum_parameter_code)||''#''||k.hivtstr_value ||''#''||nvl(hivstr_referencerange,'''')||''#''||nvl(hivt_isinrefrange,''0'') from hivt_parameter_dtl k where k.gnum_isvalid=1 and k.hivtnum_test_code = ''' || a.gnum_test_code || ''' and k.hivtnum_req_dno=''' || a.hivtnum_req_dno || ''' and k.gnum_hospital_code=''' || a.gnum_hospital_code || '''', ',') AS testParameterDetails FROM hivt_requisition_dtl a WHERE a.hrgnum_puk_reqd = ? AND gnum_hospital_code = ? and hivnum_reqdtl_status  in (2) and hivnum_req_no=? ORDER BY hivdt_requisition_date_reqd desc, testCode,groupCode ,a.hivnum_temp_sample_no DESC

